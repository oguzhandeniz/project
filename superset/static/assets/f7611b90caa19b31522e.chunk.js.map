{"version":3,"file":"f7611b90caa19b31522e.chunk.js","mappings":"sIAmBYA,E,yNAAZ,SAAYA,GACVA,EAAA,kBACAA,EAAA,qBACD,CAHD,CAAYA,IAAAA,EAAW,K,ICCXC,E,ubAAZ,SAAYA,GACVA,EAAAA,EAAA,iBACAA,EAAAA,EAAA,gBACD,CAHD,CAAYA,IAAAA,EAAW,K,gBCoBT,SAAUC,IAAa,SACnCC,EAAQ,OACRC,EAAM,QACNC,EAAO,cACPC,EAAa,cACbC,IAEA,MAAMC,GAAQC,EAAAA,EAAAA,UAAQ,KAAM,CAAGH,mBAAkB,CAACA,IAElD,OACEI,EAAAA,GAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;;;;QAINC,UAGFF,EAAAA,GAAAA,IAACG,EAAAA,EAAU,CACTC,sBAAoB,EACpBC,UAAWZ,EAASa,SACpBC,iBAAe,EACfC,WAAYb,EACZF,SAAUA,EACVgB,YAAaf,EACbI,MAAOA,EACPD,cAAeA,EACfa,OAAO,OACPC,MAAM,UAId,C,4BCpCA,MAAMC,IAAiBC,EAAAA,EAAAA,IAAOC,EAAAA,GAAeC,KAG3C;IACE,EAAGC,QAAOC,cAAaC,cAAejB,EAAAA,EAAG;cAC/BgB,EAAc,UAAY;aAC3BD,EAAMG,OAAOC,UAAUC;gCACJL,EAAMM;;eAEvBN,EAAMG,OAAOC,UAAUG;;;eAGvBN,EAAcD,EAAMG,OAAOC,UAAUG,MAAQ;;kBAE1CL,EAAW,SAAW;;6BC5BxC,MAEMM,GAAsBX,EAAAA,GAAOY,GAAG;IAClC,EAAGT,WAAYf,EAAAA,EAAG;;gBAEY,GAAjBe,EAAMU;;;ECqCjBC,GAAkC,gBAMlCC,GAAcA,EAAGnC,WAAUoC,iBAC/B,MAAMC,GAAWC,EAAAA,EAAAA,OACX,eAAEC,IAAmBC,EAAAA,EAAAA,MACrBjB,GAAQkB,EAAAA,EAAAA,OACPC,EAAKC,IAAUC,EAAAA,EAAAA,UAAS,IACzBC,GAAkBC,EAAAA,EAAAA,YAAWC,GAAAA,wBAC7BC,GAAmBC,EAAAA,EAAAA,cAAY,KACnCZ,GACEa,EAAAA,EAAAA,UAASC,EAAAA,GAAiC,CACxCC,SAAUpD,EAASoD,WAEtB,GACA,CAACf,EAAUrC,EAASoD,WACjBC,GAAaC,EAAAA,EAAAA,KAAaC,IAAgB,IAAAC,EAAA,OAC9CC,EAAAA,EAAAA,GAAe,cAAe,WAAsB,OAAZD,EAAED,EAAMG,WAAI,EAAVF,EAAYG,MAAM,KAGvDC,EAAeC,GAAmB7D,EAASe,WAAW+C,MAAM,OACnEC,EAAAA,EAAAA,YAAU,MACRC,EAAAA,GAAAA,IAAaC,OAAOL,GAAgBC,EAAiB7D,EAAU,GAC5DkE,MAAKC,IACJxB,EACE,2BAA2BwB,uBAAyBtB,IACrD,IAEFuB,OAAM,KACL7B,GAAe8B,EAAAA,EAAAA,GAAE,qCAAqC,GACtD,GACH,CACD9B,EACAM,EACAe,EACAC,EACA7D,IAEF,MAAMsE,GAAkB5B,IAAQW,EAEhC,OACEkB,EAAAA,GAAAA,IAAAC,GAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,GAAAA,IAACkE,GAAAA,EAAM,CACLC,YAAY,YACZC,WAAW,QACXC,QAAS5B,EACT6B,SAAUP,EACVQ,QACER,GACID,EAAAA,EAAAA,GAAE,iEACFU,EACLtE,UAEDF,EAAAA,GAAAA,IAACyE,GAAAA,GAAI,CACHxE,IAAKA,EAAAA,EAAG;;;;YAKRyE,GAAIvC,EAAIjC,UAEP4D,EAAAA,EAAAA,GAAE,mBAIP9D,EAAAA,GAAAA,IAACkE,GAAAA,EAAM,CACLC,YAAY,UACZC,WAAW,QACXC,QAASxC,EAET5B,IAAKA,EAAAA,EAAG;yBAC0B,EAAjBe,EAAMU;UACrBxB,UAED4D,EAAAA,EAAAA,GAAE,aAEJ,EAeO,SAAUa,IAAa,OACnCC,EAAM,QACNjF,EAAO,cACPkF,EAAa,SACbpF,EAAQ,YACRqF,EAAW,YACXC,IAEA,MAAMjD,GAAWC,EAAAA,EAAAA,MACXf,GAAQkB,EAAAA,EAAAA,OACR,eAAEF,IAAmBC,EAAAA,EAAAA,OACpB+C,EAAoBC,IAAyB5C,EAAAA,EAAAA,WAAS,IAEtD6C,EAAgBC,IAAqB9C,EAAAA,EAAAA,UAAyB,CACnE,IAAKwC,EAAeD,aAGtBpB,EAAAA,EAAAA,YAAU,KACR1B,GACEa,EAAAA,EAAAA,UAASyC,EAAAA,GAAmC,CAC1CvC,SAAUpD,EAASoD,WAEtB,GACA,CAACf,EAAUrC,EAASoD,WAEvB,MACE+B,OAAQS,EAAa,iBACrBC,EAAmBT,EAAcS,kBAC/BJ,EAAeA,EAAeK,OAAS,IAAM,CAAC,EAE5CC,GAAwBzF,EAAAA,EAAAA,UAC5B,KACE0F,EAAAA,EAAAA,GAAchG,EAAS6F,IACpBI,KACCC,IAAO,IAAAC,EAAA,OAAmB,OAAnBA,EAAIjG,EAAQkG,cAAO,EAAfD,EAAiBE,MAAKC,GAAOA,EAAIC,cAAgBL,GAAQ,IAErEM,OAAOC,GAAAA,IACZ,CAACvG,EAAQkG,QAASpG,EAAU6F,KAGxB,kBAAEa,EAAiB,mBAAEC,GC9KOC,MAClC,MAAOD,EAAoBE,IAAyBjE,EAAAA,EAAAA,UAClD9C,EAAYgH,OAuCd,MAAO,CAAEJ,mBApCiBpG,EAAAA,EAAAA,UACxB,KACEC,EAAAA,GAAAA,IAAA,OACEC,IAAMe,GAAyBf,EAAAA,EAAG;2BACE,EAAjBe,EAAMU;;;;;;UAMvBxB,UAGF8D,EAAAA,GAAAA,IAACwC,GAAAA,EAAMC,MAAK,CACVC,SAAUA,EAAGC,QAAUC,aACrBN,EAAsBM,EAAM,EAE9BC,aAActH,EAAYgH,MAAMrG,SAAA,EAEhCF,EAAAA,GAAAA,IAACwG,GAAAA,EAAMtC,OAAM,CACX0C,MAAOrH,EAAYgH,MAAMrG,UAGxB4D,EAAAA,EAAAA,GAAE,YAEL9D,EAAAA,GAAAA,IAACwG,GAAAA,EAAMtC,OAAM,CACX0C,MAAOrH,EAAYuH,MAAM5G,UAGxB4D,EAAAA,EAAAA,GAAE,iBAKX,IAE0BsC,qBAAoB,EDqIEC,IAC3CU,EAAiBC,IAAsB3E,EAAAA,EAAAA,YAExC4E,EDzK2BC,EACjCH,EACAI,EACApC,KAEKmB,EAAAA,GAAAA,GAAUa,GAGgB,IAA3BA,EAAgBxB,QAEhBvF,EAAAA,GAAAA,IAACwB,GAAmB,CAAAtB,UAClBF,EAAAA,GAAAA,IAACoH,GAAAA,EAAqB,CACpBC,SAAUN,EAAgB,GAAGM,SAC7BC,SAAUP,EAAgB,GAAGO,SAC7BC,SAAUR,EAAgB,GAAGS,aAC7BC,KAAMV,EAAgB,GAAGU,KACzBC,SA1BQ,GA2BRP,aAAcA,EACdQ,WAAS,EACT5C,YAAaA,OAMnB/E,EAAAA,GAAAA,IAAC4H,GAAAA,GAAI,CAACC,WAAW,EAAM3H,SACpB6G,EAAgBrB,KAAI,CAACoC,EAAKC,KACzB/H,EAAAA,GAAAA,IAAC4H,GAAAA,GAAKI,QAAO,CAACC,KAAKnE,EAAAA,EAAAA,GAAE,aAAciE,EAAQ,GAAG7H,UAC5CF,EAAAA,GAAAA,IAACwB,GAAmB,CAAAtB,UAClBF,EAAAA,GAAAA,IAACoH,GAAAA,EAAqB,CACpBC,SAAUS,EAAIT,SACdC,SAAUQ,EAAIR,SACdG,KAAMK,EAAIL,KACVF,SAAUO,EAAIN,aACdE,SA5CI,GA6CJP,aAAcA,EACdQ,WAAS,EACT5C,YAAaA,OAViCgD,QArBjD/H,EAAAA,GAAAA,IAAA,UCmKYkH,CACnBH,EACAtH,EAASe,WACTuE,IAGKmD,EAAiBC,IAAsB9F,EAAAA,EAAAA,UAAS5C,IAChD2I,EAAoBC,IAAyBhG,EAAAA,EAAAA,UAClD,IAAImD,EAAuBZ,GAAQqB,OAAOC,GAAAA,KAErCoC,EAAiBC,IAAsBlG,EAAAA,EAAAA,UAA8B,CAC1E,CAAEmG,QAAShD,EAAuBiD,QAAS5D,EAAc4D,SACzD,CAAED,QAAS5D,GAAU,MAGjB8D,GAAgBhG,EAAAA,EAAAA,cACpB,CAACiG,EAAoBC,EAAYtD,IAC/BuD,MAAMC,QAAQrJ,EAASmJ,IACnB,CAACD,EAAW3C,aACZ2C,EAAW3C,aACjB,CAACvG,EAAU6F,IAGPyD,GAAgCrG,EAAAA,EAAAA,cACnCsG,GACCA,EAAQC,QACN,CAACC,EAAKC,KACM,MAANA,GAAAA,EAAQ7D,kBAAoB6D,EAAOvE,SACrCsE,EAAIzJ,SAAS0J,EAAO7D,kBAAoBoD,EACtCS,EAAOvE,OACPuE,EAAO7D,kBAET4D,EAAIE,uBAAuBC,IAAIF,EAAO7D,mBAExC,MAAMgE,GACE,MAANH,OAAM,EAANA,EAAQG,uBAAwB3H,GASlC,OARAuH,EAAIzJ,SAAS6J,GAAwB,KAChC7D,EAAAA,EAAAA,GAAcyD,EAAII,QAClB7D,EAAAA,EAAAA,GAAc0D,EAAOV,SAAS/C,KAAIO,IACnCsD,EAAAA,GAAAA,GAAoBtD,MAGxBiD,EAAIM,2BAA2BH,IAAIC,GAE5BJ,CAAG,GAEZ,CACEzJ,SAAU,CAAC,EACX2J,uBAAwB,IAAIK,IAC5BD,2BAA4B,IAAIC,OAGtC,CAACf,IAGGgB,GAAmChH,EAAAA,EAAAA,cACvC,IACEwC,EAAe+D,QAAO,CAACC,EAAKC,KAC1B,MAAMG,EACJH,EAAOG,sBAAwB3H,GAKjC,OAJAuH,EAAII,GAAwB,IACtBJ,EAAII,IAAyB,MAC9BH,EAAOV,QAAQ/C,KAAIO,IAAUsD,EAAAA,GAAAA,GAAoBtD,MAE/CiD,CAAG,GACT,CAAC,IACN,CAAChE,IA2CGyE,EFhQ6BC,EACnCtB,EACAuB,EAGYC,GAAAA,MAEZ/J,EAAAA,EAAAA,UAAQ,KAEN,MAAMkB,EAAe8G,GAAkBA,EAAQO,EAAgB/C,OAAS,EAIlEwE,EAAqBC,GACzB,IAAGvE,EAAAA,EAAAA,GAAcuE,EAAWxB,SACzB9C,KAAId,GAAUA,EAAOqF,cAAgBrF,EAAOoB,cAC5CkE,KAAK,SACNF,EAAWvB,QACP,IAAIuB,EAAWvB,QACZ/C,KAAIO,GAAUA,EAAOkE,cAAgBlE,EAAOmE,MAC5CF,KAAK,SACR,KAER,OACElK,EAAAA,GAAAA,IAACc,EAAAA,GAAc,CACbb,IAAMe,GAAyBf,EAAAA,EAAG;oBACL,EAAjBe,EAAMU,gBAAqC,EAAjBV,EAAMU;UAC1CxB,SAEDoI,EACE5C,KAAI,CAACsE,EAAYjC,KAChB/H,SAAAA,GAAAA,IAACY,GAAc,CAEbK,YAAaA,EAAY8G,GACzB7G,UAxBQmJ,EAwBWL,EAvBiB,KAA5CvE,EAAAA,EAAAA,GAAc4E,EAAU7B,SAASjD,QACW,KAA5CE,EAAAA,EAAAA,GAAc4E,EAAU5B,SAASlD,QAuBzBlB,QACEpD,EAAY8G,GACR,IAAM8B,EAAkBG,EAAYjC,GACpC+B,GAAAA,GACL5J,SAGA6J,EAAkBC,IAVdjC,GAtBE7G,IAACmJ,CAkCX,IACApE,QAAOqE,IAAgC,IAAxBA,EAAKC,MAAMrJ,YACd,GAElB,CAACoH,EAAiBuB,IEgNDD,CAAsBtB,GAxChB5F,EAAAA,EAAAA,cACxB,CAACsH,EAA+BjC,KAC9BjG,GACEa,EAAAA,EAAAA,UAAS6H,EAAAA,GAAyC,CAChD3H,SAAUpD,EAASoD,YAGvBsC,GAAkBsF,GAAeA,EAAYC,MAAM,EAAG3C,KACtDQ,GAAmBoC,IACjB,MAAMC,EAAiBD,EAAgBD,MAAM,EAAG3C,EAAQ,GAExD,cADO6C,EAAeA,EAAerF,OAAS,GAAGkD,QAC1CmC,CAAc,IAEvBvC,GAAsBwC,GACpBA,EAAuBH,MAAM,EAAG3C,KAElCI,GAAmB,KACjB,GAAc,IAAVJ,EACF,OAAOtI,EAET,MAAQA,SAAUqL,EAAgB,2BAAEtB,GAClCT,EAA8B7D,EAAewF,MAAM,EAAG3C,IAElDgD,EAAc,IACftL,KACAqL,GASL,OAPAtB,EAA2BwB,SAAQC,IAAgB,IAC9CF,EACH,CAACE,GAAmB,IACfxL,EAASwL,MACTH,EAAiBG,QAGjBF,CAAW,GAClB,GAEJ,CAACjJ,EAAUoD,EAAgBzF,EAAUsJ,KAKjCmC,GAAkBnL,EAAAA,EAAAA,UAAQ,KAC9B,IAAIoL,EAAkB,IAAKjD,GACvB7C,GAAiBC,IACnB6F,EAAgB7F,GAAoBoD,EAAcrD,IAGpD,MAAM+F,EAAe1B,IAcrB,OAbA2B,OAAOC,KAAKF,GAAcJ,SAAQ1B,IAChC6B,EAAkB,IACbA,EACH,CAAC7B,GAAuB,KACnB7D,EAAAA,EAAAA,GAAchG,EAAS6J,OACvB8B,EAAa9B,IAEnB,IAGH6B,EAAgBtI,SAAW,SACpBsI,EAAgBI,kBAChBJ,EAAgBK,WAChBL,CAAe,GACrB,CACDjD,EACA7C,EACAC,EACAoE,EACAhB,EACAjJ,KAGF+D,EAAAA,EAAAA,YAAU,KACR6E,GAAsBoD,IACnBpG,GACDoG,EAASC,MACPC,GAAWA,EAAQ3F,cAAgBX,EAAcW,cAE/CyF,EACA,IAAIA,EAAUpG,IACnB,GACA,CAACA,IAEJ,MAAMuG,GAAclJ,EAAAA,EAAAA,cAClB,CACEmJ,EACAhH,KAEA/C,GACEa,EAAAA,EAAAA,UAASmJ,EAAAA,GAA8B,CACrCC,YAAa7G,EAAeK,OAAS,EACrC1C,SAAUpD,EAASoD,YAGvBsF,EAAmB+C,GACnB/F,GAAkBsF,GAAe,IAC5BA,EACH,IAAK5F,EAAeD,OAAQiH,MAE9BtD,GAAmBoC,IACjB,MAAMC,EAAiB,IAAID,EAAiB,CAAEnC,QAASqD,IAGvD,OAFAjB,EAAeA,EAAerF,OAAS,GAAGkD,QACxC5D,EAAc4D,QACTmC,CAAc,GACrB,GAEJ,CAAC9I,EAAUoD,EAAeK,OAAQ2F,EAAiBzL,EAASoD,WAGxDmJ,GAAmBjM,EAAAA,EAAAA,UACvB,KAAM,CACJkM,QAAS,CAAEC,gBAAiB9D,EAAoB+D,cAAc,MAEhE,CAAC/D,KAGG,YAAEgE,EAAW,cAAEvM,EAAa,cAAED,GEzWRyM,EAC5BC,EACA7M,EACAmM,EACAW,EACAP,KAMA,MAAMQ,GAAiBC,EAAAA,EAAAA,QAA4B,OAC5C5M,EAAe6M,IAAoBrK,EAAAA,EAAAA,WAAS,GAU7CsK,GAA4BjK,EAAAA,EAAAA,cAChC,IAAIkK,KACFF,GAAiB,GACN,MAAXd,GAAAA,KAAiBgB,EAAK,GAExB,CAAChB,IAGGiB,GAA0BnK,EAAAA,EAAAA,cAAY,KAC1CgK,GAAiB,EAAM,GACtB,IAuBH,MAAO,CAAEN,aArBWrM,EAAAA,EAAAA,UAClB,KACEC,EAAAA,GAAAA,IAAC8M,GAAgB,CACfC,IAAKP,EACLQ,GFoUJ,EEnUIvN,SAAUA,EACVmM,YAAae,EACbM,QAASJ,EACTN,eAAgBA,EAChBP,iBAAkBA,KAGtB,CACEA,EF2TF,EEzTEO,EACA9M,EACAoN,EACAF,IAGkB9M,gBAAeD,cA1CfA,CACpBsN,EACAC,EACA1E,KACE,IAAA2E,EACoB,OAAtBA,EAAAZ,EAAea,UAAfD,EAAwBE,KAAKJ,EAASC,EAAS1E,GAC/CiE,GAAiB,EAAK,EAoC4B,EFkTEL,CACpD,EACAnE,EACA0D,EACA2B,GAAgBC,QAChBxB,GAGIyB,GAAY1K,EAAAA,EAAAA,KAA2CC,IAC3D,MAAM0K,EAAkBrC,OAAOsC,OAAO3K,EAAM4K,gBAAgBC,SAAS/H,MACnEgI,IAAU,IAAAC,EAAA,OAAmB,OAAfA,EAAAD,EAAWE,WAAI,EAAfD,EAAiBzB,WAAY7M,EAASoD,QAAQ,IAE9D,OACiB,MAAf6K,OAAe,EAAfA,EAAiBM,KAAKC,qBAAoC,MAAfP,OAAe,EAAfA,EAAiBM,KAAKE,UAAS,KAI9E1K,EAAAA,EAAAA,YAAU,KACR,GAAI0H,EAAiB,CACnB,MAAOiD,IAAgBC,EAAAA,GAAAA,IAAiBlD,GACxCjG,GAAsB,GACtB+B,OAAmBxC,IACnB6J,EAAAA,EAAAA,qBAAoB,CAClB5O,SAAUyL,IAETvH,MAAK,EAAG2K,WAAUC,WACjBC,EAAAA,EAAAA,yBAAwBF,EAAUC,EAAMJ,KAEzCxK,MAAK8K,IACJzH,EAAmByH,EAAgB,IAEpC5K,OAAM,KACL7B,GAAe8B,EAAAA,EAAAA,GAAE,8BAA8B,IAEhD4K,SAAQ,KACPzJ,GAAsB,EAAM,G,IAGjC,CAACjD,EAAgBkJ,IACpB,MAAM,YAAEyD,IAAgBC,EAAAA,GAAAA,GAAsB,CAAEjP,YAEhD,OACEK,EAAAA,GAAAA,IAAC6O,GAAAA,QAAK,CACJ5O,IAAKA,EAAAA,EAAG;;;;QAKR6O,MAAI,EACJC,OAAmB,MAAXjK,EAAAA,EAAgB,IAAM,KAC9BkK,OAAOlL,EAAAA,EAAAA,GAAE,eAAgB2J,GACzBwB,QAAQjP,EAAAA,GAAAA,IAAC4B,GAAW,CAACnC,SAAUyL,IAC/BgE,YAAU,EACVC,WAAS,EACTC,gBAAiB,CACfC,UAA4B,IAAjBrO,EAAMU,SACjB4N,SAA2B,IAAjBtO,EAAMU,SAChB6N,YAAa,CACX5O,MAAO,OACPD,OAAQ,SAGZ8O,WAAS,EACTC,gBAAc,EACdC,cAAc,EAAMxP,UAEpB8D,EAAAA,GAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;;;UAINC,SAAA,CAEDyO,EACAhF,EACAxD,EACAnB,IAAsBhF,EAAAA,GAAAA,IAAC2P,EAAAA,EAAO,KAC7B3K,IAAuB+B,IACvB/G,EAAAA,GAAAA,IAAC4P,GAAAA,EAAK,CACJC,KAAK,QACLC,SAAShM,EAAAA,EAAAA,GAAE,+CAGdsC,IAAuB7G,EAAYgH,OAASQ,IAC3C/G,EAAAA,GAAAA,IAACR,GAAY,CACXG,QAASA,EACTF,SAAUyL,EACVxL,OAAQqH,EACRnH,cAAeA,EACfC,cAAeA,IAGlBuG,IAAuB7G,EAAYuH,OAClCC,GACAE,EACDmF,MAIT,C,gBGtaA,MAiBM2D,IAAqBC,EAAAA,EAAAA,KAAwBC,IAAI,wBAEjDC,GAAcC,IAAAA,OAAa,CAC/BtK,QAAS,CACP,aACA,oBACA,mBACA,wBACA,uBACA,uBACA,wBACA,uBACA,uBACA,sBACA,uBACA,qBAISuK,GAAmBA,EAC9BvL,gBACApF,WACA4Q,eAAe,EACfC,eAAe,EACf1E,cAAcA,SACdvH,UAAUA,SACV6H,kBACAC,gBAAe,EACfpH,cACAuI,UACGiD,MAEH,MAAMvP,GAAQkB,EAAAA,EAAAA,OACR,eAAEF,IAAmBC,EAAAA,EAAAA,OACpBuO,EAAkBC,IAAuBpO,EAAAA,EAAAA,WAAS,IAClDqO,EAAaC,IAAkBtO,EAAAA,EAAAA,UAAS,KACxC1C,EAASiR,IAAcvO,EAAAA,EAAAA,aACvBwD,EAASgL,IAAcxO,EAAAA,EAAAA,UAAmB,KAC1CyO,EAAWC,IAAgB1O,EAAAA,EAAAA,WAAS,IACpCgD,EAAe2L,IAAoB3O,EAAAA,EAAAA,YACpC0K,GAAMN,EAAAA,EAAAA,QAAkB,MACxBwE,EACJlB,IAAsBlK,EAAQN,OA1DI,GA2D9B2L,GAAkBxO,EAAAA,EAAAA,cACtB,CAACyO,EAAOvM,KACNP,EAAQ8M,GACRvF,EAAYhH,EAAQC,GACpBmM,EAAiBpM,GACbuH,GACF4E,GAAa,E,GAGjB,CAAClM,EAAeR,EAASuH,EAAaO,IAElCtK,GAAaa,EAAAA,EAAAA,cAAY,KAC7BqO,GAAa,EAAM,GAClB,KAEHvN,EAAAA,EAAAA,YAAU,KACG,IAAD4N,EAEHC,EAFH/D,EACS,OAAX8D,EAAArE,EAAIM,UAAJ+D,EAAaE,MAAMC,SAGR,OAAXF,EAAAtE,EAAIM,UAAJgE,EAAaG,SAAS,IACtBb,EAAe,I,GAEhB,CAACrD,IAEJ,MAAMmE,EAA0B,MAAb5M,OAAa,EAAbA,EAAeS,iBAE5BoM,GAA8B3R,EAAAA,EAAAA,UAClC,SAAA4R,EAAA,OAE2B,OAF3BA,GACEC,EAAAA,EAAAA,KACG3B,IAAIxQ,EAASa,gBAAS,EADzBqR,EAEIE,UAAU/L,MAAKgM,GAAYA,IAAaC,EAAAA,GAASvE,SAAQ,GAC/D,CAAC/N,EAASa,WAEN0R,ECvIqBC,CAACtS,IAC5B,MAAMuS,EAAc,CAAC,EAOrB,OANAzM,EAAAA,EAAAA,GAAqB,MAAP9F,OAAO,EAAPA,EAASkG,SAASmF,SAASpG,IACvCsN,EAAYtN,EAAOoB,aAAepB,EAAOqF,cAAgBrF,EAAOoB,WAAW,KAE7EP,EAAAA,EAAAA,GAAqB,MAAP9F,OAAO,EAAPA,EAASwS,SAASnH,SAASoH,IACvCF,EAAYE,EAAOC,aAAeD,EAAOnI,cAAgBmI,EAAOC,WAAW,IAEtEH,CAAW,ED+HCD,CAActS,IAEjC6D,EAAAA,EAAAA,YAAU,KAsCJkO,GAA+BD,GArCnCa,iBACE,MAAMC,EAAY7O,OAAOjE,EAASe,WAAW+C,MAAM,MAAM,IACzD,IAEE,IAAI+K,EADJmC,GAAoB,GAGlBnC,EADEyB,SACeA,GAAmBwC,EAAW9S,SAE9B+S,EAAAA,GAAAA,GAAkB,CACjCC,SAAU,mBAAmBF,OAAerC,OAGhD,MAAM,KAAE3B,GAASD,GACX,OAAE5O,GAAW6O,EACnBqC,EAAWlR,GACXmR,GACEpL,EAAAA,EAAAA,GAAc/F,EAAOmG,SAClBI,QAAOrB,GAAUA,EAAO4D,UACxBvC,QACCrB,IAAM,IAAA8N,EAAAC,EAAA,QACHlN,EAAAA,EAAAA,GACChG,EAAwC,OAAhCiT,EAAc,MAAb7N,OAAa,EAAbA,EAAeS,kBAAgBoN,EAAI,KAC5CE,SAAShO,EAAOoB,cAClBpB,EAAOoB,cAAgBvG,EAASoT,SACF,OADQF,GACtClN,EAAAA,EAAAA,GAAcyG,SAAgB,EAA9ByG,EAAgCG,OAC9BC,GAAeA,EAAY/M,cAAgBpB,EAAOoB,cACnD,I,CAGT,MAAOgN,GACPC,EAAAA,EAAQD,MAAMA,GACdE,GAAAA,EAAiBC,OAAO,mBAAmBZ,KAC3CvQ,GAAe8B,EAAAA,EAAAA,GAAE,0C,CACjB,QACA2M,GAAoB,E,CAExB,CAEE2C,E,GAED,CACDpR,EACa,MAAb6C,OAAa,EAAbA,EAAeS,iBACf4G,EACAzM,EACAiS,EACAD,IAGF,MAAM4B,EAAcC,KACjB1M,GAAkB+J,EAAe/J,IAClC2M,EAAAA,GAGIC,GAAkBzT,EAAAA,EAAAA,UACtB,IACE8F,EAAQI,QAAOrB,IACZA,EAAOqF,cAAgBrF,EAAOoB,aAC5ByN,cACAb,SAASlC,EAAY+C,kBAE5B,CAAC5N,EAAS6K,IAGNgD,GAAiB3T,EAAAA,EAAAA,UACrB,KACE4T,EAAAA,EAAAA,IACEtD,EACAmD,EAAgBjO,QAAU,EAC1B+K,EAtKe,IAwKfW,EAtKoB,GAsKe,IAEvC,CAACZ,EAAcmD,EAAgBjO,OAAQ+K,EAAcW,IAGvD,IAAI1M,EAQJ,OANKmN,EAEOD,IACVlN,GAAUT,EAAAA,EAAAA,GAAE,kDAFZS,GAAUT,EAAAA,EAAAA,GAAE,qDAKT4N,GAAgCD,GAoCnCzN,EAAAA,GAAAA,IAAAC,GAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,GAAAA,IAAC4T,EAAK,KAAAC,QAAO,CACX7E,OAAOlL,EAAAA,EAAAA,GAAE,YACTgQ,eAAe,wBACfC,YAAa,CAAC,EAAGL,MACbnD,EAAIrQ,UAER8D,EAAAA,GAAAA,IAAA,OAAA9D,SAAA,CACG+Q,IACCjR,EAAAA,GAAAA,IAACgU,EAAAA,GAAK,CACJjH,IAAKA,EACLkH,QACEjU,EAAAA,GAAAA,IAACkU,EAAAA,EAAMC,OAAM,CACXC,SAAS,IACTC,UAAWrT,EAAMG,OAAOC,UAAUC,SAGtCqF,SAAU4N,IACRA,EAAEC,kBACFlB,EAAYiB,EAAE3N,OAAOC,MAAM,EAE7B4N,aAAa1Q,EAAAA,EAAAA,GAAE,kBACfO,QAASiQ,IAEPA,EAAEG,YAAYC,0BAA0B,EAE1CC,YAAU,EACV1U,IAAKA,EAAAA,EAAG;;;0BAGqB,EAAjBe,EAAMU,cAAmC,EAAjBV,EAAMU;;kBAK7C8O,GACCxQ,EAAAA,GAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;2BACsB,EAAjBe,EAAMU;gBACjBxB,UAEFF,EAAAA,GAAAA,IAAC2P,EAAAA,EAAO,CAACiF,SAAS,sBAElBpB,EAAgBjO,QAClBvF,EAAAA,GAAAA,IAAC6U,EAAAA,GAAI,CACHlU,MAAM,OACND,OAvQS,IAwQToU,SAAU,GACVC,UAAWvB,EAAgBjO,OAC3ByP,SAAU,CAAEnP,QAAS2N,KAAoBjD,GACzC0E,cAAe,GAAG/U,SA3ElBgV,EACVnN,QACAN,OACA0N,YAMA,MAAM,QAAEtP,KAAY0K,GAAS9I,EACvB7C,EAASiB,EAAQkC,GACvB,OACE/H,EAAAA,GAAAA,IAACoV,GAAAA,EAAsB,CAErBC,YAAazQ,EAAOqF,cAAgBrF,EAAOoB,eACvCuK,EACJlM,QAASiQ,GAAKpD,EAAgBoD,EAAG1P,GACjCuQ,MAAOA,EAAMjV,SAEZ0E,EAAOqF,cAAgBrF,EAAOoB,aAN1B,iBAAiBpB,EAAOoB,cAON,KA4DnBhG,EAAAA,GAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAACuD,UAAQ,KAAqCiM,EAAIrQ,UACzD4D,EAAAA,EAAAA,GAAE,qBADmB,kCAM7BgN,IACC9Q,EAAAA,GAAAA,IAAC2E,GAAY,CACXC,OAAQS,EACRR,cAAeA,EACfpF,SAAUA,EACVqF,YAAajD,EACblC,QAAS,IAAKA,EAAUuS,YAAaF,GACrCjN,YAAaA,QAtGjB/E,EAAAA,GAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAAyBuD,UAAQ,KAAKiM,EAAIrQ,UAClD8D,EAAAA,GAAAA,IAAA,OAAA9D,SAAA,EACG4D,EAAAA,EAAAA,GAAE,aACH9D,EAAAA,GAAAA,IAACsV,EAAAA,EAAe,CAACtG,MAAOzK,QAHb,oBAyGd,EE7SA,IAAKgJ,IAAZ,SAAYA,GACVA,EAAAA,EAAA,6BACAA,EAAAA,EAAA,iCACAA,EAAAA,EAAA,qBACAA,EAAAA,EAAA,YACD,CALD,CAAYA,KAAAA,GAAe,KA2B3B,MAAMT,GAAmBA,EAErBE,KACAvN,WACAmM,cACAqB,UACAV,iBAAiBgB,GAAgBgI,IACjCvJ,oBAEFe,KACE,IAAA4E,EAAA6D,EACF,MAAMxU,GAAQkB,EAAAA,EAAAA,MACRJ,GAAWC,EAAAA,EAAAA,MACXe,GAAaC,EAAAA,EAAAA,KAAaC,IAAgB,IAAAC,EAAA,OAC9CC,EAAAA,EAAAA,GAAe,cAAe,WAAsB,OAAZD,EAAED,EAAMG,WAAI,EAAVF,EAAYG,MAAM,IAExDqS,GAA0B1S,EAAAA,EAAAA,KAAaC,IAAgB,IAAA0S,EAAA,OAC3DxS,EAAAA,EAAAA,GAAe,YAAa,yBAAoC,OAAZwS,EAAE1S,EAAMG,WAAI,EAAVuS,EAAYtS,MAAM,IAEpEuS,GAAuB5S,EAAAA,EAAAA,KAAaC,IAAgB,IAAA4S,EAAA,OACxD1S,EAAAA,EAAAA,GAAe,cAAe,aAAwB,OAAZ0S,EAAE5S,EAAMG,WAAI,EAAVyS,EAAYxS,MAAM,IAE1D2B,GAAchC,EAAAA,EAAAA,KAAaC,IAAgB,IAAA6S,EAAA,OAC/C3S,EAAAA,EAAAA,GAAe,UAAW,WAAsB,OAAZ2S,EAAE7S,EAAMG,WAAI,EAAV0S,EAAYzS,MAAM,IAEpD0S,GAAW/S,EAAAA,EAAAA,KAAaC,IAAgB,IAAA+S,EAAA,OAC5C7S,EAAAA,EAAAA,GAAe,YAAa,YAAuB,OAAZ6S,EAAE/S,EAAMG,WAAI,EAAV4S,EAAY3S,MAAM,IAEvD4S,GAAclT,GAAcgT,IAAaL,EACzCQ,GAAoBnT,GAAcgT,IAAaH,EAC/CO,GAAsBnT,EAAAA,EAAAA,KAC1B,EAAGoT,mBAAoBA,EAAcD,uBAEhCE,EAAUC,IAAehU,EAAAA,EAAAA,UAAgB,IAE1CiU,EAAehM,GACnBiC,IAAmBgB,GAAgBgI,MACnC9P,EAAAA,EAAAA,GAAc8G,GAAgBqG,SAAStI,KAElC,QAAE7B,EAAO,QAAE8N,EAAO,QAAEC,GAAWC,IAAYpU,EAAAA,EAAAA,UAI/C,CAAEkU,QAAS,EAAGC,QAAS,KAEnBE,EAAkBC,IAAuBtU,EAAAA,EAAAA,WAAS,GAEnDuU,EAAY,GAEZC,GACJC,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYC,gBAC7Bf,GACAK,EAAY/I,GAAgByJ,eAExBC,GACJH,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYvJ,UAC7BwI,GACAM,EAAY/I,GAAgBC,SAExB0J,GACJJ,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYI,wBAC7Bb,EAAY/I,GAAgB6J,aAExBC,EACmB,OADa1F,GAAGC,EAAAA,EAAAA,KACtC3B,IAAIxQ,EAASa,YACH,OADYkV,EADgB7D,EAErCE,gBADqB,EADgB2D,EAE1B5C,SAASb,EAAAA,GAASuF,kBAEjC,IAAIC,EAAa,EAcjB,GAbIL,IACFK,GAAc,GAEZV,IACFU,GAAc,GAEZN,IACFM,GAAc,GAEG,IAAfA,IACFA,EAAa,GAGXL,EAAkB,CAAC,IAADM,EACpB,MAAMC,GACHJ,IACAnB,KACO,MAAPzN,GAAAA,EAASiP,aAEZ,IAAIC,EAAwC,KACvCF,EAaOvB,EAMAmB,EAQO,MAAP5O,GAAAA,EAASiP,cACnBC,GACE3X,EAAAA,GAAAA,IAAAiE,GAAAA,GAAA,CAAA/D,UACEF,EAAAA,GAAAA,IAAA,OAAAE,UAAM4D,EAAAA,EAAAA,GAAE,yDAVZ6T,GACE3X,EAAAA,GAAAA,IAAAiE,GAAAA,GAAA,CAAA/D,UACEF,EAAAA,GAAAA,IAAA,OAAAE,UACG4D,EAAAA,EAAAA,GAAE,iEATT6T,GACE3X,EAAAA,GAAAA,IAAAiE,GAAAA,GAAA,CAAA/D,UACEF,EAAAA,GAAAA,IAAA,OAAAE,UAAM4D,EAAAA,EAAAA,GAAE,0DAfZ6T,GACE3T,EAAAA,GAAAA,IAAAC,GAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,GAAAA,IAAA,OAAAE,UACG4D,EAAAA,EAAAA,GACC,+EAGJ9D,EAAAA,GAAAA,IAAA,OAAAE,UACG4D,EAAAA,EAAAA,GAAE,oEAyBX8S,EAAUgB,MACR5T,EAAAA,GAAAA,IAAAC,GAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,GAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAERuD,SAAUmT,EACVpT,QAASA,KACI,MAAPoE,GAAAA,EAASiP,aACX5V,GAAS+V,EAAAA,EAAAA,IAAe7K,EAAIvE,EAAQiP,YAAYI,U,EAElD5X,SAEM,MAAPuI,GAAoB,OAAb+O,EAAP/O,EAASiP,cAATF,EAAsBO,wBACrBjU,EAAAA,EAAAA,GAAE,wBAEFE,EAAAA,GAAAA,IAAA,OAAA9D,SAAA,EACG4D,EAAAA,EAAAA,GAAE,qBACH9D,EAAAA,GAAAA,IAACsV,EAAAA,EAAe,CACdtG,MAAO2I,EACPK,MACGP,OAEGjT,EADAxD,EAAMG,OAAOC,UAAU6W,WAjB/B,6BAwBLV,EAAa,IAAKvX,EAAAA,GAAAA,IAAC4T,EAAK,KAAAsE,QAAO,O,CAoBtC,GAhBIrB,GACFD,EAAUgB,MACR5X,EAAAA,GAAAA,IAACmY,EAAAA,EAAoB,CACnB7L,QAASU,EACTvN,SAAUA,EACVgJ,QAAgB,MAAPA,OAAO,EAAPA,EAAS2P,cAClBC,eAAa,EACbhI,aAAcmG,EACd5K,YAAaA,EACb0E,aAAc4G,EAAmB,EAAI,EACrCpG,UAAW4F,EACX3F,aAAc4F,MACO,MAAhB3K,OAAgB,EAAhBA,EAAkBoM,gBAAiB,CAAC,KAI3CnB,EAAa,CACf,IAAI3G,EAAe,EACf4G,IACF5G,GAAgB,GAEduG,IACFvG,GAAgB,GAElBsG,EAAUgB,MACR5X,EAAAA,GAAAA,IAACoQ,GAAgB,CACfvL,cAAsB,MAAP4D,OAAO,EAAPA,EAASwD,QACxBL,YAAaA,EACbnM,SAAUA,EACV4Q,aAAcmG,EACdlG,aAAcA,EACdvL,YAAaA,EACbuI,KAAM8I,EAASxD,SAAS,wBAEH,MAAhB5G,OAAgB,EAAhBA,EAAkBC,UAAW,CAAC,GAD/B,oB,CAMV,MAAMqB,GAAO5K,EAAAA,EAAAA,cACX,CAAC6T,EAAiBC,EAAiB/N,KAAgC,IAAA6P,EACjE,MAAMC,GAAYC,EAAAA,EAAAA,IAAiBhC,EAASe,GAC5Cd,EAAS,CACPF,UACAC,QAAS+B,EACT9P,YAO0C,OAA5C6P,EAAAG,SAASC,eAAe,eAAe1L,OAAvCsL,EAA8CK,OAAO,GAEvD,CAAC3L,EAAIuK,IAWP,OARAqB,EAAAA,EAAAA,qBACE7L,GACA,KAAM,CACJO,UAEF,CAACA,IAGIuL,EAAAA,cACL7Y,EAAAA,GAAAA,IAAC8Y,EAAAA,GAAQ,CACPC,SACE/Y,EAAAA,GAAAA,IAAC4T,EAAAA,KAAI,CACHoF,UAAU,qBAEVC,aAAc7C,IACZC,EAAYD,EAAS,EACrBlW,SAED0W,EAAUrR,OACTqR,GAEA5W,EAAAA,GAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAACuD,UAAQ,EAAApE,SAAC,iBAI1BgZ,QAAS,CAAC,SACVC,gBAAiBvS,IAAUA,GAASqG,IAAU/M,UAE9CF,EAAAA,GAAAA,IAAA,QACEgN,GAAI,eAAeA,IACnB/M,KAAGmZ,EAAAA,EAAAA,IAAE,CACHC,WAAY,SACZzE,SAAU,QACV0E,IAAK9C,EACL+C,KAAMhD,EACN5V,MAAO,EACPD,OAAQ,GACT,WAGL+X,SAASe,KACV,EAGH,IAAeC,EAAAA,EAAAA,YAAW3M,ICxSpB4M,GAAY,CAChBC,eAAgBC,IAAAA,OAChBC,QAASD,IAAAA,OACTtN,QAASsN,IAAAA,OAAiBE,WAC1BtZ,WAAYoZ,IAAAA,OACZG,cAAeH,IAAAA,OACfna,SAAUma,IAAAA,OAAiBE,WAC3BE,oBAAqBJ,IAAAA,OACrBK,YAAaL,IAAAA,OACbM,eAAgBN,IAAAA,OAChBlZ,OAAQkZ,IAAAA,OACRjZ,MAAOiZ,IAAAA,OACPO,gBAAiBP,IAAAA,KACjBQ,QAASR,IAAAA,OAAiBE,WAC1BO,cAAeT,IAAAA,KAEfU,WAAYV,IAAAA,OACZW,YAAaX,IAAAA,OACbnL,gBAAiBmL,IAAAA,QAAkBA,IAAAA,QACnCY,aAAcZ,IAAAA,KACda,aAAcb,IAAAA,KAEdc,UAAWd,IAAAA,KACXe,YAAaf,IAAAA,KACbgB,iBAAkBhB,IAAAA,KAClBiB,kBAAmBjB,IAAAA,KACnBkB,SAAUlB,IAAAA,OACVmB,mBAAoBnB,IAAAA,KACpBoB,OAAQpB,IAAAA,MAAgB,CAACta,EAAY2b,UAAW3b,EAAY4b,UAC5DC,iBAAkBvB,IAAAA,MAGdwB,GAAQ,CAAC,EAKTvJ,GAAY,CAACE,EAAAA,GAASuF,kBAEtB+D,GAAe,CACnBX,UAAWA,IAAMU,GACjBR,iBAAkBA,IAAMQ,GACxBP,kBAAmBA,IAAMO,GACzBrB,cAAeqB,GACfjB,eAAAA,GAAmB,EACnBE,eAAe,GAGjB,MAAMiB,WAAsBC,EAAAA,UAC1BC,WAAAA,CAAYjR,GACVkR,MAAMlR,GACNmR,KAAK1Y,MAAQ,CACX2Y,gBACEpR,EAAMyQ,SAAW1b,EAAY2b,aAC5BnE,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYC,iBAC5BF,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYI,wBACjCtX,eAAe,EACf+b,iBAAapX,GAEfkX,KAAKG,wBAAyB,EAE9BH,KAAKlP,gBAAiBsP,EAAAA,EAAAA,aAEtBJ,KAAKK,gBAAkBL,KAAKK,gBAAgBC,KAAKN,MACjDA,KAAKO,oBAAsBP,KAAKO,oBAAoBD,KAAKN,MACzDA,KAAKQ,oBAAsBR,KAAKQ,oBAAoBF,KAAKN,MACzDA,KAAKS,sBAAwBT,KAAKS,sBAAsBH,KAAKN,MAC7DA,KAAKU,oBAAsBV,KAAKU,oBAAoBJ,KAAKN,MACzDA,KAAK/O,0BAA4B+O,KAAK/O,0BAA0BqP,KAAKN,MACrEA,KAAK7O,wBAA0B6O,KAAK7O,wBAAwBmP,KAAKN,MACjEA,KAAKW,yBAA2BX,KAAKW,yBAAyBL,KAAKN,MACnEA,KAAKY,sBAAwBZ,KAAKY,sBAAsBN,KAAKN,MAE7DA,KAAK5b,MAAQ,CACXyc,YAAab,KAAKK,gBAClBnc,cAAe8b,KAAK1Y,MAAM2Y,gBACtBD,KAAKU,yBACL5X,EACJgY,QAASd,KAAKQ,oBACd/B,gBAAiBuB,KAAKS,sBACtBvB,iBAAkBc,KAAKnR,MAAMqQ,iBAC7BC,kBAAmBa,KAAKnR,MAAMsQ,kBAC9B4B,qBAAsBf,KAAKW,yBAC3B1B,YAAa7C,IAAa,IAAD4E,EACL,OAAlBA,EAAAhB,KAAKnR,MAAMsP,UAAX6C,EAAoB7E,eAAe6D,KAAKnR,MAAM+B,QAASwL,EAAS,GAOpE4D,KAAKiB,uBAAyBC,IAAUlB,KAAKnR,MAAMkE,gBACrD,CAEAoO,qBAAAA,CAAsBC,EAAWC,GAAY,IAADC,EAAAC,EAM1C,UAJEH,EAAUrO,iBACV,CAAC,UAAW,YAAYyO,QAAQJ,EAAUvC,cAAgB,IAChC,OAA1ByC,EAACF,EAAUrO,kBAAoB,OAALwO,EAAzBD,EAA4B,KAA5BC,EAAgCjK,UAG5BmK,IAAQzB,KAAK1Y,MAAO+Z,KAGzBrB,KAAKG,uBACHiB,EAAUrO,kBAAoBiN,KAAKnR,MAAMkE,gBAEvCiN,KAAKG,yBACPH,KAAKiB,uBAAyBC,IAAUE,EAAUrO,kBAIlDiN,KAAKG,yBACJsB,IAAQL,EAAUtc,WAAYkb,KAAKnR,MAAM/J,aAC1Csc,EAAUnD,iBAAmB+B,KAAKnR,MAAMoP,gBACxCmD,EAAUhC,WAAaY,KAAKnR,MAAMuQ,UAClCgC,EAAUM,cAAgB1B,KAAKnR,MAAM6S,aACrCN,EAAUpc,SAAWgb,KAAKnR,MAAM7J,QAChCoc,EAAUnc,QAAU+a,KAAKnR,MAAM5J,OAC/Bmc,EAAUzC,eACVyC,EAAU7C,cAAgByB,KAAKnR,MAAM0P,aACrC6C,EAAU5C,iBAAmBwB,KAAKnR,MAAM2P,gBACxC4C,EAAUrd,SAAS4d,eAAiB3B,KAAKnR,MAAM9K,SAAS4d,cACxDP,EAAUrd,SAAS6d,QAAU5B,KAAKnR,MAAM9K,SAAS6d,OACjDR,EAAUS,kBAAoB7B,KAAKnR,MAAMgT,iBACzCT,EAAU3B,mBAAqBO,KAAKnR,MAAM4Q,kBAIhD,CAEAY,eAAAA,CAAgBhW,EAAKyX,EAAMC,GAAQ,EAAMC,GAAU,GACjDhC,KAAKnR,MAAMmQ,UAAU3U,EAAKyX,EAAMC,EAAOC,EACzC,CAEAzB,mBAAAA,GACE,MAAM,QAAEpC,EAAO,YAAEU,EAAW,QAAEjO,EAAO,QAAE8N,GAAYsB,KAAKnR,MACpD,CAAC,UAAW,YAAY2S,QAAQ3C,GAAe,GACjDV,EAAQ8D,wBAAwBrR,GAK9BoP,KAAKG,wBACPhC,EAAQlX,SAASib,EAAAA,GAA0B,CACzC/a,SAAUyJ,EACVhM,SAAU8Z,EACVyD,aAAcnC,KAAKoC,gBACnBC,IAAI,IAAIC,MAAOC,UACfC,SAAUC,EAAAA,GAAOC,eAAiB1C,KAAKoC,iBAG7C,CAEA5B,mBAAAA,CAAoBlJ,EAAOqL,GACzB,MAAM,QAAExE,EAAO,QAAEvN,GAAYoP,KAAKnR,MAClC0I,EAAAA,EAAQqL,KAAKtL,GACb6G,EAAQ0E,qBACNvL,EAAMwL,WACNlS,EACA+R,EAAOA,EAAKI,eAAiB,MAI3B/C,KAAKG,wBACPhC,EAAQlX,SAASib,EAAAA,GAA0B,CACzC/a,SAAUyJ,EACVoS,SAAS,EACTC,cAAe3L,EAAMwL,WACrBX,aAAcnC,KAAKoC,gBACnBC,IAAI,IAAIC,MAAOC,UACfC,SAAUC,EAAAA,GAAOC,eAAiB1C,KAAKoC,iBAG7C,CAEA3B,qBAAAA,IAAyBvP,GACvB,MAAM,gBAAEuN,GAAoBuB,KAAKnR,MAC7B4P,GACFA,KAAmBvN,EAEvB,CAEAwP,mBAAAA,CAAoBlP,EAASC,EAAS1E,GACpCiT,KAAKlP,eAAea,QAAQC,KAAKJ,EAASC,EAAS1E,GACnDiT,KAAKjF,SAAS,CAAE5W,eAAe,GACjC,CAEA8M,yBAAAA,GACE+O,KAAKjF,SAAS,CAAE5W,eAAe,GACjC,CAEAgN,uBAAAA,GACE6O,KAAKjF,SAAS,CAAE5W,eAAe,GACjC,CAEAwc,wBAAAA,CAAyBT,GACvBF,KAAKjF,SAAS,CAAEmF,eAClB,CAIAU,qBAAAA,CAAsBnL,GACfuK,KAAK1Y,MAAMnD,gBACdsR,EAAMyN,iBACNlD,KAAKU,oBAAoBjL,EAAMoF,QAASpF,EAAMqF,SAElD,CAEAqI,MAAAA,GAAU,IAADlN,EAAAmN,EACP,MAAM,WAAExE,EAAU,YAAEC,EAAW,QAAEjO,EAAO,iBAAE6O,GAAqBO,KAAKnR,MAGpE,GAAoB,YAAhBgQ,GAA+BD,GAA8B,OAAhBC,EAC/C,OAAO,KAGTmB,KAAKoC,gBAAkBK,EAAAA,GAAOC,eAE9B,MAAM,MACJzd,EAAK,OACLD,EAAM,WACNF,EAAU,eACVmZ,EAAc,cACdI,EAAa,SACbe,EAAQ,YACRsC,EAAW,aACX3C,EAAY,SACZhb,EAAQ,oBACRua,EAAmB,mBACnBe,GACEW,KAAKnR,MAEHrC,EACJuS,GAAgBT,EAAsBA,EAAsBva,EACxD2a,EAAUlS,EAAgB5H,UAAYob,KAAKnR,MAAM6P,QAMjD2E,EAAmBC,IAAU5E,GAC7B6E,EACQ,UAAZ7E,EACI,kBAAkB2E,IAClBA,EAcN,IAAIG,EACJ,MAAMC,GAAgBrb,EAAAA,EAAAA,GAAE,2CAClBsb,EACJ1D,KAAKnR,MAAMyQ,SAAW1b,EAAY4b,SAC9BpX,EAAAA,EAAAA,GACE,yHAEFU,EACA6a,EAAgB,YAEpBH,EADEve,EA1OwB,KA0OWD,EAzOV,KA2OzBV,EAAAA,GAAAA,IAACsf,EAAAA,GAAa,CACZtQ,MAAOmQ,EACPI,YAAaH,EACbI,MAAOH,KAKTrf,EAAAA,GAAAA,IAACyf,EAAAA,GAAe,CAACzQ,MAAOmQ,EAAeK,MAAOH,IAMlD,MAAMK,EACmB,OADE/N,GAAAC,EAAAA,EAAAA,KACxB3B,IAAIxQ,EAASa,YADWqR,EAEvBE,UAAU/L,MAAKgM,GAAYA,IAAaC,EAAAA,GAASiF,gBACjD,CAAEnX,cAAe6b,KAAK1Y,MAAMnD,eAC5B,CAAC,EAEC8f,IACI,MAARlgB,GAAAA,EAAUmgB,qBAA8B,MAAR9E,GAAoB,OAAZgE,EAARhE,EAAU+E,iBAAF,EAARf,EAAsBvZ,SAAU,GAAK,GAGvE,OACEvB,EAAAA,GAAAA,IAAAC,GAAAA,GAAA,CAAA/D,SAAA,CACGwb,KAAK1Y,MAAM2Y,kBACV3b,EAAAA,GAAAA,IAAC8M,GAAgB,CACfC,IAAK2O,KAAKlP,eACVQ,GAAIV,EACJ7M,SAAUyI,EACV0D,YAAa8P,KAAK/O,0BAClBM,QAASyO,KAAK7O,2BAGlB7M,EAAAA,GAAAA,IAAA,OACEJ,cACE8b,KAAK1Y,MAAM2Y,gBAAkBD,KAAKY,2BAAwB9X,EAC3DtE,UAEDF,EAAAA,GAAAA,IAACG,EAAAA,EAAU,CACTC,sBAAoB,EAEpB4M,GAAI,YAAYV,IAChB0M,UAAWiG,EACX5e,UAAW+Z,EACXzZ,MAAOA,EACPD,OAAQA,EACRiZ,eAAgBA,EAChBnZ,WAAYA,EACZuZ,cAAeA,EACfta,SAAUyI,EACV4S,SAAUA,EACVsC,YAAaA,EACbtd,MAAO4b,KAAK5b,MACZ+R,UAAWA,GACXpR,YAAaib,KAAKiB,uBAClBmD,gBAAiBpE,KAAKO,oBACtB8D,gBAAiBrE,KAAKQ,oBACtB8D,UAAWd,EACXnE,mBAAoBA,EACpBI,iBAAkBA,EAClBS,YAAaF,KAAK1Y,MAAM4Y,YACxBrb,gBAAiBof,KACbD,GAtBC,GAAGpT,SA2BlB,EAGFgP,GAAc5B,UAAYA,GAC1B4B,GAAcD,aAAeA,GAE7B,Y,2BC5VO,MAAM4E,GAA+BA,EAAG3T,UAAS0G,WAAUzI,MAChE,MAAQ7K,OAAQwgB,IAAWC,EAAAA,GAAAA,IAAmB7T,GAGxC8T,EAAapN,GAAS,IACvBA,EACHqN,MAAO,IAAKrN,EAAMqN,MAAOH,WAG3B,OAAOlgB,EAAAA,GAAAA,IAACsgB,GAAAA,EAA0B,IAAK/V,EAAOyI,MAAOoN,GAAc,E,gBCCrE,MAAM1G,GAAY,CAChBC,eAAgBC,IAAAA,OAChBC,QAASD,IAAAA,OACTtN,QAASsN,IAAAA,OAAiBE,WAC1BtZ,WAAYoZ,IAAAA,OAEZ2G,YAAa3G,IAAAA,OAIbG,cAAeH,IAAAA,OAGfna,SAAUma,IAAAA,OAAiBE,WAC3BG,YAAaL,IAAAA,OACbM,eAAgBN,IAAAA,OAChBjZ,MAAOiZ,IAAAA,OACPlZ,OAAQkZ,IAAAA,OACRO,gBAAiBP,IAAAA,KACjB4G,QAAS5G,IAAAA,OACTQ,QAASR,IAAAA,OAAiBE,WAC1BO,cAAeT,IAAAA,KACf6G,MAAO7G,IAAAA,KACP8G,qBAAsB9G,IAAAA,KAEtBU,WAAYV,IAAAA,OACZW,YAAaX,IAAAA,OACb+G,gBAAiB/G,IAAAA,OACjBnL,gBAAiBmL,IAAAA,QAAkBA,IAAAA,QACnCY,aAAcZ,IAAAA,KACda,aAAcb,IAAAA,KACdgH,aAAchH,IAAAA,KAEdc,UAAWd,IAAAA,KACXiH,QAASjH,IAAAA,KACTgB,iBAAkBhB,IAAAA,KAClBiB,kBAAmBjB,IAAAA,KACnBkB,SAAUlB,IAAAA,OACVmB,mBAAoBnB,IAAAA,KACpBkH,eAAgBlH,IAAAA,MAAgB,CAAC,UAAW,QAAS,aACrDmH,SAAUnH,IAAAA,KACVuB,iBAAkBvB,IAAAA,MAGdwB,GAAQ,CAAC,EACT4F,IAAsBld,EAAAA,EAAAA,GAC1B,2DAGIuX,GAAe,CACnBX,UAAWA,IAAMU,GACjBR,iBAAkBA,IAAMQ,GACxBP,kBAAmBA,IAAMO,GACzBrB,cAAeqB,GACfjB,eAAAA,GAAmB,EACnBE,eAAe,EACfkG,YAAa,KACbI,gBAAiB,KACjBF,OAAO,EACPM,UAAU,GAGNE,GAASpgB,EAAAA,GAAOY,GAAG;gBACTyf,GAAKA,EAAExgB;;;;;;iBAMN,EAAGM,WAAYA,EAAMmgB,WAAWC,MAAMC;;;;;;;;cAQzCH,GAAKA,EAAExgB;;;;;;;gBAOL,EAAGM,WAA6B,EAAjBA,EAAMU;;;EAK/B4f,GAAazgB,EAAAA,GAAOY,GAAG;;;;;;EAQvB8f,GAAc1gB,EAAAA,GAAO2gB,IAAI;;YAEnB,EAAGxgB,WAA6B,EAAjBA,EAAMU;;WAEtB,EAAGV,WAAYA,EAAMG,OAAOC,UAAU6W;EAG3CwJ,GAAe5gB,EAAAA,GAAOY,GAAG;iBACd,EAAGT,WAAYA,EAAMmgB,WAAWO,SAASC;;;;EAM1D,MAAMpb,WAAcqb,EAAAA,cAClBpG,WAAAA,CAAYjR,GACVkR,MAAMlR,GACNmR,KAAKmG,6BACHnG,KAAKmG,6BAA6B7F,KAAKN,KAC3C,CAEAoG,iBAAAA,GACMpG,KAAKnR,MAAMiQ,cACbkB,KAAKqG,UAET,CAEAC,kBAAAA,GACMtG,KAAKnR,MAAMiQ,cACbkB,KAAKqG,UAET,CAEAA,QAAAA,GAEErG,KAAKnR,MAAMsP,QAAQoI,kBACjBvG,KAAKnR,MAAM9K,SACXyiB,QAAQxG,KAAKnR,MAAMkW,QAAS0B,EAAAA,EAAAA,IAAYC,EAAAA,GAAW3B,QACnD/E,KAAKnR,MAAMiW,QACX9E,KAAKnR,MAAM+B,QACXoP,KAAKnR,MAAMgW,YACX7E,KAAKnR,MAAMuQ,SAEf,CAEA+G,4BAAAA,CAA6B7O,EAAOqL,GAClC,MAAM,QAAExE,EAAO,QAAEvN,GAAYoP,KAAKnR,MAClC0I,EAAAA,EAAQqL,KAAKtL,GACb6G,EAAQ0E,qBACNvL,EAAMwL,WACNlS,EACA+R,EAAOA,EAAKI,eAAiB,MAG/B5E,EAAQlX,SAASib,EAAAA,GAA0B,CACzC/a,SAAUyJ,EACVoS,SAAS,EACTC,cAAe3L,EAAMwL,WACrBX,aAAcnC,KAAKoC,gBACnBC,IAAI,IAAIC,MAAOC,UACfC,SAAUC,EAAAA,GAAOC,eAAiB1C,KAAKoC,iBAE3C,CAEAuE,kBAAAA,CAAmBC,GAAgB,IAADC,EAChC,MAAM,QACJjW,EAAO,WACPgO,EAAU,gBACVqG,EAAe,WACfngB,EAAU,YACV+f,EAAW,OACX7f,EAAM,eACNogB,GACEpF,KAAKnR,MACHyI,EAAqB,MAAbsP,GAAqB,OAARC,EAAbD,EAAeE,aAAF,EAAbD,EAAwB,GAChCzS,EAAUwK,IAA2B,MAAbgI,OAAa,EAAbA,EAAexS,SAG7C,YACiBtL,IAAf8V,GACAA,IAAe0G,IACfxgB,IAAeiiB,EAAAA,IACf3B,IAAmB4B,EAAAA,GAAeC,OAGhC3iB,EAAAA,GAAAA,IAACihB,GAAM,CAEL,iBAAe,QACfjI,UAAU,kBAEVtY,OAAQA,EAAOR,UAEfF,EAAAA,GAAAA,IAAC2P,EAAAA,EAAO,KANHrD,IAYTtM,EAAAA,GAAAA,IAACigB,GAAiB,CAEhB3T,QAASA,EACT0G,MAAOA,EACP4P,UAAU5iB,EAAAA,GAAAA,IAACyhB,GAAY,CAAAvhB,SAAE4P,IACzB+S,SAAU/S,EACVgT,KAAMR,EAAgBA,EAAcQ,KAAO,KAC3C9H,OAAQuF,EAAcjhB,EAAY2b,UAAY3b,EAAY4b,QAC1D6H,WAAYpC,GAPPrU,EAUX,CAEA0W,aAAAA,CAAcC,GACZ,MAAMnT,EAAUmT,GACZnf,EAAAA,EAAAA,GAAE,gBAAiBmf,IACnBnf,EAAAA,EAAAA,GAAE,0BAEN,OACEE,EAAAA,GAAAA,IAACsd,GAAU,CAAAphB,SAAA,EACTF,EAAAA,GAAAA,IAAC2P,EAAAA,EAAO,CAACiF,SAAS,qBAClB5U,EAAAA,GAAAA,IAACuhB,GAAW,CAAArhB,SAAE4P,MAGpB,CAEAoT,oBAAAA,GACE,OACEljB,EAAAA,GAAAA,IAAA,OAAKgZ,UAAU,kBAAiB9Y,SAC7Bwb,KAAKnR,MAAMwW,YACXjK,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYoM,2BAC9BC,EAAAA,EAAAA,MACEpjB,EAAAA,GAAAA,IAACsb,GAAa,IACRI,KAAKnR,MACTyQ,OAAQU,KAAKnR,MAAMgW,YAAc,YAAc,aAIjDvgB,EAAAA,GAAAA,IAAC2P,EAAAA,EAAO,KAIhB,CAEAkP,MAAAA,GAAU,IAADwE,EACP,MAAM,OACJ3iB,EAAM,WACN4Z,EAAU,YACVC,EAAW,WACX/Z,EAAU,aACVogB,EAAY,aACZnG,EAAY,gBACZhM,EAAkB,GAAE,MACpB9N,GACE+a,KAAKnR,MACH0Y,EAAyB,MAAVziB,GAAoB,OAAV6iB,EAAV7iB,EAAY8iB,eAAF,EAAVD,EAAsBE,KAErCC,EAA4B,YAAhBjJ,EAElB,OADAmB,KAAK+H,yBAA2BtF,EAAAA,GAAOC,eACnB,WAAhB7D,EACK9L,EAAgB/I,KAAI4E,GAAQoR,KAAK2G,mBAAmB/X,KAGzDsW,GAA0D,KAA1Cnb,EAAAA,EAAAA,GAAcgJ,GAAiBlJ,QAE/CvF,EAAAA,GAAAA,IAACsf,EAAAA,GAAa,CACZtQ,OAAOlL,EAAAA,EAAAA,GAAE,gDACTyb,aAAamE,EAAAA,GAAAA,IAAqC,GAClDlE,MAAM,cAMTgE,GACAlJ,GACAsG,IACDnG,GAC0C,KAA1ChV,EAAAA,EAAAA,GAAcgJ,GAAiBlJ,QAsB/BvF,EAAAA,GAAAA,IAAC2jB,EAAAA,EAAa,CACZnH,QAASd,KAAKmG,6BACd+B,aAAa,EAAM1jB,UAEnBF,EAAAA,GAAAA,IAACihB,GAAM,CACL,iBAAe,QACfjI,UAAU,kBAEVtY,OAAQA,EACRC,MAAOA,EAAMT,SAEZsjB,EACG9H,KAAKsH,cAAcC,GACnBvH,KAAKwH,4BAhCXljB,EAAAA,GAAAA,IAACsf,EAAAA,GAAa,CACZtQ,OAAOlL,EAAAA,EAAAA,GAAE,8BACTyb,aACEvb,EAAAA,GAAAA,IAAA,QAAA9D,SAAA,EACG4D,EAAAA,EAAAA,GACC,iGACC,KACH9D,EAAAA,GAAAA,IAAA,QAAM6jB,KAAK,SAASC,SAAU,EAAGzf,QAASqX,KAAKnR,MAAMsW,QAAQ3gB,UAC1D4D,EAAAA,EAAAA,GAAE,gBACE,OAIX0b,MAAM,aAuBd,EAGFjZ,GAAMmT,UAAYA,GAClBnT,GAAM8U,aAAeA,GAErB,YCjUA,IAAe0I,EAAAA,EAAAA,IAAQ,MAbvB,SAA4BjiB,GAC1B,MAAO,CACL+X,SAASmK,EAAAA,EAAAA,IACP,IACKnK,EACHhC,eAAc,KACdlV,SAAQA,EAAAA,UAEVb,GAGN,GAEA,CAAiDyE,G,wECbjD,MAAM0d,EAAoB,IAAIC,EAAAA,IAAkBxe,KAC9Cye,GAAMC,EAAAA,GAA+BD,GAAIE,YAG5B,MAAMC,EACnB9I,WAAAA,CAAY+I,GAE2C,IAADC,EADpD9I,KAAK+I,eAAiBF,EAAYE,gBAAkBC,EAAAA,EAAgBC,OAChEjJ,KAAK+I,iBAAmBC,EAAAA,EAAgBC,QAC1CjJ,KAAKkJ,QAAUL,EAAYK,QAC3BlJ,KAAKmJ,SAA+B,OAAvBL,EAAGD,EAAYM,eAAQ,EAApBL,EAAsBM,cACtCpJ,KAAKqJ,WAAaR,EAAYQ,WAC9BrJ,KAAKsJ,WAAaT,EAAYS,WAE5B,CAACC,EAAAA,EAAUC,OAAQD,EAAAA,EAAUE,SAASjI,QAAQqH,EAAYQ,aAC1D,IAEArJ,KAAKsJ,WAAaT,EAAYQ,aAAeE,EAAAA,EAAUC,QAGvD,CAACD,EAAAA,EAAUG,OAAQH,EAAAA,EAAUI,WAAWnI,QACtCqH,EAAYQ,aACT,IAELrJ,KAAKsJ,WAAa,MAEpBtJ,KAAK4J,OAASf,EAAYe,QAAUC,EAAAA,EAAQC,MAC5C9J,KAAK+J,cAAgB,MACZ/J,KAAK+I,iBAAmBC,EAAAA,EAAgBgB,MACjDhK,KAAK+J,cACkC,iBAA9BlB,EAAYkB,cACflB,EAAYkB,eACZE,EAAAA,EAAAA,GAAepB,EAAa,CAAEqB,WAAW,IAC/ClK,KAAK4J,OAASf,EAAYe,OAExBf,EAAYM,UACZZ,EAAkB/G,QAAQqH,EAAYM,WAAa,GAEnDnJ,KAAKkJ,QAAUL,EAAYK,QAC3BlJ,KAAKmJ,SAAWN,EAAYM,SAC5BnJ,KAAKqJ,WAAaR,EAAYQ,aAE9BrJ,KAAKkJ,QAAU,KACflJ,KAAKmJ,SAAW,MAElBnJ,KAAKsJ,WAAa,MAEpBtJ,KAAKmK,UAAYtB,EAAYsB,QAC7BnK,KAAKoK,QAAUvB,EAAYuB,MAC3BpK,KAAKqK,oBAAsBxB,EAAYwB,kBAEvCrK,KAAKsK,iBACHzB,EAAYyB,kBACZ,UAAUC,KAAKC,SAAS1H,SAAS,IAAI2H,UAAU,EAAG,OAAOF,KAAKC,SAC3D1H,SAAS,IACT2H,UAAU,EAAG,KACpB,CAEAC,aAAAA,CAAcC,GACZ,OAAO,IAAI/B,EAAY,IAClB5I,KAEHoK,OAAO,KACJO,GAEP,CAEAC,MAAAA,CAAO/B,GACL,OACEA,EAAYe,SAAW5J,KAAK4J,QAC5Bf,EAAYE,iBAAmB/I,KAAK+I,gBACpCF,EAAYkB,gBAAkB/J,KAAK+J,eACnClB,EAAYM,WAAanJ,KAAKmJ,UAC9BN,EAAYQ,aAAerJ,KAAKqJ,YAChCR,EAAYS,aAAetJ,KAAKsJ,YAChCT,EAAYK,UAAYlJ,KAAKkJ,OAEjC,CAEA2B,OAAAA,GACE,MAAMC,EAAqB,CAACvB,EAAAA,EAAUI,UAAWJ,EAAAA,EAAUG,QAAQ1f,KACjEye,GAAMC,EAAAA,GAA+BD,GAAIE,YAErCoC,EAAsB,CAACxB,EAAAA,EAAUC,OAAQD,EAAAA,EAAUE,SAASzf,KAChEye,GAAMC,EAAAA,GAA+BD,GAAIE,YAE3C,GAAI3I,KAAK+I,iBAAmBC,EAAAA,EAAgBC,OAAQ,CAClD,GAAI6B,EAAmBtJ,QAAQxB,KAAKmJ,WAAa,EAC/C,SAAUnJ,KAAKmJ,WAAYnJ,KAAKkJ,SAElC,GAAI6B,EAAoBvJ,QAAQxB,KAAKmJ,WAAa,EAChD,SAAUnJ,KAAKkJ,SAA+B,OAApBlJ,KAAKsJ,YAEjC,GAAItJ,KAAKmJ,UAAYnJ,KAAKkJ,SAAWlJ,KAAK4J,OACxC,GAAIzc,MAAMC,QAAQ4S,KAAKsJ,aACrB,GAAItJ,KAAKsJ,WAAWzf,OAAS,EAE3B,OAAO,OAEJ,GAAwB,OAApBmW,KAAKsJ,WAEd,OAAO,CAGb,MAAO,GAAItJ,KAAK+I,iBAAmBC,EAAAA,EAAgBgB,IACjD,SAAUhK,KAAK+J,gBAAiB/J,KAAK4J,QAEvC,OAAO,CACT,CAEAoB,eAAAA,GACE,MAAMC,EAAQjL,KAAKiK,iBACnB,OAAOgB,EAAMphB,OAAS,GAAKohB,EAAQ,GAAGA,EAAMR,UAAU,EAAG,QAC3D,CAEAS,eAAAA,GACE,OAAOlL,KAAKiK,gBACd,CAEAA,cAAAA,GACE,OAAOA,EAAAA,EAAAA,GAAejK,KACxB,E,2QC1GY,SAAUmL,GAAkB,YACxCtC,EAAW,QACXuC,EAAO,WACPtmB,EAAU,aACVumB,EAAY,eACZC,EAAc,gBACdC,EAAe,YACfC,EAAW,YACXC,EAAW,MACXpf,EAAK,SACLqf,EAAQ,UACRC,IAEA,MAAM,gBAAEC,EAAe,MAAEtY,IAAUuY,EAAAA,EAAAA,GAAqBhD,GAExD,OACEvkB,EAAAA,EAAAA,IAACwnB,EAAAA,EAAyB,CACxBJ,SAAUA,EACVC,UAAWA,EACX9C,YAAaA,EACbuC,QAASA,EACTtmB,WAAYA,EACZumB,aAAcA,EACdE,gBAAiBA,EAAgB/mB,UAEjCF,EAAAA,EAAAA,IAACynB,EAAAA,GAAkB,CACjBd,MAAsB,MAAfW,EAAAA,EAAmB/C,EAAYmC,kBACtCgB,aAAmB,MAAL1Y,EAAAA,EAASuV,EAAYqC,kBACnCe,SAAUX,EACVE,YAAaA,EACbC,YAAaA,EACbpf,MAAOA,EACP8H,KAAM+X,EAAAA,EAAYC,aAClBC,WAAS,EACTjC,QAAStB,EAAYsB,WAI7B,C,0BCzDA,QAAejM,IAAAA,UAAoB,CACjCA,IAAAA,MAAgB,CACd6K,eAAgB7K,IAAAA,MAAgB,CAAC8K,EAAAA,EAAgBC,SAAS7K,WAC1DwL,OAAQ1L,IAAAA,MAAgB,CAAC2L,EAAAA,EAAQwC,OAAQxC,EAAAA,EAAQC,QAAQ1L,WACzD8K,QAAShL,IAAAA,OAAiBE,WAC1BkL,WAAYpL,IAAAA,UAAoB,CAC9BA,IAAAA,OACAA,IAAAA,QAAkBA,IAAAA,UACjBE,aAELF,IAAAA,MAAgB,CACd6K,eAAgB7K,IAAAA,MAAgB,CAAC8K,EAAAA,EAAgBgB,MAAM5L,WACvDwL,OAAQ1L,IAAAA,MAAgB,CAAC2L,EAAAA,EAAQC,MAAOD,EAAAA,EAAQwC,SAASjO,WACzD2L,cAAe7L,IAAAA,OAAiBE,e,0BCmBpC,MAAM,QAAEkO,GAAYnZ,EAAAA,QAEdoZ,EAAqBrO,IAAAA,UAAoB,CAC7CA,IAAAA,OACAsO,EAAAA,IAGIxO,EAAY,CAChBiN,MAAO/M,IAAAA,UAAoB,CAACA,IAAAA,OAAkBA,IAAAA,SAC9C2J,KAAM3J,IAAAA,OACNwN,SAAUxN,IAAAA,QAAkBA,IAAAA,QAC5ByN,UAAWzN,IAAAA,QAAkBA,IAAAA,QAC7BlT,SAAUkT,IAAAA,KACVhT,MAAOgT,IAAAA,QAAkBuO,GACzB3nB,WAAYoZ,IAAAA,OACZ/T,QAAS+T,IAAAA,QAAkBwO,EAAAA,GAC3BC,aAAczO,IAAAA,QAAkB0O,EAAAA,GAChCC,gBAAiB3O,IAAAA,UAAoB,CACnCqO,EACArO,IAAAA,QAAkBqO,KAEpBzE,UAAW5J,IAAAA,KACX4O,UAAW5O,IAAAA,MAWb,SAAS6O,EAA2B7hB,GAClC,OAAOA,KAAWA,aAAiB0d,EAAAA,IAAgB1d,EAAM6d,cAC3D,CAEA,MAAMiE,UAA2BnN,EAAAA,UAC/BC,WAAAA,CAAYjR,GACVkR,MAAMlR,GACNmR,KAAKiN,iBAAmBjN,KAAKiN,iBAAiB3M,KAAKN,MACnDA,KAAKsL,eAAiBtL,KAAKsL,eAAehL,KAAKN,MAC/CA,KAAKkN,YAAclN,KAAKkN,YAAY5M,KAAKN,MACzCA,KAAKqL,aAAerL,KAAKqL,aAAa/K,KAAKN,MAC3CA,KAAKmN,UAAYnN,KAAKmN,UAAU7M,KAAKN,MACrCA,KAAKhV,SAAWgV,KAAKhV,SAASsV,KAAKN,MACnCA,KAAKoN,UAAYpN,KAAKoN,UAAU9M,KAAKN,MACrCA,KAAKqN,oBAAsBrN,KAAKqN,oBAAoB/M,KAAKN,MACzDA,KAAKsN,aAAetN,KAAKsN,aAAahN,KAAKN,MAE3C,MAAMjT,GAAWiT,KAAKnR,MAAM3D,OAAS,IAAIlB,KAAIO,GAC3CwiB,EAA2BxiB,GAAU,IAAIqe,EAAAA,EAAYre,GAAUA,IAGjEyV,KAAKuN,eAAiBC,IAAUlpB,EAAAA,EAAAA,IAACmpB,EAAAA,EAAsB,CAACD,OAAQA,IAChExN,KAAK0N,cAAgB,CAAC7E,EAAaxc,KACjC/H,EAAAA,EAAAA,IAAC6mB,EAAiB,CAEhB9e,MAAOA,EACPwc,YAAaA,EACbwC,aAAcrL,KAAKqL,aACnBD,QAASpL,KAAK1Y,MAAM8jB,QACpBM,SAAU1L,KAAKnR,MAAM6c,SACrBC,UAAW3L,KAAKnR,MAAM8c,UACtB7mB,WAAYkb,KAAKnR,MAAM/J,WACvBwmB,eAAgB1S,IACdA,EAAEC,kBACFmH,KAAKsL,eAAejf,EAAM,EAE5Bmf,YAAaxL,KAAKmN,UAClB1B,YAAaA,IAAMzL,KAAKnR,MAAM7D,SAASgV,KAAK1Y,MAAM2K,QAClDsZ,gBAAiBvL,KAAK1Y,MAAMikB,iBAdvBlf,GAiBT2T,KAAK1Y,MAAQ,CACX2K,OAAQlF,EACRqe,QAASpL,KAAKiN,iBAAiBjN,KAAKnR,OACpC0c,gBAAiB,KAErB,CAEAnF,iBAAAA,GACE,MAAM,WAAEthB,GAAekb,KAAKnR,MAC5B,GAAI/J,GAAkC,UAApBA,EAAWqP,KAAkB,CAAC,IAADwT,EAC7C,MAAMgG,EAA0B,OAAtBhG,EAAG7iB,EAAW8iB,eAAQ,EAAnBD,EAAqBrW,IAEhCsc,gBAAiB/F,EAAI,QACrBgG,EAAO,OACPC,EACAC,eAAgBC,GACdlpB,GAECkpB,GAAgBL,GAAQ9F,GAAQiG,GACnCG,EAAAA,EAAe1Z,IAAI,CACjBwC,SAAU,oBAAoB4W,2BAA6BO,EAAAA,EAAAA,IACzD,CACErG,OACAgG,UACAC,eAIH7lB,MAAK,EAAG4K,WACP,GAAIA,GAAQA,EAAKsb,WAAY,CAC3B,MAAM,WAAEA,GAAetb,EAIrBsb,GACAA,EAAWC,MAC6B,IAAxCze,OAAOC,KAAKue,EAAWC,MAAMvkB,QAE7BmW,KAAKjF,SAAS,CAAEwQ,gBAAiB4C,EAAWC,KAAK,IAErD,KAEDjmB,OAAMmP,IACLC,EAAAA,EAAQD,MAAM,8BAA+BA,EAAM+W,WAAW,GAGtE,CACF,CAEAC,gCAAAA,CAAiClN,GAC3BpB,KAAKnR,MAAM1E,UAAYiX,EAAUjX,SACnC6V,KAAKjF,SAAS,CAAEqQ,QAASpL,KAAKiN,iBAAiB7L,KAE7CpB,KAAKnR,MAAM3D,QAAUkW,EAAUlW,OACjC8U,KAAKjF,SAAS,CACZ9I,QAASmP,EAAUlW,OAAS,IAAIlB,KAAIO,GAClCwiB,EAA2BxiB,GAAU,IAAIqe,EAAAA,EAAYre,GAAUA,KAIvE,CAEA+iB,YAAAA,CAAajhB,GACX,MAAMkiB,EAAa,IAAIvO,KAAK1Y,MAAM2K,QAClCsc,EAAWC,OAAOniB,EAAO,GACzB2T,KAAKjF,UAAS0T,IAAS,IAClBA,EACHxc,OAAQsc,MAEVvO,KAAKnR,MAAM7D,SAASujB,EACtB,CAEAjD,cAAAA,CAAejf,GACb,MAAM,UAAEygB,GAAc9M,KAAKnR,OACrB,OAAEoD,GAAW+N,KAAK1Y,MAClBtD,EAAkB,MAAT8oB,OAAS,EAATA,EAAY7a,EAAO5F,GAAQ4F,GACpB,iBAAXjO,EAIXgc,KAAKsN,aAAajhB,GAHhBigB,EAAQ,CAAEhZ,OAAOlL,EAAAA,EAAAA,GAAE,WAAYsmB,QAAS1qB,GAI5C,CAEAkpB,WAAAA,CAAYyB,GACV,MAAMC,EAAe5O,KAAKoN,UAAUuB,GAChCC,GACF5O,KAAKjF,UACH0T,IAAS,IACJA,EACHxc,OAAQ,IAAIwc,EAAUxc,OAAQ2c,OAEhC,KACE5O,KAAKnR,MAAM7D,SAASgV,KAAK1Y,MAAM2K,OAAO,GAI9C,CAEAoZ,YAAAA,CAAawD,GACX7O,KAAKnR,MAAM7D,SACTgV,KAAK1Y,MAAM2K,OAAOjI,KAAIkB,GAChBA,EAAMof,mBAAqBuE,EAAcvE,iBACpCuE,EAEF3jB,IAGb,CAEAF,QAAAA,CAAS8jB,GACP,MAAM1D,GAAW0D,GAAQ,IACtB9kB,KAAIwjB,GAAUxN,KAAKoN,UAAUI,KAC7BjjB,QAAOijB,GAAUA,IACpBxN,KAAKnR,MAAM7D,SAASogB,EACtB,CAEAiC,mBAAAA,CAAoB0B,GAClB,OAAO/O,KAAKnR,MAAM8d,aAAaviB,MAC7B4kB,GAAeA,EAAYrY,cAAgBoY,IAC3CE,UACJ,CAEA9B,SAAAA,CAAU+B,EAAWC,GACnB,MAAM,OAAEld,GAAW+N,KAAK1Y,MAElB8nB,EAAY,IAAInd,IACrBmd,EAAUD,GAAaC,EAAUF,IAAc,CAC9CE,EAAUF,GACVE,EAAUD,IAEZnP,KAAKjF,SAAS,CAAE9I,OAAQmd,GAC1B,CAEAhC,SAAAA,CAAUI,GAER,OAAIA,aAAkB5E,EAAAA,EACb4E,EAGLA,EAAO6B,kBACF,IAAIzG,EAAAA,EAAY,CACrBG,eAAgBC,EAAAA,EAAgBgB,IAChCd,QAASlJ,KAAKqN,oBAAoBG,EAAO6B,mBACzClG,SACET,EAAAA,GAA+Ba,EAAAA,EAAU+F,aAAa3G,UACxDW,WAAY,EACZM,OAAQC,EAAAA,EAAQwC,SAIhBmB,EAAOvC,MACF,IAAIrC,EAAAA,EAAY,CACrBG,eAAgBC,EAAAA,EAAgBgB,IAChCd,QAAS,IAAIqG,EAAAA,EAAY/B,GAAQvD,iBACjCd,SACET,EAAAA,GAA+Ba,EAAAA,EAAU+F,aAAa3G,UACxDW,WAAY,EACZM,OAAQC,EAAAA,EAAQwC,SAIhBmB,EAAOljB,YACF,IAAIse,EAAAA,EAAY,CACrBG,eAAgBC,EAAAA,EAAgBC,OAChCC,QAASsE,EAAOljB,YAChB6e,SAAUT,EAAAA,GAA+Ba,EAAAA,EAAUiG,QAAQ7G,UAC3DW,WAAY,GACZM,OAAQC,EAAAA,EAAQC,MAChBM,OAAO,IAGJ,IACT,CAEA6C,gBAAAA,CAAiBpe,GAYf,MAXgB,IACXA,EAAM1E,YACNJ,EAAAA,EAAAA,GAAc8E,EAAMge,iBAAiB7iB,KACtC0M,GACEA,IACmB,iBAAXA,EACJ,CAAE2Y,kBAAmB3Y,GACrB,IAAI6Y,EAAAA,EAAY7Y,OAExBnM,QAAOijB,GAAUA,IAGhBjgB,QAAO,CAACkiB,EAASjC,KACZA,EAAO6B,kBACTI,EAAQvT,KAAK,IACRsR,EACHlD,iBAAkBkD,EAAO6B,oBAElB7B,EAAOljB,YAChBmlB,EAAQvT,KAAK,IACRsR,EACHlD,iBAAkB,QAAQkD,EAAOljB,gBAE1BkjB,aAAkB+B,EAAAA,GAC3BE,EAAQvT,KAAK,IACRsR,EACHlD,iBAAkB,gBAAgBkD,EAAOvC,UAGtCwE,IACN,IACFC,MAAK,CAACC,EAAGC,KACPD,EAAEN,mBAAqBM,EAAErlB,aAAeqlB,EAAE1E,OAAO4E,cAChDD,EAAEP,mBAAqBO,EAAEtlB,aAAeslB,EAAE3E,QAGlD,CAEA6E,0BAAAA,CAA2BtS,GACzB,OACElZ,EAAAA,EAAAA,IAACwnB,EAAAA,EAAyB,CACxBH,UAAW3L,KAAKnR,MAAM8c,UACtBD,SAAU1L,KAAKnR,MAAM6c,SACrB7C,YAAa,IAAID,EAAAA,EAAY,CAAC,GAC9B9jB,WAAYkb,KAAKnR,MAAM/J,WACvBsmB,QAASpL,KAAK1Y,MAAM8jB,QACpBC,aAAcrL,KAAKkN,YACnB3B,gBAAiBvL,KAAK1Y,MAAMikB,gBAAgB/mB,SAE3CgZ,GAGP,CAEA2F,MAAAA,GACE,MAAM,MAAE7d,GAAU0a,KAAKnR,MACvB,OACEvG,EAAAA,EAAAA,IAAA,OAAKgV,UAAU,iBAAgB9Y,SAAA,EAC7B8D,EAAAA,EAAAA,IAACynB,EAAAA,GAAe,CAAAvrB,SAAA,EACdF,EAAAA,EAAAA,IAAC0rB,EAAAA,EAAa,IAAKhQ,KAAKnR,QACvBmR,KAAK8P,4BACJxrB,EAAAA,EAAAA,IAAC2rB,EAAAA,GAAa,CAAAzrB,UACZF,EAAAA,EAAAA,IAACkU,EAAAA,EAAM0X,UAAS,CACdxX,SAAS,IACTC,UAAWrT,EAAMG,OAAOC,UAAUyqB,gBAK1C7rB,EAAAA,EAAAA,IAAC8rB,EAAAA,GAAe,CAAA5rB,SACbwb,KAAK1Y,MAAM2K,OAAOpI,OAAS,EACxBmW,KAAK1Y,MAAM2K,OAAOjI,KAAI,CAACkB,EAAOmB,IAC5B2T,KAAK0N,cAAcxiB,EAAOmB,KAE5B2T,KAAK8P,4BACHxnB,EAAAA,EAAAA,IAAC+nB,EAAAA,GAAe,CAAA7rB,SAAA,EACdF,EAAAA,EAAAA,IAACkU,EAAAA,EAAM8X,UAAS,CAAC3X,UAAWrT,EAAMG,OAAOC,UAAUC,UAClDyC,EAAAA,EAAAA,GAAE,sBAMnB,EAGF4kB,EAAmBhP,UAAYA,EAC/BgP,EAAmBrN,aAvTE,CACnBkI,KAAM,GACN7c,SAAUA,OACVb,QAAS,GACTwiB,aAAc,GACdE,gBAAiB,IAoTnB,SAAe0D,EAAAA,EAAAA,GAAUvD,E,2DCnXzB,QAAe9O,IAAAA,MAAgB,CAC7B5T,YAAa4T,IAAAA,OAAiBE,WAC9BjK,KAAM+J,IAAAA,Q,0DCCD,MAAMsS,EAAmB,CAC9BC,OAAQ,SACRC,IAAK,OAGP,SAASC,EAAyBC,GAChC,GACEA,EAAY7G,eACZ8G,EAAAA,GAA6BC,KAAKF,EAAY7G,eAC9C,CACA,MAAMgH,EAAuBH,EAAY7G,cAAcvI,QAAQ,KACzDwP,EAAuBJ,EAAY7G,cACtCU,UAAU,EAAGsG,GACbE,YAAY,KACf,GAAIF,EAAuB,GAAKC,EAAuB,EACrD,OAAOJ,EAAY7G,cAAcU,UAC/BuG,EAAuB,EACvBD,EAGN,CACA,OAAO,IACT,CAEA,SAASG,EAA4BN,GACnC,GACEA,EAAY7G,eACZ8G,EAAAA,GAA6BC,KAAKF,EAAY7G,eAC9C,CACA,MAAMoH,EAAsBP,EAAY7G,cAAcvI,QAAQ,KAC9D,GAAI2P,EAAsB,EACxB,OAAOP,EAAY7G,cAAcU,UAAU,EAAG0G,EAElD,CACA,OAAO,IACT,CAEe,MAAM5B,EACnBzP,WAAAA,CAAY8Q,GAEV,GADA5Q,KAAK+I,eAAiB6H,EAAY7H,gBAAkByH,EAAiBC,OACjEzQ,KAAK+I,iBAAmByH,EAAiBC,OAAQ,CAEnD,MAAMW,EAAiBT,EAAyBC,GAChD5Q,KAAK9W,OACH0nB,EAAY1nB,QACXkoB,GAAkB,CAAE9mB,YAAa8mB,GACpCpR,KAAKqR,UACHT,EAAYS,WAAaH,EAA4BN,GACvD5Q,KAAK+J,cAAgB,IACvB,MAAW/J,KAAK+I,iBAAmByH,EAAiBE,MAClD1Q,KAAK+J,cAAgB6G,EAAY7G,cACjC/J,KAAK9W,OAAS,KACd8W,KAAKqR,UAAY,MAEnBrR,KAAKqK,oBAAsBuG,EAAYvG,kBACvCrK,KAAKsR,kBAAoBV,EAAYU,iBAAkBV,EAAY3F,OACnEjL,KAAKiL,MAAQjL,KAAKsR,eACdV,EAAY3F,MACZjL,KAAKgL,kBAEThL,KAAKuR,WACHX,EAAYW,YACZ,UAAUhH,KAAKC,SAAS1H,SAAS,IAAI2H,UAAU,EAAG,OAAOF,KAAKC,SAC3D1H,SAAS,IACT2H,UAAU,EAAG,KACpB,CAEAO,eAAAA,GACE,OAAOhL,KAAKiK,eAAe,CAAEuH,gBAAgB,GAC/C,CAEAvH,cAAAA,CACEwH,EAAS,CAAED,gBAAgB,EAAOE,wBAAwB,IAE1D,GAAI1R,KAAK+I,iBAAmByH,EAAiBC,OAAQ,CAAC,IAADkB,EAAAC,EACnD,MAAMP,EAAYrR,KAAKqR,WAAa,GAE9BnoB,EACJuoB,EAAOD,gBAA6B,OAAfG,EAAI3R,KAAK9W,SAALyoB,EAAapjB,aAClC,IAAIyR,KAAK9W,OAAOqF,gBACL,OAAXqjB,EAAA5R,KAAK9W,SAAL0oB,EAAatnB,YACX,IAAI0V,KAAK9W,OAAOoB,eAChB,GAER,OACEmnB,EAAOC,wBACPL,IAAcQ,EAAAA,GAAWC,gBACzB,WAAWhB,KAAK5nB,GAET,kBAAkBA,EAAO8F,MAAM,GAAI,MAErCqiB,EAAYnoB,CACrB,CACA,OAAI8W,KAAK+I,iBAAmByH,EAAiBE,IACpC1Q,KAAK+J,cAEP,EACT,CAEAW,aAAAA,CAAcC,GACZ,OAAO,IAAI4E,EAAY,IAClBvP,QACA2K,GAEP,CAEAC,MAAAA,CAAOgG,GACL,OACEA,EAAY3F,QAAUjL,KAAKiL,OAC3B2F,EAAY7H,iBAAmB/I,KAAK+I,gBACpC6H,EAAY7G,gBAAkB/J,KAAK+J,eACnC6G,EAAYS,YAAcrR,KAAKqR,YAC9BT,EAAY1nB,QAAU0nB,EAAY1nB,OAAOoB,gBACvC0V,KAAK9W,QAAU8W,KAAK9W,OAAOoB,YAElC,CAEAugB,OAAAA,GACE,OAAI7K,KAAK+I,iBAAmByH,EAAiBC,UACjCzQ,KAAK9W,SAAU8W,KAAKqR,WAE5BrR,KAAK+I,iBAAmByH,EAAiBE,OAClC1Q,KAAK+J,aAGlB,CAEAmH,2BAAAA,GACE,OAAOA,EAA4BlR,KACrC,CAEA2Q,wBAAAA,GACE,OAAOA,EAAyB3Q,KAClC,E,uGCpIF,MAAMhC,EAAY,CAChBwP,OAAQtP,IAAAA,UAAoB,CAC1BwO,EAAAA,EACAxO,IAAAA,MAAgB,CAAEmR,kBAAmBnR,IAAAA,OAAiBE,aACtDoO,EAAAA,IACCpO,YAGU,SAASqP,GAAuB,OAAED,IAC/C,OAAIA,EAAO6B,mBAEP/qB,EAAAA,EAAAA,IAACytB,EAAAA,EAAkB,CACjB7oB,OAAQ,CAAEoB,YAAakjB,EAAO6B,kBAAmBlb,KAAM,cACvD6d,UAAQ,IAIVxE,EAAOljB,aACFhG,EAAAA,EAAAA,IAACytB,EAAAA,EAAkB,CAAC7oB,OAAQskB,EAAQwE,UAAQ,IAEjDxE,EAAOvC,OAEP3mB,EAAAA,EAAAA,IAACytB,EAAAA,EAAkB,CACjB7oB,OAAQ,CAAEoB,YAAakjB,EAAOvC,MAAO9W,KAAM,cAC3C6d,UAAQ,IAIP,IACT,CACAvE,EAAuBzP,UAAYA,C,4FC9BnC,QAAeE,IAAAA,UAAoB,CACjCA,IAAAA,MAAgB,CACd6K,eAAgB7K,IAAAA,MAAgB,CAACsS,EAAAA,EAAiBC,SAASrS,WAC3DlV,OAAQwjB,EAAAA,EAAWtO,WACnBiT,UAAWnT,IAAAA,MAAgBvO,OAAOC,KAAKiiB,EAAAA,KAAazT,WACpD6M,MAAO/M,IAAAA,OAAiBE,aAE1BF,IAAAA,MAAgB,CACd6K,eAAgB7K,IAAAA,MAAgB,CAACsS,EAAAA,EAAiBE,MAAMtS,WACxD2L,cAAe7L,IAAAA,OAAiBE,WAChC6M,MAAO/M,IAAAA,OAAiBE,c,2DCd5B,QAAeF,IAAAA,MAAgB,CAC7B5T,YAAa4T,IAAAA,OAAiBE,WAC9BjK,KAAM+J,IAAAA,Q,2DCFR,QAAeA,IAAAA,MAAgB,CAC7BvH,YAAauH,IAAAA,OACb3P,aAAc2P,IAAAA,OACd+Q,WAAY/Q,IAAAA,Q,sTCGd,MAAM+T,GAAsB9sB,EAAAA,EAAAA,IAAO+sB,EAAAA,GAAW;;kBAE5B,EAAG5sB,WAAYA,EAAMU;;EA4HvC,EAxHyBmsB,EAAGpuB,WAAUuC,qBACpC,MAAOtB,EAAQotB,IAAazrB,EAAAA,EAAAA,UAAS,QAC9B1B,EAAOotB,IAAY1rB,EAAAA,EAAAA,UAAS,QAC5BF,EAAKC,IAAUC,EAAAA,EAAAA,UAAS,KACxBue,EAAcoN,IAAmB3rB,EAAAA,EAAAA,UAAS,IAE3C4rB,GAAoBvrB,EAAAA,EAAAA,cAAY4R,IACpC,MAAM,MAAE1N,EAAK,KAAE2c,GAASjP,EAAE4Z,cACb,UAAT3K,GACFwK,EAASnnB,GAEE,WAAT2c,GACFuK,EAAUlnB,EACZ,GACC,IAEGunB,GAAYzrB,EAAAA,EAAAA,cAAY,KAC5BN,EAAO,KACPgsB,EAAAA,EAAAA,IAAkB3uB,GACfkE,MAAKxB,IACJC,EAAOD,GACP6rB,EAAgB,GAAG,IAEpBnqB,OAAM,KACLmqB,GAAgBlqB,EAAAA,EAAAA,GAAE,UAClB9B,GAAe8B,EAAAA,EAAAA,GAAE,iDAAiD,GAClE,GACH,CAAC9B,EAAgBvC,KAEpB+D,EAAAA,EAAAA,YAAU,KACR2qB,GAAW,GACV,IAEH,MAAME,GAAOtuB,EAAAA,EAAAA,UAAQ,KACnB,IAAKoC,EAAK,MAAO,GACjB,MAAMmsB,EAAU,GAAGnsB,KAAOigB,EAAAA,GAAWmM,WAAWhL,iBAAiB7iB,IACjE,MAEE,qBAAYC,iBACCD,+DAIH4tB,kBAEC,GAEZ,CAAC5tB,EAAQyB,EAAKxB,IAEX6tB,EAAO5N,GAAgByN,IAAQvqB,EAAAA,EAAAA,GAAE,kCACvC,OACEE,EAAAA,EAAAA,IAAA,OAAKgJ,GAAG,qBAAoB9M,SAAA,EAC1B8D,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;;UAGNC,SAAA,EAEFF,EAAAA,EAAAA,IAACyuB,EAAAA,EAAe,CACdC,gBAAgB,EAChBF,KAAMH,EACNM,UACE3uB,EAAAA,EAAAA,IAAC2tB,EAAmB,CAACvpB,WAAW,SAAQlE,UACtCF,EAAAA,EAAAA,IAAA,KAAGgZ,UAAU,yBAInBhZ,EAAAA,EAAAA,IAAC4uB,EAAAA,GAAQ,CAEPrL,KAAK,YACLjf,UAAW+pB,EACXznB,MAAO4nB,EACPK,KAAK,IACLC,UAAQ,EACR7uB,IAAKe,GAASf,EAAAA,EAAG;;uBAEa,EAAjBe,EAAMU;yBACJV,EAAMmgB,WAAWC,MAAMC;;gCAEhBrgB,EAAMG,OAAO4tB,UAAUlD;kBAIjD7nB,EAAAA,EAAAA,IAAA,OACE/D,IAAKe,GAASf,EAAAA,EAAG;;wBAEgB,EAAjBe,EAAMU;;4BAEe,EAAjBV,EAAMU;;;;2BAIU,EAAjBV,EAAMU;;UAEvBxB,SAAA,EAEF8D,EAAAA,EAAAA,IAAA,OAAA9D,SAAA,EACEF,EAAAA,EAAAA,IAAA,SAAOgvB,QAAQ,eAAc9uB,UAAE4D,EAAAA,EAAAA,GAAE,mBACjC9D,EAAAA,EAAAA,IAACgU,EAAAA,GAAK,CACJnE,KAAK,OACLhJ,aAAcnG,EACd6iB,KAAK,SACL7c,SAAUunB,QAGdjqB,EAAAA,EAAAA,IAAA,OAAA9D,SAAA,EACEF,EAAAA,EAAAA,IAAA,SAAOgvB,QAAQ,cAAa9uB,UAAE4D,EAAAA,EAAAA,GAAE,kBAChC9D,EAAAA,EAAAA,IAACgU,EAAAA,GAAK,CACJnE,KAAK,OACLhJ,aAAclG,EACd4iB,KAAK,QACL7c,SAAUunB,EACVjhB,GAAG,wBAIL,E,eCtHV,MAmHA,EA/G0BiiB,EACxB3iB,UACAd,aAAa,MACV0jB,MAEH,MAAMluB,GAAQkB,EAAAA,EAAAA,OACPitB,EAAiBC,IAAsB/sB,EAAAA,EAAAA,aACvCgtB,EAAaC,IAAkBjtB,EAAAA,EAAAA,YAChC4O,EAAazF,EAAWjG,OAVP,GAWjBgqB,EAAqB/jB,EAAWvF,QACpCupB,IACGL,GACDK,EAAUC,gBACPhc,cACAb,SAASuc,EAAgB1b,iBAE1BuM,EAAkC,IAAtBxU,EAAWjG,OACvBmqB,EAAiBP,GAAiD,IAA9BI,EAAmBhqB,OACvDoqB,EAAiBrjB,EAAU,kBAAkBA,IAAY,GAC/D,OACEtI,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,CACG+Q,IACCjR,EAAAA,EAAAA,IAACgU,EAAAA,GAAK,CACJW,YAAU,EACVH,aAAa1Q,EAAAA,EAAAA,GAAE,UACfmQ,QAAQjU,EAAAA,EAAAA,IAACkU,EAAAA,EAAMC,OAAM,CAACC,SAAS,MAC/BnU,IAAKA,EAAAA,EAAG;qBA9BJ;sBAgCyB,EAAjBe,EAAMU,cAAmC,EAAjBV,EAAMU;YAE1CkF,MAAOuoB,EACPzoB,SAAU4N,GAAK8a,EAAmB9a,EAAE4Z,cAActnB,UAGtD5C,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;wBAtCD;;UAyCLC,SAAA,CAEDqvB,EAAmB7pB,KAAI8pB,IACtBxvB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAER6uB,aAAcA,IAAMN,EAAeE,EAAUxiB,IAC7C6iB,aAAcA,KACRR,IAAgBG,EAAUxiB,IAC5BsiB,EAAe,K,KAGfJ,EAAShvB,UAEbF,EAAAA,EAAAA,IAACyE,EAAAA,GAAI,CACHkC,OAAO,SACPmpB,IAAI,qBACJprB,GAAI,uBAAuB8qB,EAAUxiB,KAAK2iB,IAAiBzvB,UAE3D8D,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;;;+BA7DV;kBAkEIC,SAAA,EAEFF,EAAAA,EAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;;oBAENC,SAEDsvB,EAAUC,mBAEbzvB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM6b,KAAI,CACT3b,SAAS,IACTC,UAAWrT,EAAMG,OAAOC,UAAU6W,KAClChY,IAAKA,EAAAA,EAAG;mCAC0B,EAAjBe,EAAMU;kCACP2tB,IAAgBG,EAAUxiB,GACpC,UACA;4BApCPgjB,OAAOR,EAAUxiB,OA2CzB0iB,IACC1vB,EAAAA,EAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;6BAC0B,EAAjBe,EAAMU;+BACJV,EAAMU;cACvBxB,UAED4D,EAAAA,EAAAA,GAAE,sBAGNkc,IACChgB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CACRuD,UAAQ,EACRrE,IAAKA,EAAAA,EAAG;2BAtGN;iBAyGEivB,EAAShvB,UAEZ4D,EAAAA,EAAAA,GAAE,eAIR,EC3FDmsB,EACa,kBADbA,EAIW,gBAJXA,EAKmB,wBALnBA,EAMY,iBANZA,EAOY,iBAPZA,EAQe,oBARfA,EAUY,iBAVZA,EAWQ,aAXRA,EAYY,iBAZZA,EAkBQ,aAlBRA,EAmBY,iBAGZC,EAAsB,CAAC,kBAEhBC,EAAgCtvB,EAAAA,GAAOY,GAAG;IACnD,EAAGT,WAAYf,EAAAA,EAAG;;;;;eAKU,EAAjBe,EAAMU;gBACY,EAAjBV,EAAMU;;;;;sBAKAV,EAAMU;;;EAuBtB0uB,IAlBqBvvB,EAAAA,EAAAA,IAAOqD,EAAAA,EAAO;IACrC,EAAGlD,WAAYf,EAAAA,EAAG;aACQ,EAAjBe,EAAMU;cACY,EAAjBV,EAAMU;;wBAEIV,EAAMG,OAAOkvB,QAAQC;;;;;;;;eAQ9BtvB,EAAMG,OAAOkvB,QAAQhvB;;;EAKlBpB,EAAAA,EAAG;;;;;GAORswB,EAAkCA,CAC7CvW,EACAwW,EACA9lB,EACA+lB,EACAC,EACA5V,EACAtP,KACG+E,KAEH,MAAMvP,GAAQkB,EAAAA,EAAAA,OACR,eAAEF,EAAc,gBAAE2uB,IAAoB1uB,EAAAA,EAAAA,MACtCH,GAAWC,EAAAA,EAAAA,OACV6uB,EAAmBC,IAAwBxuB,EAAAA,EAAAA,UAAS,OACpDyuB,EAAmBC,IAAwB1uB,EAAAA,EAAAA,WAAS,GACrD2uB,GAAQjuB,EAAAA,EAAAA,KACZC,IAAK,IAAAiuB,EAAA,OAAgB,OAAhBA,EAAIjuB,EAAMkuB,aAAM,EAAZD,GAAeE,EAAAA,EAAAA,IAAYnuB,EAAMouB,SAAS,KAG/C,WAAE5wB,GAAewZ,EAEjBqX,GAAe3uB,EAAAA,EAAAA,cAAY4P,UAC/B,IACE,MAAMsS,GAAU9gB,EAAAA,EAAAA,GAAE,kBACZ3B,QAAYisB,EAAAA,EAAAA,IAAkBpU,GAC9BR,EAAO8X,oBAAmBxtB,EAAAA,EAAAA,GAAE,OAAQ,yBAA0B3B,IACpEovB,OAAOC,SAASC,KAAO,mBAAmB7M,aAAmBpL,GAC/D,CAAE,MAAOxG,GACPhR,GAAe8B,EAAAA,EAAAA,GAAE,iDACnB,IACC,CAAC9B,EAAgBgY,IAEd0X,GAAYhvB,EAAAA,EAAAA,cAChB,IACE8tB,GACImB,EAAAA,EAAAA,IAAY,CACVlyB,SAAUua,EACVc,WACA8W,WAAY,OACZC,aAAc,QAEhB,MACN,CAACrB,EAAgBxW,IAGb8X,GAAmBpvB,EAAAA,EAAAA,cACvB,IACE8tB,GACImB,EAAAA,EAAAA,IAAY,CACVlyB,SAAUua,EACV4X,WAAY,iBACZC,aAAc,QAEhB,MACN,CAACrB,EAAgBxW,IAGb+X,IAAarvB,EAAAA,EAAAA,cACjB,IACE8tB,GACImB,EAAAA,EAAAA,IAAY,CACVlyB,SAAUua,EACV4X,WAAY,UACZC,aAAc,SAEhB,MACN,CAACrB,EAAgBxW,IAGbgY,IAActvB,EAAAA,EAAAA,cAClB,IACE8tB,GACImB,EAAAA,EAAAA,IAAY,CACVlyB,SAAUua,EACV4X,WAAY,UACZC,aAAc,SAEhB,MACN,CAACrB,EAAgBxW,IAGbiY,IAAWvvB,EAAAA,EAAAA,cAAY4P,UAC3B,IACE,IAAK0H,EACH,MAAM,IAAI2I,YAENuP,EAAAA,EAAAA,IAAoB,KAAM9D,EAAAA,EAAAA,IAAkBpU,KAClD2W,GAAgB7sB,EAAAA,EAAAA,GAAE,wBACpB,CAAE,MAAOkP,GACPhR,GAAe8B,EAAAA,EAAAA,GAAE,iDACnB,IACC,CAAC9B,EAAgB2uB,EAAiB3W,IAE/BmY,IAAkBzvB,EAAAA,EAAAA,cACtB,EAAGkB,MAAKwuB,eAAgB,IAADC,EACrB,OAAQzuB,GACN,KAAKqsB,EACHS,IACAK,GAAqB,GACrB,MACF,KAAKd,EACHyB,IACAX,GAAqB,GACrBjvB,GACEa,EAAAA,EAAAA,UAAS2vB,EAAAA,GAAmC,CAC1ChmB,QAAc,MAAL5B,OAAK,EAALA,EAAO7H,SAChB4K,UAAgB,MAAL/C,OAAK,EAALA,EAAOa,cAGtB,MACF,KAAK0kB,EACH6B,IACAf,GAAqB,GACrBjvB,GACEa,EAAAA,EAAAA,UAAS4vB,EAAAA,GAA2C,CAClDjmB,QAAc,MAAL5B,OAAK,EAALA,EAAO7H,SAChB4K,UAAgB,MAAL/C,OAAK,EAALA,EAAOa,cAGtB,MACF,KAAK0kB,EACH8B,KACAhB,GAAqB,GACrBjvB,GACEa,EAAAA,EAAAA,UAAS6vB,EAAAA,GAAoC,CAC3ClmB,QAAc,MAAL5B,OAAK,EAALA,EAAO7H,SAChB4K,UAAgB,MAAL/C,OAAK,EAALA,EAAOa,cAGtB,MACF,KAAK0kB,EACH+B,KACAjB,GAAqB,GACrBjvB,GACEa,EAAAA,EAAAA,UAAS8vB,EAAAA,GAAmC,CAC1CnmB,QAAc,MAAL5B,OAAK,EAALA,EAAO7H,SAChB4K,UAAgB,MAAL/C,OAAK,EAALA,EAAOa,cAGtB,MACF,KAAK0kB,GACHyC,EAAAA,EAAAA,GACE,+BAEiB,OADjBL,EACK,MAAL3nB,OAAK,EAALA,EAAOa,YAAU8mB,GAAIvuB,EAAAA,EAAAA,GAAE,cACvB,EAJF4uB,CAKEN,GACFrB,GAAqB,GACrBjvB,GACEa,EAAAA,EAAAA,UAASgwB,EAAAA,GAAqC,CAC5CrmB,QAAc,MAAL5B,OAAK,EAALA,EAAO7H,SAChB4K,UAAgB,MAAL/C,OAAK,EAALA,EAAOa,cAGtB,MACF,KAAK0kB,EACHgC,KACAlB,GAAqB,GACrB,MACF,KAAKd,EACHc,GAAqB,GACrB,MACF,KAAKd,EACHoB,IACAN,GAAqB,GACrB,MACF,KAAKd,EACHc,GAAqB,GACrB,MACF,KAAKd,EACHQ,EAAezW,EAAqBoY,EAASQ,SAC7C7B,GAAqB,GAIzB,GAEF,CACEkB,GACAP,EACAI,EACAC,GACA/X,EACAyW,EACAC,EACAW,EACK,MAAL3mB,OAAK,EAALA,EAAOa,aA+JX,MAAO,EA3JMxL,EAAAA,EAAAA,UACX,KACEiE,EAAAA,EAAAA,IAAC4P,EAAAA,KAAI,CAACvP,QAAS8tB,GAAiBU,YAAY,KAAWtiB,EAAIrQ,SAAA,EACzD8D,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,CACGwK,IACC1K,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAAAb,UACP4D,EAAAA,EAAAA,GAAE,0BADWmsB,IAIlBjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAAC,QAAO,CACX7E,OAAOlL,EAAAA,EAAAA,GAAE,iBAAiB5D,UAG1BF,EAAAA,EAAAA,IAACivB,EAAiB,CAChB3iB,QAAc,MAAL5B,OAAK,EAALA,EAAO7H,SAChB2I,WAAYA,KA7QH,wBAgRbxL,EAAAA,EAAAA,IAAC4T,EAAK,KAAAsE,QAAO,QAEflU,EAAAA,EAAAA,IAAC4P,EAAK,KAAAC,QAAO,CAAC7E,OAAOlL,EAAAA,EAAAA,GAAE,YAAY5D,SAAA,CAChCgwB,EAAoBtd,SAASoH,EAAoB1Z,WAChD0D,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAER+xB,MAAM9yB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM6e,aAAY,CAAC9yB,IAAKmwB,IAC/B9rB,UAAWksB,EAAetwB,UAEzB4D,EAAAA,EAAAA,GAAE,4BAJEmsB,IAMPjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAER+xB,MAAM9yB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM6e,aAAY,CAAC9yB,IAAKmwB,IAC/B9rB,UAAWksB,EAAetwB,UAEzB4D,EAAAA,EAAAA,GAAE,2BAJEmsB,OAQTjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAER+xB,MAAM9yB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM6e,aAAY,CAAC9yB,IAAKmwB,IAC/B9rB,UAAWksB,EAAetwB,UAEzB4D,EAAAA,EAAAA,GAAE,mBAJEmsB,IAOTjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAER+xB,MAAM9yB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM6e,aAAY,CAAC9yB,IAAKmwB,IAC/B9rB,UAAWksB,EAAetwB,UAEzB4D,EAAAA,EAAAA,GAAE,oBAJEmsB,IAMPjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAER+xB,MAAM9yB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM8e,kBAAiB,CAAC/yB,IAAKmwB,IAAclwB,UAEjD4D,EAAAA,EAAAA,GAAE,sBAHEmsB,IAKPjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAER+xB,MAAM9yB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM6e,aAAY,CAAC9yB,IAAKmwB,IAC/B9rB,UAAWksB,EAAetwB,UAEzB4D,EAAAA,EAAAA,GAAE,oBAJEmsB,KA1TG,qBAiUZjsB,EAAAA,EAAAA,IAAC4P,EAAK,KAAAC,QAAO,CAAC7E,OAAOlL,EAAAA,EAAAA,GAAE,SAAS5D,SAAA,EAC9BF,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAAAb,UACP4D,EAAAA,EAAAA,GAAE,gCADWmsB,IAGhBjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAAAb,UACP4D,EAAAA,EAAAA,GAAE,yBADWmsB,IAGfnZ,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYkc,mBAC5BjzB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAAAb,UACRF,EAAAA,EAAAA,IAACkzB,EAAAA,EAAY,CACXC,aACEnzB,EAAAA,EAAAA,IAAA,QAAAE,UAAqC4D,EAAAA,EAAAA,GAAE,gBAEzCsvB,YAAYtvB,EAAAA,EAAAA,GAAE,cACduvB,WACErzB,EAAAA,EAAAA,IAAC6tB,EAAgB,CACfpuB,SAAUua,EACVhY,eAAgBA,IAGpBsxB,SAA8B,IAAjBtyB,EAAMU,SAAT,KACV+N,gBAAc,EACdP,YAAU,KAdE+gB,GAiBd,OApVG,kBAsVTjwB,EAAAA,EAAAA,IAAC4T,EAAK,KAAAsE,QAAO,IACZ0Y,GACC5sB,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAC4T,EAAK,KAAAC,QAAO,CAAC7E,OAAOlL,EAAAA,EAAAA,GAAE,uBAAuB5D,UAC5CF,EAAAA,EAAAA,IAACuzB,EAAAA,EAAoB,CACnBvC,MAAOA,EACPH,qBAAsBA,EACtBD,kBAAmBA,EACnBG,qBAAsBA,EACtBD,kBAAmBA,EACnB0C,aAAW,OAGfxzB,EAAAA,EAAAA,IAAC4T,EAAK,KAAAsE,QAAO,QAGflY,EAAAA,EAAAA,IAAC4T,EAAAA,KAAI,CAAA1T,UACHF,EAAAA,EAAAA,IAACuzB,EAAAA,EAAoB,CACnBvC,MAAOA,EACPH,qBAAsBA,EACtBE,qBAAsBA,EACtBD,kBAAmBA,EACnB0C,aAAW,OAIjBxzB,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAAAb,UACRF,EAAAA,EAAAA,IAACkzB,EAAAA,EAAY,CACXC,aACEnzB,EAAAA,EAAAA,IAAA,QAAAE,UAAwC4D,EAAAA,EAAAA,GAAE,gBAE5CsvB,YAAYtvB,EAAAA,EAAAA,GAAE,cACduvB,WACErzB,EAAAA,EAAAA,IAACyzB,EAAAA,EAAc,CAACzZ,oBAAqBA,IAEvCxK,WAAS,EACTL,WAAS,EACTD,YAAU,KAXE+gB,GAcfzvB,IACCR,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAAAb,UACP4D,EAAAA,EAAAA,GAAE,mBADWmsB,OAMtB,CACEjuB,EACAwuB,EACAQ,EACAxlB,EACA2mB,GACArB,EACA9W,EACA4W,EACAlmB,EACA1J,EAAMU,WAGIovB,EAAmBC,EAAqB,C,kDCzbxD,MAoFA,EApFqB,CACnB,MACA,KACA,MACA,MACA,KACA,OACA,QACA,SACA,QACA,WACA,UACA,SACA,OACA,WACA,OACA,OACA,MACA,UACA,OACA,QACA,QACA,SACA,KACA,QACA,SACA,OACA,MACA,OACA,QACA,MACA,MACA,UACA,MACA,OACA,SACA,KACA,KACA,QACA,QACA,UACA,aACA,QACA,SACA,MACA,QACA,OACA,OACA,QACA,SACA,OACA,SAwB+B2C,OArBV,CACrB,SACA,SACA,MACA,OACA,OACA,UACA,SACA,QACA,MACA,UACA,QACA,SACA,UACA,OACA,MACA,OACA,YACA,YAK8BhuB,KAAIiuB,IAAO,CACzC3lB,KAAM,MACNuV,KAAMoQ,EACNC,MAAOC,EAAAA,GACPjtB,MAAO+sB,K,mFC7EF,MAAMre,EAAkBA,EAC7BtG,QACAgJ,YAKAhY,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CAAC9kB,MAAOA,EAAO+kB,UAAU,MAAK7zB,UACpCF,EAAAA,EAAAA,IAACkU,EAAAA,EAAM8f,mBAAkB,CAEvB/zB,IAAMe,GAAyBf,EAAAA,EAAG;iBACvB+X,GAAShX,EAAMG,OAAOqtB,KAAK7H;uBACJ,EAAjB3lB,EAAMU;;;;;;;;8SCR7B,QAJA,UAAqB,MAAEkF,IACrB,OAAO5G,EAAAA,EAAAA,IAAA,QAAAE,SAAO0G,EAAQqtB,EAAAA,GAAoBC,EAAAA,IAC5C,ECOA,EAZA,WACE,OACEl0B,EAAAA,EAAAA,IAAA,QACEC,IAAMe,GAAyBf,EAAAA,EAAG;iBACvBe,EAAMG,OAAOC,UAAUC;QAChCnB,SAEDi0B,EAAAA,IAGP,E,0BCKA,QAVA,UAAkB,OAChBC,EAASC,EAAAA,QAAYC,kBAAiB,MACtC1tB,IAEA,OAAIA,GACK5G,EAAAA,EAAAA,IAAA,QAAAE,UAAOq0B,EAAAA,EAAAA,IAAiBH,GAAQA,OAAOxtB,MAEzC5G,EAAAA,EAAAA,IAACw0B,EAAQ,GAClB,E,gFC2DA,QA5DA,SAA8BjqB,GAC5B,MAAM,YAAEkqB,EAAW,WAAEC,EAAU,aAAEC,EAAY,MAAE/tB,EAAK,SAAEF,GAAa6D,EAC7DvJ,GAAQkB,EAAAA,EAAAA,OACP0yB,EAAgBC,IAAqBxyB,EAAAA,EAAAA,WAAS,GAErD,OACE2B,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;;QAGNC,SAAA,EAEFF,EAAAA,EAAAA,IAAC80B,EAAAA,EAAO,CACN5b,QAAQ,QACR6b,QAASH,EACTxK,SACEpmB,EAAAA,EAAAA,IAAA,OAAA9D,SAAA,EACEF,EAAAA,EAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;+BACSe,EAAMmgB,WAAW6T,QAAQC;iCACvBj0B,EAAMU;gBACvBxB,SAEDw0B,KAEH10B,EAAAA,EAAAA,IAACwG,EAAAA,EAAMC,MAAK,CACVG,MAAOA,EACPF,SAAU4N,IACR5N,EAAS4N,EAAE3N,OAAOC,OAClBiuB,GAAkB,EAAM,EACxB30B,UAEFF,EAAAA,EAAAA,IAACk1B,EAAAA,EAAK,CAACC,UAAU,WAAUj1B,SACxBy0B,EAAajvB,KAAIwjB,IAChBlpB,EAAAA,EAAAA,IAACwG,EAAAA,EAAK,CAAoBI,MAAOsiB,EAAOtiB,MAAM1G,SAC3CgpB,EAAOvC,OADEuC,EAAOtiB,gBAQ7BmtB,UAAU,aACVqB,oBAAkB,EAAAl1B,UAElBF,EAAAA,EAAAA,IAACkU,EAAAA,EAAMmhB,gBAAe,CACpBjhB,SAAS,IACTC,UAAWrT,EAAMG,OAAOC,UAAUC,OAClCpB,IAAKA,EAAAA,EAAG;;4BAEUe,EAAMU;YAExB2C,QAASA,IAAMwwB,GAAkB,OAGpCJ,IAGP,E,2DC5Dc,SAAUa,GAAc,QACpC7sB,EAAO,WACP8sB,EAAU,WACVC,EAAU,QACVC,EAAO,SACPC,IAQA,MAAM10B,GAAQkB,EAAAA,EAAAA,MACRyzB,GAA2D51B,EAAAA,EAAAA,UAC/D,IACEsL,OAAOuqB,OACL,CAAC,KACEntB,EAAQ/C,KAAIO,IAAM,CACnB,EAAC4vB,EAAAA,EAAAA,IAAc5vB,EAAOF,KACjBE,EAAOF,IAAI4gB,MACZ1gB,EAAOF,KAAME,QAGvB,CAACwC,IAGGugB,GAAetmB,EAAAA,EAAAA,cACnBiD,IACE,MAAMmwB,EAAmB,IAAKH,UACvBG,EAAiBnwB,GACxB4vB,EAAW,IAAIlqB,OAAOsC,OAAOmoB,IAAmB,GAElD,CAACH,EAAWJ,IAGRQ,GAAah2B,EAAAA,EAAAA,UACjB,IACEsL,OAAO2qB,QAAQL,GACZjwB,KAAI,EAAEC,GAAWyE,MAAKD,oBAAoB,CACzCxE,UACAyE,IAAiB,MAAZD,EAAAA,EAAgBC,MAEtBghB,MAAK,CAACC,EAAGC,IAAMD,EAAE1lB,QAAQ4lB,cAAcD,EAAE3lB,YAC9C,CAACgwB,IAGH,OACE3xB,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;;mBAGKe,EAAMU,SAAW;yBACM,EAAjBV,EAAMU;QACvBxB,SAAA,EAEFF,EAAAA,EAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;;;4BAG6B,EAAjBe,EAAMU;UACxBxB,SAED61B,EAAWrwB,KAAI,EAAGC,UAASyE,UAC1BpG,EAAAA,EAAAA,IAACiyB,EAAAA,EAAG,CACFC,UAAQ,EACRjpB,QAAS+b,EAAahN,KAAK,KAAMrW,GAEjC1F,IAAKA,EAAAA,EAAG;wBACqB,EAAjBe,EAAMU;;;yBAGLV,EAAMU,SAAW,OAAwB,EAAjBV,EAAMU;8BACR,EAAjBV,EAAMU;+BACY,EAAjBV,EAAMU;;cAEvBxB,SAAA,EAGFF,EAAAA,EAAAA,IAAA,QACEC,IAAKA,EAAAA,EAAG;gCACUe,EAAMU;gBACtBxB,SAEDyF,KAEH3F,EAAAA,EAAAA,IAAA,UAAAE,SAAgCkK,MAnB3BzE,QAuBX3B,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;;;UAINC,SAAA,EAEFF,EAAAA,EAAAA,IAACm2B,EAAAA,EAAa,CAACV,QAASA,IAAYD,EAAYjuB,SAAUiuB,KAC1Dx1B,EAAAA,EAAAA,IAACkU,EAAAA,EAAMkiB,eAAc,CACnB/hB,UAAWrT,EAAMG,OAAOC,UAAUC,OAClC+S,SAAS,IACT,cAAYtQ,EAAAA,EAAAA,GAAE,UACd+f,KAAK,SACLxf,QAASqxB,SAKnB,C,mCCtFA,MAAMW,EAAY,GAQlB,IAUKC,EAVLC,EAAA,CAAAhT,KAAA,SAAAiT,OAAA,UACA,SAASC,GAAU,SAAEv2B,IACnB,MAAM,IAAE6M,EAAG,OAAErM,IAAWg2B,EAAAA,EAAAA,MACxB,OACE12B,EAAAA,EAAAA,IAAA,OAAK+M,IAAKA,EAAK9M,IAAGs2B,EAAcr2B,UAC7By2B,EAAAA,EAAAA,cAAaz2B,EAAU,CAAEQ,YAGhC,CAOc,SAAUk2B,GAAgB,SACtCn3B,EAAQ,eACRo3B,IAIE,IAAHC,EACC,MAAM91B,GAAQkB,EAAAA,EAAAA,OACP60B,EAAWC,IAAgB30B,EAAAA,EAAAA,UAAS,GACrC40B,GAAgBxqB,EAAAA,EAAAA,QAAOsqB,IACtBtuB,EAAS8sB,IAAclzB,EAAAA,EAAAA,UAASw0B,IAChCrT,EAAW0T,IAAgB70B,EAAAA,EAAAA,WAAS,IACpC80B,EAAeC,IAAoB/0B,EAAAA,EAAAA,UAAS,KAC5Cg1B,EAAcC,IAAmBj1B,EAAAA,EAAAA,UACtC,IAAIk1B,MAECC,EAAgBC,IAAqBp1B,EAAAA,EAAAA,UAAS,CAAC,GAEhDq1B,GAAoB30B,EAAAA,EAAAA,KACvBC,GACCA,EAAM20B,OAAOC,KAAKF,qBAIfvwB,EAAc0wB,IAAkB93B,EAAAA,EAAAA,UACrC,IAAMN,EAASe,WAAW+C,MAAM,OAChC,CAAC9D,EAASe,cAGN,YAAEmO,EAAampB,OAAQC,IAAsBnpB,EAAAA,EAAAA,GAAsB,CACvE2D,UAAWpL,IAGP6wB,GAAcj4B,EAAAA,EAAAA,UAAQ,KAC1B,MAAMk4B,EAAkBZ,EAAapnB,IAAI8mB,GACzC,OAAIkB,GACFhB,EAAc5pB,QAAU0pB,EACjBkB,GAGFZ,EAAapnB,IAAIgnB,EAAc5pB,QAAQ,GAC7C,CAAC0pB,EAAWM,IAETa,GAAuCn4B,EAAAA,EAAAA,UAC3C,KACa,MAAXi4B,OAAW,EAAXA,EAAaG,SAASzyB,KAAI,CAACd,EAAQmD,KAAU,CAC3CnE,IAAKgB,EACLwzB,UAAWxzB,EACXoK,OACa,MAAXgpB,OAAW,EAAXA,EAAaK,SAAStwB,MAAWuwB,EAAAA,EAAgBC,UAC/Cv4B,EAAAA,EAAAA,IAACw4B,EAAoB,CACnB/D,YAAa7vB,EACb8vB,YAAY5wB,EAAAA,EAAAA,GAAE,cACd6wB,aAAc,CACZ,CAAEhO,OAAO7iB,EAAAA,EAAAA,GAAE,kBAAmB8C,MAAO0vB,EAAemC,UACpD,CACE9R,OAAO7iB,EAAAA,EAAAA,GAAE,mBACT8C,MAAO0vB,EAAeoC,YAG1B9xB,MACE4wB,EAAe5yB,KAAY0xB,EAAemC,SACtCnC,EAAemC,SACfnC,EAAeoC,UAErBhyB,SAAUE,GACR6wB,GAAkBz0B,IAAK,IAAUA,EAAO,CAAC4B,GAASgC,QAItDhC,EAEJia,OAAQjY,IACQ,IAAVA,IAA4B,IAAVA,GACb5G,EAAAA,EAAAA,IAAC24B,EAAW,CAAC/xB,MAAOA,IAEf,OAAVA,GACK5G,EAAAA,EAAAA,IAACw0B,EAAQ,KAGL,MAAXwD,OAAW,EAAXA,EAAaK,SAAStwB,MAAWuwB,EAAAA,EAAgBC,UACjDf,EAAe5yB,KAAY0xB,EAAemC,WACxB,iBAAV7xB,GAAsBA,aAAiBoX,OAExChe,EAAAA,EAAAA,IAAC44B,EAAQ,CAAChyB,MAAOA,IAEnBopB,OAAOppB,GAEhBjG,MAAO,UACF,IACT,CAAY,MAAXq3B,OAAW,EAAXA,EAAaG,SAAqB,MAAXH,OAAW,EAAXA,EAAaK,SAAUb,IAG3C/vB,GAAmB1H,EAAAA,EAAAA,UACvB,KACa,MAAXi4B,OAAW,EAAXA,EAAavwB,KAAK/B,KAChB,CAACmzB,EAAK9wB,IACO,MAAXiwB,OAAW,EAAXA,EAAaG,SAASlvB,QACpB,CAACC,EAAK4vB,KAAS,IAAM5vB,EAAK,CAAC4vB,GAAOD,EAAIC,MACtC,CACEl1B,IAAKmE,QAGR,IACP,CAAY,MAAXiwB,OAAW,EAAXA,EAAaG,SAAqB,MAAXH,OAAW,EAAXA,EAAavwB,OAIjCsxB,GAAer2B,EAAAA,EAAAA,cAAY,KAC/B00B,EAAiB,IACjBE,EAAgB,IAAIC,KACpBP,EAAa,EAAE,GACd,KAGHxzB,EAAAA,EAAAA,YAAU,KACR4zB,EAAiB,IACjBE,EAAgB,IAAIC,KACpBP,EAAa,EAAE,GACd,CAACvuB,KAGJjF,EAAAA,EAAAA,YAAU,KACR,GACE6zB,EAAa2B,IAAIjC,IACjB,IAAIM,EAAa/rB,QAAQ2tB,IAAI,KAAOlC,EACpC,CACA,MAAMmC,EAAmB,IAAI3B,IAAIF,GACjC6B,EAAiB/lB,OAAO4jB,GACxBO,EACE4B,EAAiBC,IACfpC,EACAM,EAAapnB,IAAI8mB,I,IAItB,CAACA,EAAWM,KAGf7zB,EAAAA,EAAAA,YAAU,KACR,IAAK2zB,IAAkB3T,IAAc6T,EAAa2B,IAAIjC,GAAY,CAAC,IAADqC,EAChElC,GAAa,GACb,MAAMmC,EAAgD,OAArCD,EChMjB,SACJE,EACAC,GAEA,IAAKD,EACH,OAEF,MAAME,GAAcC,EAAAA,EAAAA,GAAiBH,GAC/BI,EAASC,IAAKH,EAAYE,OAAQ,UAClCjxB,EAAU,KACXhD,EAAAA,EAAAA,GAAc+zB,EAAY/wB,aAC1BhD,EAAAA,EAAAA,GAAc8zB,GAAc7zB,KAAIk0B,GAAKD,IAAKC,EAAG,mBAElD,MAAO,CACLC,YAAaL,EAAYK,YACzBC,WAAYN,EAAYM,WACxBrxB,UACAixB,SAEJ,CD6K0BK,CAAgBt6B,EAAUgJ,IAAQ2wB,EAAI,CAAC,EACrDY,EAAiB/T,KAAKgU,KAAKvC,EAAoBrB,IACrD6D,EAAAA,EAAAA,sBACErC,EACA1wB,GACA,EACAkyB,EACAhD,EACAU,EAAY,GAEXpzB,MAAK2K,IACJgpB,EACE,IAAIC,IAAI,IACH,IAAIF,EAAarB,WAAWtrB,MAAwB,EAAjBsvB,GACtC,CACEjD,EACA,CACEoD,MAAO7rB,EAAS8rB,YAChB3yB,KAAM6G,EAAS7G,KACf0wB,UAAU1yB,EAAAA,EAAAA,GAAc6I,EAASjH,UACjCgxB,UAAU5yB,EAAAA,EAAAA,GAAc6I,EAAShH,eAKzC8vB,EAAiB,GAAG,IAErBvzB,OAAMmP,IACLokB,EAAiB,GAAGpkB,EAAMuQ,SAASvQ,EAAMlD,UAAU,IAEpDpB,SAAQ,KACPwoB,GAAa,EAAM,G,IAGxB,CACDQ,EACAvwB,EACA0wB,EACApvB,EACAhJ,EACA+jB,EACAuT,EACAI,EACAE,IAGF,MAAMgD,GACFlD,IAAkBE,EAAaiD,MACjCvC,IAAsBrV,EAAAA,GAAe/S,QAEjC4qB,EAAsC,OAA7BzD,EAAGr3B,EAAS+6B,oBAAiB1D,EAE5C,IAAI2D,EAAe,KACnB,GAAItD,EAEFsD,GACEz6B,EAAAA,EAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;wBACyB,EAAjBe,EAAMU;UACpBxB,SAEDi3B,SAGA,GAAIkD,EAETI,GAAez6B,EAAAA,EAAAA,IAAC2P,EAAAA,EAAO,SAClB,GAA2B,KAAZ,MAAXqoB,OAAW,EAAXA,EAAamC,OAAa,CAEnC,MAAMnrB,GAAQlL,EAAAA,EAAAA,GAAE,0CAChB22B,GAAez6B,EAAAA,EAAAA,IAAC06B,EAAAA,GAAgB,CAAClb,MAAM,eAAexQ,MAAOA,G,MAG7DyrB,GACEz6B,EAAAA,EAAAA,IAACy2B,EAAS,CAAAv2B,UACRF,EAAAA,EAAAA,IAAC8G,EAAAA,GAAK,CACJW,KAAMA,EACN5B,QAASqyB,EACToC,KAAMK,EAAAA,GAAUC,MAChBC,gBAAiBxE,EACjByE,YAAwB,MAAX9C,OAAW,EAAXA,EAAamC,MAC1BY,eAAa,EACbtF,QAASjS,EACT9c,SAAUs0B,GACRhE,EAAagE,EAAW3tB,QAAU2tB,EAAW3tB,QAAU,EAAI,GAE7D8B,WAAS,EACT8rB,YAAU,EACVV,UAAWA,MAMnB,OACEv2B,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACIm6B,GAAiB1rB,GACjB0rB,IACAr6B,EAAAA,EAAAA,IAACs1B,EAAa,CACZ7sB,QAASA,EACT8sB,WAAYA,EACZC,WAAuB,MAAXwC,OAAW,EAAXA,EAAamC,MACzB1E,QAASjS,EACTkS,SAAUqD,IAGb0B,IAGP,EAhQA,SAAKnE,GACHA,EAAAA,EAAA,uBACAA,EAAAA,EAAA,wBACD,CAHD,CAAKA,IAAAA,EAAc,KE5BnB,MAAM10B,EAAcA,EAClBkB,aACAjB,aACAq5B,mBAEA,MAAMl6B,GAAQkB,EAAAA,EAAAA,MAEd,OACE8B,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAACkE,EAAAA,EAAM,CACLC,YAAY,YACZC,WAAW,QACXC,QAAS62B,EACT52B,UAAWxB,EACXyB,QACGzB,OAEG0B,GADAV,EAAAA,EAAAA,GAAE,4DAEP5D,UAEA4D,EAAAA,EAAAA,GAAE,iBAEL9D,EAAAA,EAAAA,IAACkE,EAAAA,EAAM,CACLC,YAAY,UACZC,WAAW,QACXC,QAASxC,EAET5B,IAAKA,EAAAA,EAAG;yBAC0B,EAAjBe,EAAMU;UACrBxB,UAED4D,EAAAA,EAAAA,GAAE,aAEJ,EAYO,SAAUq3B,IAAiB,QACvC7uB,EAAO,SACP7M,EAAQ,eACRo3B,EAAc,UACd/lB,EAAS,YACThM,IAEA,MAAM9D,GAAQkB,EAAAA,EAAAA,MACRk5B,GAAUC,EAAAA,EAAAA,MACV/4B,GAAkBC,EAAAA,EAAAA,YAAWC,EAAAA,yBAC3B+I,WAAYkC,IAAc1K,EAAAA,EAAAA,KAC/BC,GACCA,EAAMs4B,cAAcC,OAAOjvB,KAEzBxJ,GAAaC,EAAAA,EAAAA,KAAaC,IAAgB,IAAAC,EAAA,OAC9CC,EAAAA,EAAAA,GAAe,cAAe,WAAsB,OAAZD,EAAED,EAAMG,WAAI,EAAVF,EAAYG,MAAM,IAGxDo4B,GAAaz7B,EAAAA,EAAAA,UACjB,IAAM,+BAA+BuC,cAA4BgK,KACjE,CAACA,EAAShK,IAGN44B,GAAex4B,EAAAA,EAAAA,cAAY,KAC/B04B,EAAQxjB,KAAK4jB,EAAW,GACvB,CAACA,EAAYJ,IAEhB,OACEp7B,EAAAA,EAAAA,IAAC6O,EAAAA,QAAK,CACJC,KAAMgC,EACN/B,OAAmB,MAAXjK,EAAAA,EAAgB,IAAM,KAC9B7E,IAAKA,EAAAA,EAAG;;;;;QAMR+O,OAAOlL,EAAAA,EAAAA,GAAE,sBAAuB2J,GAChCwB,QACEjP,EAAAA,EAAAA,IAAC4B,EAAW,CAACs5B,aAAcA,EAAcp4B,WAAYA,IAEvDoM,YAAU,EACVC,WAAS,EACTC,gBAAiB,CACfC,UAA4B,IAAjBrO,EAAMU,SACjB4N,SAA2B,IAAjBtO,EAAMU,SAChB6N,YAAa,CACX5O,MAAO,OACPD,OAAQ,SAGZ8O,WAAS,EACTC,gBAAc,EACdC,cAAc,EAAMxP,UAEpBF,EAAAA,EAAAA,IAAC42B,EAAe,CAACn3B,SAAUA,EAAUo3B,eAAgBA,KAG3D,C,wCC1GA,MAAM4E,IAAkB33B,EAAAA,EAAAA,GAAE,mBACpB43B,IAAqB53B,EAAAA,EAAAA,GAAE,sBACvB63B,GAAmB,CACvBC,UAAU93B,EAAAA,EAAAA,GACR,6FAEF+3B,iBAAiB/3B,EAAAA,EAAAA,GACf,0FAEFg4B,YAAYh4B,EAAAA,EAAAA,GACV,sEAEFi4B,eAAej4B,EAAAA,EAAAA,GACb,uEAIEk4B,GAAmBA,EAAG97B,cAAaqK,MACvCvK,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAACuD,UAAQ,KAAKiG,EAAKrK,UAC3BF,EAAAA,EAAAA,IAAA,OACEC,IAAKA,EAAAA,EAAG;;;QAGNC,SAEDA,MAmBD+7B,IAAep7B,EAAAA,EAAAA,KAdNq7B,EACbh8B,WACAi8B,aAAY,MAKZ,MAAM/R,EACJ+R,GAAiC,iBAAbj8B,GAChBk8B,EAAAA,EAAAA,IAAel8B,GACfA,EACN,OAAOF,EAAAA,EAAAA,IAAA,QAAAE,SAAOkqB,GAAe,GAGI;IAC/B,EAAGppB,WAAY,uBACCA,EAAMmgB,WAAW6T,QAAQC,sBAC/Bj0B,EAAMG,OAAOkvB,QAAQpY;EA4KnC,GA1J6BE,EAC3B7L,UACA7M,WACAgJ,UAAU,GACV4P,iBAAgB,EAChBhI,eAAe,EACfzE,cAAcA,KAAM,MACpBvH,UAAUA,KAAM,MAChBiM,eAAe,EACfQ,YACAC,eACAsrB,0BACG9xB,MAEH,MAAM+xB,GAAwBv5B,EAAAA,EAAAA,KAC5B,EAAGw5B,kBAAa,IAAAC,EAAAC,EAAA,OACkB,OADlBD,EACdD,EAAY98B,EAASe,cAAqB,OAAVi8B,EAAhCD,EAAkClZ,eAAF,EAAhCmZ,EAA4CC,uBAAuB,KAGhEC,EAAcpH,IAAclzB,EAAAA,EAAAA,UACjC,IAGIu6B,GAAYl6B,EAAAA,EAAAA,cAChB,CAAC+F,EAAS0I,KACR9M,EAAQ8M,GACRvF,IACA2pB,EAAW9sB,GACXsI,GAAa,EAAK,GAEpB,CAAC1M,EAASuH,IAGN/J,GAAaa,EAAAA,EAAAA,cAAY,KAC7BqO,GAAa,EAAM,GAClB,IAMGW,GAA8B3R,EAAAA,EAAAA,UAClC,SAAA4R,EAAA,OAE2B,OAF3BA,GACEC,EAAAA,EAAAA,KACG3B,IAAIxQ,EAASa,gBAAS,EADzBqR,EAEIE,UAAU/L,MAAKgM,GAAYA,IAAaC,EAAAA,GAASiF,eAAc,GACrE,CAACvX,EAASa,WAKNu8B,GAAiB98B,EAAAA,EAAAA,UAAQ,KAC7B,MAAM,QAAEoS,IAAY2qB,EAAAA,EAAAA,GAAmBr9B,GACvC,OAAOs9B,IAAQ5qB,EAAQ,GACtB,CAAC1S,IAGEiU,GAAiB3T,EAAAA,EAAAA,UACrB,KACE4T,EAAAA,GAAAA,IACEtD,EACA5H,EAAQlD,OAAS,EAAIkD,EAAQlD,OAAS,EAAIkD,EAAQlD,OAClD+K,IAEJ,CAACD,EAAc5H,EAAQlD,OAAQ+K,IAGjC,IAAI0sB,EACAC,EACAX,GACFU,EAAgBrB,GAAiBC,SACjCqB,EAAkBtB,GAAiBC,UAC1BlqB,EACLmrB,GACFG,EAAgBrB,GAAiBE,gBACjCoB,EAAkBtB,GAAiBE,iBAClB,MAAPpzB,GAAAA,EAASlD,SACnB03B,EAAkBtB,GAAiBG,YAGrCmB,EAAkBtB,GAAiBI,cAGrC,MAAMmB,EAAwBF,GAC5BG,EAAAA,EAAAA,IAACnB,GAAgB,IAAKzxB,EAAO3G,IAAI,4BAC9B63B,IACDz7B,EAAAA,EAAAA,IAACsV,GAAAA,EAAe,CAACtG,MAAOguB,MAG1BG,EAAAA,EAAAA,IAACvpB,EAAK,KAAA7S,KAAI,IACJwJ,EACJ3G,IAAI,kBACJS,QAASu4B,EAAU5gB,KAAK,KAAM,IAC9BjP,IAAKsvB,GAEJZ,IAIC2B,EAA0BH,GAC9BE,EAAAA,EAAAA,IAACnB,GAAgB,IAAKzxB,EAAO3G,IAAI,+BAC9B83B,IACD17B,EAAAA,EAAAA,IAACsV,GAAAA,EAAe,CAACtG,MAAOiuB,MAG1Bj9B,EAAAA,EAAAA,IAAC4T,EAAK,KAAAC,QAAO,IACPtJ,EACJwJ,YAAa,CAAC,EAAGL,GACjBI,eAAe,wBACf9E,MAAO0sB,GAAmBx7B,UAE1B8D,EAAAA,EAAAA,IAAA,OAAA9D,SAAA,CACGuI,EAAQ/C,KAAI,CAACO,EAAQo3B,KACpBF,EAAAA,EAAAA,IAAC/nB,GAAAA,EAAsB,IACjB7K,EACJ8K,YAAa,GAAGqmB,MAAsBz1B,EAAOkE,eAC7CvG,IAAK,uBAAuBy5B,IAC5Bh5B,QAASu4B,EAAU5gB,KAAK,KAAM,CAAC/V,KAE9B,GAAGy1B,OACJ17B,EAAAA,EAAAA,IAACi8B,GAAY,CAACE,WAAS,EAAAj8B,SAAE+F,EAAOkE,kBAGnC1B,EAAQlD,OAAS,IAChB43B,EAAAA,EAAAA,IAACvpB,EAAK,KAAA7S,KAAI,IACJwJ,EACJ3G,IAAI,0BACJS,QAASu4B,EAAU5gB,KAAK,KAAMvT,KAE9BzE,EAAAA,EAAAA,IAAA,OAAA9D,SAAA,CACG,GAAGw7B,OACJ17B,EAAAA,EAAAA,IAACi8B,GAAY,CAACE,WAAW,EAAMj8B,UAAE4D,EAAAA,EAAAA,GAAE,kBAQ/C,OACEE,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,CACGg9B,EACA7kB,GAAiB+kB,GAClBp9B,EAAAA,EAAAA,IAACm7B,GAAgB,CACf7uB,QAASA,EACT7M,SAAUA,EACVo3B,eAAgB8F,EAChB7rB,UAAWA,EACXhM,YAAajD,MAEd,C,6FC/NA,MAAMuT,EAAyBA,EACpCC,cACAnV,cACGqK,MAEH,MAAO+yB,EAASC,IAAmBC,EAAAA,EAAAA,KAEnC,OACEx9B,EAAAA,EAAAA,IAAC4T,EAAAA,KAAK7S,KAAI,CACRd,IAAKA,EAAAA,EAAG;;WAGJsK,EAAKrK,UAETF,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CAAC9kB,MAAOuuB,EAAkBloB,EAAc,KAAKnV,UACnDF,EAAAA,EAAAA,IAAA,OACE+M,IAAKuwB,EACLr9B,IAAKA,EAAAA,EAAG;;cAEJw9B,EAAAA;YACFv9B,SAEDA,OAGK,C,6CCtCT,MAWMsY,EAAmBA,CAC9BhC,EACAe,EACAmmB,EAA0Bh6B,OAAOi6B,iBACjCC,EAAwB,KAGxB,MAAMC,EAAK5X,KAAK6X,IACdrlB,SAASslB,gBAAgBC,cAAgB,EACzCzM,OAAO0M,aAAe,GAGlBC,EACJjY,KAAKkY,IAxBuB,GAwBA5mB,EAAYmmB,GAtBd,GAwB1BE,EAEF,OAAOC,EAAKrnB,EAAU0nB,EAAaL,EAAKK,EAAa1nB,CAAO,EAGjD7C,EAAoBA,CAC/BtD,EACAkH,EACAjH,EAAe,EACfotB,EAA0Bh6B,OAAOi6B,iBACjCC,EAAwB,KAExB,MAAMQ,EACJ/tB,EAtCiB,EADW,GAyCTC,EAxCF,EA2CnB,OACEkI,EACE4lB,EACA7mB,EACAmmB,EACAE,GACEQ,CAAQ,C,gFCjDT,MAAMC,EAAkBA,KAC7B,MAAMr9B,GAAQkB,EAAAA,EAAAA,MACd,OACE8B,EAAAA,EAAAA,IAAA,OACErD,MAAM,KACND,OAAO,KACP49B,QAAQ,YACRC,KAAK,OACLC,MAAM,6BAA4Bt+B,SAAA,EAElCF,EAAAA,EAAAA,IAAA,QACEy+B,EAAE,mGACFF,KAAMv9B,EAAMG,OAAOkvB,QAAQpY,QAE7BjY,EAAAA,EAAAA,IAAA,QACEy+B,EAAE,oDACFF,KAAK,YAEH,EAIGG,EAAsBA,KACjC,MAAM19B,GAAQkB,EAAAA,EAAAA,MACd,OACE8B,EAAAA,EAAAA,IAAA,OACErD,MAAM,KACND,OAAO,KACP49B,QAAQ,YACRC,KAAK,OACLC,MAAM,6BAA4Bt+B,SAAA,EAElCF,EAAAA,EAAAA,IAAA,QACEy+B,EAAE,+FACFF,KAAMv9B,EAAMG,OAAOC,UAAUC,UAE/BrB,EAAAA,EAAAA,IAAA,QAAMy+B,EAAE,oBAAoBF,KAAK,YAC7B,EAIGI,EAAoBA,KAC/B,MAAM39B,GAAQkB,EAAAA,EAAAA,MACd,OACE8B,EAAAA,EAAAA,IAAA,OACErD,MAAM,KACND,OAAO,KACP49B,QAAQ,YACRC,KAAK,OACLC,MAAM,6BAA4Bt+B,SAAA,EAElCF,EAAAA,EAAAA,IAAA,QACEy+B,EAAE,+FACFF,KAAMv9B,EAAMG,OAAOC,UAAUw9B,UAE/B5+B,EAAAA,EAAAA,IAAA,QAAMy+B,EAAE,qBAAqBF,KAAK,YAC9B,C,sFC/CV,MAAMtd,EAASpgB,EAAAA,GAAO2gB,IAAI;;;;;EAOZ,SAAUqd,GAAS,QAC/BC,EAAO,SACPp4B,EAAQ,MACRyO,EAAK,UACL6D,IAEA,OACEhZ,EAAAA,EAAAA,IAACihB,EAAM,CACL9L,MAAOA,EACP9Q,QAASA,KACPqC,GAAUo4B,EAAQ,EAEpBjb,KAAK,WACLC,SAAU,EACV,eAAcgb,EACd,aAAW,WACX9lB,UAAWA,GAAa,GAAG9Y,SAE1B4+B,GAAU9+B,EAAAA,EAAAA,IAACq+B,EAAAA,GAAe,KAAMr+B,EAAAA,EAAAA,IAAC2+B,EAAAA,GAAiB,KAGzD,C,qHCzBA,MAAMI,EAAWl+B,EAAAA,GAAOY,GAAG;WAChB,EAAGT,WAA6B,IAAjBA,EAAMU;YACpB,EAAGV,WAA6B,IAAjBA,EAAMU;;sBAEX,EAAGV,WAAYA,EAAMG,OAAOC,UAAUC;;iBAE3C,EAAGL,WAAYA,EAAMmgB,WAAW6T,QAAQgK;;;;;wBAKjC,EAAGh+B,WAAYA,EAAMG,OAAOkvB,QAAQpY;;;;0BAIlC,EAAGjX,WAAYA,EAAMG,OAAOkvB,QAAQpY;;;;;;;;aAQjD,EAAGjX,WAA6B,IAAjBA,EAAMU;cACpB,EAAGV,WAA6B,IAAjBA,EAAMU;;wBAEX,EAAGV,WAAYA,EAAMG,OAAOC,UAAUC;;;;WAInD,EAAGL,WAAYA,EAAMU;;;;cAIlB,EAAGV,WAAYA,EAAMU;;EAI7Bu9B,EAAkBp+B,EAAAA,GAAOY,GAAG;;;aAGrB,EAAGT,WAA6B,EAAjBA,EAAMU;kBAChB,EAAGV,WAAYA,EAAMU;EAGhC,IAAKw9B,GAAZ,SAAYA,GACVA,EAAA,oBACAA,EAAA,uBACD,CAHD,CAAYA,IAAAA,EAAe,KAS3B,MAAMC,EAAaA,CACjBC,EAAmCF,EAAgBG,WAGjDD,IAAoBF,EAAgBI,YAClCt/B,EAAAA,EAAAA,IAACkU,EAAAA,EAAMqrB,UAAS,CAACnrB,SAAS,QAE1BpU,EAAAA,EAAAA,IAAC++B,EAAQ,IAKFjmB,EAAWA,EACtBC,UACAqmB,kBAAkBF,EAAgBG,YAC/B9uB,MAEHvQ,EAAAA,EAAAA,IAACw/B,EAAAA,GAAY,CAACzmB,QAASA,KAAaxI,EAAIrQ,UACtCF,EAAAA,EAAAA,IAACi/B,EAAe,CAAA/+B,SACbi/B,EAAWC,OAeLK,EAAuBl1B,IAClC,MAAM,SAAErK,EAAQ,OAAEw/B,EAAM,UAAEC,KAAcpvB,GAAShG,EAC3Cq1B,GAAoBjJ,EAAAA,EAAAA,cAAaz2B,EAA0B,CAC/Dw/B,SACAC,cAGF,OACE3/B,EAAAA,EAAAA,IAACw/B,EAAAA,GAAY,CAACK,aAAct1B,EAAMs1B,gBAAkBtvB,EAAIrQ,SACrD0/B,GACY,C,uGCpGnB,MAAME,EAAa,IAAIvI,IAEjB/kB,GAAoButB,EAAAA,EAAAA,GACxBpW,EAAAA,EAAe1Z,IACf6vB,GACA,EAAGrtB,cAAeA,GAAY,KASnButB,EACXC,IAAiC,CAEjCr5B,MAAOq5B,EAAIjzB,GACX2Z,MAAOsZ,EAAI1c,KACX3f,IAAKq8B,EAAIjzB,KAGEkzB,EAAW5tB,MACtB6tB,EACAC,EACAC,KAEA,MAAMC,EAAe,OACfC,EAAQpwB,IAAAA,OAAa,CACzB1H,QAAS,CACP,CAAE1C,IAAKu6B,EAAcE,IAAK,KAAM55B,MAAOu5B,GACvC,CAAEp6B,IAAK,OAAQy6B,IAAK,aAAc55B,OAAO,IAE3Cw5B,OACAK,UAAWJ,EACXK,aAAcJ,EACdK,gBAAiB,QAWnB,OAAOnuB,EAAkB,CACvBC,SAAU,kBAAkB8tB,MAE3B58B,MAAK2K,IAKG,CACL7G,KAFI6G,EAASC,KAAK7O,OAAOgG,IAAIs6B,GAG7BxK,WAAYlnB,EAASC,KAAKqyB,UAG7B/8B,OAAMyO,MAAMU,IACX,MAAM4N,EAtBcigB,GAAG7tB,QAAOlD,cAChC,IAAIgxB,EAAYhxB,GAAWkD,IAASlP,EAAAA,EAAAA,GAAE,yBAItC,MAHgB,cAAZgM,IACFgxB,GAAYh9B,EAAAA,EAAAA,GAAE,4CAETg9B,CAAS,EAiBOD,OAAsBE,EAAAA,EAAAA,IAAqB/tB,IAChE,MAAM,IAAI2P,MAAM/B,EAAa,GAC7B,C,2KCvDN,MAAMogB,EAAqBA,KAAa,IAAAC,EAAAC,EACtC,MAAMC,GAAgBC,EAAAA,EAAAA,KAGtB,OADe,MAAbD,GAAqB,OAARF,EAAbE,EAAexJ,SAAY,OAANuJ,EAArBD,EAAuBrJ,WAAV,EAAbsJ,EAA6BG,kCACO,GAAI,EAG/BC,EAAcA,EACzB/uB,YACAgvB,eAAe,CAAC,EAChB/4B,UACAg5B,kBACAC,gBACAC,aACAC,aACAC,gBACA9H,aACA+H,mBACAhyB,OACA0Q,cACAvT,SAQ2B,IAAA80B,EAC3B,MAAMC,EAIF,CAAC,EAUL,OATIxvB,IACFwvB,EAAWvhC,WAAa,GAAG+R,YAEzB/J,IACFu5B,EAAWv5B,QAAU,CAACA,IAEpBm5B,IACFI,EAAWJ,WAAaA,GAEnB,IACFF,KACAM,EACHH,cAA4B,MAAbA,EAAAA,EAAiB,GAChCI,cAAe,GACfC,gBAAiBV,EACjBM,mBACA1vB,QAAS,CAAC,SACV+vB,UAAWlB,IACX/vB,YAAY,EACZpK,aAA6B,MAAf26B,GAA4B,OAAbM,EAAfN,EAAiBpkB,kBAAF,EAAf0kB,EAA8Bl7B,MAC5CkzB,aACAqI,YAAYC,EAAAA,EAAAA,GAAiB,WAC7BC,QAAQ,EACR/hC,SAAUohC,EACV7xB,OACA0Q,cACA+hB,iBAAkBt1B,EACnB,EAGG,SAAUu1B,EACdC,EAA+B,CAAC,EAChCC,EAA0B,CAAC,GAE3B,MAAMC,EAA6B,CAAC,EAoBpC,OAnBAC,EAAAA,GAA4B33B,SAASpH,IACnC,MAAMg/B,EAAe,IACfJ,EAAc5+B,IAAQ,MACtB6+B,EAAS7+B,IAAQ,IAEnBg/B,EAAar9B,SACfm9B,EAAY9+B,GAAOg/B,E,IAGvBC,EAAAA,GAA8B73B,SAASpH,IACrC,MAAMk/B,EAAgBN,EAAc5+B,QACdY,IAAlBs+B,IACFJ,EAAY9+B,GAAOk/B,GAErB,MAAMC,EAAWN,EAAS7+B,QACTY,IAAbu+B,IACFL,EAAY9+B,GAAOm/B,E,IAGhBL,CACT,CASM,SAAUM,EACdlrB,EACAmrB,GAEA,IAAIC,EAA+B,CAAC,EAOpC,OANAD,EAAwBj4B,SAAQpH,IAAM,IAAAu/B,EAAAC,EACpCF,EAAgBX,EACdW,EAC4B,OADfC,EACA,OADAC,EACbtrB,EAASlU,SAAI,EAAbw/B,EAAeF,eAAaC,EAAI,CAAC,EAClC,IAEID,CACT,CAEM,SAAUG,EAAiBxxB,GAC/B,OACGA,EAAUe,SAASb,EAAAA,GAASuxB,gBAC5BxsB,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYI,wBAC5BtF,EAAUe,SAASb,EAAAA,GAASuF,iBAElC,CAEA,MAAMisB,EAAkBA,CACtB31B,EACA41B,KAAmB,IAAAC,EAAA,OACD,MAAf71B,GAA8B,OAAf61B,EAAf71B,EAAkB41B,SAAH,EAAfC,EAAgC5zB,QAAS6zB,EAAAA,EAAQ,EAEhDC,EAAkCA,CACtC/1B,EACAg2B,EACAJ,EACAK,EACAC,EACAC,KACE,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACEN,EAAQ/K,IAAIwK,KAGhBO,EAAQ16B,IAAIm6B,IAEK,MAAf51B,GAA8B,OAAfo2B,EAAfp2B,EAAkB41B,SAAH,EAAfQ,EAAgCn0B,QAASy0B,EAAAA,IACzCV,EAAchxB,SAAqC,OAA7BqxB,EAACr2B,EAAgB41B,KAAkB,OAANU,EAA5BD,EAA8Bj2B,WAAF,EAA5Bk2B,EAAoC53B,UAE3Du3B,EAAO74B,QAAQ84B,EAAgBz6B,IAAKy6B,GAGiB,KAAtC,MAAfl2B,GAA8B,OAAfu2B,EAAfv2B,EAAkB41B,KAAsB,OAAVY,EAA9BD,EAAgCjkC,eAAjB,EAAfkkC,EAA0C7+B,SACzCg+B,EAAgB31B,EAAiB41B,IAChCM,EAAgB9K,IAAIwK,IAII,OAA5Ba,EAAAz2B,EAAgB41B,KAAhBa,EAA8BnkC,SAAS8K,SAAQu5B,GAC7CZ,EACE/1B,EACAg2B,EACAW,EACAhB,EAAgB31B,EAAiB22B,GAAW,IAAIV,EAAQU,GAAWV,EACnEC,EACAC,KAEH,EAGUS,EAA4BA,CACvC52B,EACAg2B,KAEA,MACMa,EADgB72B,EAAgB82B,EAAAA,IACJxkC,SAAS,GACrCykC,EAAkBF,IAAgBG,EAAAA,GAClCC,EAAc,IAAIp7B,IAClBs6B,EAAU,IAAIt6B,IACE,IAADq7B,EAAAC,EAyBrB,OAzBIJ,EAC0B,OAA5BG,EAAAl3B,EAAgB62B,KAAsB,OAAVM,EAA5BD,EAA8B5kC,WAA9B6kC,EAAwC/5B,SAAQg6B,GAC9CrB,EACE/1B,EACAg2B,EACAoB,EACA,CAACA,GACDH,EACAd,KAIJ14B,OAAOsC,OAAOC,GACX3H,QAAOg/B,IAAkB,MAAPA,OAAO,EAAPA,EAASp1B,QAAS6zB,EAAAA,KACpC14B,SAAQi6B,GACPtB,EACE/1B,EACAg2B,EACAqB,EAAQj4B,GACR,CAACi4B,EAAQj4B,IACT63B,EACAd,KAIDc,CAAW,EAGPK,EACXt+B,GAEIA,QACK,GAEY,iBAAVA,GAAuC,iBAAVA,EAC/B,GAAGA,IAERiC,MAAMC,QAAQlC,GACTA,EAAMsD,KAAK,MAEC,iBAAVtD,EACFu+B,KAAKC,UAAUx+B,IAEjB9C,EAAAA,EAAAA,GAAE,gB,4DCxOG,SAAUuhC,EAAyB58B,GAC/C,OAAO4C,OAAO2qB,QAAQvtB,GACnB/C,KAAI,EAAEd,EAAQ+I,MAAY,CACzB5H,IAAKnB,EACLuf,GAAItb,MAAMC,QAAQ6E,GAAU,KAAO,KACnCvD,IAAKuD,MAEN1H,QAAOA,GAAyB,OAAfA,EAAOmE,KAC7B,C,eCIA,MAAMk7B,EAAuB,CAAC,EACxBC,EAAwB,CAAC,EAoBjB,SAAUC,GAA4B,MAClDxU,EAAK,QACLvoB,EAAO,cACPg9B,EAAa,mBACbC,EAAkB,YAClBC,EAAW,eACXC,EAAc,QACdC,EAAO,SACP/tB,EAAQ,cACRguB,EAAa,YACb7rB,EAAW,eACXC,EAAc,YACd6rB,IAGA,MAAMC,EAAiBT,EAAsBM,GAC7C,GACEP,EAAqBO,KAAap9B,IAClCw9B,EAAAA,EAAAA,IAA8B,MAAdD,OAAc,EAAdA,EAAgB3oB,aAAcsoB,EAAa,CACzDO,iBAAiB,MAEnBD,EAAAA,EAAAA,IAA8B,MAAdD,OAAc,EAAdA,EAAgBG,gBAAiBP,EAAgB,CAC/DM,iBAAiB,MAEnBD,EAAAA,EAAAA,IAA8B,MAAdD,OAAc,EAAdA,EAAgBI,aAAcnsB,EAAa,CACzDisB,iBAAiB,MAEnBD,EAAAA,EAAAA,IAA8B,MAAdD,OAAc,EAAdA,EAAgBK,oBAAqBnsB,EAAgB,CACnEgsB,iBAAiB,KAEjBF,IACFC,EAAAA,EAAAA,IAA8B,MAAdD,OAAc,EAAdA,EAAgBluB,SAAUA,EAAU,CAClDouB,iBAAiB,MAEnBD,EAAAA,EAAAA,IAA8B,MAAdD,OAAc,EAAdA,EAAgBF,cAAeA,EAAe,CAC5DI,iBAAiB,IAGnB,OAAOF,EAGT,IAAIM,EAA8C,CAAC,EACnD,MAAMC,GAAgBC,EAAAA,EAAAA,GAAoB,CACxCd,qBACA5tB,WACA2tB,gBACAM,gBAEI9C,EAA0B53B,OAAO2qB,QAAQuQ,GAC5CtgC,QAAO,EAAE,EAAIwgC,YAAaA,EAAM7zB,SAASoe,EAAMhkB,MAC/CtH,KAAI,EAAEghC,KAAcA,IACnBzD,EAAwB19B,SAC1B+gC,EAAY,CACVrE,iBAAiBe,EAAAA,EAAAA,IAAiBlrB,EAAUmrB,KAIhD,MAAMxjC,EAAW,IACZuxB,EAAM2V,UACTP,aAAcnsB,EACdosB,oBAAqBnsB,KACjByrB,GAAe,CAAEtoB,aAAcsoB,GACnC3D,cAAeqD,EAAyB58B,MACrC69B,KACAR,GAML,OAHAR,EAAqBO,GAAWp9B,EAChC88B,EAAsBM,GAAW,IAAKpmC,EAAUqY,WAAUguB,iBAEnDrmC,CACT,C,8SC5EO,MAAMmnC,GAAW/lC,EAAAA,EAAAA,IAAO,OAAO;WAC3B,EAAGG,WAAYA,EAAMG,OAAOC,UAAUC;EAGpCusB,GAAa/sB,EAAAA,EAAAA,IAAOqD,EAAAA,EAAO;eACzB,EAAGlD,WAAYA,EAAMmgB,WAAWC,MAAMC;;;;gBAIrC,EAAGrgB,WAA6B,EAAjBA,EAAMU;;;;iBAIpB,EAAGV,WAAYA,EAAMU;;EAIzBmlC,EAAwBA,EACnCp/B,OACA5B,cAKA,MAAM7E,GAAQkB,EAAAA,EAAAA,MACd,OACElC,EAAAA,EAAAA,IAACyuB,EAAAA,EAAe,CACdD,KACE/mB,GAAQ5B,GAAUihC,EAAAA,EAAAA,IAAkCr/B,EAAM5B,GAAW,GAEvEkhC,SAAS,EACTpY,UACE3uB,EAAAA,EAAAA,IAACkU,EAAAA,EAAM8yB,aAAY,CACjB3yB,UAAWrT,EAAMG,OAAOC,UAAU6W,KAClC7D,SAAS,IACT,cAAYtQ,EAAAA,EAAAA,GAAE,QACd+f,KAAK,SACL5jB,IAAKA,EAAAA,EAAG;;;;eAOZ,EAIOgnC,EAAcA,EACzBC,kBACAC,eAAc,MAKd,MAAMC,GAA2B36B,EAAAA,EAAAA,QAAO,OAExCjJ,EAAAA,EAAAA,YAAU,KAEJ4jC,EAAS/5B,SAAW85B,GACtBC,EAAS/5B,QAAQkE,O,GAElB,IAEH,MAAMvQ,GAAQkB,EAAAA,EAAAA,MACRmlC,EAAyB/zB,IAAS4zB,EAAiBI,EAAAA,IACzD,OACEtnC,EAAAA,EAAAA,IAACgU,EAAAA,GAAK,CACJC,QAAQjU,EAAAA,EAAAA,IAACkU,EAAAA,EAAMC,OAAM,CAACE,UAAWrT,EAAMG,OAAOC,UAAU6W,OACxDzD,aAAa1Q,EAAAA,EAAAA,GAAE,UACf4C,SAAWyK,IACT,MAAMo2B,EAAap2B,EAAMxK,OAAOC,MAChCygC,EAAuBE,EAAW,EAEpCtnC,IAAKA,EAAAA,EAAG;;wBAE2B,EAAjBe,EAAMU;QAExBqL,IAAKq6B,GACL,EAIN,IAAKI,GAAL,SAAKA,GACHA,EAAA,sBACAA,EAAA,mBACD,CAHD,CAAKA,IAAAA,EAAiB,KAKtB,MAAMC,EAAeA,EACnB/gC,WACAE,YAKA5G,EAAAA,EAAAA,IAACwG,EAAAA,EAAMC,MAAK,CAACG,MAAOA,EAAOF,SAAUA,EAASxG,UAC5C8D,EAAAA,EAAAA,IAACkxB,EAAAA,EAAK,CAACC,UAAU,WAAUj1B,SAAA,EACzBF,EAAAA,EAAAA,IAACwG,EAAAA,EAAK,CAACI,MAAO4gC,EAAkB9O,UAAUx4B,UAAE4D,EAAAA,EAAAA,GAAE,qBAC9C9D,EAAAA,EAAAA,IAACwG,EAAAA,EAAK,CAACI,MAAO4gC,EAAkB/O,SAASv4B,UAAE4D,EAAAA,EAAAA,GAAE,yBAK7C4jC,EAAwB7mC,EAAAA,GAAOY,GAAG;;;;aAI3B,EAAGT,WAAgC,EAAjBA,EAAMU,SAAT;EAGtBimC,EAAoB9mC,EAAAA,GAAO2gB,IAAI;eACtB,EAAGxgB,WAAYA,EAAMmgB,WAAWC,MAAMC;WAC1C,EAAGrgB,WAAYA,EAAMG,OAAOC,UAAU6W;mBAC9B,EAAGjX,WAA6B,EAAjBA,EAAMU;;EAIlCkmC,EAA8BA,EAClCC,aACAC,qBACA3gC,eACA4gC,2BAUA,MAAM/mC,GAAQkB,EAAAA,EAAAA,MAERwE,EAAY4N,IAChBwzB,EAAmBD,EAAYvzB,EAAE3N,OAAOC,MAAM,EAG1CohC,GAAiBjoC,EAAAA,EAAAA,UACrB,IACEoH,GACEnD,EAAAA,EAAAA,IAAC0jC,EAAqB,CAACrjC,QAASiQ,GAAKA,EAAEC,kBAAkBrU,SAAA,EAEvDF,EAAAA,EAAAA,IAACioC,EAAAA,GAAM,CACLzR,OAAQv2B,EAAAA,EAAG;;;;iBAMbD,EAAAA,EAAAA,IAAC2nC,EAAiB,CAAAznC,UAAE4D,EAAAA,EAAAA,GAAE,wBACtB9D,EAAAA,EAAAA,IAACynC,EAAY,CACX/gC,SAAUA,EACVE,MACEmhC,EACIP,EAAkB/O,SAClB+O,EAAkB9O,eAI1B,MACN,CAACvxB,EAAc4gC,IAGjB,OAAO5gC,GACLnD,EAAAA,EAAAA,IAAA,QAAA9D,SAAA,EACEF,EAAAA,EAAAA,IAAC80B,EAAAA,EAAO,CACNoT,iBAAiB,4BACjBhvB,QAAQ,QACRkR,QAAS4d,EACTjU,UAAU,aACVqB,oBAAkB,EAAAl1B,UAElBF,EAAAA,EAAAA,IAACkU,EAAAA,EAAMmhB,gBAAe,CACpBjhB,SAAS,IACTC,UAAWrT,EAAMG,OAAOC,UAAUC,OAClCpB,KAAGmZ,EAAAA,EAAAA,IAAE,CAAE+uB,YAAa,GAAGnnC,EAAMU,cAAc,OAC3C2C,QAASiQ,GAAKA,EAAEC,sBAGnBszB,MAGH7nC,EAAAA,EAAAA,IAAA,QAAAE,SAAO2nC,GACR,EAGUO,EAAuBA,CAClCb,EACA9/B,KAEA,MAAM4gC,GAAgBtoC,EAAAA,EAAAA,UACpB,SAAAuoC,EAAA,OAKG,OALHA,EACM,MAAJ7gC,OAAI,EAAJA,EAAM/B,KAAKmzB,GACTxtB,OAAOsC,OAAOkrB,GAAKnzB,KAAIkB,GACrBA,EAAQA,EAAM4X,WAAW/K,eAAgB3P,EAAAA,EAAAA,GAAE,YAE9CwkC,EAAI,EAAE,GACT,CAAC7gC,IAGH,OAAO1H,EAAAA,EAAAA,UAAQ,IACJ,MAAJ0H,GAAAA,EAAMlC,OAGJkC,EAAKxB,QAAO,CAACsiC,EAAGxgC,IACrBsgC,EAActgC,GAAO2D,MACnB9E,GAAc,MAALA,OAAK,EAALA,EAAOgM,SAAS20B,EAAW9zB,mBAJ/B,IAOR,CAAChM,EAAM8/B,EAAYc,GAAe,EAGjCG,GAAgBjU,EAAAA,EAAAA,IAAiBF,EAAAA,QAAYC,mBAEtCmU,EAAkBA,CAC7BphC,EACAC,EACAG,EACAN,EACAQ,EACA+gC,EACAnO,KAEA,MAAOoO,EAA8BC,IACnCvmC,EAAAA,EAAAA,WAAmBwmC,EAAAA,EAAAA,GAAe1hC,IAE9B2gC,EAAqBA,CACzBD,EACAzf,KAEA,GAAKjhB,EAGL,GACEihB,IAAeof,EAAkB/O,UAChCkQ,EAA6B/1B,SAASi1B,IAMlC,GACLzf,IAAeof,EAAkB9O,WACjCiQ,EAA6B/1B,SAASi1B,GACtC,CACA,MAAM/d,GAAO+e,EAAAA,EAAAA,GAAe1hC,GAC5B2iB,EAAKI,OAAOJ,EAAK5M,QAAQ2qB,GAAa,IACtCiB,EAAAA,EAAAA,GAAe3hC,EAAc2iB,GAC7B8e,EAAgC9e,E,MAZhC,CACA,MAAMA,GAAO+e,EAAAA,EAAAA,GAAe1hC,GAC5B2iB,EAAKlS,KAAKiwB,IACViB,EAAAA,EAAAA,GAAe3hC,EAAc2iB,GAC7B8e,EAAgC9e,E,GAkBpC,OANAtmB,EAAAA,EAAAA,YAAU,KACJmE,GACFihC,GAAgCC,EAAAA,EAAAA,GAAe1hC,G,GAEhD,CAACA,EAAcQ,KAEX5H,EAAAA,EAAAA,UACL,IACEsH,GAAgB,MAAJI,GAAAA,EAAMlC,OACd8B,EACGpB,QAAQrB,GAAmByG,OAAOC,KAAK7D,EAAK,IAAImL,SAAShO,KACzDc,KAAI,CAAC9B,EAAKmE,KACT,MAAMghC,EAAkB,MAARzhC,OAAQ,EAARA,EAAWS,GACrBihC,EAAavhC,EAAK,GAAG7D,GACrBqlC,EACJF,IAAYzQ,EAAAA,EAAgBC,SACxBoQ,EAA6BzrB,QAAQtZ,IACpC,EACDmkC,EACJY,EAA6B/1B,SAAShP,GACxC,MAAO,CAELoJ,GAAIpJ,GAAOmE,EACXmhC,SAAUrQ,GAAOA,EAAIj1B,GACrBulC,OACEJ,IAAYzQ,EAAAA,EAAgBC,UACN,iBAAfyQ,GACLhpC,EAAAA,EAAAA,IAAC4nC,EAA2B,CAC1BC,WAAYjkC,EACZuD,aAAcA,EACd2gC,mBAAoBA,EACpBC,qBAAsBA,IAGxBnkC,EAEJwlC,KAAMA,EAAGxiC,YACO,IAAVA,EACKqtB,EAAAA,IAEK,IAAVrtB,EACKstB,EAAAA,GAEK,OAAVttB,GACK5G,EAAAA,EAAAA,IAAC4mC,EAAQ,CAAA1mC,SAAEi0B,EAAAA,KAGlB4U,IAAYzQ,EAAAA,EAAgBC,WACU,IAAtC0Q,GACiB,iBAAVriC,EAEA4hC,EAAc5hC,GAEF,iBAAVA,GAAsB2zB,GACxB8O,EAAAA,EAAAA,IAAaziC,GAEfopB,OAAOppB,MAEF,MAAX8hC,OAAW,EAAXA,EAAc9kC,GACR,IAEf,IACN,CACEyD,EACAI,EACAH,EACAH,EACAuhC,EACAC,GAEH,C,qECzVI,MAAME,EAAkB1hC,IAC7B,MAAMmiC,GAAUC,EAAAA,EAAAA,IACdC,EAAAA,GAAiBC,6CACjB,CAAC,GAEH,YAAqBjlC,IAAjB2C,EACK,IAEF1B,EAAAA,EAAAA,GAAc6jC,EAAQniC,GAAc,EAGhC2hC,EAAiBA,CAAC3hC,EAAsBtB,KACnD,MAAMyjC,GAAUC,EAAAA,EAAAA,IACdC,EAAAA,GAAiBC,6CACjB,CAAC,IAEHC,EAAAA,EAAAA,IAAQF,EAAAA,GAAiBC,6CAA8C,IAClEH,EACH,CAACniC,GAAetB,GAChB,C,qKCdG,MAAM8jC,EAAuB9oC,EAAAA,GAAOY,GAAG;IAC1C,EAAGT,WAAY,2GAImB,EAAjBA,EAAMU;EAQd4zB,EAAgBA,EAC3B7tB,OACAN,eACAyiC,gBACAC,cACAC,cACAviC,WACAic,YACAze,kBAEA,MAAMglC,GAAsBlB,EAAAA,EAAAA,GAAe1hC,GACrC6iC,EAAuBC,IAC3BJ,EACAC,GAEC7jC,QACC,EAAEsd,EAAM1T,KACNA,IAASyoB,EAAAA,EAAgBC,UACzBhV,IACCwmB,EAAoBn3B,SAAS2Q,KAEjC7d,KAAI,EAAEwkC,KAAaA,IAChBC,GAAgBpqC,EAAAA,EAAAA,UACpB,KAAMqqC,EAAAA,EAAAA,IAA6B3iC,EAAMuiC,IACzC,CAACviC,EAAMuiC,IAET,OACEhmC,EAAAA,EAAAA,IAAC2lC,EAAoB,CAAAzpC,SAAA,EACnBF,EAAAA,EAAAA,IAACinC,EAAAA,GAAW,CAACC,gBAAiB0C,EAAezC,aAAW,KACxDnjC,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;;UAGNC,SAAA,EAEFF,EAAAA,EAAAA,IAACm2B,EAAAA,EAAa,CAAC5uB,SAAUA,EAAUkuB,QAASjS,IAC3Cze,IACC/E,EAAAA,EAAAA,IAAC6mC,EAAAA,EAAqB,CAACp/B,KAAM0iC,EAAetkC,QAASgkC,SAGpC,C,wGCvDpB,MAAMziC,EAAwBA,EACnCK,OACAJ,WACAC,WACAC,WACAJ,eACAO,WAAW,GACXC,YACA5C,kBAEA,MAAOwiC,EAAY8C,IAAiBhoC,EAAAA,EAAAA,UAAS,IAIvCwD,GAAU4iC,EAAAA,EAAAA,IACdphC,EACAC,EACAG,EACAN,EACAQ,EACA,CAAC,GACD,GAEI2iC,GAAelC,EAAAA,EAAAA,IAAqBb,EAAY9/B,GAEtD,OACEzD,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAACs1B,EAAAA,EAAa,CACZ7tB,KAAM6iC,EACNT,YAAaxiC,EACbyiC,YAAaxiC,EACbC,SAAUA,EACVJ,aAAcA,EACdyiC,cAAet4B,GAAS+4B,EAAc/4B,GACtCkS,WAAW,EACXze,YAAaA,KAEf/E,EAAAA,EAAAA,IAACuqC,EAAAA,EAAS,CACR1kC,QAASA,EACT4B,KAAM6iC,EACNjK,SAAU34B,EACV8iC,YAAY1mC,EAAAA,EAAAA,GAAE,cACd2mC,iBAAkBC,EAAAA,EAAiB9P,MACnC5hB,UAAU,kBACV2xB,oBAAkB,EAClBC,cAAc,EACdC,OAAK,MAEN,C,iDChDKC,E,8EAAZ,SAAYA,GACVA,EAAA,kBACAA,EAAA,iBACD,CAHD,CAAYA,IAAAA,EAAW,K,sGCMvB,MAAMnoB,EAAQ9hB,EAAAA,GAAOkqC,GAAG;gBACR,EAAG/pC,WAAgC,EAAjBA,EAAMU,SAAT;EAGzBspC,EAAQ,IAAIC,QAELC,EAAiBA,EAC5BC,YACA7R,gBACA8R,aACAtwB,WACA8F,eACA/G,UACAlS,YACAD,WAAW,GACX3C,kBACqC,IAAAsmC,EACrC,MAAMC,GAAW15B,EAAAA,EAAAA,KAA2B3B,KAC7B,MAAbqpB,OAAa,EAAbA,EAAeh5B,YAAyB,MAAbg5B,OAAa,EAAbA,EAAelf,WAGrCmxB,EAAYC,IAAiBnpC,EAAAA,EAAAA,UAAiC,KAC9DmhB,EAAW0T,IAAgB70B,EAAAA,EAAAA,WAAkB,IAC7C80B,EAAeC,IAAoB/0B,EAAAA,EAAAA,UAAiB,IACrDopC,EAAuC,OAA7BJ,EAAW,MAARC,OAAQ,EAARA,EAAUI,kBAAgBL,EAAI,EA+CjD,IA7CA7nC,EAAAA,EAAAA,YAAU,KAEJod,IACAuqB,GAAaH,EAAMhS,IAAIM,KACzBkS,GAAc/lC,EAAAA,EAAAA,GAAculC,EAAM/6B,IAAIqpB,KACtClC,EAAiB,IACbgU,GAAcvxB,GAChBA,EAAQ8xB,eAAc,GAExBzU,GAAa,IAEXiU,IAAcH,EAAMhS,IAAIM,KAC1BpC,GAAa,IACb7oB,EAAAA,EAAAA,qBAAoB,CAClB5O,SAAU65B,EACV7Y,MAAO2qB,EACPvZ,aAAc,OACdD,WAAY,UACZ9W,aAECnX,MAAK,EAAG4K,WACPi9B,GAAc/lC,EAAAA,EAAAA,GAAc8I,EAAK7O,SACjC03B,EAAiB,IACjB4T,EAAM7R,IAAIG,EAAe/qB,EAAK7O,QAC1B0rC,GAAcvxB,GAChBA,EAAQ8xB,eAAc,E,IAGzB9nC,OAAMyK,KACLyyB,EAAAA,EAAAA,IAAqBzyB,GAAU3K,MAAK,EAAGqP,QAAOlD,cAC5CsnB,EAAiBpkB,GAASlD,IAAWhM,EAAAA,EAAAA,GAAE,4BAA4B,GACnE,IAEH4K,SAAQ,KACPwoB,GAAa,EAAM,K,GAGxB,CAACoC,EAAe6R,KAEnB3nC,EAAAA,EAAAA,YAAU,KACJod,GACFsW,GAAa,E,GAEd,CAACtW,IAEA4C,EACF,OAAO3a,MAAM4iC,GAAYlN,MAAKv+B,EAAAA,EAAAA,IAAC2P,EAAAA,EAAO,KAGxC,GAAIiR,EAAc,CAChB,MAAM5R,GAAQlL,EAAAA,EAAAA,GAAE,kCAChB,OAAO+E,MAAM4iC,GAAYlN,MACvBv+B,EAAAA,EAAAA,IAAC06B,EAAAA,GAAgB,CAAClb,MAAM,eAAexQ,MAAOA,I,CAIlD,GAAImoB,EAAe,CACjB,MAAMyU,GACJ5nC,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAACs1B,EAAAA,EAAa,CACZ7tB,KAAM,GACNoiC,YAAa,GACbC,YAAa,GACbviC,SAAU,EACVJ,aAAcmyB,EAAc94B,WAC5BopC,cAAeA,OACfpmB,WAAW,EACXze,YAAaA,KAEf/E,EAAAA,EAAAA,IAAC2iB,EAAK,CAAAziB,SAAEi3B,OAGZ,OAAOtuB,MAAM4iC,GAAYlN,KAAKqN,E,CAGhC,GAA0B,IAAtBL,EAAWhmC,OAAc,CAC3B,MAAMyJ,GAAQlL,EAAAA,EAAAA,GAAE,2CAChB,OAAO+E,MAAM4iC,GAAYlN,MACvBv+B,EAAAA,EAAAA,IAAC06B,EAAAA,GAAgB,CAAClb,MAAM,eAAexQ,MAAOA,I,CAGlD,OAAOu8B,EACJ7gC,MAAM,EAAG+gC,GACT/lC,KAAI,CAAChG,EAAQmsC,KACZ7rC,EAAAA,EAAAA,IAACoH,EAAAA,EAAqB,CACpBK,KAAM/H,EAAO+H,KACbJ,SAAU3H,EAAO2H,SACjBC,SAAU5H,EAAO4H,SACjBC,SAAU7H,EAAO6H,SACjBG,SAAUA,EACVP,aAAcmyB,EAAc94B,WAE5BmH,UAAWA,EACX5C,YAAaA,GAFR8mC,IAIP,ECpIAC,EAAUjrC,EAAAA,GAAOY,GAAG;;;;;;;;;;;;;;;;;;;;;EAuBbsqC,EAAyBA,EACpCZ,YACA7R,gBACA8R,aACAtwB,WACA8F,eACA/G,UACAlS,YACAD,WAAW,GACX3C,kBAEA,MAAMinC,EAAed,EAAe,CAClCtqB,eACA0Y,gBACA8R,aACAtwB,WACAqwB,YACAtxB,UACAnS,WACAC,YACA5C,gBAGF,GAA4B,IAAxBinC,EAAazmC,OACf,OAAOvF,EAAAA,EAAAA,IAAC8rC,EAAO,CAAA5rC,SAAE8rC,EAAa,KAGhC,MAAMC,EAAQD,EAAatmC,KAAI,CAACwmC,EAAML,IACxB,IAARA,GAEA7rC,EAAAA,EAAAA,IAAC4H,EAAAA,GAAKI,QAAO,CAACC,KAAKnE,EAAAA,EAAAA,GAAE,WAAW5D,SAC7BgsC,GADmCpB,EAAYqB,UAOpDnsC,EAAAA,EAAAA,IAAC4H,EAAAA,GAAKI,QAAO,CACXC,KAAKnE,EAAAA,EAAAA,GAAE,aAAc+nC,EAAM,GAAG3rC,SAG7BgsC,GAFI,GAAGpB,EAAYqB,WAAWN,EAAM,OAO3C,OACE7rC,EAAAA,EAAAA,IAAC8rC,EAAO,CAAA5rC,UACNF,EAAAA,EAAAA,IAAC4H,EAAAA,GAAI,CAACC,WAAW,EAAM3H,SAAE+rC,KACjB,E,0BChEd,MAAMtpB,EAAQ9hB,EAAAA,GAAOkqC,GAAG;gBACR,EAAG/pC,WAAgC,EAAjBA,EAAMU,SAAT;EAGzBspC,EAAQ,IAAIoB,QAELC,EAAcA,EACzBlB,YACA3qC,aACA4qC,aACAvxB,UACAnS,WAAW,GACXC,YACA5C,kBAEA,MAAOwiC,EAAY8C,IAAiBhoC,EAAAA,EAAAA,UAAS,KACtCoF,EAAM6kC,IAAWjqC,EAAAA,EAAAA,UAAkC,KACnDgF,EAAUklC,IAAelqC,EAAAA,EAAAA,UAAmB,KAC5CiF,EAAUklC,IAAenqC,EAAAA,EAAAA,UAA4B,KACrDmhB,EAAW0T,IAAgB70B,EAAAA,EAAAA,WAAkB,IAC7CkF,EAAUklC,IAAepqC,EAAAA,EAAAA,UAAiB,IAC1C80B,EAAeC,IAAoB/0B,EAAAA,EAAAA,UAAiB,IACrD8E,GAAepH,EAAAA,EAAAA,UACnB,IAAM,GAAGS,EAAWwM,OAAOxM,EAAWqP,QACtC,CAACrP,KAGHgD,EAAAA,EAAAA,YAAU,KACJ2nC,GAAaC,GACfJ,EAAM73B,OAAO3S,GAGX2qC,IAAcH,EAAMhS,IAAIx4B,KAC1B02B,GAAa,IACbgD,EAAAA,EAAAA,sBAAqB15B,EAAWqP,KAAMrP,EAAWwM,GAAIo+B,EAAY,CAAC,GAC/DznC,MAAK2K,IACJg+B,GAAQ7mC,EAAAA,EAAAA,GAAc6I,EAAS7G,OAC/B8kC,GAAY9mC,EAAAA,EAAAA,GAAc6I,EAASjH,WACnCmlC,GAAY/mC,EAAAA,EAAAA,GAAc6I,EAAShH,WACnCmlC,EAAYn+B,EAAS/G,UACrB6vB,EAAiB,IACjB4T,EAAM3hC,IAAI7I,GACN4qC,GAAcvxB,GAChBA,EAAQ8xB,eAAc,E,IAGzB9nC,OAAMmP,IACLs5B,EAAQ,IACRC,EAAY,IACZC,EAAY,IACZpV,EAAiB,GAAGpkB,EAAMuQ,SAASvQ,EAAMlD,UAAU,IAEpDpB,SAAQ,KACPwoB,GAAa,EAAM,I,GAGxB,CAAC12B,EAAY2qC,EAAWC,IAI3B,MAAMvlC,GAAU4iC,EAAAA,EAAAA,IACdphC,EACAC,EACAG,EACAN,EACAQ,EACA,CAAC,GACD,GAEI2iC,GAAelC,EAAAA,EAAAA,IAAqBb,EAAY9/B,GAEtD,GAAI+b,EACF,OAAOxjB,EAAAA,EAAAA,IAAC2P,EAAAA,EAAO,IAGjB,GAAIwnB,EACF,OACEnzB,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAACs1B,EAAAA,EAAa,CACZ7tB,KAAM6iC,EACNT,YAAaxiC,EACbyiC,YAAaxiC,EACbC,SAAUA,EACVJ,aAAcA,EACdyiC,cAAet4B,GAAS+4B,EAAc/4B,GACtCkS,UAAWA,EACXze,YAAaA,KAEf/E,EAAAA,EAAAA,IAAC2iB,EAAK,CAAAziB,SAAEi3B,OAKd,GAAoB,IAAhB1vB,EAAKlC,OAAc,CACrB,MAAMyJ,GAAQlL,EAAAA,EAAAA,GAAE,6CAChB,OAAO9D,EAAAA,EAAAA,IAAC06B,EAAAA,GAAgB,CAAClb,MAAM,eAAexQ,MAAOA,G,CAGvD,OACEhL,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAACs1B,EAAAA,EAAa,CACZ7tB,KAAM6iC,EACNT,YAAaxiC,EACbyiC,YAAaxiC,EACbC,SAAUA,EACVJ,aAAcA,EACdyiC,cAAet4B,GAAS+4B,EAAc/4B,GACtCkS,UAAWA,EACXze,YAAaA,KAEf/E,EAAAA,EAAAA,IAACuqC,EAAAA,EAAS,CACR1kC,QAASA,EACT4B,KAAM6iC,EACNjK,SAAU34B,EACV8iC,YAAY1mC,EAAAA,EAAAA,GAAE,cACd2mC,iBAAkBC,EAAAA,EAAiB9P,MACnC5hB,UAAU,kBACV2xB,oBAAkB,EAClBC,cAAc,EACdC,OAAK,MAEN,EChHD6B,EAAY7rC,EAAAA,GAAOY,GAAG;IACxB,EAAGT,WAAY,oDAEKA,EAAMG,OAAOC,UAAUyqB,gaAwBL,EAAjB7qB,EAAMU,6DAGa,EAAjBV,EAAMU;EAWpBirC,EAAiBA,EAC5BrT,gBACA94B,aACA4qC,aACAwB,mBACAryB,cACAO,WACA8F,eACA/G,UACA9U,kBAEA,MAAM/D,GAAQkB,EAAAA,EAAAA,OACP2qC,EAAcC,IAAmBzqC,EAAAA,EAAAA,UAAiByoC,EAAYqB,UAC9DhB,EAAW4B,IAAgB1qC,EAAAA,EAAAA,UAAuC,CACvE8oB,SAAS,EACT6hB,SAAS,KAEJC,EAAWC,IAAgB7qC,EAAAA,EAAAA,YAChCyU,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYo2B,4BAEzB5D,EAAAA,EAAAA,IAAQC,EAAAA,GAAiB4D,iBAAiB,KAGhD5pC,EAAAA,EAAAA,YAAU,MACHsT,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYo2B,4BAChCzD,EAAAA,EAAAA,IAAQF,EAAAA,GAAiB4D,gBAAiBH,EAAU,GACrD,CAACA,KAEJzpC,EAAAA,EAAAA,YAAU,KACHypC,GACHF,EAAa,CACX5hB,SAAS,EACT6hB,SAAS,IAKXC,GACAJ,EAAaQ,WAAWvC,EAAYqB,UACpC5xB,GACgB,YAAhBA,GAEAwyB,EAAa,CACX5hB,SAAS,EACT6hB,SAAS,IAITC,GAAaJ,IAAiB/B,EAAYwC,SAC5CP,EAAa,CACX5hB,SAAS,EACT6hB,SAAS,G,GAGZ,CAACC,EAAWJ,EAActyB,IAE7B,MAAMgzB,GAAuB7qC,EAAAA,EAAAA,cAC1B8qC,IACCZ,EAAiBY,GACjBN,EAAaM,EAAO,GAEtB,CAACZ,IAGGa,GAAiB/qC,EAAAA,EAAAA,cACrB,CAACgrC,EAAgBp5B,KACV24B,EAEMS,IAAWb,IACpBv4B,EAAEsK,iBACF2uB,GAAqB,IAHrBA,GAAqB,GAKvBT,EAAgBY,EAAO,GAEzB,CAACb,EAAcU,EAAsBN,IAGjCU,GAAiB5tC,EAAAA,EAAAA,UAAQ,KAC7B,MAAM6tC,EAAYX,GAChBjtC,EAAAA,EAAAA,IAACkU,EAAAA,EAAM25B,QAAO,CACZx5B,UAAWrT,EAAMG,OAAOC,UAAU6W,KAClC,cAAYnU,EAAAA,EAAAA,GAAE,0BAGhB9D,EAAAA,EAAAA,IAACkU,EAAAA,EAAM45B,UAAS,CACdz5B,UAAWrT,EAAMG,OAAOC,UAAU6W,KAClC,cAAYnU,EAAAA,EAAAA,GAAE,uBAGlB,OACE9D,EAAAA,EAAAA,IAAC2pC,EAAAA,EAAoB,CAAAzpC,SAClB+sC,GACCjtC,EAAAA,EAAAA,IAAA,QACE6jB,KAAK,SACLC,SAAU,EACVzf,QAASA,IAAMkpC,GAAqB,GAAOrtC,SAE1C0tC,KAGH5tC,EAAAA,EAAAA,IAAA,QACE6jB,KAAK,SACLC,SAAU,EACVzf,QAASA,IAAMkpC,GAAqB,GAAMrtC,SAEzC0tC,KAGgB,GAExB,CAACL,EAAsBN,EAAWjsC,EAAMG,OAAOC,UAAU6W,OAEtD81B,EAAoB7C,EAAe,CACvCtqB,eACA0Y,gBACA8R,aACAtwB,WACAqwB,UAAWA,EAAUhgB,QACrBtR,UACAlS,UAAWmjC,EAAYqB,UAAYU,EACnC9nC,gBACCW,KAAI,CAACwmC,EAAML,IACA,IAARA,GAEA7rC,EAAAA,EAAAA,IAAC4H,EAAAA,GAAKI,QAAO,CAACC,KAAKnE,EAAAA,EAAAA,GAAE,WAAW5D,SAC7BgsC,GADmCpB,EAAYqB,SAKlDN,EAAM,GAEN7rC,EAAAA,EAAAA,IAAC4H,EAAAA,GAAKI,QAAO,CACXC,KAAKnE,EAAAA,EAAAA,GAAE,aAAc+nC,EAAM,GAAG3rC,SAG7BgsC,GAFI,GAAGpB,EAAYqB,WAAWN,EAAM,KAMpC,OAGT,OACE7rC,EAAAA,EAAAA,IAAC0sC,EAAS,CAAAxsC,UACR8D,EAAAA,EAAAA,IAAC4D,EAAAA,GAAI,CACHC,WAAW,EACXmmC,mBAAoBL,EACpBM,UAAWhB,EAAYJ,EAAe,GACtCqB,WAAYT,EAAevtC,SAAA,CAE1B6tC,GACD/tC,EAAAA,EAAAA,IAAC4H,EAAAA,GAAKI,QAAO,CAACC,KAAKnE,EAAAA,EAAAA,GAAE,WAAW5D,UAC9BF,EAAAA,EAAAA,IAACqsC,EAAW,CACV7rC,WAAYA,EACZ4qC,WAAYA,EACZD,UAAWA,EAAU6B,QACrBnzB,QAASA,EACTlS,UAAWmjC,EAAYwC,UAAYT,EACnC9nC,YAAaA,KAPqB+lC,EAAYwC,aAW1C,C,kBC7NT,IAAK1lB,E,iBAAZ,SAAYA,GAEVA,EAAA,gBAEAA,EAAA,4BAEAA,EAAA,gCAGAA,EAAA,gBAEAA,EAAA,4BAEAA,EAAA,gCAGAA,EAAA,2BACD,CAjBD,CAAYA,IAAAA,EAAW,I,mCCFhB,MAAMumB,E,SAAwBttC,GAAOY,GAAG;;;;kBAI7B,EAAGT,WAA6B,EAAjBA,EAAMU;oBACnB,EAAGV,YAA8B,EAAlBA,EAAMU;;;;cAI3B,EAAGV,WAAYA,EAAMG,OAAOC,UAAUw9B;;+FCApD,MAAMwP,GAAkBtqC,EAAAA,EAAAA,GACtB,iFAGY,SAAUqyB,EAAc5rB,GACpC,MAAM,SAAEhD,EAAW,EAAC,MAAE8mC,EAAQ,KAAI,QAAE5Y,GAAYlrB,EAC1C+jC,EAAeD,GAAS9mC,GAAY8mC,EACpCx+B,EACJy+B,GAA8B,IAAb/mC,IAAmBkuB,EAAW,SAAW,UACtD8Y,GAAoBC,EAAAA,EAAAA,KAAAA,CAAqBjnC,GACzCof,GACJ3mB,EAAAA,EAAAA,IAACyuC,EAAAA,EAAK,CAAC5+B,KAAMA,EAAK3P,SACfu1B,GACC3xB,EAAAA,EAAAA,GAAE,eAEF9D,EAAAA,EAAAA,IAAA,QAAAE,UACGwuC,EAAAA,EAAAA,IAAG,SAAU,UAAWnnC,EAAUgnC,OAK3C,OAAOD,GACLtuC,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CAAC9mB,GAAG,sBAAsBgC,OAAOhP,EAAAA,EAAAA,IAAA,QAAAE,SAAOkuC,IAAwBluC,SACrEymB,IAGHA,CAEJ,C,mNC5Bc,SAAUgoB,EAAiBpkC,GACvC,MAAM,GAAEyC,EAAE,MAAE2Z,EAAK,OAAExlB,GAAWoJ,GACvBqkC,EAAaC,IAAkBxsC,EAAAA,EAAAA,WAAkB,GAClDysC,GAAeriC,EAAAA,EAAAA,QAAoB,MACnCsiC,GAAiBtiC,EAAAA,EAAAA,QAAoB,MAmBrCuiC,EAAaA,IACjB7tC,EAAOuE,KAAI,CAACsS,EAAeqlB,KACzBr9B,EAAAA,EAAAA,IAAA,QAGEC,IAAMe,GAAgCf,EAAAA,EAAG;0BACvBe,EAAMU,SAAW;;;;gCAIXsW;gCACU,UAAVA,EAAoB,QAAUA;;;;WAPjD,GAAGhL,KAAMqwB,OAsBpB,OACEr9B,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CACN,cAAY,UACZoU,iBAAiB,uBACjBl5B,MAXmBigC,KACrBjrC,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAA,QAAAE,SAAOymB,KACP3mB,EAAAA,EAAAA,IAAA,OAAAE,SAAM8uC,SAUNja,QAAS6Z,EAAY1uC,UAErB8D,EAAAA,EAAAA,IAAA,QACEgV,UAAU,sBACV4W,aAtDoBsf,KACxB,MAAMC,EAAmBL,EAAazhC,QAChC+hC,EAAqBL,EAAe1hC,QAExC8hC,GACAC,IACCD,EAAiBE,YAAcF,EAAiBG,aAC/CH,EAAiBI,aAAeJ,EAAiBK,cACjDJ,EAAmBC,YAAcD,EAAmBE,aACpDF,EAAmBG,aAAeH,EAAmBI,eAEvDX,GAAe,E,EA4Cbhf,aAzCoB4f,KACxBZ,GAAe,EAAM,EAyCjB5uC,IAAKA,EAAAA,EAAG;;;;UAINC,SAAA,EAGFF,EAAAA,EAAAA,IAAA,QACEgZ,UAAU,qBACVjM,IAAK+hC,EACL7uC,IAAMe,GAAyBf,EAAAA,EAAG;;6BAEE,EAAjBe,EAAMU;;;;YAIvBxB,SAEDymB,KAEH3mB,EAAAA,EAAAA,IAAA,QACE+M,IAAKgiC,EACL9uC,IAAMe,GAAyBf,EAAAA,EAAG;;;;;6BAKfe,EAAMU;YACvBxB,SAED8uC,UArCAhiC,EA0CX,CCtFA,MAAM,OAAE0iC,EAAM,SAAEC,GAAaC,EAAAA,QAsBvBC,GAAchvC,EAAAA,EAAAA,IAAOqT,EAAAA,EAAM47B,WAAW;WACjC,EAAG9uC,WAAYA,EAAMG,OAAO4uC,MAAM93B;EAGvC+3B,GAAqBlsC,EAAAA,EAAAA,GACzB,uHAIImsC,GAAkBnsC,EAAAA,EAAAA,GACtB,wHAII2qC,EAAQA,EACZ9nB,QACAupB,uBACA3vB,kBAKA,GAAI2vB,GAAwB3vB,EAAa,CACvC,MAAM4vB,EAAaD,EACfF,EACAC,EACJ,OACEjsC,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,CACGymB,EAAO,KACR3mB,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CAAC9kB,MAAOmhC,EAAWjwC,UACzBF,EAAAA,EAAAA,IAAC6vC,EAAW,CAACz7B,SAAS,U,CAK9B,OAAOpU,EAAAA,EAAAA,IAAAiE,EAAAA,GAAA,CAAA/D,SAAGymB,GAAS,EAgLrB,EA7K2BypB,EACzBF,wBAAuB,EACvB3vB,cACAoG,SAAQ7iB,EAAAA,EAAAA,GAAE,gBACV4C,WAAWA,SACXE,QACAypC,aAAY,EACZC,gBACAC,UAAU,GACVC,UAAU,CAAC,EACXC,cACGlgC,MAEH,MAAMvP,GAAQkB,EAAAA,EAAAA,MACRwuC,GAAgB3wC,EAAAA,EAAAA,UAAQ,KAC5B,GAAIwgB,EACF,MAAO,YAET,IAAI7gB,EAASkH,GAAS0pC,EACtB,GAAe,qBAAX5wC,EAA+B,CAAC,IAADixC,EACjC,MAAMC,EAAgBC,IAAWL,GAAWA,IAAYA,EACxD9wC,EAAsB,MAAbkxC,GAA+B,OAAlBD,EAAbC,EAAeE,uBAAF,EAAbH,EAAiC3jC,E,CAE5C,OAAOtN,CAAM,GACZ,CAAC6gB,EAAa+vB,EAAeE,EAAS5pC,IAEnCkgB,GAAU/mB,EAAAA,EAAAA,UAAQ,KACtB,GAAIwgB,EACF,MAAO,EACLvgB,EAAAA,EAAAA,IAAC0vC,EAAM,CAAC9oC,MAAM,YAAY+f,OAAO7iB,EAAAA,EAAAA,GAAE,aAAa5D,UAC9CF,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CAAC9kB,MAAOihC,EAAgB/vC,UAAE4D,EAAAA,EAAAA,GAAE,uBADe,cAKzD,MAAM8sC,EAAgBC,IAAWL,GAAWA,IAAYA,EAClDO,EAAiBF,IAAWN,GAAWA,IAAYA,EACnDS,EAA4B,GAS5BC,EARuBF,EAAe9qC,QAAOirC,IACjD,MAAMhoB,EAASgoB,EAAE,GACXC,EACO,qBAAXjoB,IAAkC8nB,EAAgBp+B,SAASsW,GAE7D,OADA8nB,EAAgBp5B,KAAKsR,GACdioB,CAAkB,IAGSloC,QAClC,CAACC,GAAMtC,MAAU,IAAAwqC,EAAAC,EACf,MAAMX,EAAgBE,EAAchqC,GAKpC,IAAIzF,EAAmB,GACnBuvC,IACFvvC,EAASsvC,EACJC,EAAmCY,UAAU,IAC9CZ,EAAcvvC,QAEpB,MAAM+nB,EAAS,CACbqoB,aACEvxC,EAAAA,EAAAA,IAAC2uC,EAAgB,CACf3hC,GAAI0jC,EAAc1jC,GAClB2Z,MAAO+pB,EAAc/pB,MACrBxlB,OAAQA,IAGZwlB,OAAoB,MAAbiqB,GAAsB,OAATQ,EAAbR,EAAgBhqC,SAAH,EAAbwqC,EAAwBzqB,QAAS/f,EACxCA,SAGF,OADAsC,EAAuB,OAApBmoC,EAACX,EAAcc,OAAKH,EAAII,EAAAA,EAAiBC,OAAO5qB,QAAQlP,KAAKsR,GACzDhgB,CAAG,GAEZ,CACE,CAACuoC,EAAAA,EAAiBE,QAAS,CACzB3iC,MAAOyiC,EAAAA,EAAiBE,OACxBhrB,OAAO7iB,EAAAA,EAAAA,GAAE,yBACTgjB,QAAS,IAEX,CAAC2qB,EAAAA,EAAiBG,UAAW,CAC3B5iC,MAAOyiC,EAAAA,EAAiBG,SACxBjrB,OAAO7iB,EAAAA,EAAAA,GAAE,2BACTgjB,QAAS,IAEX,CAAC2qB,EAAAA,EAAiBC,OAAQ,CACxB1iC,MAAOyiC,EAAAA,EAAiBC,MACxB/qB,OAAO7iB,EAAAA,EAAAA,GAAE,wBACTgjB,QAAS,MAIT+qB,EAAiBxmC,OAAOsC,OAAOsjC,GAClChrC,QAAOurC,GAASA,EAAM1qB,QAAQvhB,OAAS,IACvCG,KAAI8rC,IAAK,IACLA,EACH1qB,QAASgrB,IAAON,EAAM1qB,SAASirB,GAAOA,EAAIprB,YAI9C,OAC4B,IAA1BkrB,EAAetsC,QACfssC,EAAe,GAAG7iC,QAAUyiC,EAAAA,EAAiBC,MAEtCG,EAAe,GAAG/qB,QAAQphB,KAAI,CAACqsC,EAAKhqC,KACzC/H,EAAAA,EAAAA,IAAC0vC,EAAM,CAAC9oC,MAAOmrC,EAAInrC,MAAO+f,MAAOorB,EAAIprB,MAAMzmB,SACxC6xC,EAAIR,aAD0CxpC,KAK9C8pC,EAAensC,KAAI,CAAC8rC,EAAOQ,KAChChyC,EAAAA,EAAAA,IAAC2vC,EAAQ,CAAChpB,MAAO6qB,EAAM7qB,MAAMzmB,SAC1BsxC,EAAM1qB,QAAQphB,KAAI,CAACqsC,EAAKE,KACvBjyC,EAAAA,EAAAA,IAAC0vC,EAAM,CACL9oC,MAAOmrC,EAAInrC,MACX+f,MAAOorB,EAAIprB,MAAMzmB,SAGhB6xC,EAAIR,aAFA,GAAGS,KAAcC,QALOD,IAWnC,GACD,CAACzB,EAAShwB,EAAakwB,EAAUD,IAMpC,OACExsC,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAC0rB,EAAAA,EAAa,IACRnb,EACJoW,OACE3mB,EAAAA,EAAAA,IAACyuC,EAAK,CACJ9nB,MAAOA,EACPupB,qBAAsBA,EACtB3vB,YAAaA,OAInBvgB,EAAAA,EAAAA,IAACkyC,EAAAA,GAAY,CACXjyC,IAAKA,EAAAA,EAAG;;;4BAGYe,EAAMU;yBACTV,EAAMmgB,WAAWC,MAAM+wB;;;4BAGH,EAAjBnxC,EAAMU;;UAG1B,cAAYoC,EAAAA,EAAAA,GAAE,uBACd6Q,WAAY07B,EACZ/rC,WAAYic,EACZ7Z,SA5BkBE,GAAkBF,EAASE,GA6B7C4N,aAAa1Q,EAAAA,EAAAA,GAAE,iBACf8C,MAAO8pC,EACP0B,kBAAmBjf,GAAeA,EAAYkf,WAC9CphC,YAAU,EACVqhC,aAAcA,CAACnS,EAAQjX,KACrBqpB,EAAAA,EAAAA,IACEpS,EACAjX,EACA,CAAC,QAAS,UACV,GAEHhpB,SAEA4mB,MAEF,C,4TCpPP,MAAM0rB,EAA4D,CAChEC,uBAAwB,GACxBC,6BAA8B,GAC9B9xB,aAAc,I,+CC6BhB,MAAM+xB,GAAc9xC,EAAAA,EAAAA,IAAOmT,EAAAA,GAAM;mBACd,EAAGhT,WAA6B,EAAjBA,EAAMU;EASlCkxC,IANwB/xC,EAAAA,EAAAA,IAAOgyC,EAAAA,EAAS;;;;GAMtBhyC,EAAAA,EAAAA,IAAOiyC,EAAAA,GAA8B;;eAE9C,EAAGC,eAAgBA,GAAa;;;aAGlC,EAAG/xC,WAAYA,EAAMG,OAAOC,UAAUC;;;GAodnD,EA7Q0DkJ,IAAQ,IAAAyoC,EAAAC,EAChE,MAAM,gBACJC,EAAe,iBACfC,EAAgB,mBAChBC,EAAkB,mBAClBC,EAAkB,mBAClBC,GAlKmCC,CAAChpC,IACtC,MAAMipC,GAAoBC,EAAAA,EAAAA,MAEpBL,EAAqBA,CAACvuB,EAAqBD,KAAmB,IAAA8uB,EAClE,MAAM9uC,EAAiC,OAA3B8uC,EAAGnpC,EAAM/J,WAAWqF,cAAO,EAAxB6tC,EAA0B5tC,MACvCC,GAAOA,EAAIC,cAAgB4e,IAEvB+uB,IACF/uC,IAA2B,SAAhBA,EAAOiL,MAAmC,YAAhBjL,EAAOiL,MAC1C+jC,IACFhvC,IAA2B,QAAhBA,EAAOiL,MAAkC,YAAhBjL,EAAOiL,MACzCgkC,IAAqBjvC,KAAYA,EAAO+lB,WAE9C,GAAI9F,GAAYA,IAAaI,EAAAA,EAAU6uB,gBAAiB,CACtD,MAAM,gBAAE7sB,GAAoB1c,EAC5B,OAAO0c,GAAmBrC,GAAWA,IAAYqC,C,CAEnD,QAAIpC,GAAYA,IAAaI,EAAAA,EAAU8uB,iBAInClvB,IAAaI,EAAAA,EAAUC,QAAUL,IAAaI,EAAAA,EAAUE,QACnDwuB,GAAmBC,GAAkBC,EAE1CF,EACK9uB,IAAaI,EAAAA,EAAUG,QAAUP,IAAaI,EAAAA,EAAUI,UAG/D9a,EAAMga,YAAYe,SAAWC,EAAAA,EAAQwC,SACG,IAAxCisB,EAAAA,GAAiB92B,QAAQ2H,GAAgB,EAqH7C,MAAO,CACLquB,gBAnHuBlmC,IACvB,MAAMkc,EAAS3e,EAAMuc,QAAQhhB,MAC3BojB,GACG,gBAAiBA,GAAUA,EAAOljB,cAAgBgH,GAClD,eAAgBkc,GAAUA,EAAO+D,aAAejgB,IAErD,IACIsY,EADAV,EAAU,GAGVsE,GAAU,gBAAiBA,GAC7BtE,EAAUsE,EAAOljB,YACjBsf,EAASC,EAAAA,EAAQC,OACR0D,GAAU,sBAAuBA,GAC1CtE,EAAUsE,EAAO6B,kBACjBzF,EAASC,EAAAA,EAAQwC,QACF,MAANmB,GAAAA,EAAQvC,QACjB/B,EAAUsE,EAAOvC,MACjBrB,EAASC,EAAAA,EAAQwC,QAEnB,IAAI,SAAElD,EAAQ,WAAEE,EAAU,WAAEC,GAAeza,EAAMga,YACjDM,EACEA,GAAYE,GAAcquB,EAAmBruB,EAAYH,GACrDR,EAAAA,GAA+BW,GAAYV,UAC3C,MACDne,EAAAA,EAAAA,GAAU2e,KAEbA,EAAWI,EAAAA,EAAUgvB,GACrBlvB,EAAaE,EAAAA,EAAUgvB,GACvBjvB,OAAaxgB,IAGX0vC,EAAAA,EAAAA,GAAiBlnC,EAAIzC,EAAM/J,cAC7BokB,EAAU5X,EACV6X,EAAWI,EAAAA,EAAU8uB,cACrBhvB,EAAaE,EAAAA,EAAU8uB,cACvB/uB,EAAawuB,GAGfjpC,EAAM7D,SACJ6D,EAAMga,YAAY6B,cAAc,CAC9BxB,UACAU,SACAT,WACAJ,eAAgBC,EAAAA,EAAgBC,OAChCI,aACAC,eAEH,EAqEDmuB,iBAnEwBpuB,IACxB,MAAMovB,EAAoB5pC,EAAMga,YAAYS,WAC5C,IAAIovB,EAIFA,EADEC,EAAAA,GAAgBrb,IAAIjU,GACNlc,MAAMC,QAAQqrC,GAC1BA,EACA,CAACA,GAAmBluC,QAAOg/B,GAAWA,IAE1Bp8B,MAAMC,QAAQqrC,GAC1BA,EAAkB,GAClBA,EAEFpvB,IAAeE,EAAAA,EAAUC,QAAUH,IAAeE,EAAAA,EAAUE,UAC9DivB,EAAgBnvB,EAAAA,EAAUC,SAAWH,GAEnCA,GAAcb,EAAAA,GAAiB8U,IAAIjU,GACrCxa,EAAM7D,SACJ6D,EAAMga,YAAY6B,cAAc,CAC9BxB,QAASra,EAAMga,YAAYK,QAC3BU,OAAQC,EAAAA,EAAQC,MAChBT,aACAF,SAAUT,EAAAA,GAA+BW,GAAYV,UACrDI,eAAgBC,EAAAA,EAAgBgB,IAChCllB,WAAY+J,EAAM/J,cAItB+J,EAAM7D,SACJ6D,EAAMga,YAAY6B,cAAc,CAC9BrB,aACAF,SAAUT,EAAAA,GAA+BW,GAAYV,UACrDW,WAAYovB,EACZ3vB,eAAgBC,EAAAA,EAAgBC,S,EAkCtC0uB,mBA7B0BruB,IAC1Bza,EAAM7D,SACJ6D,EAAMga,YAAY6B,cAAc,CAC9BpB,aACAP,eAAgBC,EAAAA,EAAgBC,SAEnC,EAwBDyuB,qBACAkB,cAvBoBA,KACpB/pC,EAAM7D,SACJ6D,EAAMga,YAAY6B,cAAc,CAC9BrB,gBAAYvgB,EACZqgB,cAAUrgB,IAEb,EAkBD8uC,mBAhByBA,CAACzL,EAAoB0M,KAC9ChqC,EAAM7D,SACJ6D,EAAMga,YAAY6B,cAAc,CAC9BxB,QAASijB,EACThjB,SAAUI,EAAAA,EAAU8uB,cACpB/uB,WAAYuvB,EACZ9vB,eAAgBC,EAAAA,EAAgBC,SAEnC,EASF,EAUG4uB,CAAwBhpC,IACrBiqC,EAAaC,IAAkBpyC,EAAAA,EAAAA,UAEpC,KACK2iB,EAAY0vB,IAAiBryC,EAAAA,EAAAA,UAASkI,EAAMga,YAAYS,aACxD2vB,EAA8BC,IACnCvyC,EAAAA,EAAAA,WAAS,IAEL,uBACJwyC,EAAsB,wBACtBC,EAAuB,mCACvBC,EAAkC,6BAClCC,GDnQyBC,CAACC,IAC5B,MAAOL,EAAwBM,IAC7B9yC,EAAAA,EAAAA,UAAiCmwC,IAC5BsC,EAAyBM,IAA8B/yC,EAAAA,EAAAA,YAIxD0yC,GAAqCryC,EAAAA,EAAAA,cACzC,CACE2yC,EACAR,EACAC,KAEA,MAAMnnC,GAASlI,EAAAA,EAAAA,GAAc4vC,GACxBP,EAILxhC,KAAS,KACP,MAIMb,EAAW,wCAJGtC,IAAAA,OAAa,CAC/BN,KAAMilC,EACNnnC,aAGFgc,EAAAA,EAAe1Z,IAAI,CAAEwC,aAClB9O,MAAK,EAAG4K,WACP4mC,EAA0B,CACxB1C,uBAAwBlkC,EAAK7O,OAAO41C,cACpC5C,6BAA8BnkC,EAAK7O,OAAO61C,uBAC1C30B,aAAcrS,EAAK7O,OAAO81C,gBAG5BN,GAAc3mC,EAAK7O,OAAO81C,cAAc,IAEzC3xC,OAAM,KACLsxC,EAA0B,CACxB1C,uBAAwB,GACxBC,6BACEmC,EAAuBnC,6BACzB9xB,cAAc9c,EAAAA,EAAAA,GAAE,sCAElBoxC,GAAa,EAAM,GACnB,GACH,IAzBH5hC,GAHE6hC,EAA0B3C,EA4BnB,GAEX,CAAC0C,IAkBH,MAAO,CACLL,yBACAC,0BACAK,4BACAJ,qCACAC,6BApBoCzqC,IACpC,MAAM2e,EAAS3e,EAAMuc,QAAQhhB,MAC3BojB,GACG,gBAAiBA,GAChBA,EAAOljB,cAAgBuE,EAAMga,YAAYK,SAC1C,eAAgBsE,GACfA,EAAO+D,aAAe1iB,EAAMga,YAAYK,UAE1CsE,GAAU,uBAAwBA,EACpCksB,EAA2BlsB,EAAOusB,oBAElClrC,EAAM2qC,cAAa,E,EAUtB,EC+LGD,CAAqB1qC,EAAM2qC,cAEzBQ,EAA4BA,CAAC7wB,EAAqBD,IACtDkwB,EACI1B,EAAmBvuB,EAAUD,IAC7BiwB,EAAuBnC,6BAA6B9/B,SAASiS,GAC7DuuB,EAAmBvuB,EAAUD,GAkB7B+wB,EAA+BA,KACnC,MAAMC,EARoBC,MAAK,IAAAtf,EAE/B,MAAMuf,EAA8BjtC,MAAMC,QAAQkc,GAC9CA,EAAW/e,QAAO8vC,GAAKvB,EAAY5hC,SAASmjC,KAAIxwC,OAChD,EACJ,OAAwD,OAAxDgxB,GAAkB,MAAXie,OAAW,EAAXA,EAAajvC,QAASuwC,GAA2Bvf,EAAI,CAAC,EAGpCsf,GACnBrhC,GAAc1Q,EAAAA,EAAAA,GAAE,eAAgB8xC,GACtC,OAAOA,EAAmBphC,EAAc,EAAE,EAQ5C,IAAI3O,EAAU0E,EAAMuc,QACpB,MAAM,QAAElC,EAAO,SAAEC,EAAQ,WAAEE,GAAexa,EAAMga,YAE1CyxB,EAAqB,CACzBC,WAAWnyC,EAAAA,EAAAA,GAAE,kBACb8C,MAAc,MAAPge,EAAAA,OAAWpgB,EAClBkC,SAX2Bke,IAC3B8vB,OAAclwC,GACd0uC,EAAgBtuB,EAAQ,EAUxBsxB,iBAAiBpyC,EAAAA,EAAAA,GACf,wEAEFqyC,WAAYvxB,EACZpQ,YAAa,IAGfwhC,EAAmBxhC,YACjBjK,EAAMga,YAAYe,SAAWC,EAAAA,EAAQC,OACjC1hB,EAAAA,EAAAA,GAAE,eAAgB+B,EAAQN,SAC1BzB,EAAAA,EAAAA,GAAE,8CACR+B,EAAU0E,EAAMuc,QAAQ7gB,QACtBijB,GAAU,gBAAiBA,GAAUA,EAAOljB,cAG9C,MAAMowC,EAAsB,CAC1B5hC,aAAa1Q,EAAAA,EAAAA,GACX,kBACgB,OAAhBkvC,EAACzoC,EAAM8c,WAAS2rB,EAAIqD,EAAAA,IAAmBpwC,QAAOke,GAC5CuxB,EAA0BvxB,EAAIS,KAC9Brf,QAEJqB,MAAOme,EACPre,SAAUysC,EACVgD,YAAaH,EAAmBpvC,QAAUie,EAC1CoxB,WAAWnyC,EAAAA,EAAAA,GAAE,oBAGTwyC,IACFN,EAAmBpvC,SAAWwvC,EAAoBxvC,MAEhD2vC,EAAwB,CAC5B5hC,YAAY,EACZ6hC,iBAAiB,EACjBP,WAAWnyC,EAAAA,EAAAA,GAAE,qBACb2yC,KAAMpC,EAAAA,GAAgBrb,IAAIjU,GACrB,WACA,SACL0Q,QAASkf,EACT/tC,MAAOoe,EACPte,SAAU2sC,EACV6C,iBAAiBpyC,EAAAA,EAAAA,GAAE,qBACnBQ,SAAUoyC,EAAAA,GAAwB9jC,SAASmS,GAC3CvQ,YAAamhC,IACbQ,UAAWG,GAGPvD,EACJ/tB,GAAcA,EAAWzf,OAAS,GAAKowC,IAEnCgB,GAAaC,EAAAA,EAAAA,GAA2B,CAC5C/O,WAAYt9B,EAAMga,YAAYK,QAC9B2vB,UACEhqC,EAAMga,YAAYM,WAAaI,EAAAA,EAAU8uB,cACrCxpC,EAAMga,YAAYS,gBAClBxgB,EACNhE,WAAY+J,EAAM/J,WAClBkG,SAAU4sC,KAGZ9vC,EAAAA,EAAAA,YAAU,KAkCHmzC,GAjCgCE,MACnC,MAAM,WAAEr2C,GAAe+J,EACjBxE,EAAMwE,EAAMga,YAAYK,QACxBkyB,EAASvsC,EAAMga,YAAYe,SAAWC,EAAAA,EAAQwC,OAEpD,GAAIhiB,GAAOvF,GAAcA,EAAWu2C,gBAAkBD,EAAQ,CAC5D,MAAME,EAAa,IAAIC,iBACjB,OAAEC,GAAWF,EACfrC,GACFqC,EAAWG,QAEbvC,GAAgC,GAChCjrB,EAAAA,EAAe1Z,IAAI,CACjBinC,SACAzkC,SAAU,sBAAsBjS,EAAWqP,QAAQrP,EAAWwM,aAAajH,cAE1EpC,MAAK,EAAG4K,WACPkmC,EACElmC,EAAK7O,OAAOgG,KACT0xC,IAAiD,CAChDxwC,MAAOwwC,EACPzwB,OAAO0wB,EAAAA,EAAAA,IAAYD,QAIzBxC,GAAgC,EAAM,IAEvC/wC,OAAM,KACL4wC,EAAe,IACfG,GAAgC,EAAM,G,GAK5CiC,E,GAED,CAACtsC,EAAMga,YAAYK,WAEtBphB,EAAAA,EAAAA,YAAU,MACJsT,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYugC,0BAC/BtC,EAA6BzqC,E,GAE9B,CAACA,EAAMga,YAAYK,WAEtBphB,EAAAA,EAAAA,YAAU,MACJsT,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYugC,0BAC/BvC,OACiBvwC,IAAfwgB,EAA2B,GAAKA,EAChC6vB,EACAC,E,GAGH,CAAC9vB,EAAY8vB,EAAyBC,KAEzCvxC,EAAAA,EAAAA,YAAU,MACJsT,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYugC,0BAC/B5C,EAAcnqC,EAAMga,YAAYS,W,GAEjC,CAACza,EAAMga,YAAYS,aAGtB,MAAMuyB,GACJv3C,EAAAA,EAAAA,IAAC8yC,EAAAA,GAAM,CACL7yC,IAAMe,IAAyB,CAC7Bw2C,UAA4B,EAAjBx2C,EAAMU,SACjB+1C,aAA+B,EAAjBz2C,EAAMU,WAGtBolB,QAASjhB,EAAQH,KAAId,IAAM,OACzBgC,MACG,gBAAiBhC,GAAUA,EAAOoB,aAClC,eAAgBpB,GAAUA,EAAOqoB,YAClC,GACFtG,MACG,sBAAuB/hB,GAAUA,EAAOmmB,mBACxC,gBAAiBnmB,GAAUA,EAAOoB,aAClC,UAAWpB,GAAUA,EAAO+hB,MAC/B/iB,IACG,OAAQgB,GAAUA,EAAOoI,IACzB,eAAgBpI,GAAUA,EAAOqoB,iBAClCzoB,EACF+sC,aA3K4BroB,EA2KUtkB,GA1K1C5E,EAAAA,EAAAA,IAACmpB,EAAAA,EAAsB,CAACD,OAAQA,MADDwuB,IAACxuB,CA4K5B,OACE8sB,IAIF2B,GACJ3zC,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAC8yC,EAAAA,GAAM,CACL7yC,IAAMe,IAAyB,CAAGy2C,aAA+B,EAAjBz2C,EAAMU,WACtDolB,SAAyB,OAAhBmsB,EAAC1oC,EAAM8c,WAAS4rB,EAAIoD,EAAAA,IAC1BpwC,QAAOke,GAAMuxB,EAA0BvxB,EAAIS,KAC3Clf,KAAI,CAACwjB,EAAQnhB,KAAU,CACtBnB,MAAOsiB,EACPvC,MAAOvC,EAAAA,GAA+B8E,GAAQ0uB,QAC9Ch0C,IAAKslB,EACL2uB,MAAO9vC,SAEPquC,IAEL/B,EAAAA,GAAgBrb,IAAIjU,IAAeyvB,EAAYjvC,OAAS,GACvDvF,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CACN9kB,MACE6lC,EAAuBj0B,cACvBi0B,EAAuBpC,uBACxBvyC,UAEDF,EAAAA,EAAAA,IAAC4yC,EAAe,CACdG,UAAWA,EACXjsB,QAAS0tB,KACL+B,OAIRv2C,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CACN9kB,MACE6lC,EAAuBj0B,cACvBi0B,EAAuBpC,uBACxBvyC,UAEDF,EAAAA,EAAAA,IAAC2yC,EAAW,CAEVpvB,KAAK,eACLxW,IAAKA,IACCA,GAAOupC,GACTvpC,EAAIwE,O,EAGR7K,SAjOuByK,IAC/B,MAAM,MAAEvK,GAAUuK,EAAMxK,OACxB+tC,EAAc9tC,GACdysC,EAAmBzsC,EAAM,EA+NjBA,MAAOoe,EACPxQ,aAAa1Q,EAAAA,EAAAA,GAAE,iCACfQ,SAAUoyC,EAAAA,GAAwB9jC,SAASmS,UAMrD,OACE/gB,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,CACGq3C,EACU,MAAVZ,EAAAA,EAAcgB,IACd,E,qCCzfP,MAAMj+B,EAAY,CAChB6K,YAAa3K,IAAAA,WAAqB0K,EAAAA,GAAaxK,WAC/CpT,SAAUkT,IAAAA,KAAeE,WACzBgN,QAASlN,IAAAA,QACPA,IAAAA,UAAoB,CAClBwO,EAAAA,EACAxO,IAAAA,MAAgB,CAAEmR,kBAAmBnR,IAAAA,OAAiBE,aACtDoO,EAAAA,KAEFpO,WACFpZ,OAAQkZ,IAAAA,OAAiBE,YAGrBo4B,GAAerxC,EAAAA,EAAAA,IAAOiyC,EAAAA,GAAO;IAC/B,EAAG9xC,WAAY,gBACW,GAAjBA,EAAMU,iCACAV,EAAMU;EAIV,MAAMo2C,UAA4Cv8B,EAAAA,UAC/DC,WAAAA,CAAYjR,GACVkR,MAAMlR,GACNmR,KAAKq8B,sBAAwBr8B,KAAKq8B,sBAAsB/7B,KAAKN,MAC7DA,KAAKs8B,4BACHt8B,KAAKs8B,4BAA4Bh8B,KAAKN,MACxCA,KAAKu8B,mBAAqBv8B,KAAKu8B,mBAAmBj8B,KAAKN,KACzD,CAEAsG,kBAAAA,GACMtG,KAAKw8B,cACPx8B,KAAKw8B,aAAaC,OAAOC,QAE7B,CAEAJ,2BAAAA,CAA4B1yB,GAC1B5J,KAAKnR,MAAM7D,SACTgV,KAAKnR,MAAMga,YAAY6B,cAAc,CACnCd,SACAb,eAAgBC,EAAAA,EAAgBgB,MAGtC,CAEAqyB,qBAAAA,CAAsBtyB,GACpB/J,KAAKnR,MAAM7D,SACTgV,KAAKnR,MAAMga,YAAY6B,cAAc,CACnCX,gBACAhB,eAAgBC,EAAAA,EAAgBgB,MAGtC,CAEAuyB,kBAAAA,CAAmBlrC,GACbA,IACF2O,KAAKw8B,aAAenrC,EAExB,CAEA8R,MAAAA,GACE,MAAM,YAAE0F,EAAW,OAAE7jB,EAAM,QAAEomB,GAAYpL,KAAKnR,MAExC8tC,EAAWC,EAAAA,EAAY5kB,OAC3B5M,EACGphB,KAAIwjB,GACCA,EAAOljB,YACF,CACLud,KAAM2F,EAAOljB,YACbY,MAAOsiB,EAAOljB,YACd4tB,MAAO,GACP5lB,KAAM,UAGH,OAER/H,OAAOic,UAENq2B,EAAgBltC,OAAOsC,OAAO4X,EAAAA,GAAS7f,KAAI4f,IAAM,CACrDqB,MAAOrB,EACP1e,MAAO0e,MAGT,OACEthB,EAAAA,EAAAA,IAAA,QAAA9D,SAAA,EACE8D,EAAAA,EAAAA,IAAA,OAAKgV,UAAU,6BAA4B9Y,SAAA,EACzCF,EAAAA,EAAAA,IAAA,OAAAE,UACEF,EAAAA,EAAAA,IAACkyC,EAAY,CACXprB,QAASyxB,EACTtC,WAAWnyC,EAAAA,EAAAA,GAAE,iBACb0Q,aAAa1Q,EAAAA,EAAAA,GAAE,6BACf8C,MAAO2d,EAAYe,OACnB5e,SAAUgV,KAAKs8B,iCAGnBh0C,EAAAA,EAAAA,IAAA,QAAMgV,UAAU,0BAAyB9Y,SAAA,EACvCF,EAAAA,EAAAA,IAAA,UAAAE,SAAQ,UAAc,KAAE4D,EAAAA,EAAAA,GAAE,uBAC1B9D,EAAAA,EAAAA,IAAA,UACAA,EAAAA,EAAAA,IAAA,UAAAE,SAAQ,WAAe,KAAE4D,EAAAA,EAAAA,GAAE,6BAG/B9D,EAAAA,EAAAA,IAAA,OAAKC,IAAKe,IAAK,CAAOw2C,UAA4B,EAAjBx2C,EAAMU,WAAgBxB,UACrDF,EAAAA,EAAAA,IAACw4C,EAAAA,GAAS,CACRzrC,IAAK2O,KAAKu8B,mBACVI,SAAUA,EACV33C,OAAWA,EAAS,IAAZ,KACRgG,SAAUgV,KAAKq8B,sBACfp3C,MAAM,OACN83C,YAAY,EACZ7xC,MAAO2d,EAAYkB,eAAiBlB,EAAYoB,iBAChD+yB,YAAa,CAAEC,iBAAiB,GAChCC,0BAAwB,EACxB5/B,UAAU,oBACV6/B,aAAW,QAKrB,EAEFf,EAAoCp+B,UAAYA,ECjHhD,MAAMA,EAAY,CAChB6K,YAAa3K,IAAAA,WAAqB0K,EAAAA,GAAaxK,WAC/CpT,SAAUkT,IAAAA,KAAeE,WACzB7M,QAAS2M,IAAAA,KAAeE,WACxBg/B,SAAUl/B,IAAAA,KAAeE,WACzBgN,QAASlN,IAAAA,QACPA,IAAAA,UAAoB,CAClBwO,EAAAA,EACAxO,IAAAA,MAAgB,CAAEmR,kBAAmBnR,IAAAA,OAAiBE,aACtDoO,EAAAA,KAEFpO,WACFtZ,WAAYoZ,IAAAA,OACZqN,gBAAiBrN,IAAAA,OACjB5Y,MAAO4Y,IAAAA,OACPwN,SAAUxN,IAAAA,QAAkBA,IAAAA,QAC5ByN,UAAWzN,IAAAA,QAAkBA,IAAAA,QAC7Bm/B,YAAan/B,IAAAA,MAGTo/B,EAAan4C,EAAAA,GAAOw8B,CAAC;iBACV,EAAGr8B,WAA6B,EAAjBA,EAAMU;EAGhCu3C,EAAgCp4C,EAAAA,GAAOY,GAAG;;qBAE3B,EAAGT,WAA6B,EAAjBA,EAAMU;;;iBAGzB,EAAGV,WAAYA,EAAMU;;;;;;;;;iBASrB,EAAGV,WAAYA,EAAMmgB,WAAWC,MAAM83B;;;;;;WAM5C,EAAGl4C,WAA6B,EAAjBA,EAAMU;;;;kBAId,EAAGV,WAA6B,EAAjBA,EAAMU;;EAIjCy3C,EAAyBt4C,EAAAA,GAAOY,GAAG;gBACzB,EAAGT,WAA6B,EAAjBA,EAAMU;EAGtB,MAAM03C,UAA+B79B,EAAAA,UAClDC,WAAAA,CAAYjR,GAAQ,IAAD8uC,EAAAC,EACjB79B,MAAMlR,GACNmR,KAAK69B,OAAS79B,KAAK69B,OAAOv9B,KAAKN,MAC/BA,KAAK89B,WAAa99B,KAAK89B,WAAWx9B,KAAKN,MACvCA,KAAK+9B,YAAc/9B,KAAK+9B,YAAYz9B,KAAKN,MACzCA,KAAKg+B,UAAYh+B,KAAKg+B,UAAU19B,KAAKN,MACrCA,KAAKi+B,oBAAsBj+B,KAAKi+B,oBAAoB39B,KAAKN,MACzDA,KAAKk+B,oBAAsBl+B,KAAKk+B,oBAAoB59B,KAAKN,MACzDA,KAAKm+B,aAAen+B,KAAKm+B,aAAa79B,KAAKN,MAC3CA,KAAKo+B,YAAcp+B,KAAKo+B,YAAY99B,KAAKN,MAEzCA,KAAK1Y,MAAQ,CACXuhB,YAAa7I,KAAKnR,MAAMga,YACxB5jB,MAAOo5C,EAAAA,GACPr5C,OAAQs5C,EAAAA,GACR/L,WAAqB,OAAVoL,EAAA39B,KAAKnR,QAAkB,OAAb+uC,EAAVD,EAAY90B,kBAAF,EAAV+0B,EAAyB70B,iBAAkB,SACtDw1B,kBAAkB,GAGpBv+B,KAAKw+B,mBAAoBp+B,EAAAA,EAAAA,YAC3B,CAEAgG,iBAAAA,GACErJ,SAAS0hC,iBAAiB,UAAWz+B,KAAKg+B,UAC5C,CAEAU,oBAAAA,GACE3hC,SAAS4hC,oBAAoB,UAAW3+B,KAAKg+B,WAC7CjhC,SAAS4hC,oBAAoB,YAAa3+B,KAAK+9B,YACjD,CAEAE,mBAAAA,CAAoBp1B,GAClB7I,KAAKjF,SAAS,CAAE8N,eAClB,CAEAq1B,mBAAAA,CAAoBrzB,GAClB7K,KAAKjF,SAAS,CAAEwjC,iBAAkB1zB,GACpC,CAEAgzB,MAAAA,GACE79B,KAAKnR,MAAM7D,SAASgV,KAAK1Y,MAAMuhB,aAC/B7I,KAAKnR,MAAM0C,SACb,CAEAusC,UAAAA,CAAWllC,GACToH,KAAK4+B,WAAahmC,EAAEiC,QACpBmF,KAAK6+B,WAAajmC,EAAEkC,QACpBkF,KAAK8+B,eAAiB9+B,KAAK1Y,MAAMrC,MACjC+a,KAAK++B,gBAAkB/+B,KAAK1Y,MAAMtC,OAClC+X,SAAS0hC,iBAAiB,YAAaz+B,KAAK+9B,YAC9C,CAEAA,WAAAA,CAAYnlC,GACVoH,KAAKnR,MAAMuuC,WACXp9B,KAAKjF,SAAS,CACZ9V,MAAOslB,KAAK6X,IACVpiB,KAAK8+B,gBAAkBlmC,EAAEiC,QAAUmF,KAAK4+B,YACxCP,EAAAA,IAEFr5C,OAAQulB,KAAK6X,IACXpiB,KAAK++B,iBAAmBnmC,EAAEkC,QAAUkF,KAAK6+B,YACzCP,EAAAA,KAGN,CAEAN,SAAAA,GACEjhC,SAAS4hC,oBAAoB,YAAa3+B,KAAK+9B,YACjD,CAEAK,WAAAA,CAAY7L,GACVvyB,KAAKjF,SAAS,CACZw3B,aAEJ,CAEA4L,YAAAA,CAAaa,GACXh/B,KAAKjF,UAASzT,IAAK,CAAOtC,OAAQsC,EAAMtC,OAASg6C,KACnD,CAEA77B,MAAAA,GACE,MACE0F,YAAao2B,EAAgB,QAC7B7zB,EAAO,SACPpgB,EAAQ,QACRuG,EAAO,SACP6rC,EAAQ,WACRt4C,EAAU,gBACVymB,EAAe,MACfjmB,EAAK,UACLqmB,EAAS,YACT0xB,KACG6B,GACDl/B,KAAKnR,OAEH,YAAEga,GAAgB7I,KAAK1Y,MACvB63C,EAAet2B,EAAYgC,UAC3Bu0B,EACJ/B,IAAgBx0B,EAAY+B,OAAOq0B,GAErC,OACE32C,EAAAA,EAAAA,IAACi1C,EAA6B,CAC5BjsC,GAAG,yBACC4tC,EAEJ7tC,IAAK2O,KAAKw+B,kBAAkBh6C,SAAA,EAE5B8D,EAAAA,EAAAA,IAAC4D,EAAAA,GAAI,CACHoF,GAAG,yBACH+tC,iBAAkBx2B,EAAYE,eAC9BzL,UAAU,yBAEV7D,MAAO,CAAE9F,UAAWqM,KAAK1Y,MAAMtC,OAAQC,MAAO+a,KAAK1Y,MAAMrC,OACzDq6C,eAAa,EACbt0C,SAAUgV,KAAKo+B,YAAY55C,SAAA,EAE3BF,EAAAA,EAAAA,IAAC4H,EAAAA,GAAKI,QAAO,CACXgR,UAAU,wBAEV/Q,KAAKnE,EAAAA,EAAAA,GAAE,UAAU5D,UAEjBF,EAAAA,EAAAA,IAAC2jB,EAAAA,EAAa,CAAAzjB,UACZF,EAAAA,EAAAA,IAACi7C,EAAsC,CACrC5zB,UAAWA,EACX9C,YAAa7I,KAAK1Y,MAAMuhB,YACxB7d,SAAUgV,KAAKi+B,oBACf7yB,QAASA,EACTtmB,WAAYA,EACZ06C,eAAgBx/B,KAAKm+B,aACrB5yB,gBAAiBA,EACjBk0B,WAAYz/B,KAAKw+B,kBAAkB7sC,QACnC6nC,aAAcx5B,KAAKk+B,yBAblBl1B,EAAAA,EAAgBC,SAiBvB3kB,EAAAA,EAAAA,IAAC4H,EAAAA,GAAKI,QAAO,CACXgR,UAAU,wBAEV/Q,KAAKnE,EAAAA,EAAAA,GAAE,cAAc5D,UAErBF,EAAAA,EAAAA,IAAC2jB,EAAAA,EAAa,CAAAzjB,UACZF,EAAAA,EAAAA,IAAC83C,EAAmC,CAClCvzB,YAAa7I,KAAK1Y,MAAMuhB,YACxB7d,SAAUgV,KAAKi+B,oBACf7yB,QAASpL,KAAKnR,MAAMuc,QACpBpmB,OAAQgb,KAAK1Y,MAAMtC,OACnButC,UAAWvyB,KAAK1Y,MAAMirC,eATrBvpB,EAAAA,EAAgBgB,SAczB1hB,EAAAA,EAAAA,IAACm1C,EAAsB,CAAAj5C,SAAA,EACrBF,EAAAA,EAAAA,IAACkE,EAAAA,EAAM,CAACE,WAAW,QAAQC,QAASqX,KAAKnR,MAAM0C,QAASmuC,KAAG,EAAAl7C,UACxD4D,EAAAA,EAAAA,GAAE,YAEL9D,EAAAA,EAAAA,IAACkE,EAAAA,EAAM,CAELI,UACGu2C,IACAn/B,KAAK1Y,MAAMi3C,mBACXa,EAEH32C,YAAY,UACZC,WAAW,QACX4U,UAAU,QACV3U,QAASqX,KAAK69B,OACd6B,KAAG,EAAAl7C,UAEF4D,EAAAA,EAAAA,GAAE,WAEL9D,EAAAA,EAAAA,IAACg5C,EAAU,CACTn1B,KAAK,SACL,aAAW,SACXC,SAAU,EACVu3B,YAAa3/B,KAAK89B,WAClBxgC,UAAU,qDAKpB,EAGFogC,EAAuB1/B,UAAYA,E,0BCvOnC,MAAM8N,UAAkC5F,EAAAA,cAItCpG,WAAAA,CAAYjR,GACVkR,MAAMlR,GACNmR,KAAK4/B,gBAAkB5/B,KAAK4/B,gBAAgBt/B,KAAKN,MACjDA,KAAK6/B,aAAe7/B,KAAK6/B,aAAav/B,KAAKN,MAC3CA,KAAK8/B,cAAgB9/B,KAAK8/B,cAAcx/B,KAAKN,MAC7CA,KAAK1Y,MAAQ,CACX4xB,gBAAgB,EAEpB,CAEA0mB,eAAAA,GACE5/B,KAAK+/B,aACP,CAEAF,YAAAA,GACE7/B,KAAK8/B,eAAc,EACrB,CAEAA,aAAAA,CAAczmB,GACZrZ,KAAKjF,SAAS,CACZme,eAAgBG,GAEpB,CAEAlW,MAAAA,GACE,MAAM,YAAE0F,EAAW,sBAAEm3B,GAA0BhgC,KAAKnR,OAE9C,QAAEwqB,EAAO,cAAEymB,EAAa,aAAED,GAAiBG,EAC7C,CACE3mB,QAASrZ,KAAKnR,MAAMwqB,QACpBymB,cAAe9/B,KAAKnR,MAAMixC,cAC1BD,aAAc7/B,KAAKnR,MAAMgxC,cAE3B,CACExmB,QAASrZ,KAAK1Y,MAAM4xB,eACpB4mB,cAAe9/B,KAAK8/B,cACpBD,aAAc7/B,KAAK6/B,cAEnBvT,GACJhoC,EAAAA,EAAAA,IAACmuC,EAAAA,EAAqB,CAAAjuC,UACpBF,EAAAA,EAAAA,IAACo5C,EAAsB,CACrB70B,YAAaA,EACbuC,QAASpL,KAAKnR,MAAMuc,QACpBtmB,WAAYkb,KAAKnR,MAAM/J,WACvBymB,gBAAiBvL,KAAKnR,MAAM0c,gBAC5B6xB,SAAUp9B,KAAK4/B,gBACfruC,QAASsuC,EACTn0B,SAAU1L,KAAKnR,MAAM6c,SACrBC,UAAW3L,KAAKnR,MAAM8c,UACtB3gB,SAAUgV,KAAKnR,MAAMwc,aACrBgyB,YAAar9B,KAAKnR,MAAMwuC,gBAK9B,OACE/4C,EAAAA,EAAAA,IAAC27C,EAAAA,EAAc,CACbziC,QAAQ,QACRkR,QAAS4d,EACT4T,eAAgB7mB,EAChBA,QAASA,EACT5b,gBAAiBqiC,EACjBK,sBAAoB,EAAA37C,SAEnBwb,KAAKnR,MAAMrK,UAGlB,EAGF,S,kBCpGO,IAAKwkB,EAKAa,E,yBALZ,SAAYb,GACVA,EAAA,gBACAA,EAAA,SACD,CAHD,CAAYA,IAAAA,EAAe,KAK3B,SAAYa,GACVA,EAAA,gBACAA,EAAA,aACD,CAHD,CAAYA,IAAAA,EAAO,I,mGCKZ,MAAMgC,EAAwBhD,IACnC,MAAO+C,EAAiBw0B,IAAsBz5C,EAAAA,EAAAA,UAAkB,CAAC,GA2CjE,OAzCAmB,EAAAA,EAAAA,YAAU,KAEN+gB,EAAYM,WAAaI,EAAAA,EAAU8uB,eACnCxvB,EAAYE,iBAAmBC,EAAAA,EAAgBC,QAE/Cm3B,EAAmB,CAAC,GAGpBv3B,EAAYM,WAAaI,EAAAA,EAAU8uB,eACnCxvB,EAAYS,aAAe+2B,EAAAA,IAE3BD,EAAmB,CACjBx0B,gBAAiB,GAAG/C,EAAYK,YAAYm3B,EAAAA,MAC5C/sC,MAAO+sC,EAAAA,KAKTx3B,EAAYM,WAAaI,EAAAA,EAAU8uB,eACnCxvB,EAAYE,iBAAmBC,EAAAA,EAAgBC,QAC/CJ,EAAYS,aAAe+2B,EAAAA,IAC3Bz0B,EAAgBtY,QAAUuV,EAAYS,aAEtCg3B,EAAAA,EAAAA,IAAez3B,EAAYS,WAAYT,EAAYK,SAASjhB,MAC1D,EAAGiD,QAAOoM,YAEN8oC,EADE9oC,EACiB,CACjBsU,gBAAiB,GAAG/C,EAAYK,YAAYL,EAAYS,cACxDhW,MAAOgE,GAGU,CACjBsU,gBAAsB,MAAL1gB,EAAAA,EAAS,GAC1BoI,MAAOuV,EAAYS,Y,MAM5B,CAACT,IAEG+C,CAAe,E,2DCzCjB,MAAMsvB,EAA6BA,EACxC/O,aACA0M,YACA/zC,aACAkG,eAIOwtC,EAAAA,EAAAA,GAAiBrM,EAAYrnC,IAClCwD,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAC0rB,EAAAA,EAAa,CAAC/E,OAAO7iB,EAAAA,EAAAA,GAAE,iBACxB9D,EAAAA,EAAAA,IAACi8C,EAAAA,EAAiB,CAChBr1C,MAAO2tC,EACPhxB,KAAK,aACL7c,SARqB0D,GAAgB1D,EAASmhC,EAAYz9B,GAS1Dy1B,aAAa,kBAGfr7B,C,wECpBC,MAAM03C,EAAmB,CAC9B,KAAM,IACN,KAAM,KACN,IAAK,IACL,IAAK,IACL,KAAM,KACN,KAAM,KACNC,GAAI,KACJ,SAAU,SACVC,KAAM,OACNC,MAAO,QACPC,MAAO,QACP,cAAe,cACf,UAAW,UACX,UAAW,UACX,WAAY,WACZ,mBAAoBC,EAClB/7C,gBAIA,kCAAkCA,EAAWgpB,UAAUhpB,EAAW8oB,yBAGzD3D,EAAiBA,CAC5BpB,GACEqB,aAAsC,CAAEA,WAAW,MAErD,IAAI42B,EAAAA,EAAAA,IAAoBj4B,IAAgBqB,EAAW,CACjD,MAAM,QAAEhB,EAAO,SAAEC,GAAaN,EACxBS,EACJ,eAAgBT,EAAcA,EAAYS,gBAAaxgB,EACnD2f,EACJU,GAEAA,IACET,EAAAA,GAA+Ba,EAAAA,EAAU6uB,iBAAiBzvB,UACxD63B,EAAiBr3B,GAAUN,GAC3B23B,EAAiBr3B,GACvB,OAAO43B,EAAAA,EAAAA,IAAuB73B,EAAST,EAAIa,E,CAE7C,OAAI03B,EAAAA,EAAAA,IAAsBn4B,GACjBA,EAAYkB,cAEd,EAAE,C,0PC7CJ,MAAMk3B,EAAgB97C,EAAAA,GAAOY,GAAG;mBACpB,EAAGT,WAAYA,EAAMU;;;;EAM3Bk7C,EAAyB/7C,EAAAA,GAAOY,GAE3C;;;;eAIa,EAAGT,WAAYA,EAAMmgB,WAAWC,MAAMC;YACzC,EAAGrgB,WAA6B,EAAjBA,EAAMU;sBACX,EAAGV,WAAYA,EAAMG,OAAOC,UAAUy7C;;YAEhD,EAAG/0B,eAAiBA,EAAY,UAAY;EAE3C2mB,EAAQ5tC,EAAAA,GAAOY,GAAG;IAC3B,EAAGT,WAAY,sKAOCA,EAAMU,+CAEJV,EAAMU,8DAGW,EAAjBV,EAAMU,mCACPV,EAAMU,mCACNV,EAAMmgB,WAAW6T,QAAQgK;EASxC8d,EAAYj8C,EAAAA,GAAO2gB,IAAI;;;EAKhBu7B,EAAiBl8C,EAAAA,GAAOY,GAAG;;2BAEb,EAAGT,WAAYA,EAAMG,OAAOC,UAAUkvB;;EAIpD0sB,EAAiBn8C,EAAAA,GAAOY,GAAG;;WAE7B,EAAGT,WAA6B,EAAjBA,EAAMU;4BACJ,EAAGV,WAAYA,EAAMG,OAAOC,UAAUkvB;;EAI5D2sB,GAA+Bp8C,EAAAA,EAAAA,IAAOq8C,EAAAA,EAAuB;cACrD,EAAGl8C,WAAYA,EAAMU;EAGtB+pB,EAAkB5qB,EAAAA,GAAOY,GAAG;;;;EAM5BqqB,EAAkBjrB,EAAAA,GAAOY,GAAG;aAC5B,EAAGT,WAAYA,EAAMU;sBACZ,EAAGV,WAAYA,EAAMG,OAAOC,UAAUw9B;mBACzC,EAAG59B,WAAYA,EAAMU;EAGlCy7C,EAAcC,EAAAA,EAAS;;;;;;;;;;;;;EAehBC,EAAqBx8C,EAAAA,GAAOY,GAKvC;IACE,EAAGT,QAAOwiB,YAAW85B,UAASC,aAAYC,YAAa,uCAE9Cx8C,EAAMU,2BAEd8hB,GAAa+5B,EACV,cACED,EAAUt8C,EAAMG,OAAOkd,KAAK9c,MAAQP,EAAMG,OAAO6R,MAAMzR,QAEzD,aACEiiB,GAAa+5B,EACTv8C,EAAMG,OAAO6mB,QAAQ3mB,OACrBL,EAAMG,OAAOC,UAAUw9B,+BAGlB59B,EAAMU,yGAKJV,EAAMU,gDAGZ67C,GAAc/5B,EAAY,QAAU,kCAE7C85B,EAAUt8C,EAAMG,OAAOkvB,QAAQpY,KAAOjX,EAAMG,OAAO6R,MAAM3R,yBAEhDL,EAAMy8C,OAAOC,uCACb18C,EAAM28C,QAAQC,4GAOdp6B,GAAc85B,GAAWE,EAAU,QAAU,kCAEtDh6B,EAAYxiB,EAAMG,OAAOC,UAAUy7C,OAAS77C,EAAMG,OAAOkvB,QAAQpY,uBAExDjX,EAAMy8C,OAAOI,2BACb78C,EAAM28C,QAAQG,2BACjB98C,EAAMU,4BACJV,EAAMU,6BACLV,EAAMU,2BACRV,EAAMU,4BACL8hB,EAAY,OAAS;;;MAK7B,EAAGxiB,QAAOwiB,eACVA,GACAvjB,EAAAA,EAAG;qBACYk9C;;gCAEWn8C,EAAMU,SAAW;;iBAEhCV,EAAMU;gBACPV,EAAMU;mBACHV,EAAMU,SAAW;kBAClBV,EAAMU,SAAW;;;EAKtBqqB,EAAkBlrB,EAAAA,GAAOY,GAEpC;;;;YAIU,EAAGT,WAA6B,EAAjBA,EAAMU;kBACf,EAAGV,WAAYA,EAAMU;eACxB,EAAGV,WAAYA,EAAMmgB,WAAWC,MAAMC;WAC1C,EAAGrgB,WAAYA,EAAMG,OAAOC,UAAUC;uBAC1B,EAAGL,WAAYA,EAAMG,OAAOC,UAAUw9B;mBAC1C,EAAG59B,WAAYA,EAAMU;YAC5B,EAAGq8C,iBAAmBA,EAAc,UAAY;;;wBAGpC,EAAGA,cAAa/8C,WAClC+8C,EAAc,UAAY/8C,EAAMG,OAAOC,UAAU48C;;;;wBAI/B,EAAGD,cAAa/8C,WAClC+8C,EAAc,UAAY/8C,EAAMG,OAAOC,UAAUy7C;;EAI1ClxB,EAAgB9qB,EAAAA,GAAOo9C,MAAM;;;;YAI9B,EAAGj9C,WAA6B,EAAjBA,EAAMU;WACtB,EAAGV,WAA6B,EAAjBA,EAAMU;;sBAEV,EAAGV,WAAYA,EAAMG,OAAOkvB,QAAQ9uB;;;;;;wBAMlC,EAAGP,WAAYA,EAAMG,OAAOC,UAAUC;;EASjDomB,EAAqBA,EAChCd,QACA+D,cACA4B,cACA3E,WACAT,cACAC,cACAW,YACAo2B,aACAruC,OACA9H,QACA8d,UACAs4B,2BACAz2B,eACA02B,SAAQ,KACL7zC,MAkBH,MAAMvJ,GAAQkB,EAAAA,EAAAA,MACR6K,GAAMN,EAAAA,EAAAA,QAAuB,MAC7B4xC,GAAW5xC,EAAAA,EAAAA,QAAuB,MAClC6xC,EAA2B,MAAX5zB,OAAW,EAAXA,EAAarY,aAC5B,CAAEksC,IAAQC,EAAAA,EAAAA,GAAQ,CACvBC,OAAQ5uC,EACR0uC,IAAAA,GACOH,IAGM,MAAXj3B,GAAAA,IACF,EACAu3B,KAAAA,CAAMp0C,EAAgBq0C,GAA6B,IAAHvtC,EAC9C,IAAKgtC,EACH,OAEF,IAAKrxC,EAAIM,QACP,OAEF,MAAM,UAAEud,GAActgB,EAChBugB,EAAa9iB,EAEnB,GAAI6iB,IAAcC,EAChB,OAGF,MAAM+zB,EAA+B,OAAdxtC,EAAGrE,EAAIM,cAAO,EAAX+D,EAAaytC,wBAEjCC,GACHF,EAAkBG,OAASH,EAAkBtlC,KAAO,EAEjD0lC,EAAeL,EAAQM,kBAEvBC,EAA2B,MAAZF,GAAAA,EAAcG,GACnB,MAAZH,OAAY,EAAZA,EAAcG,GAAIP,EAAkBtlC,IACpC,EAKAsR,EAAYC,GAAcq0B,EAAeJ,GAIzCl0B,EAAYC,GAAcq0B,EAAeJ,IAIlC,MAAX53B,GAAAA,EAAc0D,EAAWC,GAMzBvgB,EAAKsgB,UAAYC,EACnB,MAEK,WAAE0yB,GAAc6B,IAAQC,EAAAA,EAAAA,GAAQ,CACrC/0C,KAAM,CACJuF,OACA+a,UAAW7iB,EACXnB,MAAkB,MAAX8jB,GAAAA,EAAarY,YAAcqY,EAAc4B,GAElDgzB,QAASX,IAAO,CACdpB,WAAYoB,EAAQpB,iBA2ExB,OADA6B,EAAKb,EAAKxxC,KACH/M,EAAAA,EAAAA,IAAC28C,EAAa,CAAC5vC,IAAKA,EAAI7M,UAvC7B8D,EAAAA,EAAAA,IAAC44C,EAAsB,CACrB90B,UAAWA,KAEPvd,EAAKrK,SAAA,EAETF,EAAAA,EAAAA,IAACg9C,EAAc,CACbn5B,KAAK,SAELxf,QAASsjB,EAASznB,UAElBF,EAAAA,EAAAA,IAACkU,EAAAA,EAAMqrC,OAAM,CAAClrC,UAAWrT,EAAMG,OAAOC,UAAUC,YAElD2C,EAAAA,EAAAA,IAACyqC,EAAK,CAAAvuC,SAAA,CACHg+C,IAAcl+C,EAAAA,EAAAA,IAACkU,EAAAA,EAAMsrC,aAAY,IA7ChBC,MACtB,MAAMC,GACFnC,GACiB,iBAAV52B,GACPe,GACAf,GACAe,IAAiBf,IACjB42B,GACAc,GACAA,EAAShxC,SACTgxC,EAAShxC,QAAQgiC,YAAcgP,EAAShxC,QAAQsyC,YAEpD,OAAIj1B,GAAe4zB,GAEft+C,EAAAA,EAAAA,IAAC4/C,EAAAA,EAAkB,CACjBxtC,OAAQsY,EACR2zB,SAAUA,EACVqB,mBAAoBnC,IAIrBmC,GAIH1/C,EAAAA,EAAAA,IAAC8zB,EAAAA,EAAO,CAAC9kB,MAAO0Y,GAAgBf,EAAMzmB,UACpCF,EAAAA,EAAAA,IAAC88C,EAAS,CAAC/vC,IAAKsxC,EAASn+C,SAAEymB,OAJtB3mB,EAAAA,EAAAA,IAAC88C,EAAS,CAAC/vC,IAAKsxC,EAASn+C,SAAEymB,GAKxB,EAmBP84B,SAECtB,GAA4Bt4B,KAC9B7lB,EAAAA,EAAAA,IAACi9C,EAA4B,CAC3BnqB,KAAK,uBACLiB,UAAU,MACV8rB,QAAQ,UACRt7C,QACE45C,IACAr6C,EAAAA,EAAAA,GAAE,yJAOPgkB,IACC9nB,EAAAA,EAAAA,IAAC+8C,EAAc,CAAA78C,UACbF,EAAAA,EAAAA,IAACkU,EAAAA,EAAM4rC,WAAU,CAACzrC,UAAWrT,EAAMG,OAAOC,UAAUC,eAOe,C,mJC7X7E,MAAM0+C,GAAsBl/C,EAAAA,EAAAA,IAAO+sB,EAAAA,GAAW;;kBAE5B,EAAG5sB,WAAYA,EAAMU;;EAIvCs+C,EAAAA,EAAkBC,iBAAiB,WAAYC,EAAAA,GAC/CF,EAAAA,EAAkBC,iBAAiB,OAAQE,EAAAA,GAC3CH,EAAAA,EAAkBC,iBAAiB,MAAOG,EAAAA,GAC1CJ,EAAAA,EAAkBC,iBAAiB,OAAQI,EAAAA,GAO3C,MAAMC,EAAwBz/C,EAAAA,GAAOY,GAAG;;;;EAMlC8+C,GAA0B1/C,EAAAA,EAAAA,IAAOm/C,EAAAA,EAAkB;;EAwBzD,EApBsCz1C,IACpC,MAAM,IAAEi2C,EAAG,SAAEC,EAAW,OAAUl2C,EAClC,OACEvG,EAAAA,EAAAA,IAACs8C,EAAqB,CAAApgD,SAAA,EACpBF,EAAAA,EAAAA,IAACyuB,EAAAA,EAAe,CACdD,KAAMgyB,EACN9xB,gBAAgB,EAChBC,UACE3uB,EAAAA,EAAAA,IAAC+/C,EAAmB,CAAC37C,WAAW,SAAQlE,UACtCF,EAAAA,EAAAA,IAAA,KAAGgZ,UAAU,yBAInBhZ,EAAAA,EAAAA,IAACugD,EAAuB,CAACE,SAAUA,EAAUtrC,MAAOurC,EAAAA,EAAOxgD,SACxDsgD,MAXuBA,EAaJ,C,0IChC5B,MAAMG,EAA0B9/C,EAAAA,GAAOY,GAAG;;;;EAyD1C,EAnDkC8I,IAChC,MAAO7K,EAAQkhD,IAAav+C,EAAAA,EAAAA,UAAmB,KACxCmhB,EAAW0T,IAAgB70B,EAAAA,EAAAA,WAAS,IACpC2Q,EAAO6tC,IAAYx+C,EAAAA,EAAAA,UAAwB,MA8BlD,OAJAmB,EAAAA,EAAAA,YAAU,KAvBR0zB,GAAa,IACb7oB,EAAAA,EAAAA,qBAAoB,CAClB5O,SAAU8K,EAAMyP,oBAChB6X,aAAc,OACdD,WAoBY,UAlBXjuB,MAAK,EAAG4K,WACPqyC,GAAUn7C,EAAAA,EAAAA,GAAc8I,EAAK7O,SAC7Bw3B,GAAa,GACb2pB,EAAS,KAAK,IAEfh9C,OAAMyK,KACLyyB,EAAAA,EAAAA,IAAqBzyB,GAAU3K,MAAK,EAAGqP,QAAOlD,cAC5C+wC,EACE7tC,GACElD,GACAxB,EAASyb,aACTjmB,EAAAA,EAAAA,GAAE,6BAENozB,GAAa,EAAM,GACnB,GAIgB,GACrB,CAACiO,KAAKC,UAAU76B,EAAMyP,uBAErBwJ,GACKxjB,EAAAA,EAAAA,IAAC2P,EAAAA,EAAO,IAEbqD,GACKhT,EAAAA,EAAAA,IAAA,OAAAE,SAAM8S,KAIbhT,EAAAA,EAAAA,IAAC2gD,EAAuB,CAAAzgD,SACrBR,EAAOgG,KAAI4E,GACVA,EAAKi2B,OACHvgC,EAAAA,EAAAA,IAAC8gD,EAAAA,EAAS,CAACN,IAAKl2C,EAAKi2B,MAAOkgB,SAAUn2C,EAAKm2C,eAAYj8C,IACrD,QAEkB,C,yFChE9B,MAAMu8C,EAAqB,CAAC,cAEfC,EAAoBvhD,GAC/Bk6B,IAAKl6B,EAAUshD,GAEXE,EAAmBA,CAACr9C,EAAcohC,KACtC,IAAIvyB,EAAW,2BAOf,OANI7O,IACF6O,EAAWA,EAASihB,OAAO,IAAI9vB,MAE7BohC,IACFvyB,EAAWA,EAASihB,OAAO,WAAWsR,MAEjCvyB,CAAQ,EAGXyuC,EAAkBA,CACtB/5C,EACA0wB,EACAp4B,EACA6M,KAEA,MAAM60C,EAAmB,CACvB99C,cAAe8D,EACf7D,gBAAiBu0B,EACjB8O,UAAWxB,KAAKC,UAAU4b,EAAiBvhD,KAK7C,OAHI6M,IACF60C,EAAQC,SAAW90C,GAEd60C,CAAO,EAGH19C,EAAeA,CAC1B0D,EACA0wB,EACAp4B,EACA6M,EACA04B,IAEArb,EAAAA,EAAe03B,KAAK,CAClB5uC,SAAUwuC,OAAiBz8C,EAAWwgC,GACtC3L,YAAa6nB,EACX/5C,EACA0wB,EACAp4B,EACA6M,KAED3I,MAAK29C,GAAKA,EAAE/yC,KAAK3K,MAET29C,EAAcA,CACzBp6C,EACA0wB,EACAj0B,EACAnE,EACA6M,EACA04B,IAEArb,EAAAA,EAAe63B,IAAI,CACjB/uC,SAAUwuC,EAAiBr9C,EAAKohC,GAChC3L,YAAa6nB,EACX/5C,EACA0wB,EACAp4B,EACA6M,KAED3I,MAAK29C,GAAKA,EAAE/yC,KAAKuB,S,oJC7Df,MAAMlB,EAAwBA,EACnCjP,QAAS8hD,EACTlvC,gBAEA,MAAMvR,GAAQkB,EAAAA,EAAAA,OACPxC,EAAQkhD,IAAav+C,EAAAA,EAAAA,aACrBy1B,EAAQ4pB,IAAar/C,EAAAA,EAAAA,UAC1Bo/C,EAAe/+B,EAAAA,GAAei/B,SAAWj/B,EAAAA,GAAe/S,SAqF1D,OAlFAnM,EAAAA,EAAAA,YAAU,MACHi+C,GAAgBlvC,IACnBC,EAAAA,EAAAA,GAAkB,CAChBC,SAAU,mBAAmBF,MAE5B5O,MAAK,EAAG4K,MAAQ7O,cACfkhD,EAAUlhD,GACVgiD,EAAUh/B,EAAAA,GAAei/B,SAAS,IAEnC99C,OAAM,KACL69C,EAAUh/B,EAAAA,GAAeC,MAAM,G,GAGpC,CAACpQ,EAAWkvC,IAqER,CACL9yC,aApEkB5O,EAAAA,EAAAA,UAAQ,KAC1B,MAAM6hD,EAAuB,GACvBjiD,EAAU8hD,GAAgB/hD,EAChC,GAAIC,EAAS,CAAC,IAADkiD,EAAAC,EACX,MAAM,qBACJC,EAAoB,qBACpBC,EAAoB,YACpBziC,EAAW,WACX0iC,EAAU,WACVC,EAAU,WACVC,EAAU,OACVjiC,GACEvgB,EACEyiD,GAAet+C,EAAAA,EAAAA,GAAE,iBACjBu+C,EACJ,GAAyB,OAAzBR,EAAa,MAAVM,OAAU,EAAVA,EAAYG,YAAUT,EAAI,MACN,OADQC,EACnB,MAAVK,OAAU,EAAVA,EAAYI,WAAST,EAAI,KACxBU,QAAUJ,EACTK,EAAaP,EACf,GAAGA,EAAWI,cAAcJ,EAAWK,YACvCH,EACEM,GACE,MAANxiC,OAAM,EAANA,EAAQ3a,QAAS,EACb2a,EAAOxa,KAAIi9C,GAAS,GAAGA,EAAML,cAAcK,EAAMJ,cACjD,CAACH,GACPR,EAAMhqC,KAAK,CACT/H,KAAM+yC,EAAAA,EAAa97C,MACnBkI,MAAOizC,IAETL,EAAMhqC,KAAK,CACT/H,KAAM+yC,EAAAA,EAAaC,aACnBj8C,MAAOm7C,EACPU,eAEFb,EAAMhqC,KAAK,CACT/H,KAAM+yC,EAAAA,EAAaE,MACnBT,YACAniC,OAAQwiC,EACRK,UAAWf,IAETziC,GACFqiC,EAAMhqC,KAAK,CACT/H,KAAM+yC,EAAAA,EAAaI,YACnBp8C,MAAO2Y,G,CAIb,OACEvb,EAAAA,EAAAA,IAAA,OACE/D,IAAKA,EAAAA,EAAG;;2BAE4B,EAAjBe,EAAMU;UACvBxB,SAAA,CAED43B,IAAWpV,EAAAA,GAAei/B,WACzB3hD,EAAAA,EAAAA,IAACijD,EAAAA,GAAW,CAACrB,MAAOA,EAAOsB,iBAAiB,WAE7CprB,IAAWpV,EAAAA,GAAeC,QACzB3iB,EAAAA,EAAAA,IAAC4P,EAAAA,EAAK,CACJC,KAAK,QACLC,SAAShM,EAAAA,EAAAA,GAAE,uDAGX,GAEP,CAAC29C,EAAc/hD,EAAQo4B,EAAQ92B,EAAMU,WAItCo2B,SACD,C,iDCrGSqrB,EAKAC,E,sQALZ,SAAYD,GACVA,EAAA,wBACAA,EAAA,eACD,CAHD,CAAYA,IAAAA,EAAU,KAKtB,SAAYC,GACVA,EAAA,YACAA,EAAA,UACAA,EAAA,SACD,CAJD,CAAYA,IAAAA,EAAmB,K,qECPxB,MAAMC,GAAcxiD,EAAAA,EAAAA,IAAOgO,EAAAA,QAAM;;;;EAM3By0C,EAAmBziD,EAAAA,GAAOY,GAAG;aAC7B,EAAGT,WACZ,GAAoB,EAAjBA,EAAMU,cAAmC,EAAjBV,EAAMU,cAAmC,EAAjBV,EAAMU;;iBAE5C,EAAGV,WAAYA,EAAMmgB,WAAWC,MAAMC;aAC1C,EAAGrgB,WAAYA,EAAMG,OAAOC,UAAUC;;EAItCkiD,EAAsB1iD,EAAAA,GAAOY,GAAG;0BACnB,EAAGT,WAAYA,EAAMG,OAAOC,UAAUw9B;aACnD,EAAG59B,WACZ,GAAoB,EAAjBA,EAAMU,cAAmC,EAAjBV,EAAMU,cAAmC,EAAjBV,EAAMU;;;;;iBAK5C,EAAGV,WAAYA,EAAMmgB,WAAWC,MAAMC;aAC1C,EAAGrgB,WAAYA,EAAMG,OAAOC,UAAUC;;EAItCmiD,EAAoB3iD,EAAAA,GAAO2gB,IAAI;;oBAExB,EAAGxgB,WAA6B,EAAjBA,EAAMU;;;;;;EAQ5B+hD,EAAsB5iD,EAAAA,GAAOY,GAAG;mBAC1B,EAAGT,WAA6B,EAAjBA,EAAMU;;;qBAGnB,EAAGV,WAA6B,EAAjBA,EAAMU;;EAI7BgiD,GAAmB7iD,EAAAA,EAAAA,IAAO8iD,EAAAA,GAAW;mBAC/B,EAAG3iD,WAA6B,EAAjBA,EAAMU;WAC7B,EAAGV,WAA6B,IAAjBA,EAAMU;EAGnBkiD,EAAkB/iD,EAAAA,GAAOqgB,CAAC;WAC5B,EAAGlgB,WAAYA,EAAMG,OAAO6R,MAAMiF;EAGhC4rC,EAAiB5jD,EAAAA,EAAG;;EAIpB6jD,GAAqBjjD,EAAAA,EAAAA,IAAOqD,EAAAA,EAAO;WACrC,EAAGlD,WAA6B,GAAjBA,EAAMU;EAOnBqiD,EAA0B/iD,GAAyBf,EAAAA,EAAG;YACtC,EAAjBe,EAAMU,gBAAqC,EAAjBV,EAAMU;EAO/BsiD,EAA4BnjD,EAAAA,GAAOY,GAAG;YACvC,EAAGT,WAA6B,EAAjBA,EAAMU;MAC3B,EAAGV,WAA6B,EAAjBA,EAAMU;EAGduiD,GAAcpjD,EAAAA,EAAAA,IAAO2F,EAAAA,EAAM;;iBAEvB,EAAGxF,WAA6B,EAAjBA,EAAMU;EAGzBwiD,GAAmBrjD,EAAAA,EAAAA,IAAO2F,EAAAA,EAAMC,MAAM;iBAClC,EAAGzF,WAA6B,GAAjBA,EAAMU;iBC1BtC,MAAMyiD,EAAiC,CACrC,iBACA,QACA,gBAGIC,EAAgB,CACpBC,QAAS,cAYLC,EAAe,CAAC,EAyRtB,GAAeC,EAAAA,EAAAA,KAvRf,UAAqB,OACnBx1C,EAAM,KACND,GAAO,EAAK,YACZyR,EAAW,MACXyQ,EAAK,OACLwzB,EAAM,UACNC,EAAS,QACTC,EAAO,SACPC,EAAQ,eACRC,EAAc,cACdC,EAAa,UACbp3C,IACe,IAAHq3C,EACZ,MAAM1qC,EAAe,MAAL4W,GAAoB,OAAf8zB,EAAL9zB,EAAO+zB,oBAAF,EAALD,EAAsBxkD,SAChC0kD,IAAYh0B,EACZi0B,EACJD,GAAW5qC,GAAW+pC,EAA+BvxC,SAASwH,GAC1D8qC,EAA4BD,EAC9B7B,EAAoB+B,KACpB/B,EAAoBgC,IAClBC,EAAaR,GAAiBp3C,EAC9B63C,GAAkCvlD,EAAAA,EAAAA,UACtC,KAAM,IACDqkD,EACH7gC,KAAM8hC,GACFvhD,EAAAA,EAAAA,GAAE,uBAAwBuhD,IAC1BvhD,EAAAA,EAAAA,GAAE,oBAER,CAACuhD,IAGGE,GAAgB7iD,EAAAA,EAAAA,cACpB,CAACM,EAAiCwiD,IACjB,UAAXA,EACKF,EAEF,IACFtiD,KACAwiD,IAGP,CAACF,KAGIG,EAAeC,IAAoBC,EAAAA,EAAAA,YACxCJ,EACAD,IAEKM,EAAWC,IAAgBxjD,EAAAA,EAAAA,YAE5BP,IAAWC,EAAAA,EAAAA,MAEX+jD,IAAS/iD,EAAAA,EAAAA,KAA+BC,IAC5C,MAAM+iD,EAAexlC,EACjBylC,GAAeC,WACfD,GAAeE,OACnB,OACEC,EAAAA,EAAAA,IAAenjD,EAAO+iD,EAAcxlC,IAAoB,MAALyQ,OAAK,EAALA,EAAOhkB,MAC1Ds3C,CAAY,IAGV8B,GAAaN,IAAUz6C,OAAOC,KAAKw6C,IAAQvgD,QAEjD/B,EAAAA,EAAAA,YAAU,KAENkiD,EADEU,GACeN,GAEA,Q,GAElB,CAACM,GAAYN,KAEhB,MA6CMO,IACJriD,EAAAA,EAAAA,IAACw/C,EAAiB,CAAAtjD,SAAA,EAChBF,EAAAA,EAAAA,IAACkU,EAAAA,EAAMoyC,SAAQ,KACftmD,EAAAA,EAAAA,IAAA,QAAMgZ,UAAU,OAAM9Y,SACnBkmD,IAAatiD,EAAAA,EAAAA,GAAE,sBAAuBA,EAAAA,EAAAA,GAAE,oCAKzCyiD,IACJviD,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAC8jD,EAAkB,CAAYz/C,QAAS0K,EAAO7O,UAC5C4D,EAAAA,EAAAA,GAAE,WADmB,SAGxB9D,EAAAA,EAAAA,IAAC8jD,EAAkB,CAEjB3/C,YAAY,UACZE,QA9DSiO,UAEb,MAAMk0C,EAAyC,CAC7C32C,KAAM,SACN42C,QAAQ,EACRC,kBAAkB,EAClBC,aAAclB,EAAckB,aAC5BC,gBAAiBhC,EACjBp1B,UAAWjP,EACXyQ,MAAY,MAALA,OAAK,EAALA,EAAOhkB,GACdkT,OAAQ,CAACskC,GACTqC,WAAY,CACV,CACEC,sBAAuB,CACrBngD,OAAQ89C,EACRsC,SAAUrC,EACVsC,UAAWrC,GAEb90C,KAAM,UAGV0T,KAAMkiC,EAAcliC,KACpBhE,YAAakmC,EAAclmC,YAC3B8kC,QAASoB,EAAcpB,QACvB4C,cAAexB,EAAcwB,eAAiB/B,EAC9CgC,SAAUzB,EAAcyB,UAG1BxB,EAAiB,CAAEyB,cAAc,EAAMn0C,WAAOxO,IAC9C,IACM4hD,SACItkD,IACJslD,EAAAA,EAAAA,IAAW3B,EAAcz4C,GAAIw5C,UAGzB1kD,IAASulD,EAAAA,EAAAA,IAAUb,IAE3Bz3C,G,CACA,MAAOuF,GACP,MAAM,MAAEtB,SAAgB+tB,EAAAA,EAAAA,IAAqBzsB,GAC7CoxC,EAAiB,CAAE1yC,S,CAErB0yC,EAAiB,CAAEyB,cAAc,GAAQ,EAqBrC7iD,UAAWmhD,EAAcliC,KACzBkS,QAASgwB,EAAc0B,aAAajnD,SAEnCkmD,IAAatiD,EAAAA,EAAAA,GAAE,SAAUA,EAAAA,EAAAA,GAAE,QANxB,aAWJwjD,IACJtjD,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAACgkD,EAAyB,CAAA9jD,UACxBF,EAAAA,EAAAA,IAAA,MAAAE,UAAK4D,EAAAA,EAAAA,GAAE,wBAET9D,EAAAA,EAAAA,IAAA,OAAKgZ,UAAU,mBAAkB9Y,UAC/B8D,EAAAA,EAAAA,IAACkgD,EAAgB,CACfx9C,SAAWyK,IACTu0C,EAAiB,CAAEuB,cAAe91C,EAAMxK,OAAOC,OAAQ,EAEzDA,MAAO6+C,EAAcwB,eAAiB/B,EAA0BhlD,SAAA,CAE/D+kD,IACCjlD,EAAAA,EAAAA,IAACikD,EAAW,CAACr9C,MAAOw8C,EAAoB+B,KAAKjlD,UAC1C4D,EAAAA,EAAAA,GAAE,6BAGP9D,EAAAA,EAAAA,IAACikD,EAAW,CAACr9C,MAAOw8C,EAAoBgC,IAAIllD,UACzC4D,EAAAA,EAAAA,GAAE,oCAEL9D,EAAAA,EAAAA,IAACikD,EAAW,CAACr9C,MAAOw8C,EAAoBmE,IAAIrnD,UACzC4D,EAAAA,EAAAA,GAAE,6CAMP0jD,IACJxjD,EAAAA,EAAAA,IAACyjD,EAAAA,GAAoB,CAAAvnD,SAAA,EACnBF,EAAAA,EAAAA,IAAA,OAAKgZ,UAAU,gBAAgB/Y,IAAK8jD,EAAuB7jD,UACxD4D,EAAAA,EAAAA,GAAE,uBAEL9D,EAAAA,EAAAA,IAAA,OAAKgZ,UAAU,kBAAiB9Y,UAC9BF,EAAAA,EAAAA,IAACgU,EAAAA,GAAK,CACJnE,KAAK,SACL0T,KAAK,eACL3c,OAAoB,MAAb6+C,OAAa,EAAbA,EAAekB,eAAgB,GACtCnyC,aAAa1Q,EAAAA,EAAAA,GAAE,gCACf4C,SAAWyK,IACTu0C,EAAiB,CACfiB,aAAce,SAASv2C,EAAMxK,OAAOC,MAAO,KAAO,MAClD,SAOZ,OACE5C,EAAAA,EAAAA,IAACq/C,EAAW,CACVv0C,KAAMA,EACNC,OAAQA,EACRC,MAAOq3C,GACPp3C,OAAQs3C,GACR5lD,MAAM,MACNgnD,UAAQ,EAAAznD,SAAA,EAER8D,EAAAA,EAAAA,IAACs/C,EAAgB,CAAApjD,SAAA,EACfF,EAAAA,EAAAA,IAAC4nD,EAAAA,EAAsB,CACrB56C,GAAG,OACHuW,KAAK,OACL3c,MAAO6+C,EAAcliC,MAAQ,GAC7B/O,YAAa8wC,EAAa/hC,KAC1BskC,UAAQ,EACRC,kBAAmB,CACjBphD,SAAUA,EAAGC,YACX++C,EAAiB,CAAEniC,KAAM5c,EAAOC,SAEpC+f,OAAO7iB,EAAAA,EAAAA,GAAE,kBAGX9D,EAAAA,EAAAA,IAAC4nD,EAAAA,EAAsB,CACrB56C,GAAG,cACHuW,KAAK,cACL3c,OAAoB,MAAb6+C,OAAa,EAAbA,EAAelmC,cAAe,GACrCuoC,kBAAmB,CACjBphD,SAAUA,EAAGC,aACX++C,EAAiB,CAAEnmC,YAAa5Y,EAAOC,OAAQ,GAGnD+f,OAAO7iB,EAAAA,EAAAA,GAAE,eACT0Q,aAAa1Q,EAAAA,EAAAA,GACX,4DAEF7D,IAAK4jD,QAKT7/C,EAAAA,EAAAA,IAACu/C,EAAmB,CAAArjD,SAAA,EAClB8D,EAAAA,EAAAA,IAACy/C,EAAmB,CAAAvjD,SAAA,EAClBF,EAAAA,EAAAA,IAAA,MAAIC,IAAMe,GDnPc+mD,CAAC/mD,GAAyBf,EAAAA,EAAG;YAClC,EAAjBe,EAAMU;ECkP2BqmD,CAAmB/mD,GAAOd,UAC1D4D,EAAAA,EAAAA,GAAE,eAEL9D,EAAAA,EAAAA,IAAA,KAAAE,UAAI4D,EAAAA,EAAAA,GAAE,kDAGR9D,EAAAA,EAAAA,IAAC0jD,EAAgB,CACfsE,aAAa,EACbphD,MAAO6+C,EAAcpB,SAAW,aAChC7yC,SAAWuxB,IACT2iB,EAAiB,CAAErB,QAASthB,GAAW,EAEzCvmB,QAASqpC,KAEX7lD,EAAAA,EAAAA,IAAC4jD,EAAe,CAAA1jD,SAAE0lD,KAClB5lD,EAAAA,EAAAA,IAAA,OACEgZ,UAAU,gBACV/Y,IAAMe,GD5QmBinD,CAACjnD,GAAyBf,EAAAA,EAAG;YACnC,EAAjBe,EAAMU,gBAAqC,EAAjBV,EAAMU;EC2QHumD,CAAoBjnD,GAAOd,UAEzD4D,EAAAA,EAAAA,GAAE,eAEL9D,EAAAA,EAAAA,IAACkoD,EAAAA,EAAgB,CACfhB,SAAUzB,EAAcyB,SACxBiB,iBAAkBvhD,IAChB8+C,EAAiB,CAAEwB,SAAUtgD,GAAQ,IAGxCo+C,GAAWsC,KACTtC,IAAYC,IAAqBuC,MAErC/B,EAAczyC,QACbhT,EAAAA,EAAAA,IAAC4P,EAAAA,EAAK,CACJC,KAAK,QACL5P,IAAMe,GDlQoBonD,CAACpnD,GAAyBf,EAAAA,EAAG;YACrDe,EAAMG,OAAO6R,MAAMiF;aACD,EAAjBjX,EAAMU;YACU,EAAjBV,EAAMU;;WAEPV,EAAMG,OAAO6R,MAAMsd;;iBAEbtvB,EAAMmgB,WAAWC,MAAM+wB;;;;iBAIvBnxC,EAAMmgB,WAAWC,MAAM+wB;mBACJ,EAAjBnxC,EAAMU;;sBAEc,IAAjBV,EAAMU;mBACTV,EAAMmgB,WAAWC,MAAMinC;;aAE7BrnD,EAAMU,SAAW;;;ECiPW0mD,CAAqBpnD,GACpD8O,QACEs2C,IACItiD,EAAAA,EAAAA,GAAE,4BACFA,EAAAA,EAAAA,GAAE,2BAERyb,YAAakmC,EAAczyC,UAKrC,I,eC5UA,MAAMs1C,IAAqBt4C,EAAAA,EAAAA,KAErBu4C,GAAevnD,GAAyBf,EAAAA,EAAG;WACtCe,EAAMG,OAAO6R,MAAMiF;EAGxBuwC,GAAexnD,GAAyBf,EAAAA,EAAG;;;;;;eAMlCe,EAAMG,OAAOC,UAAUG;;;;wBAIdP,EAAMG,OAAO4tB,UAAUlD;;EAIzC48B,GAAmBznD,GAAyBf,EAAAA,EAAG;;aAExCe,EAAMG,OAAOC,UAAUG;wBACZP,EAAMG,OAAO4tB,UAAUlD;;EAIzC68B,GAA6B7nD,EAAAA,GAAOY,GAAG;;;;;;oBAMzB,EAAGT,WAAYA,EAAMU;;EAInCinD,GAAwBL,GAAmBr4C,IAC/C,mCAGK,IAAK+1C,IAAZ,SAAYA,GACVA,EAAA,gBACAA,EAAA,uBACD,CAHD,CAAYA,KAAAA,GAAc,KAe1B,MAAM1B,GAAe,CAAC,EAAE,IAAA/tB,GAAA,CAAAhT,KAAA,UAAAiT,OAAA,eAAAoyB,GAAA,CAAArlC,KAAA,SAAAiT,OAAA,eAEV,SAAUjD,IAAqB,YAC3ChT,EAAW,MACXyQ,EAAK,YACLwC,GAAc,EAAK,qBACnB3C,EAAoB,qBACpBE,EAAoB,kBACpBD,KACGvgB,IAEH,MAAMzO,GAAWC,EAAAA,EAAAA,MACX+jD,GAAS/iD,EAAAA,EAAAA,KAA8BC,IAC3C,MAAM+iD,EAAexlC,EACjBylC,GAAeC,WACfD,GAAeE,OACnB,OACEC,EAAAA,EAAAA,IAAenjD,EAAO+iD,EAAcxlC,IAAoB,MAALyQ,OAAK,EAALA,EAAOhkB,MAC1Ds3C,EAAY,IAIVuE,GAAgC,MAAN/C,OAAM,EAANA,EAAQW,UAAU,EAC5CtjD,GAAoCJ,EAAAA,EAAAA,KAGxCC,GAASA,EAAMG,OACX2lD,EAAgBA,OACfhyC,EAAAA,EAAAA,IAAiBC,EAAAA,GAAYgyC,kBAIzB,MAAJ5lD,IAAAA,EAAMqhD,aAMLjkC,GAAoB,MAALyQ,GAAAA,EAAOhkB,KAId3B,OAAOC,KAAKnI,EAAKC,OAAS,IACdsC,KAAI9B,GAC5BT,EAAKC,MAAMQ,GAAKqC,QACd+iD,GAAsB,gBAAbA,EAAM,IAAqC,WAAbA,EAAM,OAG9Bt9C,MAAKu9C,GAAcA,EAAW1jD,OAAS,OAGrD2jD,EAAuBC,IAC5B9mD,EAAAA,EAAAA,UAA6B,MACzBrB,GAAQkB,EAAAA,EAAAA,MACRknD,GAAgBC,EAAAA,EAAAA,GAAY9oC,IAC3BzP,EAAWC,IAAgB1O,EAAAA,EAAAA,WAAkB,GAC9CinD,EAAkBh3C,MAAO7K,EAAmBq3B,KACxC,MAAJr3B,GAAAA,EAAMuF,IACRlL,GAASynD,EAAAA,EAAAA,GAAa9hD,EAAMq3B,G,EAS1B0qB,EACJV,QACIvoC,GAAe6oC,IAAkB7oC,GAAqB,MAALyQ,GAAAA,EAAOhkB,KAE9DxJ,EAAAA,EAAAA,YAAU,KACJgmD,GACF1nD,GACE2nD,EAAAA,EAAAA,IAAsB,CACpBjF,OAAQrhD,EAAKqhD,OACbkF,YAAanpC,EAAc,eAAiB,WAC5CqkC,eAAgBrkC,EAAc,aAAe,SAC7CopC,WAAYppC,IAAoB,MAALyQ,OAAK,EAALA,EAAOhkB,M,GAIvC,IAEH,MAAM4jB,EAAoBk1B,GAAUj1B,GAAwBi4B,KAQ5DtlD,EAAAA,EAAAA,YAAU,KACJotB,EACFC,GAAqB,IACXi1B,GAAUj1B,GACpBA,GAAqB,E,GAEtB,CAACi1B,IAEJ,MAAM8D,EAAiBA,KACjB74B,IACFA,GAAqB,GACrBhgB,GAAa,G,EAuGjB,OACE/Q,EAAAA,EAAAA,IAAAiE,EAAAA,GAAA,CAAA/D,SACG4oD,MACC9kD,EAAAA,EAAAA,IAAAC,EAAAA,GAAA,CAAA/D,SAAA,EACEF,EAAAA,EAAAA,IAAC6pD,EAAW,CACVrF,OAAQrhD,EAAKqhD,OACb11C,KAAMgC,EACN/B,OAAQA,IAAMgC,GAAa,GAC3B0zC,UAAWthD,EAAK2mD,MAChBvpC,YAAaA,EACbyQ,MAAOA,EACP4zB,eACErkC,EAAcylC,GAAeC,WAAaD,GAAeE,SAG5D1yB,EA1GPuJ,IAAQ+oB,IACN9hD,EAAAA,EAAAA,IAAC4P,EAAAA,KAAI,CAACif,YAAY,KAAWtiB,EAAMtQ,IAAKuoD,GAAYtoD,SAAA,EAClDF,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAACsD,QAASulD,EAAe1pD,SAChCyoD,IACC3kD,EAAAA,EAAAA,IAAC0kD,GAA0B,CAAAxoD,SAAA,EACzBF,EAAAA,EAAAA,IAAA,OAAAE,UAAM4D,EAAAA,EAAAA,GAAE,6BACR9D,EAAAA,EAAAA,IAAC2oD,GAAqB,QAGxB7kD,EAAAA,EAAAA,GAAE,6BAGN9D,EAAAA,EAAAA,IAAC4T,EAAK,KAAAsE,QAAO,OAGf4Y,IACE9sB,EAAAA,EAAAA,IAAC4P,EAAAA,KAAI,CAACif,YAAY,EAAO5yB,IAAGs2B,GAAqBr2B,SAAA,EAC/CF,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CACRd,IAAKwoD,GACLpkD,QAASA,IAAMilD,EAAgBxD,GAAS+C,GAAgB3oD,UAExD8D,EAAAA,EAAAA,IAACmsB,EAAAA,GAA6B,CAAAjwB,SAAA,EAC5BF,EAAAA,EAAAA,IAAC6+B,EAAAA,GAAQ,CAACC,QAAS+pB,EAAgBniD,SAAUoD,EAAAA,MAC5ChG,EAAAA,EAAAA,GAAE,8BAGP9D,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAACd,IAAKwoD,GAAiBpkD,QAASulD,EAAe1pD,UACtD4D,EAAAA,EAAAA,GAAE,wBAEL9D,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAACd,IAAKwoD,GAAiBpkD,QArCX0lD,KACxBh5B,IACFA,GAAqB,GACrBo4B,EAAyBrD,G,EAkC2C5lD,UAC7D4D,EAAAA,EAAAA,GAAE,4BA8BXi5B,IAAQ+oB,IACN9lD,EAAAA,EAAAA,IAAA,QACE6jB,KAAK,SACL7U,OAAOlL,EAAAA,EAAAA,GAAE,yBACTggB,SAAU,EACV9K,UAAU,uCACV3U,QAASA,IAAM0M,GAAa,GAAM7Q,UAElCF,EAAAA,EAAAA,IAACkU,EAAAA,EAAMoyC,SAAQ,OAGjBtmD,EAAAA,EAAAA,IAAAiE,EAAAA,GAAA,CAAA/D,UACEF,EAAAA,EAAAA,IAACy/B,EAAAA,GAAmB,CAClB1mB,SArCN/U,EAAAA,EAAAA,IAAC4P,EAAAA,KAAI,CAACif,YAAY,EAAO5yB,IAAG2oD,GAAqB1oD,SAAA,EAC/C8D,EAAAA,EAAAA,IAAC4P,EAAK,KAAA7S,KAAI,CAAAb,SAAA,EACP4D,EAAAA,EAAAA,GAAE,yBACH9D,EAAAA,EAAAA,IAACgqD,EAAAA,EAAM,CAELlrB,QAAS+pB,EACTxkD,QAAUy6B,GAAqBwqB,EAAgBxD,EAAQhnB,GACvDxE,KAAK,QACLr6B,KAAGmZ,EAAAA,EAAAA,IAAE,CAAE6wC,WAA6B,EAAjBjpD,EAAMU,UAAc,aAG3C1B,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CAACsD,QAASA,IAAM0M,GAAa,GAAM7Q,UAC1C4D,EAAAA,EAAAA,GAAE,wBAEL9D,EAAAA,EAAAA,IAAC4T,EAAK,KAAA7S,KAAI,CACRsD,QAASA,IAAM8kD,EAAyBrD,GACxC7lD,IAAKsoD,GAAYroD,UAEhB4D,EAAAA,EAAAA,GAAE,4BAoBD+7B,aAtGqB,CAC3B4d,OAAQ,GACRyM,kBAAmB,MAqGbhxC,QAAS,CAAC,SACVk5B,kBAAoBjf,GAClBA,EAAYg3B,QAAQ,kBACrBjqD,UAEDF,EAAAA,EAAAA,IAAA,QACE6jB,KAAK,SACL7K,UAAU,uCACV8K,SAAU,EAAE5jB,UAEZF,EAAAA,EAAAA,IAACkU,EAAAA,EAAMoyC,SAAQ,UAsBhB4C,IACClpD,EAAAA,EAAAA,IAACoqD,EAAAA,EAAW,CACV7qC,aAAazb,EAAAA,EAAAA,GACX,0CACqB,MAArBolD,OAAqB,EAArBA,EAAuB3lC,MAEzB8mC,UAAWA,KACLnB,GAvKS52C,OAAOwzC,UAC1BhkD,GAASwoD,EAAAA,EAAAA,IAAmBxE,IAClCqD,EAAyB,KAAK,EAsKhBoB,CAAmBrB,E,EAGvBn6C,OAAQA,IAAMo6C,EAAyB,MACvC77C,MAAI,EACJ0B,OAAOlL,EAAAA,EAAAA,GAAE,wBAOvB,C,4DCpUA,MAEM0mD,EACJ,IAAIC,iBAHsB,kBAKtB,SAAUC,IACd,MAAO1lB,EAAO2lB,IAAYtoD,EAAAA,EAAAA,YAkE1B,OAzDAmB,EAAAA,EAAAA,YAAU,KACR,IARF,WACE,IACE,OAAO+tB,OAAOq5B,cAAgBr5B,OAAOs5B,c,CACrC,MAAO73C,GACP,OAAO,C,CAEX,CAEO83C,GAIH,YAHK9lB,GACH2lB,GAASI,EAAAA,EAAAA,QAKb,MAAMC,EAAcA,KAClB,IAAIC,EACJ,IACEA,EAAY15B,OAAOq5B,aAAarhB,QAAQ,c,CACxC,MAAOv2B,GACP,CAEF,MAAMk4C,EAAWl7B,OACfi7B,EAAYvnD,OAAOgkD,SAASuD,EAAW,IAAM,EAAI,GAEnD,IACE15B,OAAOs5B,eAAenhB,QAAQ,SAAUwhB,GACxC35B,OAAOq5B,aAAalhB,QAAQ,cAAewhB,E,CAC3C,MAAOl4C,GACP,CAEF23C,EAASO,EAAS,EAEpB,IAAIC,EACJ,IACEA,EAAc55B,OAAOs5B,eAAethB,QAAQ,S,CAC5C,MAAOv2B,GACP,CAEEm4C,GACFX,EAAQY,YAAY,CAClBv7C,KAAM,oBACNm1B,MAAOmmB,IAETR,EAASQ,IAETH,IAGFR,EAAQa,UAAYC,IAClB,GAAIA,EAAa7jD,KAAKu9B,QAAUA,EAC9B,GAA+B,sBAA3BsmB,EAAa7jD,KAAKoI,KAA8B,CAClD,MAAMC,EAA+B,CACnCD,KAAM,gBACNm1B,MAAOsmB,EAAa7jD,KAAKu9B,OAE3BwlB,EAAQY,YAAYt7C,E,KACgB,kBAA3Bw7C,EAAa7jD,KAAKoI,MAC3Bm7C,G,CAGL,GACA,CAAChmB,IAEGA,CACT,C,mCC/EO,MAAMjF,EACXA,CACEwrB,EACAvgB,EACAwgB,EAAgCA,KAAI5+C,IAAYu4B,KAAKC,UAAU,IAAIx4B,OAErE,IAAIA,KACF,MAAMhJ,EAAM4nD,KAAS5+C,GACrB,GAAIo+B,EAAMhS,IAAIp1B,GACZ,OAAOonC,EAAM/6B,IAAIrM,GAEnB,MAAMlE,EAAS6rD,KAAM3+C,GAErB,OADAo+B,EAAM7R,IAAIv1B,EAAKlE,GACRA,CAAM,C,oECVV,MAAMwT,EAAmB,IAAIqkB,IAEvB/kB,GAAoButB,EAAAA,EAAAA,GAC/BpW,EAAAA,EAAe1Z,IACfiD,GACA,EAAGT,cAAeA,GAAY,I,gHCGhC,MAAMg5C,EAAmBA,CAAClsC,EAAqBmsC,EAAO,IAAI1tC,OACxD,GAAG2tC,IAAUpsC,MAAgBmsC,EAAKE,cAAcC,QAAQ,QAAS,OAWrD,SAAUn5B,EACtBo5B,EACAvsC,EACAwsC,GAAkB,GAElB,OAAQ56C,IACN,MAAM66C,EAAiBD,EACnBtzC,SAASwzC,cAAcH,GACvB36C,EAAM+c,cAAci8B,QAAQ2B,GAEhC,OAAKE,EAkBEE,IAAAA,OACGF,EAAgB,CACtBG,QAASC,EAAAA,GAAcjrD,OAAOC,UAAU48C,OACxC/3C,OAbYomD,GACgB,iBAAnBA,EAAKrzC,WAEO,+BAAnBqzC,EAAKrzC,YACJqzC,EAAKrzC,UAAUpG,SAAS,qBAW5BjP,MAAM2oD,IACL,MAAMxpC,EAAOrK,SAAS8zC,cAAc,KACpCzpC,EAAK0pC,SAAW,GAAGf,EAAiBlsC,SACpCuD,EAAK2O,KAAO66B,EACZxpC,EAAKnK,OAAO,IAEb9U,OAAOyQ,IACNm4C,QAAQz5C,MAAM,wBAAyBsB,EAAE,KA7BpCo4C,EAAAA,EAAAA,KACL5oD,EAAAA,EAAAA,GAAE,wDA6BF,CAER,C,kDChEA,MAAM6oD,GAAoB7oD,EAAAA,EAAAA,GAAE,gBACtB8oD,GAAoB9oD,EAAAA,EAAAA,GAAE,gBAEf4f,EAAwCmpC,IACnD/oD,EAAAA,EAAAA,GACE,+GACA,IAAI+oD,EAAaF,EAAoBC,K,mFCIlC,MAAMrjD,EAAsBA,CACjCujD,EACAxnC,EAAkBC,EAAAA,EAAQC,SAE1B,IAAI9lB,EAYI,IAADqtD,EAoBP,OA9BErtD,GADEm2B,EAAAA,EAAAA,IAAci3B,EAAa/mD,KACpB,CACP0e,eAAgB,MAChBa,SACAG,eAAeE,EAAAA,EAAAA,GAAe,CAC5BlB,eAAgBC,EAAAA,EAAgBC,OAChCC,QAAS,IAAIkoC,EAAa/mD,IAAI0f,iBAC9BZ,SAAUioC,EAAa3oC,GACvBa,WAAY,QAAS8nC,EAAeA,EAAa1iD,SAAM5F,KAIlD,CACPigB,eAAgB,SAChBa,SACAT,SAAUioC,EAAa3oC,GACvBY,WAEC,OAFSgoC,EAAE1hD,OAAO2qB,QAAQ5R,EAAAA,IAAgCte,MACzDknD,GAAiBA,EAAc,GAAG3oC,YAAcyoC,EAAa3oC,WAC9D,EAFW4oC,EAER,GACJnoC,QAASkoC,EAAa/mD,IACtBif,WAAY,QAAS8nC,EAAeA,EAAa1iD,SAAM5F,GAGvDsoD,EAAajnC,SACfxa,OAAOuqB,OAAOl2B,EAAQ,CACpBmmB,SAAS,EACTG,iBAAkB,UAAUC,KAAKC,SAC9B1H,SAAS,IACT2H,UAAU,EAAG,OAAOF,KAAKC,SAAS1H,SAAS,IAAI2H,UAAU,EAAG,QAG5DzmB,CAAM,C","sources":["webpack://superset/./src/types/ChartSource.ts","webpack://superset/./src/components/Chart/types.ts","webpack://superset/./src/components/Chart/DrillBy/DrillByChart.tsx","webpack://superset/./src/components/Chart/DrillBy/useDrillByBreadcrumbs.tsx","webpack://superset/./src/components/Chart/DrillBy/useResultsTableView.tsx","webpack://superset/./src/components/Chart/DrillBy/DrillByModal.tsx","webpack://superset/./src/components/Chart/DrillBy/useDisplayModeToggle.tsx","webpack://superset/./src/components/Chart/ChartContextMenu/useContextMenu.tsx","webpack://superset/./src/components/Chart/DrillBy/DrillByMenuItems.tsx","webpack://superset/./src/hooks/apiResources/datasets.ts","webpack://superset/./src/components/Chart/ChartContextMenu/ChartContextMenu.tsx","webpack://superset/./src/components/Chart/ChartRenderer.jsx","webpack://superset/./src/components/Chart/ChartErrorMessage.tsx","webpack://superset/./src/components/Chart/Chart.jsx","webpack://superset/./src/components/Chart/ChartContainer.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilter/index.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterOption/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/adhocFilterType.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterControl/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetric.js","webpack://superset/./src/explore/components/controls/MetricControl/FilterDefinitionOption.jsx","webpack://superset/./src/explore/components/controls/MetricControl/adhocMetricType.js","webpack://superset/./src/explore/components/controls/MetricControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/savedMetricType.js","webpack://superset/./src/explore/components/EmbedCodeContent.jsx","webpack://superset/./src/explore/components/useExploreAdditionalActionsMenu/DashboardsSubMenu.tsx","webpack://superset/./src/explore/components/useExploreAdditionalActionsMenu/index.jsx","webpack://superset/./src/SqlLab/utils/sqlKeywords.ts","webpack://superset/./src/components/Chart/DisabledMenuItemTooltip.tsx","webpack://superset/./src/components/Table/cell-renderers/BooleanCell/index.tsx","webpack://superset/./src/components/Table/cell-renderers/NullCell/index.tsx","webpack://superset/./src/components/Table/cell-renderers/TimeCell/index.tsx","webpack://superset/./src/components/Table/header-renderers/HeaderWithRadioGroup.tsx","webpack://superset/./src/components/Chart/DrillDetail/DrillDetailTableControls.tsx","webpack://superset/./src/components/Chart/DrillDetail/DrillDetailPane.tsx","webpack://superset/./src/components/Chart/DrillDetail/utils.ts","webpack://superset/./src/components/Chart/DrillDetail/DrillDetailModal.tsx","webpack://superset/./src/components/Chart/DrillDetail/DrillDetailMenuItems.tsx","webpack://superset/./src/components/Chart/MenuItemWithTruncation.tsx","webpack://superset/./src/components/Chart/utils.ts","webpack://superset/./src/components/Checkbox/CheckboxIcons.tsx","webpack://superset/./src/components/Checkbox/Checkbox.tsx","webpack://superset/./src/components/Dropdown/index.tsx","webpack://superset/./src/components/Tags/utils.tsx","webpack://superset/./src/dashboard/components/nativeFilters/utils.ts","webpack://superset/./src/dashboard/util/charts/getEffectiveExtraFilters.ts","webpack://superset/./src/dashboard/util/charts/getFormDataWithExtraFilters.ts","webpack://superset/./src/explore/components/DataTableControl/index.tsx","webpack://superset/./src/explore/components/DataTableControl/utils.ts","webpack://superset/./src/explore/components/DataTablesPane/components/DataTableControls.tsx","webpack://superset/./src/explore/components/DataTablesPane/components/SingleQueryResultPane.tsx","webpack://superset/./src/explore/components/DataTablesPane/types.ts","webpack://superset/./src/explore/components/DataTablesPane/components/useResultsPane.tsx","webpack://superset/./src/explore/components/DataTablesPane/components/ResultsPaneOnDashboard.tsx","webpack://superset/./src/explore/components/DataTablesPane/components/SamplesPane.tsx","webpack://superset/./src/explore/components/DataTablesPane/DataTablesPane.tsx","webpack://superset/./src/explore/components/DndItemType.ts","webpack://superset/./src/explore/components/ExploreContentPopover.tsx","webpack://superset/./src/explore/components/RowCountLabel/index.tsx","webpack://superset/./src/explore/components/controls/ColorSchemeControl/ColorSchemeLabel.tsx","webpack://superset/./src/explore/components/controls/ColorSchemeControl/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/useAdvancedDataTypes.ts","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/types.ts","webpack://superset/./src/explore/components/controls/FilterControl/utils/useGetTimeRangeLabel.tsx","webpack://superset/./src/explore/components/controls/FilterControl/utils/useDatePickerInAdhocFilter.tsx","webpack://superset/./src/explore/components/controls/FilterControl/utils/translateToSQL.ts","webpack://superset/./src/explore/components/controls/OptionControls/index.tsx","webpack://superset/./src/explore/components/controls/ViewQuery.tsx","webpack://superset/./src/explore/components/controls/ViewQueryModal.tsx","webpack://superset/./src/explore/exploreUtils/formData.ts","webpack://superset/./src/features/datasets/metadataBar/useDatasetMetadataBar.tsx","webpack://superset/./src/features/reports/types.ts","webpack://superset/./src/features/reports/ReportModal/styles.tsx","webpack://superset/./src/features/reports/ReportModal/index.tsx","webpack://superset/./src/features/reports/ReportModal/HeaderReportDropdown/index.tsx","webpack://superset/./src/hooks/useTabId.ts","webpack://superset/./src/utils/cacheWrapper.ts","webpack://superset/./src/utils/cachedSupersetGet.ts","webpack://superset/./src/utils/downloadAsImage.ts","webpack://superset/./src/utils/getChartRequiredFieldsMissingMessage.ts","webpack://superset/./src/utils/simpleFilterToAdhoc.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport enum ChartSource {\n  Explore = 'explore',\n  Dashboard = 'dashboard',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Column, Metric } from '@superset-ui/core';\n\nexport enum DrillByType {\n  Chart,\n  Table,\n}\n\nexport type Dataset = {\n  changed_by?: {\n    first_name: string;\n    last_name: string;\n  };\n  created_by?: {\n    first_name: string;\n    last_name: string;\n  };\n  changed_on_humanized: string;\n  created_on_humanized: string;\n  description: string;\n  table_name: string;\n  owners: {\n    first_name: string;\n    last_name: string;\n  }[];\n  columns?: Column[];\n  metrics?: Metric[];\n  verbose_map?: Record<string, string>;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useMemo } from 'react';\nimport {\n  BaseFormData,\n  QueryData,\n  SuperChart,\n  css,\n  ContextMenuFilters,\n} from '@superset-ui/core';\nimport { Dataset } from '../types';\n\ninterface DrillByChartProps {\n  formData: BaseFormData & { [key: string]: any };\n  result: QueryData[];\n  dataset: Dataset;\n  onContextMenu: (\n    offsetX: number,\n    offsetY: number,\n    filters: ContextMenuFilters,\n  ) => void;\n  inContextMenu: boolean;\n}\n\nexport default function DrillByChart({\n  formData,\n  result,\n  dataset,\n  onContextMenu,\n  inContextMenu,\n}: DrillByChartProps) {\n  const hooks = useMemo(() => ({ onContextMenu }), [onContextMenu]);\n\n  return (\n    <div\n      css={css`\n        width: 100%;\n        height: 100%;\n        min-height: 0;\n      `}\n      data-test=\"drill-by-chart\"\n    >\n      <SuperChart\n        disableErrorBoundary\n        chartType={formData.viz_type}\n        enableNoResults\n        datasource={dataset}\n        formData={formData}\n        queriesData={result}\n        hooks={hooks}\n        inContextMenu={inContextMenu}\n        height=\"100%\"\n        width=\"100%\"\n      />\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useMemo } from 'react';\nimport {\n  BinaryQueryObjectFilterClause,\n  Column,\n  css,\n  ensureIsArray,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { AntdBreadcrumb } from 'src/components/index';\nimport { noOp } from 'src/utils/common';\n\nexport interface DrillByBreadcrumb {\n  groupby: Column | Column[];\n  filters?: BinaryQueryObjectFilterClause[];\n}\n\nconst BreadcrumbItem = styled(AntdBreadcrumb.Item)<{\n  isClickable: boolean;\n  isHidden: boolean;\n}>`\n  ${({ theme, isClickable, isHidden }) => css`\n    cursor: ${isClickable ? 'pointer' : 'auto'};\n    color: ${theme.colors.grayscale.light1};\n    transition: color ease-in ${theme.transitionTiming}s;\n    .ant-breadcrumb > span:last-child > & {\n      color: ${theme.colors.grayscale.dark1};\n    }\n    &:hover {\n      color: ${isClickable ? theme.colors.grayscale.dark1 : 'inherit'};\n    }\n    visibility: ${isHidden ? 'hidden' : 'visible'};\n  `}\n`;\n\nexport const useDrillByBreadcrumbs = (\n  breadcrumbsData: DrillByBreadcrumb[],\n  onBreadcrumbClick: (\n    breadcrumb: DrillByBreadcrumb,\n    index: number,\n  ) => void = noOp,\n) =>\n  useMemo(() => {\n    // the last breadcrumb is not clickable\n    const isClickable = (index: number) => index < breadcrumbsData.length - 1;\n    const isHidden = (breadcumb: DrillByBreadcrumb) =>\n      ensureIsArray(breadcumb.groupby).length === 0 &&\n      ensureIsArray(breadcumb.filters).length === 0;\n    const getBreadcrumbText = (breadcrumb: DrillByBreadcrumb) =>\n      `${ensureIsArray(breadcrumb.groupby)\n        .map(column => column.verbose_name || column.column_name)\n        .join(', ')} ${\n        breadcrumb.filters\n          ? `(${breadcrumb.filters\n              .map(filter => filter.formattedVal || filter.val)\n              .join(', ')})`\n          : ''\n      }`;\n    return (\n      <AntdBreadcrumb\n        css={(theme: SupersetTheme) => css`\n          margin: ${theme.gridUnit * 2}px 0 ${theme.gridUnit * 4}px;\n        `}\n      >\n        {breadcrumbsData\n          .map((breadcrumb, index) => (\n            <BreadcrumbItem\n              key={index}\n              isClickable={isClickable(index)}\n              isHidden={isHidden(breadcrumb)}\n              onClick={\n                isClickable(index)\n                  ? () => onBreadcrumbClick(breadcrumb, index)\n                  : noOp\n              }\n              data-test=\"drill-by-breadcrumb-item\"\n            >\n              {getBreadcrumbText(breadcrumb)}\n            </BreadcrumbItem>\n          ))\n          .filter(item => item.props.isHidden === false)}\n      </AntdBreadcrumb>\n    );\n  }, [breadcrumbsData, onBreadcrumbClick]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { css, styled, isDefined, QueryData, t } from '@superset-ui/core';\nimport { SingleQueryResultPane } from 'src/explore/components/DataTablesPane/components/SingleQueryResultPane';\nimport Tabs from 'src/components/Tabs';\n\nconst DATA_SIZE = 15;\n\nconst PaginationContainer = styled.div`\n  ${({ theme }) => css`\n    & .pagination-container {\n      bottom: ${-theme.gridUnit * 4}px;\n    }\n  `}\n`;\n\nexport const useResultsTableView = (\n  chartDataResult: QueryData[] | undefined,\n  datasourceId: string,\n  canDownload: boolean,\n) => {\n  if (!isDefined(chartDataResult)) {\n    return <div />;\n  }\n  if (chartDataResult.length === 1) {\n    return (\n      <PaginationContainer data-test=\"drill-by-results-table\">\n        <SingleQueryResultPane\n          colnames={chartDataResult[0].colnames}\n          coltypes={chartDataResult[0].coltypes}\n          rowcount={chartDataResult[0].sql_rowcount}\n          data={chartDataResult[0].data}\n          dataSize={DATA_SIZE}\n          datasourceId={datasourceId}\n          isVisible\n          canDownload={canDownload}\n        />\n      </PaginationContainer>\n    );\n  }\n  return (\n    <Tabs fullWidth={false} data-test=\"drill-by-results-tabs\">\n      {chartDataResult.map((res, index) => (\n        <Tabs.TabPane tab={t('Results %s', index + 1)} key={index}>\n          <PaginationContainer>\n            <SingleQueryResultPane\n              colnames={res.colnames}\n              coltypes={res.coltypes}\n              data={res.data}\n              rowcount={res.sql_rowcount}\n              dataSize={DATA_SIZE}\n              datasourceId={datasourceId}\n              isVisible\n              canDownload={canDownload}\n            />\n          </PaginationContainer>\n        </Tabs.TabPane>\n      ))}\n    </Tabs>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useContext, useEffect, useMemo, useState } from 'react';\nimport {\n  BaseFormData,\n  Column,\n  QueryData,\n  css,\n  ensureIsArray,\n  isDefined,\n  t,\n  useTheme,\n  ContextMenuFilters,\n} from '@superset-ui/core';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport Modal from 'src/components/Modal';\nimport Loading from 'src/components/Loading';\nimport Button from 'src/components/Button';\nimport { RootState } from 'src/dashboard/types';\nimport { DashboardPageIdContext } from 'src/dashboard/containers/DashboardPage';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport { simpleFilterToAdhoc } from 'src/utils/simpleFilterToAdhoc';\nimport { useDatasetMetadataBar } from 'src/features/datasets/metadataBar/useDatasetMetadataBar';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport Alert from 'src/components/Alert';\nimport { logEvent } from 'src/logger/actions';\nimport {\n  LOG_ACTIONS_DRILL_BY_BREADCRUMB_CLICKED,\n  LOG_ACTIONS_DRILL_BY_EDIT_CHART,\n  LOG_ACTIONS_DRILL_BY_MODAL_OPENED,\n  LOG_ACTIONS_FURTHER_DRILL_BY,\n} from 'src/logger/LogUtils';\nimport { findPermission } from 'src/utils/findPermission';\nimport { getQuerySettings } from 'src/explore/exploreUtils';\nimport { Dataset, DrillByType } from '../types';\nimport DrillByChart from './DrillByChart';\nimport { ContextMenuItem } from '../ChartContextMenu/ChartContextMenu';\nimport { useContextMenu } from '../ChartContextMenu/useContextMenu';\nimport { getChartDataRequest, handleChartDataResponse } from '../chartAction';\nimport { useDisplayModeToggle } from './useDisplayModeToggle';\nimport {\n  DrillByBreadcrumb,\n  useDrillByBreadcrumbs,\n} from './useDrillByBreadcrumbs';\nimport { useResultsTableView } from './useResultsTableView';\n\nconst DEFAULT_ADHOC_FILTER_FIELD_NAME = 'adhoc_filters';\ninterface ModalFooterProps {\n  closeModal?: () => void;\n  formData: BaseFormData;\n}\n\nconst ModalFooter = ({ formData, closeModal }: ModalFooterProps) => {\n  const dispatch = useDispatch();\n  const { addDangerToast } = useToasts();\n  const theme = useTheme();\n  const [url, setUrl] = useState('');\n  const dashboardPageId = useContext(DashboardPageIdContext);\n  const onEditChartClick = useCallback(() => {\n    dispatch(\n      logEvent(LOG_ACTIONS_DRILL_BY_EDIT_CHART, {\n        slice_id: formData.slice_id,\n      }),\n    );\n  }, [dispatch, formData.slice_id]);\n  const canExplore = useSelector((state: RootState) =>\n    findPermission('can_explore', 'Superset', state.user?.roles),\n  );\n\n  const [datasource_id, datasource_type] = formData.datasource.split('__');\n  useEffect(() => {\n    postFormData(Number(datasource_id), datasource_type, formData, 0)\n      .then(key => {\n        setUrl(\n          `/explore/?form_data_key=${key}&dashboard_page_id=${dashboardPageId}`,\n        );\n      })\n      .catch(() => {\n        addDangerToast(t('Failed to generate chart edit URL'));\n      });\n  }, [\n    addDangerToast,\n    dashboardPageId,\n    datasource_id,\n    datasource_type,\n    formData,\n  ]);\n  const isEditDisabled = !url || !canExplore;\n\n  return (\n    <>\n      <Button\n        buttonStyle=\"secondary\"\n        buttonSize=\"small\"\n        onClick={onEditChartClick}\n        disabled={isEditDisabled}\n        tooltip={\n          isEditDisabled\n            ? t('You do not have sufficient permissions to edit the chart')\n            : undefined\n        }\n      >\n        <Link\n          css={css`\n            &:hover {\n              text-decoration: none;\n            }\n          `}\n          to={url}\n        >\n          {t('Edit chart')}\n        </Link>\n      </Button>\n\n      <Button\n        buttonStyle=\"primary\"\n        buttonSize=\"small\"\n        onClick={closeModal}\n        data-test=\"close-drill-by-modal\"\n        css={css`\n          margin-left: ${theme.gridUnit * 2}px;\n        `}\n      >\n        {t('Close')}\n      </Button>\n    </>\n  );\n};\n\nexport interface DrillByModalProps {\n  column?: Column;\n  dataset: Dataset;\n  drillByConfig: Required<ContextMenuFilters>['drillBy'];\n  formData: BaseFormData & { [key: string]: any };\n  onHideModal: () => void;\n  canDownload: boolean;\n}\n\ntype DrillByConfigs = (ContextMenuFilters['drillBy'] & { column?: Column })[];\n\nexport default function DrillByModal({\n  column,\n  dataset,\n  drillByConfig,\n  formData,\n  onHideModal,\n  canDownload,\n}: DrillByModalProps) {\n  const dispatch = useDispatch();\n  const theme = useTheme();\n  const { addDangerToast } = useToasts();\n  const [isChartDataLoading, setIsChartDataLoading] = useState(true);\n\n  const [drillByConfigs, setDrillByConfigs] = useState<DrillByConfigs>([\n    { ...drillByConfig, column },\n  ]);\n\n  useEffect(() => {\n    dispatch(\n      logEvent(LOG_ACTIONS_DRILL_BY_MODAL_OPENED, {\n        slice_id: formData.slice_id,\n      }),\n    );\n  }, [dispatch, formData.slice_id]);\n\n  const {\n    column: currentColumn,\n    groupbyFieldName = drillByConfig.groupbyFieldName,\n  } = drillByConfigs[drillByConfigs.length - 1] || {};\n\n  const initialGroupbyColumns = useMemo(\n    () =>\n      ensureIsArray(formData[groupbyFieldName])\n        .map(\n          colName => dataset.columns?.find(col => col.column_name === colName),\n        )\n        .filter(isDefined),\n    [dataset.columns, formData, groupbyFieldName],\n  );\n\n  const { displayModeToggle, drillByDisplayMode } = useDisplayModeToggle();\n  const [chartDataResult, setChartDataResult] = useState<QueryData[]>();\n\n  const resultsTable = useResultsTableView(\n    chartDataResult,\n    formData.datasource,\n    canDownload,\n  );\n\n  const [currentFormData, setCurrentFormData] = useState(formData);\n  const [usedGroupbyColumns, setUsedGroupbyColumns] = useState<Column[]>(\n    [...initialGroupbyColumns, column].filter(isDefined),\n  );\n  const [breadcrumbsData, setBreadcrumbsData] = useState<DrillByBreadcrumb[]>([\n    { groupby: initialGroupbyColumns, filters: drillByConfig.filters },\n    { groupby: column || [] },\n  ]);\n\n  const getNewGroupby = useCallback(\n    (groupbyCol: Column, fieldName = groupbyFieldName) =>\n      Array.isArray(formData[fieldName])\n        ? [groupbyCol.column_name]\n        : groupbyCol.column_name,\n    [formData, groupbyFieldName],\n  );\n\n  const getFormDataChangesFromConfigs = useCallback(\n    (configs: DrillByConfigs) =>\n      configs.reduce(\n        (acc, config) => {\n          if (config?.groupbyFieldName && config.column) {\n            acc.formData[config.groupbyFieldName] = getNewGroupby(\n              config.column,\n              config.groupbyFieldName,\n            );\n            acc.overridenGroupbyFields.add(config.groupbyFieldName);\n          }\n          const adhocFilterFieldName =\n            config?.adhocFilterFieldName || DEFAULT_ADHOC_FILTER_FIELD_NAME;\n          acc.formData[adhocFilterFieldName] = [\n            ...ensureIsArray(acc[adhocFilterFieldName]),\n            ...ensureIsArray(config.filters).map(filter =>\n              simpleFilterToAdhoc(filter),\n            ),\n          ];\n          acc.overridenAdhocFilterFields.add(adhocFilterFieldName);\n\n          return acc;\n        },\n        {\n          formData: {},\n          overridenGroupbyFields: new Set<string>(),\n          overridenAdhocFilterFields: new Set<string>(),\n        },\n      ),\n    [getNewGroupby],\n  );\n\n  const getFiltersFromConfigsByFieldName = useCallback(\n    () =>\n      drillByConfigs.reduce((acc, config) => {\n        const adhocFilterFieldName =\n          config.adhocFilterFieldName || DEFAULT_ADHOC_FILTER_FIELD_NAME;\n        acc[adhocFilterFieldName] = [\n          ...(acc[adhocFilterFieldName] || []),\n          ...config.filters.map(filter => simpleFilterToAdhoc(filter)),\n        ];\n        return acc;\n      }, {}),\n    [drillByConfigs],\n  );\n\n  const onBreadcrumbClick = useCallback(\n    (breadcrumb: DrillByBreadcrumb, index: number) => {\n      dispatch(\n        logEvent(LOG_ACTIONS_DRILL_BY_BREADCRUMB_CLICKED, {\n          slice_id: formData.slice_id,\n        }),\n      );\n      setDrillByConfigs(prevConfigs => prevConfigs.slice(0, index));\n      setBreadcrumbsData(prevBreadcrumbs => {\n        const newBreadcrumbs = prevBreadcrumbs.slice(0, index + 1);\n        delete newBreadcrumbs[newBreadcrumbs.length - 1].filters;\n        return newBreadcrumbs;\n      });\n      setUsedGroupbyColumns(prevUsedGroupbyColumns =>\n        prevUsedGroupbyColumns.slice(0, index),\n      );\n      setCurrentFormData(() => {\n        if (index === 0) {\n          return formData;\n        }\n        const { formData: overrideFormData, overridenAdhocFilterFields } =\n          getFormDataChangesFromConfigs(drillByConfigs.slice(0, index));\n\n        const newFormData = {\n          ...formData,\n          ...overrideFormData,\n        };\n        overridenAdhocFilterFields.forEach(adhocFilterField => ({\n          ...newFormData,\n          [adhocFilterField]: [\n            ...formData[adhocFilterField],\n            ...overrideFormData[adhocFilterField],\n          ],\n        }));\n        return newFormData;\n      });\n    },\n    [dispatch, drillByConfigs, formData, getFormDataChangesFromConfigs],\n  );\n\n  const breadcrumbs = useDrillByBreadcrumbs(breadcrumbsData, onBreadcrumbClick);\n\n  const drilledFormData = useMemo(() => {\n    let updatedFormData = { ...currentFormData };\n    if (currentColumn && groupbyFieldName) {\n      updatedFormData[groupbyFieldName] = getNewGroupby(currentColumn);\n    }\n\n    const adhocFilters = getFiltersFromConfigsByFieldName();\n    Object.keys(adhocFilters).forEach(adhocFilterFieldName => {\n      updatedFormData = {\n        ...updatedFormData,\n        [adhocFilterFieldName]: [\n          ...ensureIsArray(formData[adhocFilterFieldName]),\n          ...adhocFilters[adhocFilterFieldName],\n        ],\n      };\n    });\n\n    updatedFormData.slice_id = 0;\n    delete updatedFormData.slice_name;\n    delete updatedFormData.dashboards;\n    return updatedFormData;\n  }, [\n    currentFormData,\n    currentColumn,\n    groupbyFieldName,\n    getFiltersFromConfigsByFieldName,\n    getNewGroupby,\n    formData,\n  ]);\n\n  useEffect(() => {\n    setUsedGroupbyColumns(usedCols =>\n      !currentColumn ||\n      usedCols.some(\n        usedCol => usedCol.column_name === currentColumn.column_name,\n      )\n        ? usedCols\n        : [...usedCols, currentColumn],\n    );\n  }, [currentColumn]);\n\n  const onSelection = useCallback(\n    (\n      newColumn: Column,\n      drillByConfig: Required<ContextMenuFilters>['drillBy'],\n    ) => {\n      dispatch(\n        logEvent(LOG_ACTIONS_FURTHER_DRILL_BY, {\n          drill_depth: drillByConfigs.length + 1,\n          slice_id: formData.slice_id,\n        }),\n      );\n      setCurrentFormData(drilledFormData);\n      setDrillByConfigs(prevConfigs => [\n        ...prevConfigs,\n        { ...drillByConfig, column: newColumn },\n      ]);\n      setBreadcrumbsData(prevBreadcrumbs => {\n        const newBreadcrumbs = [...prevBreadcrumbs, { groupby: newColumn }];\n        newBreadcrumbs[newBreadcrumbs.length - 2].filters =\n          drillByConfig.filters;\n        return newBreadcrumbs;\n      });\n    },\n    [dispatch, drillByConfigs.length, drilledFormData, formData.slice_id],\n  );\n\n  const additionalConfig = useMemo(\n    () => ({\n      drillBy: { excludedColumns: usedGroupbyColumns, openNewModal: false },\n    }),\n    [usedGroupbyColumns],\n  );\n\n  const { contextMenu, inContextMenu, onContextMenu } = useContextMenu(\n    0,\n    currentFormData,\n    onSelection,\n    ContextMenuItem.DrillBy,\n    additionalConfig,\n  );\n\n  const chartName = useSelector<RootState, string | undefined>(state => {\n    const chartLayoutItem = Object.values(state.dashboardLayout.present).find(\n      layoutItem => layoutItem.meta?.chartId === formData.slice_id,\n    );\n    return (\n      chartLayoutItem?.meta.sliceNameOverride || chartLayoutItem?.meta.sliceName\n    );\n  });\n\n  useEffect(() => {\n    if (drilledFormData) {\n      const [useLegacyApi] = getQuerySettings(drilledFormData);\n      setIsChartDataLoading(true);\n      setChartDataResult(undefined);\n      getChartDataRequest({\n        formData: drilledFormData,\n      })\n        .then(({ response, json }) =>\n          handleChartDataResponse(response, json, useLegacyApi),\n        )\n        .then(queriesResponse => {\n          setChartDataResult(queriesResponse);\n        })\n        .catch(() => {\n          addDangerToast(t('Failed to load chart data.'));\n        })\n        .finally(() => {\n          setIsChartDataLoading(false);\n        });\n    }\n  }, [addDangerToast, drilledFormData]);\n  const { metadataBar } = useDatasetMetadataBar({ dataset });\n\n  return (\n    <Modal\n      css={css`\n        .ant-modal-footer {\n          border-top: none;\n        }\n      `}\n      show\n      onHide={onHideModal ?? (() => null)}\n      title={t('Drill by: %s', chartName)}\n      footer={<ModalFooter formData={drilledFormData} />}\n      responsive\n      resizable\n      resizableConfig={{\n        minHeight: theme.gridUnit * 128,\n        minWidth: theme.gridUnit * 128,\n        defaultSize: {\n          width: 'auto',\n          height: '80vh',\n        },\n      }}\n      draggable\n      destroyOnClose\n      maskClosable={false}\n    >\n      <div\n        css={css`\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n        `}\n      >\n        {metadataBar}\n        {breadcrumbs}\n        {displayModeToggle}\n        {isChartDataLoading && <Loading />}\n        {!isChartDataLoading && !chartDataResult && (\n          <Alert\n            type=\"error\"\n            message={t('There was an error loading the chart data')}\n          />\n        )}\n        {drillByDisplayMode === DrillByType.Chart && chartDataResult && (\n          <DrillByChart\n            dataset={dataset}\n            formData={drilledFormData}\n            result={chartDataResult}\n            onContextMenu={onContextMenu}\n            inContextMenu={inContextMenu}\n          />\n        )}\n        {drillByDisplayMode === DrillByType.Table &&\n          chartDataResult &&\n          resultsTable}\n        {contextMenu}\n      </div>\n    </Modal>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useMemo, useState } from 'react';\nimport { css, SupersetTheme, t } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport { DrillByType } from '../types';\n\nexport const useDisplayModeToggle = () => {\n  const [drillByDisplayMode, setDrillByDisplayMode] = useState<DrillByType>(\n    DrillByType.Chart,\n  );\n\n  const displayModeToggle = useMemo(\n    () => (\n      <div\n        css={(theme: SupersetTheme) => css`\n          margin-bottom: ${theme.gridUnit * 6}px;\n          .ant-radio-button-wrapper-checked:not(\n              .ant-radio-button-wrapper-disabled\n            ):focus-within {\n            box-shadow: none;\n          }\n        `}\n        data-test=\"drill-by-display-toggle\"\n      >\n        <Radio.Group\n          onChange={({ target: { value } }) => {\n            setDrillByDisplayMode(value);\n          }}\n          defaultValue={DrillByType.Chart}\n        >\n          <Radio.Button\n            value={DrillByType.Chart}\n            data-test=\"drill-by-chart-radio\"\n          >\n            {t('Chart')}\n          </Radio.Button>\n          <Radio.Button\n            value={DrillByType.Table}\n            data-test=\"drill-by-table-radio\"\n          >\n            {t('Table')}\n          </Radio.Button>\n        </Radio.Group>\n      </div>\n    ),\n    [],\n  );\n  return { displayModeToggle, drillByDisplayMode };\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport { BaseFormData, ContextMenuFilters } from '@superset-ui/core';\nimport ChartContextMenu, {\n  ChartContextMenuRef,\n  ContextMenuItem,\n} from './ChartContextMenu';\n\nexport const useContextMenu = (\n  chartId: number,\n  formData: BaseFormData & { [key: string]: any },\n  onSelection?: (...args: any) => void,\n  displayedItems?: ContextMenuItem[] | ContextMenuItem,\n  additionalConfig?: {\n    crossFilter?: Record<string, any>;\n    drillToDetail?: Record<string, any>;\n    drillBy?: Record<string, any>;\n  },\n) => {\n  const contextMenuRef = useRef<ChartContextMenuRef>(null);\n  const [inContextMenu, setInContextMenu] = useState(false);\n  const onContextMenu = (\n    offsetX: number,\n    offsetY: number,\n    filters: ContextMenuFilters,\n  ) => {\n    contextMenuRef.current?.open(offsetX, offsetY, filters);\n    setInContextMenu(true);\n  };\n\n  const handleContextMenuSelected = useCallback(\n    (...args: any) => {\n      setInContextMenu(false);\n      onSelection?.(...args);\n    },\n    [onSelection],\n  );\n\n  const handleContextMenuClosed = useCallback(() => {\n    setInContextMenu(false);\n  }, []);\n\n  const contextMenu = useMemo(\n    () => (\n      <ChartContextMenu\n        ref={contextMenuRef}\n        id={chartId}\n        formData={formData}\n        onSelection={handleContextMenuSelected}\n        onClose={handleContextMenuClosed}\n        displayedItems={displayedItems}\n        additionalConfig={additionalConfig}\n      />\n    ),\n    [\n      additionalConfig,\n      chartId,\n      displayedItems,\n      formData,\n      handleContextMenuClosed,\n      handleContextMenuSelected,\n    ],\n  );\n  return { contextMenu, inContextMenu, onContextMenu };\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  CSSProperties,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { Menu } from 'src/components/Menu';\nimport {\n  BaseFormData,\n  Behavior,\n  Column,\n  ContextMenuFilters,\n  FAST_DEBOUNCE,\n  JsonResponse,\n  css,\n  ensureIsArray,\n  getChartMetadataRegistry,\n  getExtensionsRegistry,\n  logging,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport rison from 'rison';\nimport { debounce } from 'lodash';\nimport { FixedSizeList as List } from 'react-window';\nimport { AntdInput } from 'src/components';\nimport Icons from 'src/components/Icons';\nimport { Input } from 'src/components/Input';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport Loading from 'src/components/Loading';\nimport {\n  cachedSupersetGet,\n  supersetGetCache,\n} from 'src/utils/cachedSupersetGet';\nimport { useVerboseMap } from 'src/hooks/apiResources/datasets';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport DrillByModal from './DrillByModal';\nimport { getSubmenuYOffset } from '../utils';\nimport { MenuItemWithTruncation } from '../MenuItemWithTruncation';\nimport { Dataset } from '../types';\n\nconst SUBMENU_HEIGHT = 200;\nconst SHOW_COLUMNS_SEARCH_THRESHOLD = 10;\nconst SEARCH_INPUT_HEIGHT = 48;\n\nexport interface DrillByMenuItemsProps {\n  drillByConfig?: ContextMenuFilters['drillBy'];\n  formData: BaseFormData & { [key: string]: any };\n  contextMenuY?: number;\n  submenuIndex?: number;\n  onSelection?: (...args: any) => void;\n  onClick?: (event: MouseEvent) => void;\n  openNewModal?: boolean;\n  excludedColumns?: Column[];\n  canDownload: boolean;\n  open: boolean;\n}\n\nconst loadDrillByOptions = getExtensionsRegistry().get('load.drillby.options');\n\nconst queryString = rison.encode({\n  columns: [\n    'table_name',\n    'owners.first_name',\n    'owners.last_name',\n    'created_by.first_name',\n    'created_by.last_name',\n    'created_on_humanized',\n    'changed_by.first_name',\n    'changed_by.last_name',\n    'changed_on_humanized',\n    'columns.column_name',\n    'columns.verbose_name',\n    'columns.groupby',\n  ],\n});\n\nexport const DrillByMenuItems = ({\n  drillByConfig,\n  formData,\n  contextMenuY = 0,\n  submenuIndex = 0,\n  onSelection = () => {},\n  onClick = () => {},\n  excludedColumns,\n  openNewModal = true,\n  canDownload,\n  open,\n  ...rest\n}: DrillByMenuItemsProps) => {\n  const theme = useTheme();\n  const { addDangerToast } = useToasts();\n  const [isLoadingColumns, setIsLoadingColumns] = useState(true);\n  const [searchInput, setSearchInput] = useState('');\n  const [dataset, setDataset] = useState<Dataset>();\n  const [columns, setColumns] = useState<Column[]>([]);\n  const [showModal, setShowModal] = useState(false);\n  const [currentColumn, setCurrentColumn] = useState();\n  const ref = useRef<AntdInput>(null);\n  const showSearch =\n    loadDrillByOptions || columns.length > SHOW_COLUMNS_SEARCH_THRESHOLD;\n  const handleSelection = useCallback(\n    (event, column) => {\n      onClick(event);\n      onSelection(column, drillByConfig);\n      setCurrentColumn(column);\n      if (openNewModal) {\n        setShowModal(true);\n      }\n    },\n    [drillByConfig, onClick, onSelection, openNewModal],\n  );\n  const closeModal = useCallback(() => {\n    setShowModal(false);\n  }, []);\n\n  useEffect(() => {\n    if (open) {\n      ref.current?.input.focus();\n    } else {\n      // Reset search input when menu is closed\n      ref.current?.setValue('');\n      setSearchInput('');\n    }\n  }, [open]);\n\n  const hasDrillBy = drillByConfig?.groupbyFieldName;\n\n  const handlesDimensionContextMenu = useMemo(\n    () =>\n      getChartMetadataRegistry()\n        .get(formData.viz_type)\n        ?.behaviors.find(behavior => behavior === Behavior.DrillBy),\n    [formData.viz_type],\n  );\n  const verboseMap = useVerboseMap(dataset);\n\n  useEffect(() => {\n    async function loadOptions() {\n      const datasetId = Number(formData.datasource.split('__')[0]);\n      try {\n        setIsLoadingColumns(true);\n        let response: JsonResponse;\n        if (loadDrillByOptions) {\n          response = await loadDrillByOptions(datasetId, formData);\n        } else {\n          response = await cachedSupersetGet({\n            endpoint: `/api/v1/dataset/${datasetId}?q=${queryString}`,\n          });\n        }\n        const { json } = response;\n        const { result } = json;\n        setDataset(result);\n        setColumns(\n          ensureIsArray(result.columns)\n            .filter(column => column.groupby)\n            .filter(\n              column =>\n                !ensureIsArray(\n                  formData[drillByConfig?.groupbyFieldName ?? ''],\n                ).includes(column.column_name) &&\n                column.column_name !== formData.x_axis &&\n                ensureIsArray(excludedColumns)?.every(\n                  excludedCol => excludedCol.column_name !== column.column_name,\n                ),\n            ),\n        );\n      } catch (error) {\n        logging.error(error);\n        supersetGetCache.delete(`/api/v1/dataset/${datasetId}`);\n        addDangerToast(t('Failed to load dimensions for drill by'));\n      } finally {\n        setIsLoadingColumns(false);\n      }\n    }\n    if (handlesDimensionContextMenu && hasDrillBy) {\n      loadOptions();\n    }\n  }, [\n    addDangerToast,\n    drillByConfig?.groupbyFieldName,\n    excludedColumns,\n    formData,\n    handlesDimensionContextMenu,\n    hasDrillBy,\n  ]);\n\n  const handleInput = debounce(\n    (value: string) => setSearchInput(value),\n    FAST_DEBOUNCE,\n  );\n\n  const filteredColumns = useMemo(\n    () =>\n      columns.filter(column =>\n        (column.verbose_name || column.column_name)\n          .toLowerCase()\n          .includes(searchInput.toLowerCase()),\n      ),\n    [columns, searchInput],\n  );\n\n  const submenuYOffset = useMemo(\n    () =>\n      getSubmenuYOffset(\n        contextMenuY,\n        filteredColumns.length || 1,\n        submenuIndex,\n        SUBMENU_HEIGHT,\n        showSearch ? SEARCH_INPUT_HEIGHT : 0,\n      ),\n    [contextMenuY, filteredColumns.length, submenuIndex, showSearch],\n  );\n\n  let tooltip: ReactNode;\n\n  if (!handlesDimensionContextMenu) {\n    tooltip = t('Drill by is not yet supported for this chart type');\n  } else if (!hasDrillBy) {\n    tooltip = t('Drill by is not available for this data point');\n  }\n\n  if (!handlesDimensionContextMenu || !hasDrillBy) {\n    return (\n      <Menu.Item key=\"drill-by-disabled\" disabled {...rest}>\n        <div>\n          {t('Drill by')}\n          <MenuItemTooltip title={tooltip} />\n        </div>\n      </Menu.Item>\n    );\n  }\n\n  const Row = ({\n    index,\n    data,\n    style,\n  }: {\n    index: number;\n    data: { columns: Column[] };\n    style: CSSProperties;\n  }) => {\n    const { columns, ...rest } = data;\n    const column = columns[index];\n    return (\n      <MenuItemWithTruncation\n        key={`drill-by-item-${column.column_name}`}\n        tooltipText={column.verbose_name || column.column_name}\n        {...rest}\n        onClick={e => handleSelection(e, column)}\n        style={style}\n      >\n        {column.verbose_name || column.column_name}\n      </MenuItemWithTruncation>\n    );\n  };\n\n  return (\n    <>\n      <Menu.SubMenu\n        title={t('Drill by')}\n        popupClassName=\"chart-context-submenu\"\n        popupOffset={[0, submenuYOffset]}\n        {...rest}\n      >\n        <div data-test=\"drill-by-submenu\">\n          {showSearch && (\n            <Input\n              ref={ref}\n              prefix={\n                <Icons.Search\n                  iconSize=\"l\"\n                  iconColor={theme.colors.grayscale.light1}\n                />\n              }\n              onChange={e => {\n                e.stopPropagation();\n                handleInput(e.target.value);\n              }}\n              placeholder={t('Search columns')}\n              onClick={e => {\n                // prevent closing menu when clicking on input\n                e.nativeEvent.stopImmediatePropagation();\n              }}\n              allowClear\n              css={css`\n                width: auto;\n                max-width: 100%;\n                margin: ${theme.gridUnit * 2}px ${theme.gridUnit * 3}px;\n                box-shadow: none;\n              `}\n            />\n          )}\n          {isLoadingColumns ? (\n            <div\n              css={css`\n                padding: ${theme.gridUnit * 3}px 0;\n              `}\n            >\n              <Loading position=\"inline-centered\" />\n            </div>\n          ) : filteredColumns.length ? (\n            <List\n              width=\"100%\"\n              height={SUBMENU_HEIGHT}\n              itemSize={35}\n              itemCount={filteredColumns.length}\n              itemData={{ columns: filteredColumns, ...rest }}\n              overscanCount={20}\n            >\n              {Row}\n            </List>\n          ) : (\n            <Menu.Item disabled key=\"no-drill-by-columns-found\" {...rest}>\n              {t('No columns found')}\n            </Menu.Item>\n          )}\n        </div>\n      </Menu.SubMenu>\n      {showModal && (\n        <DrillByModal\n          column={currentColumn}\n          drillByConfig={drillByConfig}\n          formData={formData}\n          onHideModal={closeModal}\n          dataset={{ ...dataset!, verbose_map: verboseMap }}\n          canDownload={canDownload}\n        />\n      )}\n    </>\n  );\n};\n","/* eslint-disable no-underscore-dangle */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Column, Metric, ensureIsArray } from '@superset-ui/core';\nimport { Dataset } from 'src/components/Chart/types';\n\nexport const useVerboseMap = (dataset?: Dataset) => {\n  const verbose_map = {};\n  ensureIsArray(dataset?.columns).forEach((column: Column) => {\n    verbose_map[column.column_name] = column.verbose_name || column.column_name;\n  });\n  ensureIsArray(dataset?.metrics).forEach((metric: Metric) => {\n    verbose_map[metric.metric_name] = metric.verbose_name || metric.metric_name;\n  });\n  return verbose_map;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  forwardRef,\n  Key,\n  ReactNode,\n  RefObject,\n  useCallback,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  Behavior,\n  ContextMenuFilters,\n  ensureIsArray,\n  FeatureFlag,\n  getChartMetadataRegistry,\n  isFeatureEnabled,\n  QueryFormData,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { RootState } from 'src/dashboard/types';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Menu } from 'src/components/Menu';\nimport { AntdDropdown as Dropdown } from 'src/components/index';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';\n\nexport enum ContextMenuItem {\n  CrossFilter,\n  DrillToDetail,\n  DrillBy,\n  All,\n}\nexport interface ChartContextMenuProps {\n  id: number;\n  formData: QueryFormData;\n  onSelection: () => void;\n  onClose: () => void;\n  additionalConfig?: {\n    crossFilter?: Record<string, any>;\n    drillToDetail?: Record<string, any>;\n    drillBy?: Record<string, any>;\n  };\n  displayedItems?: ContextMenuItem[] | ContextMenuItem;\n}\n\nexport interface ChartContextMenuRef {\n  open: (\n    clientX: number,\n    clientY: number,\n    filters?: ContextMenuFilters,\n  ) => void;\n}\n\nconst ChartContextMenu = (\n  {\n    id,\n    formData,\n    onSelection,\n    onClose,\n    displayedItems = ContextMenuItem.All,\n    additionalConfig,\n  }: ChartContextMenuProps,\n  ref: RefObject<ChartContextMenuRef>,\n) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const canExplore = useSelector((state: RootState) =>\n    findPermission('can_explore', 'Superset', state.user?.roles),\n  );\n  const canWriteExploreFormData = useSelector((state: RootState) =>\n    findPermission('can_write', 'ExploreFormDataRestApi', state.user?.roles),\n  );\n  const canDatasourceSamples = useSelector((state: RootState) =>\n    findPermission('can_samples', 'Datasource', state.user?.roles),\n  );\n  const canDownload = useSelector((state: RootState) =>\n    findPermission('can_csv', 'Superset', state.user?.roles),\n  );\n  const canDrill = useSelector((state: RootState) =>\n    findPermission('can_drill', 'Dashboard', state.user?.roles),\n  );\n  const canDrillBy = (canExplore || canDrill) && canWriteExploreFormData;\n  const canDrillToDetail = (canExplore || canDrill) && canDatasourceSamples;\n  const crossFiltersEnabled = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled,\n  );\n  const [openKeys, setOpenKeys] = useState<Key[]>([]);\n\n  const isDisplayed = (item: ContextMenuItem) =>\n    displayedItems === ContextMenuItem.All ||\n    ensureIsArray(displayedItems).includes(item);\n\n  const [{ filters, clientX, clientY }, setState] = useState<{\n    clientX: number;\n    clientY: number;\n    filters?: ContextMenuFilters;\n  }>({ clientX: 0, clientY: 0 });\n\n  const [drillModalIsOpen, setDrillModalIsOpen] = useState(false);\n\n  const menuItems = [];\n\n  const showDrillToDetail =\n    isFeatureEnabled(FeatureFlag.DrillToDetail) &&\n    canDrillToDetail &&\n    isDisplayed(ContextMenuItem.DrillToDetail);\n\n  const showDrillBy =\n    isFeatureEnabled(FeatureFlag.DrillBy) &&\n    canDrillBy &&\n    isDisplayed(ContextMenuItem.DrillBy);\n\n  const showCrossFilters =\n    isFeatureEnabled(FeatureFlag.DashboardCrossFilters) &&\n    isDisplayed(ContextMenuItem.CrossFilter);\n\n  const isCrossFilteringSupportedByChart = getChartMetadataRegistry()\n    .get(formData.viz_type)\n    ?.behaviors?.includes(Behavior.InteractiveChart);\n\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n\n  if (showCrossFilters) {\n    const isCrossFilterDisabled =\n      !isCrossFilteringSupportedByChart ||\n      !crossFiltersEnabled ||\n      !filters?.crossFilter;\n\n    let crossFilteringTooltipTitle: ReactNode = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t(\n              'Cross-filter will be applied to all of the charts that use this dataset.',\n            )}\n          </div>\n          <div>\n            {t('You can also just click on the chart to apply cross-filter.')}\n          </div>\n        </>\n      );\n    } else if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t('Cross-filtering is not enabled for this dashboard.')}</div>\n        </>\n      );\n    } else if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t('This visualization type does not support cross-filtering.')}\n          </div>\n        </>\n      );\n    } else if (!filters?.crossFilter) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t(`You can't apply cross-filter on this data point.`)}</div>\n        </>\n      );\n    }\n    menuItems.push(\n      <>\n        <Menu.Item\n          key=\"cross-filtering-menu-item\"\n          disabled={isCrossFilterDisabled}\n          onClick={() => {\n            if (filters?.crossFilter) {\n              dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n            }\n          }}\n        >\n          {filters?.crossFilter?.isCurrentValueSelected ? (\n            t('Remove cross-filter')\n          ) : (\n            <div>\n              {t('Add cross-filter')}\n              <MenuItemTooltip\n                title={crossFilteringTooltipTitle}\n                color={\n                  !isCrossFilterDisabled\n                    ? theme.colors.grayscale.base\n                    : undefined\n                }\n              />\n            </div>\n          )}\n        </Menu.Item>\n        {itemsCount > 1 && <Menu.Divider />}\n      </>,\n    );\n  }\n  if (showDrillToDetail) {\n    menuItems.push(\n      <DrillDetailMenuItems\n        chartId={id}\n        formData={formData}\n        filters={filters?.drillToDetail}\n        isContextMenu\n        contextMenuY={clientY}\n        onSelection={onSelection}\n        submenuIndex={showCrossFilters ? 2 : 1}\n        showModal={drillModalIsOpen}\n        setShowModal={setDrillModalIsOpen}\n        {...(additionalConfig?.drillToDetail || {})}\n      />,\n    );\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(\n      <DrillByMenuItems\n        drillByConfig={filters?.drillBy}\n        onSelection={onSelection}\n        formData={formData}\n        contextMenuY={clientY}\n        submenuIndex={submenuIndex}\n        canDownload={canDownload}\n        open={openKeys.includes('drill-by-submenu')}\n        key=\"drill-by-submenu\"\n        {...(additionalConfig?.drillBy || {})}\n      />,\n    );\n  }\n\n  const open = useCallback(\n    (clientX: number, clientY: number, filters?: ContextMenuFilters) => {\n      const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n      setState({\n        clientX,\n        clientY: adjustedY,\n        filters,\n      });\n\n      // Since Ant Design's Dropdown does not offer an imperative API\n      // and we can't attach event triggers to charts SVG elements, we\n      // use a hidden span that gets clicked on when receiving click events\n      // from the charts.\n      document.getElementById(`hidden-span-${id}`)?.click();\n    },\n    [id, itemsCount],\n  );\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      open,\n    }),\n    [open],\n  );\n\n  return ReactDOM.createPortal(\n    <Dropdown\n      overlay={\n        <Menu\n          className=\"chart-context-menu\"\n          data-test=\"chart-context-menu\"\n          onOpenChange={openKeys => {\n            setOpenKeys(openKeys);\n          }}\n        >\n          {menuItems.length ? (\n            menuItems\n          ) : (\n            <Menu.Item disabled>No actions</Menu.Item>\n          )}\n        </Menu>\n      }\n      trigger={['click']}\n      onVisibleChange={value => !value && onClose()}\n    >\n      <span\n        id={`hidden-span-${id}`}\n        css={{\n          visibility: 'hidden',\n          position: 'fixed',\n          top: clientY,\n          left: clientX,\n          width: 1,\n          height: 1,\n        }}\n      />\n    </Dropdown>,\n    document.body,\n  );\n};\n\nexport default forwardRef(ChartContextMenu);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { snakeCase, isEqual, cloneDeep } from 'lodash';\nimport PropTypes from 'prop-types';\nimport { createRef, Component } from 'react';\nimport {\n  SuperChart,\n  logging,\n  Behavior,\n  t,\n  isFeatureEnabled,\n  FeatureFlag,\n  getChartMetadataRegistry,\n} from '@superset-ui/core';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from 'src/logger/LogUtils';\nimport { EmptyStateBig, EmptyStateSmall } from 'src/components/EmptyState';\nimport { ChartSource } from 'src/types/ChartSource';\nimport ChartContextMenu from './ChartContextMenu/ChartContextMenu';\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  initialValues: PropTypes.object,\n  formData: PropTypes.object.isRequired,\n  latestQueryFormData: PropTypes.object,\n  labelsColor: PropTypes.object,\n  labelsColorMap: PropTypes.object,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  chartIsStale: PropTypes.bool,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  setDataMask: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object,\n  postTransformProps: PropTypes.func,\n  source: PropTypes.oneOf([ChartSource.Dashboard, ChartSource.Explore]),\n  emitCrossFilters: PropTypes.bool,\n};\n\nconst BLANK = {};\n\nconst BIG_NO_RESULT_MIN_WIDTH = 300;\nconst BIG_NO_RESULT_MIN_HEIGHT = 220;\n\nconst behaviors = [Behavior.InteractiveChart];\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n};\n\nclass ChartRenderer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showContextMenu:\n        props.source === ChartSource.Dashboard &&\n        (isFeatureEnabled(FeatureFlag.DrillToDetail) ||\n          isFeatureEnabled(FeatureFlag.DashboardCrossFilters)),\n      inContextMenu: false,\n      legendState: undefined,\n    };\n    this.hasQueryResponseChange = false;\n\n    this.contextMenuRef = createRef();\n\n    this.handleAddFilter = this.handleAddFilter.bind(this);\n    this.handleRenderSuccess = this.handleRenderSuccess.bind(this);\n    this.handleRenderFailure = this.handleRenderFailure.bind(this);\n    this.handleSetControlValue = this.handleSetControlValue.bind(this);\n    this.handleOnContextMenu = this.handleOnContextMenu.bind(this);\n    this.handleContextMenuSelected = this.handleContextMenuSelected.bind(this);\n    this.handleContextMenuClosed = this.handleContextMenuClosed.bind(this);\n    this.handleLegendStateChanged = this.handleLegendStateChanged.bind(this);\n    this.onContextMenuFallback = this.onContextMenuFallback.bind(this);\n\n    this.hooks = {\n      onAddFilter: this.handleAddFilter,\n      onContextMenu: this.state.showContextMenu\n        ? this.handleOnContextMenu\n        : undefined,\n      onError: this.handleRenderFailure,\n      setControlValue: this.handleSetControlValue,\n      onFilterMenuOpen: this.props.onFilterMenuOpen,\n      onFilterMenuClose: this.props.onFilterMenuClose,\n      onLegendStateChanged: this.handleLegendStateChanged,\n      setDataMask: dataMask => {\n        this.props.actions?.updateDataMask(this.props.chartId, dataMask);\n      },\n    };\n\n    // TODO: queriesResponse comes from Redux store but it's being edited by\n    // the plugins, hence we need to clone it to avoid state mutation\n    // until we change the reducers to use Redux Toolkit with Immer\n    this.mutableQueriesResponse = cloneDeep(this.props.queriesResponse);\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    const resultsReady =\n      nextProps.queriesResponse &&\n      ['success', 'rendered'].indexOf(nextProps.chartStatus) > -1 &&\n      !nextProps.queriesResponse?.[0]?.error;\n\n    if (resultsReady) {\n      if (!isEqual(this.state, nextState)) {\n        return true;\n      }\n      this.hasQueryResponseChange =\n        nextProps.queriesResponse !== this.props.queriesResponse;\n\n      if (this.hasQueryResponseChange) {\n        this.mutableQueriesResponse = cloneDeep(nextProps.queriesResponse);\n      }\n\n      return (\n        this.hasQueryResponseChange ||\n        !isEqual(nextProps.datasource, this.props.datasource) ||\n        nextProps.annotationData !== this.props.annotationData ||\n        nextProps.ownState !== this.props.ownState ||\n        nextProps.filterState !== this.props.filterState ||\n        nextProps.height !== this.props.height ||\n        nextProps.width !== this.props.width ||\n        nextProps.triggerRender ||\n        nextProps.labelsColor !== this.props.labelsColor ||\n        nextProps.labelsColorMap !== this.props.labelsColorMap ||\n        nextProps.formData.color_scheme !== this.props.formData.color_scheme ||\n        nextProps.formData.stack !== this.props.formData.stack ||\n        nextProps.cacheBusterProp !== this.props.cacheBusterProp ||\n        nextProps.emitCrossFilters !== this.props.emitCrossFilters\n      );\n    }\n    return false;\n  }\n\n  handleAddFilter(col, vals, merge = true, refresh = true) {\n    this.props.addFilter(col, vals, merge, refresh);\n  }\n\n  handleRenderSuccess() {\n    const { actions, chartStatus, chartId, vizType } = this.props;\n    if (['loading', 'rendered'].indexOf(chartStatus) < 0) {\n      actions.chartRenderingSucceeded(chartId);\n    }\n\n    // only log chart render time which is triggered by query results change\n    // currently we don't log chart re-render time, like window resize etc\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        viz_type: vizType,\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime,\n      });\n    }\n  }\n\n  handleRenderFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n      error.toString(),\n      chartId,\n      info ? info.componentStack : null,\n    );\n\n    // only trigger render log when query is changed\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        has_err: true,\n        error_details: error.toString(),\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime,\n      });\n    }\n  }\n\n  handleSetControlValue(...args) {\n    const { setControlValue } = this.props;\n    if (setControlValue) {\n      setControlValue(...args);\n    }\n  }\n\n  handleOnContextMenu(offsetX, offsetY, filters) {\n    this.contextMenuRef.current.open(offsetX, offsetY, filters);\n    this.setState({ inContextMenu: true });\n  }\n\n  handleContextMenuSelected() {\n    this.setState({ inContextMenu: false });\n  }\n\n  handleContextMenuClosed() {\n    this.setState({ inContextMenu: false });\n  }\n\n  handleLegendStateChanged(legendState) {\n    this.setState({ legendState });\n  }\n\n  // When viz plugins don't handle `contextmenu` event, fallback handler\n  // calls `handleOnContextMenu` with no `filters` param.\n  onContextMenuFallback(event) {\n    if (!this.state.inContextMenu) {\n      event.preventDefault();\n      this.handleOnContextMenu(event.clientX, event.clientY);\n    }\n  }\n\n  render() {\n    const { chartAlert, chartStatus, chartId, emitCrossFilters } = this.props;\n\n    // Skip chart rendering\n    if (chartStatus === 'loading' || !!chartAlert || chartStatus === null) {\n      return null;\n    }\n\n    this.renderStartTime = Logger.getTimestamp();\n\n    const {\n      width,\n      height,\n      datasource,\n      annotationData,\n      initialValues,\n      ownState,\n      filterState,\n      chartIsStale,\n      formData,\n      latestQueryFormData,\n      postTransformProps,\n    } = this.props;\n\n    const currentFormData =\n      chartIsStale && latestQueryFormData ? latestQueryFormData : formData;\n    const vizType = currentFormData.viz_type || this.props.vizType;\n\n    // It's bad practice to use unprefixed `vizType` as classnames for chart\n    // container. It may cause css conflicts as in the case of legacy table chart.\n    // When migrating charts, we should gradually add a `superset-chart-` prefix\n    // to each one of them.\n    const snakeCaseVizType = snakeCase(vizType);\n    const chartClassName =\n      vizType === 'table'\n        ? `superset-chart-${snakeCaseVizType}`\n        : snakeCaseVizType;\n\n    const webpackHash =\n      process.env.WEBPACK_MODE === 'development'\n        ? `-${\n            // eslint-disable-next-line camelcase\n            typeof __webpack_require__ !== 'undefined' &&\n            // eslint-disable-next-line camelcase, no-undef\n            typeof __webpack_require__.h === 'function' &&\n            // eslint-disable-next-line no-undef, camelcase\n            __webpack_require__.h()\n          }`\n        : '';\n\n    let noResultsComponent;\n    const noResultTitle = t('No results were returned for this query');\n    const noResultDescription =\n      this.props.source === ChartSource.Explore\n        ? t(\n            'Make sure that the controls are configured properly and the datasource contains data for the selected time range',\n          )\n        : undefined;\n    const noResultImage = 'chart.svg';\n    if (width > BIG_NO_RESULT_MIN_WIDTH && height > BIG_NO_RESULT_MIN_HEIGHT) {\n      noResultsComponent = (\n        <EmptyStateBig\n          title={noResultTitle}\n          description={noResultDescription}\n          image={noResultImage}\n        />\n      );\n    } else {\n      noResultsComponent = (\n        <EmptyStateSmall title={noResultTitle} image={noResultImage} />\n      );\n    }\n\n    // Check for Behavior.DRILL_TO_DETAIL to tell if chart can receive Drill to\n    // Detail props or if it'll cause side-effects (e.g. excessive re-renders).\n    const drillToDetailProps = getChartMetadataRegistry()\n      .get(formData.viz_type)\n      ?.behaviors.find(behavior => behavior === Behavior.DrillToDetail)\n      ? { inContextMenu: this.state.inContextMenu }\n      : {};\n    // By pass no result component when server pagination is enabled & the table has a backend search query\n    const bypassNoResult = !(\n      formData?.server_pagination && (ownState?.searchText?.length || 0) > 0\n    );\n\n    return (\n      <>\n        {this.state.showContextMenu && (\n          <ChartContextMenu\n            ref={this.contextMenuRef}\n            id={chartId}\n            formData={currentFormData}\n            onSelection={this.handleContextMenuSelected}\n            onClose={this.handleContextMenuClosed}\n          />\n        )}\n        <div\n          onContextMenu={\n            this.state.showContextMenu ? this.onContextMenuFallback : undefined\n          }\n        >\n          <SuperChart\n            disableErrorBoundary\n            key={`${chartId}${webpackHash}`}\n            id={`chart-id-${chartId}`}\n            className={chartClassName}\n            chartType={vizType}\n            width={width}\n            height={height}\n            annotationData={annotationData}\n            datasource={datasource}\n            initialValues={initialValues}\n            formData={currentFormData}\n            ownState={ownState}\n            filterState={filterState}\n            hooks={this.hooks}\n            behaviors={behaviors}\n            queriesData={this.mutableQueriesResponse}\n            onRenderSuccess={this.handleRenderSuccess}\n            onRenderFailure={this.handleRenderFailure}\n            noResults={noResultsComponent}\n            postTransformProps={postTransformProps}\n            emitCrossFilters={emitCrossFilters}\n            legendState={this.state.legendState}\n            enableNoResults={bypassNoResult}\n            {...drillToDetailProps}\n          />\n        </div>\n      </>\n    );\n  }\n}\n\nChartRenderer.propTypes = propTypes;\nChartRenderer.defaultProps = defaultProps;\n\nexport default ChartRenderer;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { FC } from 'react';\nimport { SupersetError } from '@superset-ui/core';\nimport { useChartOwnerNames } from 'src/hooks/apiResources';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\n\ninterface Props {\n  chartId: string;\n  error?: SupersetError;\n}\n\n/**\n * fetches the chart owners and adds them to the extra data of the error message\n */\nexport const ChartErrorMessage: FC<Props> = ({ chartId, error, ...props }) => {\n  const { result: owners } = useChartOwnerNames(chartId);\n\n  // don't mutate props\n  const ownedError = error && {\n    ...error,\n    extra: { ...error.extra, owners },\n  };\n\n  return <ErrorMessageWithStackTrace {...props} error={ownedError} />;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { PureComponent } from 'react';\nimport {\n  ensureIsArray,\n  FeatureFlag,\n  isFeatureEnabled,\n  logging,\n  styled,\n  t,\n} from '@superset-ui/core';\nimport { PLACEHOLDER_DATASOURCE } from 'src/dashboard/constants';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateBig } from 'src/components/EmptyState';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from 'src/logger/LogUtils';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { isCurrentUserBot } from 'src/utils/isBot';\nimport { ChartSource } from 'src/types/ChartSource';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport ChartRenderer from './ChartRenderer';\nimport { ChartErrorMessage } from './ChartErrorMessage';\nimport { getChartRequiredFieldsMissingMessage } from '../../utils/getChartRequiredFieldsMissingMessage';\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  // current chart is included by dashboard\n  dashboardId: PropTypes.number,\n  // original selected values for FilterBox viz\n  // so that FilterBox can pre-populate selected values\n  // only affect UI control\n  initialValues: PropTypes.object,\n  // formData contains chart's own filter parameter\n  // and merged with extra filter that current dashboard applying\n  formData: PropTypes.object.isRequired,\n  labelsColor: PropTypes.object,\n  labelsColorMap: PropTypes.object,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  setControlValue: PropTypes.func,\n  timeout: PropTypes.number,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  force: PropTypes.bool,\n  isFiltersInitialized: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartStackTrace: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  chartIsStale: PropTypes.bool,\n  errorMessage: PropTypes.node,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onQuery: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object,\n  postTransformProps: PropTypes.func,\n  datasetsStatus: PropTypes.oneOf(['loading', 'error', 'complete']),\n  isInView: PropTypes.bool,\n  emitCrossFilters: PropTypes.bool,\n};\n\nconst BLANK = {};\nconst NONEXISTENT_DATASET = t(\n  'The dataset associated with this chart no longer exists',\n);\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n  dashboardId: null,\n  chartStackTrace: null,\n  force: false,\n  isInView: true,\n};\n\nconst Styles = styled.div`\n  min-height: ${p => p.height}px;\n  position: relative;\n  text-align: center;\n\n  .chart-tooltip {\n    opacity: 0.75;\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  }\n\n  .slice_container {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n\n    height: ${p => p.height}px;\n\n    .pivot_table tbody tr {\n      font-feature-settings: 'tnum' 1;\n    }\n\n    .alert {\n      margin: ${({ theme }) => theme.gridUnit * 2}px;\n    }\n  }\n`;\n\nconst LoadingDiv = styled.div`\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  width: 80%;\n  transform: translate(-50%, -50%);\n`;\n\nconst MessageSpan = styled.span`\n  display: block;\n  margin: ${({ theme }) => theme.gridUnit * 4}px auto;\n  width: fit-content;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n`;\n\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\n\nclass Chart extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleRenderContainerFailure =\n      this.handleRenderContainerFailure.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  runQuery() {\n    // Create chart with POST request\n    this.props.actions.postChartFormData(\n      this.props.formData,\n      Boolean(this.props.force || getUrlParam(URL_PARAMS.force)), // allow override via url params force=true\n      this.props.timeout,\n      this.props.chartId,\n      this.props.dashboardId,\n      this.props.ownState,\n    );\n  }\n\n  handleRenderContainerFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n      error.toString(),\n      chartId,\n      info ? info.componentStack : null,\n    );\n\n    actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n      slice_id: chartId,\n      has_err: true,\n      error_details: error.toString(),\n      start_offset: this.renderStartTime,\n      ts: new Date().getTime(),\n      duration: Logger.getTimestamp() - this.renderStartTime,\n    });\n  }\n\n  renderErrorMessage(queryResponse) {\n    const {\n      chartId,\n      chartAlert,\n      chartStackTrace,\n      datasource,\n      dashboardId,\n      height,\n      datasetsStatus,\n    } = this.props;\n    const error = queryResponse?.errors?.[0];\n    const message = chartAlert || queryResponse?.message;\n\n    // if datasource is still loading, don't render JS errors\n    if (\n      chartAlert !== undefined &&\n      chartAlert !== NONEXISTENT_DATASET &&\n      datasource === PLACEHOLDER_DATASOURCE &&\n      datasetsStatus !== ResourceStatus.Error\n    ) {\n      return (\n        <Styles\n          key={chartId}\n          data-ui-anchor=\"chart\"\n          className=\"chart-container\"\n          data-test=\"chart-container\"\n          height={height}\n        >\n          <Loading />\n        </Styles>\n      );\n    }\n\n    return (\n      <ChartErrorMessage\n        key={chartId}\n        chartId={chartId}\n        error={error}\n        subtitle={<MonospaceDiv>{message}</MonospaceDiv>}\n        copyText={message}\n        link={queryResponse ? queryResponse.link : null}\n        source={dashboardId ? ChartSource.Dashboard : ChartSource.Explore}\n        stackTrace={chartStackTrace}\n      />\n    );\n  }\n\n  renderSpinner(databaseName) {\n    const message = databaseName\n      ? t('Waiting on %s', databaseName)\n      : t('Waiting on database...');\n\n    return (\n      <LoadingDiv>\n        <Loading position=\"inline-centered\" />\n        <MessageSpan>{message}</MessageSpan>\n      </LoadingDiv>\n    );\n  }\n\n  renderChartContainer() {\n    return (\n      <div className=\"slice_container\" data-test=\"slice-container\">\n        {this.props.isInView ||\n        !isFeatureEnabled(FeatureFlag.DashboardVirtualization) ||\n        isCurrentUserBot() ? (\n          <ChartRenderer\n            {...this.props}\n            source={this.props.dashboardId ? 'dashboard' : 'explore'}\n            data-test={this.props.vizType}\n          />\n        ) : (\n          <Loading />\n        )}\n      </div>\n    );\n  }\n\n  render() {\n    const {\n      height,\n      chartAlert,\n      chartStatus,\n      datasource,\n      errorMessage,\n      chartIsStale,\n      queriesResponse = [],\n      width,\n    } = this.props;\n    const databaseName = datasource?.database?.name;\n\n    const isLoading = chartStatus === 'loading';\n    this.renderContainerStartTime = Logger.getTimestamp();\n    if (chartStatus === 'failed') {\n      return queriesResponse.map(item => this.renderErrorMessage(item));\n    }\n\n    if (errorMessage && ensureIsArray(queriesResponse).length === 0) {\n      return (\n        <EmptyStateBig\n          title={t('Add required control values to preview chart')}\n          description={getChartRequiredFieldsMissingMessage(true)}\n          image=\"chart.svg\"\n        />\n      );\n    }\n\n    if (\n      !isLoading &&\n      !chartAlert &&\n      !errorMessage &&\n      chartIsStale &&\n      ensureIsArray(queriesResponse).length === 0\n    ) {\n      return (\n        <EmptyStateBig\n          title={t('Your chart is ready to go!')}\n          description={\n            <span>\n              {t(\n                'Click on \"Create chart\" button in the control panel on the left to preview a visualization or',\n              )}{' '}\n              <span role=\"button\" tabIndex={0} onClick={this.props.onQuery}>\n                {t('click here')}\n              </span>\n              .\n            </span>\n          }\n          image=\"chart.svg\"\n        />\n      );\n    }\n\n    return (\n      <ErrorBoundary\n        onError={this.handleRenderContainerFailure}\n        showMessage={false}\n      >\n        <Styles\n          data-ui-anchor=\"chart\"\n          className=\"chart-container\"\n          data-test=\"chart-container\"\n          height={height}\n          width={width}\n        >\n          {isLoading\n            ? this.renderSpinner(databaseName)\n            : this.renderChartContainer()}\n        </Styles>\n      </ErrorBoundary>\n    );\n  }\n}\n\nChart.propTypes = propTypes;\nChart.defaultProps = defaultProps;\n\nexport default Chart;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\n\nimport * as actions from './chartAction';\nimport { logEvent } from '../../logger/actions';\nimport Chart from './Chart';\nimport { updateDataMask } from '../../dataMask/actions';\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        ...actions,\n        updateDataMask,\n        logEvent,\n      },\n      dispatch,\n    ),\n  };\n}\n\nexport default connect(null, mapDispatchToProps)(Chart);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  CUSTOM_OPERATORS,\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport { translateToSql } from '../utils/translateToSQL';\nimport { Clauses, ExpressionTypes } from '../types';\n\nconst CUSTOM_OPERATIONS = [...CUSTOM_OPERATORS].map(\n  op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n);\n\nexport default class AdhocFilter {\n  constructor(adhocFilter) {\n    this.expressionType = adhocFilter.expressionType || ExpressionTypes.Simple;\n    if (this.expressionType === ExpressionTypes.Simple) {\n      this.subject = adhocFilter.subject;\n      this.operator = adhocFilter.operator?.toUpperCase();\n      this.operatorId = adhocFilter.operatorId;\n      this.comparator = adhocFilter.comparator;\n      if (\n        [Operators.IsTrue, Operators.IsFalse].indexOf(adhocFilter.operatorId) >=\n        0\n      ) {\n        this.comparator = adhocFilter.operatorId === Operators.IsTrue;\n      }\n      if (\n        [Operators.IsNull, Operators.IsNotNull].indexOf(\n          adhocFilter.operatorId,\n        ) >= 0\n      ) {\n        this.comparator = null;\n      }\n      this.clause = adhocFilter.clause || Clauses.Where;\n      this.sqlExpression = null;\n    } else if (this.expressionType === ExpressionTypes.Sql) {\n      this.sqlExpression =\n        typeof adhocFilter.sqlExpression === 'string'\n          ? adhocFilter.sqlExpression\n          : translateToSql(adhocFilter, { useSimple: true });\n      this.clause = adhocFilter.clause;\n      if (\n        adhocFilter.operator &&\n        CUSTOM_OPERATIONS.indexOf(adhocFilter.operator) >= 0\n      ) {\n        this.subject = adhocFilter.subject;\n        this.operator = adhocFilter.operator;\n        this.operatorId = adhocFilter.operatorId;\n      } else {\n        this.subject = null;\n        this.operator = null;\n      }\n      this.comparator = null;\n    }\n    this.isExtra = !!adhocFilter.isExtra;\n    this.isNew = !!adhocFilter.isNew;\n    this.datasourceWarning = !!adhocFilter.datasourceWarning;\n\n    this.filterOptionName =\n      adhocFilter.filterOptionName ||\n      `filter_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocFilter({\n      ...this,\n      // all duplicated fields are not new (i.e. will not open popup automatically)\n      isNew: false,\n      ...nextFields,\n    });\n  }\n\n  equals(adhocFilter) {\n    return (\n      adhocFilter.clause === this.clause &&\n      adhocFilter.expressionType === this.expressionType &&\n      adhocFilter.sqlExpression === this.sqlExpression &&\n      adhocFilter.operator === this.operator &&\n      adhocFilter.operatorId === this.operatorId &&\n      adhocFilter.comparator === this.comparator &&\n      adhocFilter.subject === this.subject\n    );\n  }\n\n  isValid() {\n    const nullCheckOperators = [Operators.IsNotNull, Operators.IsNull].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    const truthCheckOperators = [Operators.IsTrue, Operators.IsFalse].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    if (this.expressionType === ExpressionTypes.Simple) {\n      if (nullCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.operator && this.subject);\n      }\n      if (truthCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.subject && this.comparator !== null);\n      }\n      if (this.operator && this.subject && this.clause) {\n        if (Array.isArray(this.comparator)) {\n          if (this.comparator.length > 0) {\n            // A non-empty array of values ('IN' or 'NOT IN' clauses)\n            return true;\n          }\n        } else if (this.comparator !== null) {\n          // A value has been selected or typed\n          return true;\n        }\n      }\n    } else if (this.expressionType === ExpressionTypes.Sql) {\n      return !!(this.sqlExpression && this.clause);\n    }\n    return false;\n  }\n\n  getDefaultLabel() {\n    const label = this.translateToSql();\n    return label.length < 43 ? label : `${label.substring(0, 40)}...`;\n  }\n\n  getTooltipTitle() {\n    return this.translateToSql();\n  }\n\n  translateToSql() {\n    return translateToSql(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { OptionControlLabel } from 'src/explore/components/controls/OptionControls';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { OptionSortType } from 'src/explore/types';\nimport { Operators } from 'src/explore/constants';\nimport { useGetTimeRangeLabel } from '../utils';\n\nexport interface AdhocFilterOptionProps {\n  adhocFilter: AdhocFilter;\n  onFilterEdit: () => void;\n  onRemoveFilter: () => void;\n  options: OptionSortType[];\n  sections: string[];\n  operators: Operators[];\n  datasource: Record<string, any>;\n  partitionColumn: string;\n  onMoveLabel: () => void;\n  onDropLabel: () => void;\n  index: number;\n}\n\nexport default function AdhocFilterOption({\n  adhocFilter,\n  options,\n  datasource,\n  onFilterEdit,\n  onRemoveFilter,\n  partitionColumn,\n  onMoveLabel,\n  onDropLabel,\n  index,\n  sections,\n  operators,\n}: AdhocFilterOptionProps) {\n  const { actualTimeRange, title } = useGetTimeRangeLabel(adhocFilter);\n\n  return (\n    <AdhocFilterPopoverTrigger\n      sections={sections}\n      operators={operators}\n      adhocFilter={adhocFilter}\n      options={options}\n      datasource={datasource}\n      onFilterEdit={onFilterEdit}\n      partitionColumn={partitionColumn}\n    >\n      <OptionControlLabel\n        label={actualTimeRange ?? adhocFilter.getDefaultLabel()}\n        tooltipTitle={title ?? adhocFilter.getTooltipTitle()}\n        onRemove={onRemoveFilter}\n        onMoveLabel={onMoveLabel}\n        onDropLabel={onDropLabel}\n        index={index}\n        type={DndItemType.FilterOption}\n        withCaret\n        isExtra={adhocFilter.isExtra}\n      />\n    </AdhocFilterPopoverTrigger>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { Clauses, ExpressionTypes } from './types';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([ExpressionTypes.Simple]).isRequired,\n    clause: PropTypes.oneOf([Clauses.Having, Clauses.Where]).isRequired,\n    subject: PropTypes.string.isRequired,\n    comparator: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.arrayOf(PropTypes.string),\n    ]).isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([ExpressionTypes.Sql]).isRequired,\n    clause: PropTypes.oneOf([Clauses.Where, Clauses.Having]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  t,\n  logging,\n  SupersetClient,\n  withTheme,\n  ensureIsArray,\n} from '@superset-ui/core';\n\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport {\n  AddControlLabel,\n  AddIconButton,\n  HeaderContainer,\n  LabelsContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport Icons from 'src/components/Icons';\nimport Modal from 'src/components/Modal';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilterOption from 'src/explore/components/controls/FilterControl/AdhocFilterOption';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport adhocFilterType from 'src/explore/components/controls/FilterControl/adhocFilterType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport { toQueryString } from 'src/utils/urlUtils';\nimport { Clauses, ExpressionTypes } from '../types';\n\nconst { warning } = Modal;\n\nconst selectedMetricType = PropTypes.oneOfType([\n  PropTypes.string,\n  adhocMetricType,\n]);\n\nconst propTypes = {\n  label: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  name: PropTypes.string,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  onChange: PropTypes.func,\n  value: PropTypes.arrayOf(adhocFilterType),\n  datasource: PropTypes.object,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  selectedMetrics: PropTypes.oneOfType([\n    selectedMetricType,\n    PropTypes.arrayOf(selectedMetricType),\n  ]),\n  isLoading: PropTypes.bool,\n  canDelete: PropTypes.func,\n};\n\nconst defaultProps = {\n  name: '',\n  onChange: () => {},\n  columns: [],\n  savedMetrics: [],\n  selectedMetrics: [],\n};\n\nfunction isDictionaryForAdhocFilter(value) {\n  return value && !(value instanceof AdhocFilter) && value.expressionType;\n}\n\nclass AdhocFilterControl extends Component {\n  constructor(props) {\n    super(props);\n    this.optionsForSelect = this.optionsForSelect.bind(this);\n    this.onRemoveFilter = this.onRemoveFilter.bind(this);\n    this.onNewFilter = this.onNewFilter.bind(this);\n    this.onFilterEdit = this.onFilterEdit.bind(this);\n    this.moveLabel = this.moveLabel.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.mapOption = this.mapOption.bind(this);\n    this.getMetricExpression = this.getMetricExpression.bind(this);\n    this.removeFilter = this.removeFilter.bind(this);\n\n    const filters = (this.props.value || []).map(filter =>\n      isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n    );\n\n    this.optionRenderer = option => <FilterDefinitionOption option={option} />;\n    this.valueRenderer = (adhocFilter, index) => (\n      <AdhocFilterOption\n        key={index}\n        index={index}\n        adhocFilter={adhocFilter}\n        onFilterEdit={this.onFilterEdit}\n        options={this.state.options}\n        sections={this.props.sections}\n        operators={this.props.operators}\n        datasource={this.props.datasource}\n        onRemoveFilter={e => {\n          e.stopPropagation();\n          this.onRemoveFilter(index);\n        }}\n        onMoveLabel={this.moveLabel}\n        onDropLabel={() => this.props.onChange(this.state.values)}\n        partitionColumn={this.state.partitionColumn}\n      />\n    );\n    this.state = {\n      values: filters,\n      options: this.optionsForSelect(this.props),\n      partitionColumn: null,\n    };\n  }\n\n  componentDidMount() {\n    const { datasource } = this.props;\n    if (datasource && datasource.type === 'table') {\n      const dbId = datasource.database?.id;\n      const {\n        datasource_name: name,\n        catalog,\n        schema,\n        is_sqllab_view: isSqllabView,\n      } = datasource;\n\n      if (!isSqllabView && dbId && name && schema) {\n        SupersetClient.get({\n          endpoint: `/api/v1/database/${dbId}/table_metadata/extra/${toQueryString(\n            {\n              name,\n              catalog,\n              schema,\n            },\n          )}`,\n        })\n          .then(({ json }) => {\n            if (json && json.partitions) {\n              const { partitions } = json;\n              // for now only show latest_partition option\n              // when table datasource has only 1 partition key.\n              if (\n                partitions &&\n                partitions.cols &&\n                Object.keys(partitions.cols).length === 1\n              ) {\n                this.setState({ partitionColumn: partitions.cols[0] });\n              }\n            }\n          })\n          .catch(error => {\n            logging.error('fetch extra_table_metadata:', error.statusText);\n          });\n      }\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (this.props.columns !== nextProps.columns) {\n      this.setState({ options: this.optionsForSelect(nextProps) });\n    }\n    if (this.props.value !== nextProps.value) {\n      this.setState({\n        values: (nextProps.value || []).map(filter =>\n          isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n        ),\n      });\n    }\n  }\n\n  removeFilter(index) {\n    const valuesCopy = [...this.state.values];\n    valuesCopy.splice(index, 1);\n    this.setState(prevState => ({\n      ...prevState,\n      values: valuesCopy,\n    }));\n    this.props.onChange(valuesCopy);\n  }\n\n  onRemoveFilter(index) {\n    const { canDelete } = this.props;\n    const { values } = this.state;\n    const result = canDelete?.(values[index], values);\n    if (typeof result === 'string') {\n      warning({ title: t('Warning'), content: result });\n      return;\n    }\n    this.removeFilter(index);\n  }\n\n  onNewFilter(newFilter) {\n    const mappedOption = this.mapOption(newFilter);\n    if (mappedOption) {\n      this.setState(\n        prevState => ({\n          ...prevState,\n          values: [...prevState.values, mappedOption],\n        }),\n        () => {\n          this.props.onChange(this.state.values);\n        },\n      );\n    }\n  }\n\n  onFilterEdit(changedFilter) {\n    this.props.onChange(\n      this.state.values.map(value => {\n        if (value.filterOptionName === changedFilter.filterOptionName) {\n          return changedFilter;\n        }\n        return value;\n      }),\n    );\n  }\n\n  onChange(opts) {\n    const options = (opts || [])\n      .map(option => this.mapOption(option))\n      .filter(option => option);\n    this.props.onChange(options);\n  }\n\n  getMetricExpression(savedMetricName) {\n    return this.props.savedMetrics.find(\n      savedMetric => savedMetric.metric_name === savedMetricName,\n    ).expression;\n  }\n\n  moveLabel(dragIndex, hoverIndex) {\n    const { values } = this.state;\n\n    const newValues = [...values];\n    [newValues[hoverIndex], newValues[dragIndex]] = [\n      newValues[dragIndex],\n      newValues[hoverIndex],\n    ];\n    this.setState({ values: newValues });\n  }\n\n  mapOption(option) {\n    // already a AdhocFilter, skip\n    if (option instanceof AdhocFilter) {\n      return option;\n    }\n    // via datasource saved metric\n    if (option.saved_metric_name) {\n      return new AdhocFilter({\n        expressionType: ExpressionTypes.Sql,\n        subject: this.getMetricExpression(option.saved_metric_name),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GreaterThan].operation,\n        comparator: 0,\n        clause: Clauses.Having,\n      });\n    }\n    // has a custom label, meaning it's custom column\n    if (option.label) {\n      return new AdhocFilter({\n        expressionType: ExpressionTypes.Sql,\n        subject: new AdhocMetric(option).translateToSql(),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GreaterThan].operation,\n        comparator: 0,\n        clause: Clauses.Having,\n      });\n    }\n    // add a new filter item\n    if (option.column_name) {\n      return new AdhocFilter({\n        expressionType: ExpressionTypes.Simple,\n        subject: option.column_name,\n        operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.Equals].operation,\n        comparator: '',\n        clause: Clauses.Where,\n        isNew: true,\n      });\n    }\n    return null;\n  }\n\n  optionsForSelect(props) {\n    const options = [\n      ...props.columns,\n      ...ensureIsArray(props.selectedMetrics).map(\n        metric =>\n          metric &&\n          (typeof metric === 'string'\n            ? { saved_metric_name: metric }\n            : new AdhocMetric(metric)),\n      ),\n    ].filter(option => option);\n\n    return options\n      .reduce((results, option) => {\n        if (option.saved_metric_name) {\n          results.push({\n            ...option,\n            filterOptionName: option.saved_metric_name,\n          });\n        } else if (option.column_name) {\n          results.push({\n            ...option,\n            filterOptionName: `_col_${option.column_name}`,\n          });\n        } else if (option instanceof AdhocMetric) {\n          results.push({\n            ...option,\n            filterOptionName: `_adhocmetric_${option.label}`,\n          });\n        }\n        return results;\n      }, [])\n      .sort((a, b) =>\n        (a.saved_metric_name || a.column_name || a.label).localeCompare(\n          b.saved_metric_name || b.column_name || b.label,\n        ),\n      );\n  }\n\n  addNewFilterPopoverTrigger(trigger) {\n    return (\n      <AdhocFilterPopoverTrigger\n        operators={this.props.operators}\n        sections={this.props.sections}\n        adhocFilter={new AdhocFilter({})}\n        datasource={this.props.datasource}\n        options={this.state.options}\n        onFilterEdit={this.onNewFilter}\n        partitionColumn={this.state.partitionColumn}\n      >\n        {trigger}\n      </AdhocFilterPopoverTrigger>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div className=\"metrics-select\" data-test=\"adhoc-filter-control\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          {this.addNewFilterPopoverTrigger(\n            <AddIconButton data-test=\"add-filter-button\">\n              <Icons.PlusLarge\n                iconSize=\"s\"\n                iconColor={theme.colors.grayscale.light5}\n              />\n            </AddIconButton>,\n          )}\n        </HeaderContainer>\n        <LabelsContainer>\n          {this.state.values.length > 0\n            ? this.state.values.map((value, index) =>\n                this.valueRenderer(value, index),\n              )\n            : this.addNewFilterPopoverTrigger(\n                <AddControlLabel>\n                  <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n                  {t('Add filter')}\n                </AddControlLabel>,\n              )}\n        </LabelsContainer>\n      </div>\n    );\n  }\n}\n\nAdhocFilterControl.propTypes = propTypes;\nAdhocFilterControl.defaultProps = defaultProps;\n\nexport default withTheme(AdhocFilterControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  sqlaAutoGeneratedMetricRegex,\n  AGGREGATES,\n} from 'src/explore/constants';\n\nexport const EXPRESSION_TYPES = {\n  SIMPLE: 'SIMPLE',\n  SQL: 'SQL',\n};\n\nfunction inferSqlExpressionColumn(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstCloseParen = adhocMetric.sqlExpression.indexOf(')');\n    const indexPairedOpenParen = adhocMetric.sqlExpression\n      .substring(0, indexFirstCloseParen)\n      .lastIndexOf('(');\n    if (indexFirstCloseParen > 0 && indexPairedOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(\n        indexPairedOpenParen + 1,\n        indexFirstCloseParen,\n      );\n    }\n  }\n  return null;\n}\n\nfunction inferSqlExpressionAggregate(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstOpenParen = adhocMetric.sqlExpression.indexOf('(');\n    if (indexFirstOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(0, indexFirstOpenParen);\n    }\n  }\n  return null;\n}\n\nexport default class AdhocMetric {\n  constructor(adhocMetric) {\n    this.expressionType = adhocMetric.expressionType || EXPRESSION_TYPES.SIMPLE;\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      // try to be clever in the case of transitioning from Sql expression back to simple expression\n      const inferredColumn = inferSqlExpressionColumn(adhocMetric);\n      this.column =\n        adhocMetric.column ||\n        (inferredColumn && { column_name: inferredColumn });\n      this.aggregate =\n        adhocMetric.aggregate || inferSqlExpressionAggregate(adhocMetric);\n      this.sqlExpression = null;\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      this.sqlExpression = adhocMetric.sqlExpression;\n      this.column = null;\n      this.aggregate = null;\n    }\n    this.datasourceWarning = !!adhocMetric.datasourceWarning;\n    this.hasCustomLabel = !!(adhocMetric.hasCustomLabel && adhocMetric.label);\n    this.label = this.hasCustomLabel\n      ? adhocMetric.label\n      : this.getDefaultLabel();\n\n    this.optionName =\n      adhocMetric.optionName ||\n      `metric_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  getDefaultLabel() {\n    return this.translateToSql({ useVerboseName: true });\n  }\n\n  translateToSql(\n    params = { useVerboseName: false, transformCountDistinct: false },\n  ) {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      const aggregate = this.aggregate || '';\n      // eslint-disable-next-line camelcase\n      const column =\n        params.useVerboseName && this.column?.verbose_name\n          ? `(${this.column.verbose_name})`\n          : this.column?.column_name\n            ? `(${this.column.column_name})`\n            : '';\n      // transform from `count_distinct(column)` to `count(distinct column)`\n      if (\n        params.transformCountDistinct &&\n        aggregate === AGGREGATES.COUNT_DISTINCT &&\n        /^\\(.*\\)$/.test(column)\n      ) {\n        return `COUNT(DISTINCT ${column.slice(1, -1)})`;\n      }\n      return aggregate + column;\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return this.sqlExpression;\n    }\n    return '';\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocMetric({\n      ...this,\n      ...nextFields,\n    });\n  }\n\n  equals(adhocMetric) {\n    return (\n      adhocMetric.label === this.label &&\n      adhocMetric.expressionType === this.expressionType &&\n      adhocMetric.sqlExpression === this.sqlExpression &&\n      adhocMetric.aggregate === this.aggregate &&\n      (adhocMetric.column && adhocMetric.column.column_name) ===\n        (this.column && this.column.column_name)\n    );\n  }\n\n  isValid() {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      return !!(this.column && this.aggregate);\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return !!this.sqlExpression;\n    }\n    return false;\n  }\n\n  inferSqlExpressionAggregate() {\n    return inferSqlExpressionAggregate(this);\n  }\n\n  inferSqlExpressionColumn() {\n    return inferSqlExpressionColumn(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nimport columnType from './columnType';\nimport adhocMetricType from './adhocMetricType';\nimport { StyledColumnOption } from '../../optionRenderers';\n\nconst propTypes = {\n  option: PropTypes.oneOfType([\n    columnType,\n    PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n    adhocMetricType,\n  ]).isRequired,\n};\n\nexport default function FilterDefinitionOption({ option }) {\n  if (option.saved_metric_name) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.saved_metric_name, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  if (option.column_name) {\n    return <StyledColumnOption column={option} showType />;\n  }\n  if (option.label) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.label, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  return null;\n}\nFilterDefinitionOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nimport { AGGREGATES } from 'src/explore/constants';\nimport columnType from './columnType';\nimport { EXPRESSION_TYPES } from './AdhocMetric';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SIMPLE]).isRequired,\n    column: columnType.isRequired,\n    aggregate: PropTypes.oneOf(Object.keys(AGGREGATES)).isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SQL]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  metric_name: PropTypes.string,\n  verbose_name: PropTypes.string,\n  expression: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { css, styled, t } from '@superset-ui/core';\nimport { Input, TextArea } from 'src/components/Input';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { URL_PARAMS } from 'src/constants';\nimport { getChartPermalink } from 'src/utils/urlUtils';\nimport { CopyButton } from './DataTableControl';\n\nconst CopyButtonEmbedCode = styled(CopyButton)`\n  && {\n    margin: 0 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nconst EmbedCodeContent = ({ formData, addDangerToast }) => {\n  const [height, setHeight] = useState('400');\n  const [width, setWidth] = useState('600');\n  const [url, setUrl] = useState('');\n  const [errorMessage, setErrorMessage] = useState('');\n\n  const handleInputChange = useCallback(e => {\n    const { value, name } = e.currentTarget;\n    if (name === 'width') {\n      setWidth(value);\n    }\n    if (name === 'height') {\n      setHeight(value);\n    }\n  }, []);\n\n  const updateUrl = useCallback(() => {\n    setUrl('');\n    getChartPermalink(formData)\n      .then(url => {\n        setUrl(url);\n        setErrorMessage('');\n      })\n      .catch(() => {\n        setErrorMessage(t('Error'));\n        addDangerToast(t('Sorry, something went wrong. Try again later.'));\n      });\n  }, [addDangerToast, formData]);\n\n  useEffect(() => {\n    updateUrl();\n  }, []);\n\n  const html = useMemo(() => {\n    if (!url) return '';\n    const srcLink = `${url}?${URL_PARAMS.standalone.name}=1&height=${height}`;\n    return (\n      '<iframe\\n' +\n      `  width=\"${width}\"\\n` +\n      `  height=\"${height}\"\\n` +\n      '  seamless\\n' +\n      '  frameBorder=\"0\"\\n' +\n      '  scrolling=\"no\"\\n' +\n      `  src=\"${srcLink}\"\\n` +\n      '>\\n' +\n      '</iframe>'\n    );\n  }, [height, url, width]);\n\n  const text = errorMessage || html || t('Generating link, please wait..');\n  return (\n    <div id=\"embed-code-popover\" data-test=\"embed-code-popover\">\n      <div\n        css={css`\n          display: flex;\n          flex-direction: column;\n        `}\n      >\n        <CopyToClipboard\n          shouldShowText={false}\n          text={html}\n          copyNode={\n            <CopyButtonEmbedCode buttonSize=\"xsmall\">\n              <i className=\"fa fa-clipboard\" />\n            </CopyButtonEmbedCode>\n          }\n        />\n        <TextArea\n          data-test=\"embed-code-textarea\"\n          name=\"embedCode\"\n          disabled={!html}\n          value={text}\n          rows=\"4\"\n          readOnly\n          css={theme => css`\n            resize: vertical;\n            padding: ${theme.gridUnit * 2}px;\n            font-size: ${theme.typography.sizes.s}px;\n            border-radius: 4px;\n            background-color: ${theme.colors.secondary.light5};\n          `}\n        />\n      </div>\n      <div\n        css={theme => css`\n          display: flex;\n          margin-top: ${theme.gridUnit * 4}px;\n          & > div {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          & > div:last-of-type {\n            margin-right: 0;\n            margin-left: ${theme.gridUnit * 2}px;\n          }\n        `}\n      >\n        <div>\n          <label htmlFor=\"embed-height\">{t('Chart height')}</label>\n          <Input\n            type=\"text\"\n            defaultValue={height}\n            name=\"height\"\n            onChange={handleInputChange}\n          />\n        </div>\n        <div>\n          <label htmlFor=\"embed-width\">{t('Chart width')}</label>\n          <Input\n            type=\"text\"\n            defaultValue={width}\n            name=\"width\"\n            onChange={handleInputChange}\n            id=\"embed-width\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EmbedCodeContent;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useState } from 'react';\nimport { css, t, useTheme } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport Icons from 'src/components/Icons';\nimport { Menu } from 'src/components/Menu';\nimport { Link } from 'react-router-dom';\n\nexport interface DashboardsSubMenuProps {\n  chartId?: number;\n  dashboards?: { id: number; dashboard_title: string }[];\n}\n\nconst WIDTH = 220;\nconst HEIGHT = 300;\nconst SEARCH_THRESHOLD = 10;\n\nconst DashboardsSubMenu = ({\n  chartId,\n  dashboards = [],\n  ...menuProps\n}: DashboardsSubMenuProps) => {\n  const theme = useTheme();\n  const [dashboardSearch, setDashboardSearch] = useState<string>();\n  const [hoveredItem, setHoveredItem] = useState<number | null>();\n  const showSearch = dashboards.length > SEARCH_THRESHOLD;\n  const filteredDashboards = dashboards.filter(\n    dashboard =>\n      !dashboardSearch ||\n      dashboard.dashboard_title\n        .toLowerCase()\n        .includes(dashboardSearch.toLowerCase()),\n  );\n  const noResults = dashboards.length === 0;\n  const noResultsFound = dashboardSearch && filteredDashboards.length === 0;\n  const urlQueryString = chartId ? `?focused_chart=${chartId}` : '';\n  return (\n    <>\n      {showSearch && (\n        <Input\n          allowClear\n          placeholder={t('Search')}\n          prefix={<Icons.Search iconSize=\"l\" />}\n          css={css`\n            width: ${WIDTH}px;\n            margin: ${theme.gridUnit * 2}px ${theme.gridUnit * 3}px;\n          `}\n          value={dashboardSearch}\n          onChange={e => setDashboardSearch(e.currentTarget.value)}\n        />\n      )}\n      <div\n        css={css`\n          max-height: ${HEIGHT}px;\n          overflow: auto;\n        `}\n      >\n        {filteredDashboards.map(dashboard => (\n          <Menu.Item\n            key={String(dashboard.id)}\n            onMouseEnter={() => setHoveredItem(dashboard.id)}\n            onMouseLeave={() => {\n              if (hoveredItem === dashboard.id) {\n                setHoveredItem(null);\n              }\n            }}\n            {...menuProps}\n          >\n            <Link\n              target=\"_blank\"\n              rel=\"noreferer noopener\"\n              to={`/superset/dashboard/${dashboard.id}${urlQueryString}`}\n            >\n              <div\n                css={css`\n                  display: flex;\n                  flex-direction: row;\n                  align-items: center;\n                  max-width: ${WIDTH}px;\n                `}\n              >\n                <div\n                  css={css`\n                    white-space: normal;\n                  `}\n                >\n                  {dashboard.dashboard_title}\n                </div>\n                <Icons.Full\n                  iconSize=\"l\"\n                  iconColor={theme.colors.grayscale.base}\n                  css={css`\n                    margin-left: ${theme.gridUnit * 2}px;\n                    visibility: ${hoveredItem === dashboard.id\n                      ? 'visible'\n                      : 'hidden'};\n                  `}\n                />\n              </div>\n            </Link>\n          </Menu.Item>\n        ))}\n        {noResultsFound && (\n          <div\n            css={css`\n              margin-left: ${theme.gridUnit * 3}px;\n              margin-bottom: ${theme.gridUnit}px;\n            `}\n          >\n            {t('No results found')}\n          </div>\n        )}\n        {noResults && (\n          <Menu.Item\n            disabled\n            css={css`\n              min-width: ${WIDTH}px;\n            `}\n            {...menuProps}\n          >\n            {t('None')}\n          </Menu.Item>\n        )}\n      </div>\n    </>\n  );\n};\n\nexport default DashboardsSubMenu;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useMemo, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  css,\n  isFeatureEnabled,\n  FeatureFlag,\n  styled,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport { Menu } from 'src/components/Menu';\nimport ModalTrigger from 'src/components/ModalTrigger';\nimport Button from 'src/components/Button';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport { exportChart, getChartKey } from 'src/explore/exploreUtils';\nimport downloadAsImage from 'src/utils/downloadAsImage';\nimport { getChartPermalink } from 'src/utils/urlUtils';\nimport copyTextToClipboard from 'src/utils/copy';\nimport HeaderReportDropDown from 'src/features/reports/ReportModal/HeaderReportDropdown';\nimport { logEvent } from 'src/logger/actions';\nimport {\n  LOG_ACTIONS_CHART_DOWNLOAD_AS_IMAGE,\n  LOG_ACTIONS_CHART_DOWNLOAD_AS_JSON,\n  LOG_ACTIONS_CHART_DOWNLOAD_AS_CSV,\n  LOG_ACTIONS_CHART_DOWNLOAD_AS_CSV_PIVOTED,\n  LOG_ACTIONS_CHART_DOWNLOAD_AS_XLS,\n} from 'src/logger/LogUtils';\nimport ViewQueryModal from '../controls/ViewQueryModal';\nimport EmbedCodeContent from '../EmbedCodeContent';\nimport DashboardsSubMenu from './DashboardsSubMenu';\n\nconst MENU_KEYS = {\n  EDIT_PROPERTIES: 'edit_properties',\n  DASHBOARDS_ADDED_TO: 'dashboards_added_to',\n  DOWNLOAD_SUBMENU: 'download_submenu',\n  EXPORT_TO_CSV: 'export_to_csv',\n  EXPORT_TO_CSV_PIVOTED: 'export_to_csv_pivoted',\n  EXPORT_TO_JSON: 'export_to_json',\n  EXPORT_TO_XLSX: 'export_to_xlsx',\n  DOWNLOAD_AS_IMAGE: 'download_as_image',\n  SHARE_SUBMENU: 'share_submenu',\n  COPY_PERMALINK: 'copy_permalink',\n  EMBED_CODE: 'embed_code',\n  SHARE_BY_EMAIL: 'share_by_email',\n  REPORT_SUBMENU: 'report_submenu',\n  SET_UP_REPORT: 'set_up_report',\n  SET_REPORT_ACTIVE: 'set_report_active',\n  EDIT_REPORT: 'edit_report',\n  DELETE_REPORT: 'delete_report',\n  VIEW_QUERY: 'view_query',\n  RUN_IN_SQL_LAB: 'run_in_sql_lab',\n};\n\nconst VIZ_TYPES_PIVOTABLE = ['pivot_table_v2'];\n\nexport const MenuItemWithCheckboxContainer = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    align-items: center;\n\n    & svg {\n      width: ${theme.gridUnit * 3}px;\n      height: ${theme.gridUnit * 3}px;\n    }\n\n    & span[role='checkbox'] {\n      display: inline-flex;\n      margin-right: ${theme.gridUnit}px;\n    }\n  `}\n`;\n\nexport const MenuTrigger = styled(Button)`\n  ${({ theme }) => css`\n    width: ${theme.gridUnit * 8}px;\n    height: ${theme.gridUnit * 8}px;\n    padding: 0;\n    border: 1px solid ${theme.colors.primary.dark2};\n\n    &.ant-btn > span.anticon {\n      line-height: 0;\n      transition: inherit;\n    }\n\n    &:hover:not(:focus) > span.anticon {\n      color: ${theme.colors.primary.light1};\n    }\n  `}\n`;\n\nconst iconReset = css`\n  .ant-dropdown-menu-item > & > .anticon:first-child {\n    margin-right: 0;\n    vertical-align: 0;\n  }\n`;\n\nexport const useExploreAdditionalActionsMenu = (\n  latestQueryFormData,\n  canDownloadCSV,\n  slice,\n  onOpenInEditor,\n  onOpenPropertiesModal,\n  ownState,\n  dashboards,\n  ...rest\n) => {\n  const theme = useTheme();\n  const { addDangerToast, addSuccessToast } = useToasts();\n  const dispatch = useDispatch();\n  const [showReportSubMenu, setShowReportSubMenu] = useState(null);\n  const [isDropdownVisible, setIsDropdownVisible] = useState(false);\n  const chart = useSelector(\n    state => state.charts?.[getChartKey(state.explore)],\n  );\n\n  const { datasource } = latestQueryFormData;\n\n  const shareByEmail = useCallback(async () => {\n    try {\n      const subject = t('Superset Chart');\n      const url = await getChartPermalink(latestQueryFormData);\n      const body = encodeURIComponent(t('%s%s', 'Check out this chart: ', url));\n      window.location.href = `mailto:?Subject=${subject}%20&Body=${body}`;\n    } catch (error) {\n      addDangerToast(t('Sorry, something went wrong. Try again later.'));\n    }\n  }, [addDangerToast, latestQueryFormData]);\n\n  const exportCSV = useCallback(\n    () =>\n      canDownloadCSV\n        ? exportChart({\n            formData: latestQueryFormData,\n            ownState,\n            resultType: 'full',\n            resultFormat: 'csv',\n          })\n        : null,\n    [canDownloadCSV, latestQueryFormData],\n  );\n\n  const exportCSVPivoted = useCallback(\n    () =>\n      canDownloadCSV\n        ? exportChart({\n            formData: latestQueryFormData,\n            resultType: 'post_processed',\n            resultFormat: 'csv',\n          })\n        : null,\n    [canDownloadCSV, latestQueryFormData],\n  );\n\n  const exportJson = useCallback(\n    () =>\n      canDownloadCSV\n        ? exportChart({\n            formData: latestQueryFormData,\n            resultType: 'results',\n            resultFormat: 'json',\n          })\n        : null,\n    [canDownloadCSV, latestQueryFormData],\n  );\n\n  const exportExcel = useCallback(\n    () =>\n      canDownloadCSV\n        ? exportChart({\n            formData: latestQueryFormData,\n            resultType: 'results',\n            resultFormat: 'xlsx',\n          })\n        : null,\n    [canDownloadCSV, latestQueryFormData],\n  );\n\n  const copyLink = useCallback(async () => {\n    try {\n      if (!latestQueryFormData) {\n        throw new Error();\n      }\n      await copyTextToClipboard(() => getChartPermalink(latestQueryFormData));\n      addSuccessToast(t('Copied to clipboard!'));\n    } catch (error) {\n      addDangerToast(t('Sorry, something went wrong. Try again later.'));\n    }\n  }, [addDangerToast, addSuccessToast, latestQueryFormData]);\n\n  const handleMenuClick = useCallback(\n    ({ key, domEvent }) => {\n      switch (key) {\n        case MENU_KEYS.EDIT_PROPERTIES:\n          onOpenPropertiesModal();\n          setIsDropdownVisible(false);\n          break;\n        case MENU_KEYS.EXPORT_TO_CSV:\n          exportCSV();\n          setIsDropdownVisible(false);\n          dispatch(\n            logEvent(LOG_ACTIONS_CHART_DOWNLOAD_AS_CSV, {\n              chartId: slice?.slice_id,\n              chartName: slice?.slice_name,\n            }),\n          );\n          break;\n        case MENU_KEYS.EXPORT_TO_CSV_PIVOTED:\n          exportCSVPivoted();\n          setIsDropdownVisible(false);\n          dispatch(\n            logEvent(LOG_ACTIONS_CHART_DOWNLOAD_AS_CSV_PIVOTED, {\n              chartId: slice?.slice_id,\n              chartName: slice?.slice_name,\n            }),\n          );\n          break;\n        case MENU_KEYS.EXPORT_TO_JSON:\n          exportJson();\n          setIsDropdownVisible(false);\n          dispatch(\n            logEvent(LOG_ACTIONS_CHART_DOWNLOAD_AS_JSON, {\n              chartId: slice?.slice_id,\n              chartName: slice?.slice_name,\n            }),\n          );\n          break;\n        case MENU_KEYS.EXPORT_TO_XLSX:\n          exportExcel();\n          setIsDropdownVisible(false);\n          dispatch(\n            logEvent(LOG_ACTIONS_CHART_DOWNLOAD_AS_XLS, {\n              chartId: slice?.slice_id,\n              chartName: slice?.slice_name,\n            }),\n          );\n          break;\n        case MENU_KEYS.DOWNLOAD_AS_IMAGE:\n          downloadAsImage(\n            '.panel-body .chart-container',\n            // eslint-disable-next-line camelcase\n            slice?.slice_name ?? t('New chart'),\n            true,\n          )(domEvent);\n          setIsDropdownVisible(false);\n          dispatch(\n            logEvent(LOG_ACTIONS_CHART_DOWNLOAD_AS_IMAGE, {\n              chartId: slice?.slice_id,\n              chartName: slice?.slice_name,\n            }),\n          );\n          break;\n        case MENU_KEYS.COPY_PERMALINK:\n          copyLink();\n          setIsDropdownVisible(false);\n          break;\n        case MENU_KEYS.EMBED_CODE:\n          setIsDropdownVisible(false);\n          break;\n        case MENU_KEYS.SHARE_BY_EMAIL:\n          shareByEmail();\n          setIsDropdownVisible(false);\n          break;\n        case MENU_KEYS.VIEW_QUERY:\n          setIsDropdownVisible(false);\n          break;\n        case MENU_KEYS.RUN_IN_SQL_LAB:\n          onOpenInEditor(latestQueryFormData, domEvent.metaKey);\n          setIsDropdownVisible(false);\n          break;\n        default:\n          break;\n      }\n    },\n    [\n      copyLink,\n      exportCSV,\n      exportCSVPivoted,\n      exportJson,\n      latestQueryFormData,\n      onOpenInEditor,\n      onOpenPropertiesModal,\n      shareByEmail,\n      slice?.slice_name,\n    ],\n  );\n\n  const menu = useMemo(\n    () => (\n      <Menu onClick={handleMenuClick} selectable={false} {...rest}>\n        <>\n          {slice && (\n            <Menu.Item key={MENU_KEYS.EDIT_PROPERTIES}>\n              {t('Edit chart properties')}\n            </Menu.Item>\n          )}\n          <Menu.SubMenu\n            title={t('On dashboards')}\n            key={MENU_KEYS.DASHBOARDS_ADDED_TO}\n          >\n            <DashboardsSubMenu\n              chartId={slice?.slice_id}\n              dashboards={dashboards}\n            />\n          </Menu.SubMenu>\n          <Menu.Divider />\n        </>\n        <Menu.SubMenu title={t('Download')} key={MENU_KEYS.DOWNLOAD_SUBMENU}>\n          {VIZ_TYPES_PIVOTABLE.includes(latestQueryFormData.viz_type) ? (\n            <>\n              <Menu.Item\n                key={MENU_KEYS.EXPORT_TO_CSV}\n                icon={<Icons.FileOutlined css={iconReset} />}\n                disabled={!canDownloadCSV}\n              >\n                {t('Export to original .CSV')}\n              </Menu.Item>\n              <Menu.Item\n                key={MENU_KEYS.EXPORT_TO_CSV_PIVOTED}\n                icon={<Icons.FileOutlined css={iconReset} />}\n                disabled={!canDownloadCSV}\n              >\n                {t('Export to pivoted .CSV')}\n              </Menu.Item>\n            </>\n          ) : (\n            <Menu.Item\n              key={MENU_KEYS.EXPORT_TO_CSV}\n              icon={<Icons.FileOutlined css={iconReset} />}\n              disabled={!canDownloadCSV}\n            >\n              {t('Export to .CSV')}\n            </Menu.Item>\n          )}\n          <Menu.Item\n            key={MENU_KEYS.EXPORT_TO_JSON}\n            icon={<Icons.FileOutlined css={iconReset} />}\n            disabled={!canDownloadCSV}\n          >\n            {t('Export to .JSON')}\n          </Menu.Item>\n          <Menu.Item\n            key={MENU_KEYS.DOWNLOAD_AS_IMAGE}\n            icon={<Icons.FileImageOutlined css={iconReset} />}\n          >\n            {t('Download as image')}\n          </Menu.Item>\n          <Menu.Item\n            key={MENU_KEYS.EXPORT_TO_XLSX}\n            icon={<Icons.FileOutlined css={iconReset} />}\n            disabled={!canDownloadCSV}\n          >\n            {t('Export to Excel')}\n          </Menu.Item>\n        </Menu.SubMenu>\n        <Menu.SubMenu title={t('Share')} key={MENU_KEYS.SHARE_SUBMENU}>\n          <Menu.Item key={MENU_KEYS.COPY_PERMALINK}>\n            {t('Copy permalink to clipboard')}\n          </Menu.Item>\n          <Menu.Item key={MENU_KEYS.SHARE_BY_EMAIL}>\n            {t('Share chart by email')}\n          </Menu.Item>\n          {isFeatureEnabled(FeatureFlag.EmbeddableCharts) ? (\n            <Menu.Item key={MENU_KEYS.EMBED_CODE}>\n              <ModalTrigger\n                triggerNode={\n                  <span data-test=\"embed-code-button\">{t('Embed code')}</span>\n                }\n                modalTitle={t('Embed code')}\n                modalBody={\n                  <EmbedCodeContent\n                    formData={latestQueryFormData}\n                    addDangerToast={addDangerToast}\n                  />\n                }\n                maxWidth={`${theme.gridUnit * 100}px`}\n                destroyOnClose\n                responsive\n              />\n            </Menu.Item>\n          ) : null}\n        </Menu.SubMenu>\n        <Menu.Divider />\n        {showReportSubMenu ? (\n          <>\n            <Menu.SubMenu title={t('Manage email report')}>\n              <HeaderReportDropDown\n                chart={chart}\n                setShowReportSubMenu={setShowReportSubMenu}\n                showReportSubMenu={showReportSubMenu}\n                setIsDropdownVisible={setIsDropdownVisible}\n                isDropdownVisible={isDropdownVisible}\n                useTextMenu\n              />\n            </Menu.SubMenu>\n            <Menu.Divider />\n          </>\n        ) : (\n          <Menu>\n            <HeaderReportDropDown\n              chart={chart}\n              setShowReportSubMenu={setShowReportSubMenu}\n              setIsDropdownVisible={setIsDropdownVisible}\n              isDropdownVisible={isDropdownVisible}\n              useTextMenu\n            />\n          </Menu>\n        )}\n        <Menu.Item key={MENU_KEYS.VIEW_QUERY}>\n          <ModalTrigger\n            triggerNode={\n              <span data-test=\"view-query-menu-item\">{t('View query')}</span>\n            }\n            modalTitle={t('View query')}\n            modalBody={\n              <ViewQueryModal latestQueryFormData={latestQueryFormData} />\n            }\n            draggable\n            resizable\n            responsive\n          />\n        </Menu.Item>\n        {datasource && (\n          <Menu.Item key={MENU_KEYS.RUN_IN_SQL_LAB}>\n            {t('Run in SQL Lab')}\n          </Menu.Item>\n        )}\n      </Menu>\n    ),\n    [\n      addDangerToast,\n      canDownloadCSV,\n      chart,\n      dashboards,\n      handleMenuClick,\n      isDropdownVisible,\n      latestQueryFormData,\n      showReportSubMenu,\n      slice,\n      theme.gridUnit,\n    ],\n  );\n  return [menu, isDropdownVisible, setIsDropdownVisible];\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SQL_KEYWORD_AUTOCOMPLETE_SCORE } from '../constants';\n\nconst SQL_KEYWORDS = [\n  'AND',\n  'AS',\n  'ASC',\n  'AVG',\n  'BY',\n  'CASE',\n  'COUNT',\n  'CREATE',\n  'CROSS',\n  'DATABASE',\n  'DEFAULT',\n  'DELETE',\n  'DESC',\n  'DISTINCT',\n  'DROP',\n  'ELSE',\n  'END',\n  'FOREIGN',\n  'FROM',\n  'GRANT',\n  'GROUP',\n  'HAVING',\n  'IF',\n  'INNER',\n  'INSERT',\n  'JOIN',\n  'KEY',\n  'LEFT',\n  'LIMIT',\n  'MAX',\n  'MIN',\n  'NATURAL',\n  'NOT',\n  'NULL',\n  'OFFSET',\n  'ON',\n  'OR',\n  'ORDER',\n  'OUTER',\n  'PRIMARY',\n  'REFERENCES',\n  'RIGHT',\n  'SELECT',\n  'SUM',\n  'TABLE',\n  'THEN',\n  'TYPE',\n  'UNION',\n  'UPDATE',\n  'WHEN',\n  'WHERE',\n];\n\nconst SQL_DATA_TYPES = [\n  'BIGINT',\n  'BINARY',\n  'BIT',\n  'CHAR',\n  'DATE',\n  'DECIMAL',\n  'DOUBLE',\n  'FLOAT',\n  'INT',\n  'INTEGER',\n  'MONEY',\n  'NUMBER',\n  'NUMERIC',\n  'REAL',\n  'SET',\n  'TEXT',\n  'TIMESTAMP',\n  'VARCHAR',\n];\n\nconst allKeywords = SQL_KEYWORDS.concat(SQL_DATA_TYPES);\n\nconst sqlKeywords = allKeywords.map(keyword => ({\n  meta: 'sql',\n  name: keyword,\n  score: SQL_KEYWORD_AUTOCOMPLETE_SCORE,\n  value: keyword,\n}));\n\nexport default sqlKeywords;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ReactNode } from 'react';\nimport { css, SupersetTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport { Tooltip } from 'src/components/Tooltip';\n\nexport const MenuItemTooltip = ({\n  title,\n  color,\n}: {\n  title: ReactNode;\n  color?: string;\n}) => (\n  <Tooltip title={title} placement=\"top\">\n    <Icons.InfoCircleOutlined\n      data-test=\"tooltip-trigger\"\n      css={(theme: SupersetTheme) => css`\n        color: ${color || theme.colors.text.label};\n        margin-left: ${theme.gridUnit * 2}px;\n        &.anticon {\n          font-size: unset;\n          .anticon {\n            line-height: unset;\n            vertical-align: unset;\n          }\n        }\n      `}\n    />\n  </Tooltip>\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { BOOL_FALSE_DISPLAY, BOOL_TRUE_DISPLAY } from 'src/constants';\n\nexport interface BooleanCellProps {\n  value?: boolean;\n}\n\nfunction BooleanCell({ value }: BooleanCellProps) {\n  return <span>{value ? BOOL_TRUE_DISPLAY : BOOL_FALSE_DISPLAY}</span>;\n}\n\nexport default BooleanCell;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { css, SupersetTheme } from '@superset-ui/core';\nimport { NULL_DISPLAY } from 'src/constants';\n\nfunction NullCell() {\n  return (\n    <span\n      css={(theme: SupersetTheme) => css`\n        color: ${theme.colors.grayscale.light1};\n      `}\n    >\n      {NULL_DISPLAY}\n    </span>\n  );\n}\n\nexport default NullCell;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getTimeFormatter, TimeFormats } from '@superset-ui/core';\nimport NullCell from '../NullCell';\n\nexport interface TimeCellProps {\n  format?: string;\n  value?: number | Date;\n}\n\nfunction TimeCell({\n  format = TimeFormats.DATABASE_DATETIME,\n  value,\n}: TimeCellProps) {\n  if (value) {\n    return <span>{getTimeFormatter(format).format(value)}</span>;\n  }\n  return <NullCell />;\n}\n\nexport default TimeCell;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useState } from 'react';\nimport { css, useTheme } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport { Space } from 'src/components';\nimport Icons from 'src/components/Icons';\nimport Popover from 'src/components/Popover';\n\nexport interface HeaderWithRadioGroupProps {\n  headerTitle: string;\n  groupTitle: string;\n  groupOptions: { label: string; value: string | number }[];\n  value?: string | number;\n  onChange: (value: string) => void;\n}\n\nfunction HeaderWithRadioGroup(props: HeaderWithRadioGroupProps) {\n  const { headerTitle, groupTitle, groupOptions, value, onChange } = props;\n  const theme = useTheme();\n  const [popoverVisible, setPopoverVisible] = useState(false);\n\n  return (\n    <div\n      css={css`\n        display: flex;\n        align-items: center;\n      `}\n    >\n      <Popover\n        trigger=\"click\"\n        visible={popoverVisible}\n        content={\n          <div>\n            <div\n              css={css`\n                font-weight: ${theme.typography.weights.bold};\n                margin-bottom: ${theme.gridUnit}px;\n              `}\n            >\n              {groupTitle}\n            </div>\n            <Radio.Group\n              value={value}\n              onChange={e => {\n                onChange(e.target.value);\n                setPopoverVisible(false);\n              }}\n            >\n              <Space direction=\"vertical\">\n                {groupOptions.map(option => (\n                  <Radio key={option.value} value={option.value}>\n                    {option.label}\n                  </Radio>\n                ))}\n              </Space>\n            </Radio.Group>\n          </div>\n        }\n        placement=\"bottomLeft\"\n        arrowPointAtCenter\n      >\n        <Icons.SettingOutlined\n          iconSize=\"m\"\n          iconColor={theme.colors.grayscale.light1}\n          css={css`\n            margin-top: 3px; // we need exactly 3px to align the icon\n            margin-right: ${theme.gridUnit}px;\n          `}\n          onClick={() => setPopoverVisible(true)}\n        />\n      </Popover>\n      {headerTitle}\n    </div>\n  );\n}\n\nexport default HeaderWithRadioGroup;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useMemo } from 'react';\nimport { Tag } from 'antd';\nimport {\n  BinaryQueryObjectFilterClause,\n  css,\n  isAdhocColumn,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport RowCountLabel from 'src/explore/components/RowCountLabel';\nimport Icons from 'src/components/Icons';\n\nexport default function TableControls({\n  filters,\n  setFilters,\n  totalCount,\n  loading,\n  onReload,\n}: {\n  filters: BinaryQueryObjectFilterClause[];\n  setFilters: (filters: BinaryQueryObjectFilterClause[]) => void;\n  totalCount?: number;\n  loading: boolean;\n  onReload: () => void;\n}) {\n  const theme = useTheme();\n  const filterMap: Record<string, BinaryQueryObjectFilterClause> = useMemo(\n    () =>\n      Object.assign(\n        {},\n        ...filters.map(filter => ({\n          [isAdhocColumn(filter.col)\n            ? (filter.col.label as string)\n            : filter.col]: filter,\n        })),\n      ),\n    [filters],\n  );\n\n  const removeFilter = useCallback(\n    colName => {\n      const updatedFilterMap = { ...filterMap };\n      delete updatedFilterMap[colName];\n      setFilters([...Object.values(updatedFilterMap)]);\n    },\n    [filterMap, setFilters],\n  );\n\n  const filterTags = useMemo(\n    () =>\n      Object.entries(filterMap)\n        .map(([colName, { val, formattedVal }]) => ({\n          colName,\n          val: formattedVal ?? val,\n        }))\n        .sort((a, b) => a.colName.localeCompare(b.colName)),\n    [filterMap],\n  );\n\n  return (\n    <div\n      css={css`\n        display: flex;\n        justify-content: space-between;\n        padding: ${theme.gridUnit / 2}px 0;\n        margin-bottom: ${theme.gridUnit * 2}px;\n      `}\n    >\n      <div\n        css={css`\n          display: flex;\n          flex-wrap: wrap;\n          margin-bottom: -${theme.gridUnit * 4}px;\n        `}\n      >\n        {filterTags.map(({ colName, val }) => (\n          <Tag\n            closable\n            onClose={removeFilter.bind(null, colName)}\n            key={colName}\n            css={css`\n              height: ${theme.gridUnit * 6}px;\n              display: flex;\n              align-items: center;\n              padding: ${theme.gridUnit / 2}px ${theme.gridUnit * 2}px;\n              margin-right: ${theme.gridUnit * 4}px;\n              margin-bottom: ${theme.gridUnit * 4}px;\n              line-height: 1.2;\n            `}\n            data-test=\"filter-col\"\n          >\n            <span\n              css={css`\n                margin-right: ${theme.gridUnit}px;\n              `}\n            >\n              {colName}\n            </span>\n            <strong data-test=\"filter-val\">{val}</strong>\n          </Tag>\n        ))}\n      </div>\n      <div\n        css={css`\n          display: flex;\n          align-items: center;\n          height: min-content;\n        `}\n      >\n        <RowCountLabel loading={loading && !totalCount} rowcount={totalCount} />\n        <Icons.ReloadOutlined\n          iconColor={theme.colors.grayscale.light1}\n          iconSize=\"l\"\n          aria-label={t('Reload')}\n          role=\"button\"\n          onClick={onReload}\n        />\n      </div>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  cloneElement,\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useSelector } from 'react-redux';\nimport {\n  BinaryQueryObjectFilterClause,\n  css,\n  ensureIsArray,\n  GenericDataType,\n  JsonObject,\n  QueryFormData,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport Loading from 'src/components/Loading';\nimport BooleanCell from 'src/components/Table/cell-renderers/BooleanCell';\nimport NullCell from 'src/components/Table/cell-renderers/NullCell';\nimport TimeCell from 'src/components/Table/cell-renderers/TimeCell';\nimport { EmptyStateMedium } from 'src/components/EmptyState';\nimport { getDatasourceSamples } from 'src/components/Chart/chartAction';\nimport Table, { ColumnsType, TableSize } from 'src/components/Table';\nimport HeaderWithRadioGroup from 'src/components/Table/header-renderers/HeaderWithRadioGroup';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport { useDatasetMetadataBar } from 'src/features/datasets/metadataBar/useDatasetMetadataBar';\nimport TableControls from './DrillDetailTableControls';\nimport { getDrillPayload } from './utils';\nimport { ResultsPage } from './types';\n\nconst PAGE_SIZE = 50;\n\ninterface DataType {\n  [key: string]: any;\n}\n\n// Must be outside of the main component due to problems in\n// react-resize-detector with conditional rendering\n// https://github.com/maslianok/react-resize-detector/issues/178\nfunction Resizable({ children }: { children: ReactElement }) {\n  const { ref, height } = useResizeDetector();\n  return (\n    <div ref={ref} css={{ flex: 1 }}>\n      {cloneElement(children, { height })}\n    </div>\n  );\n}\n\nenum TimeFormatting {\n  Original,\n  Formatted,\n}\n\nexport default function DrillDetailPane({\n  formData,\n  initialFilters,\n}: {\n  formData: QueryFormData;\n  initialFilters: BinaryQueryObjectFilterClause[];\n}) {\n  const theme = useTheme();\n  const [pageIndex, setPageIndex] = useState(0);\n  const lastPageIndex = useRef(pageIndex);\n  const [filters, setFilters] = useState(initialFilters);\n  const [isLoading, setIsLoading] = useState(false);\n  const [responseError, setResponseError] = useState('');\n  const [resultsPages, setResultsPages] = useState<Map<number, ResultsPage>>(\n    new Map(),\n  );\n  const [timeFormatting, setTimeFormatting] = useState({});\n\n  const SAMPLES_ROW_LIMIT = useSelector(\n    (state: { common: { conf: JsonObject } }) =>\n      state.common.conf.SAMPLES_ROW_LIMIT,\n  );\n\n  // Extract datasource ID/type from string ID\n  const [datasourceId, datasourceType] = useMemo(\n    () => formData.datasource.split('__'),\n    [formData.datasource],\n  );\n\n  const { metadataBar, status: metadataBarStatus } = useDatasetMetadataBar({\n    datasetId: datasourceId,\n  });\n  // Get page of results\n  const resultsPage = useMemo(() => {\n    const nextResultsPage = resultsPages.get(pageIndex);\n    if (nextResultsPage) {\n      lastPageIndex.current = pageIndex;\n      return nextResultsPage;\n    }\n\n    return resultsPages.get(lastPageIndex.current);\n  }, [pageIndex, resultsPages]);\n\n  const mappedColumns: ColumnsType<DataType> = useMemo(\n    () =>\n      resultsPage?.colNames.map((column, index) => ({\n        key: column,\n        dataIndex: column,\n        title:\n          resultsPage?.colTypes[index] === GenericDataType.Temporal ? (\n            <HeaderWithRadioGroup\n              headerTitle={column}\n              groupTitle={t('Formatting')}\n              groupOptions={[\n                { label: t('Original value'), value: TimeFormatting.Original },\n                {\n                  label: t('Formatted value'),\n                  value: TimeFormatting.Formatted,\n                },\n              ]}\n              value={\n                timeFormatting[column] === TimeFormatting.Original\n                  ? TimeFormatting.Original\n                  : TimeFormatting.Formatted\n              }\n              onChange={value =>\n                setTimeFormatting(state => ({ ...state, [column]: value }))\n              }\n            />\n          ) : (\n            column\n          ),\n        render: value => {\n          if (value === true || value === false) {\n            return <BooleanCell value={value} />;\n          }\n          if (value === null) {\n            return <NullCell />;\n          }\n          if (\n            resultsPage?.colTypes[index] === GenericDataType.Temporal &&\n            timeFormatting[column] !== TimeFormatting.Original &&\n            (typeof value === 'number' || value instanceof Date)\n          ) {\n            return <TimeCell value={value} />;\n          }\n          return String(value);\n        },\n        width: 150,\n      })) || [],\n    [resultsPage?.colNames, resultsPage?.colTypes, timeFormatting],\n  );\n\n  const data: DataType[] = useMemo(\n    () =>\n      resultsPage?.data.map(\n        (row, index) =>\n          resultsPage?.colNames.reduce(\n            (acc, curr) => ({ ...acc, [curr]: row[curr] }),\n            {\n              key: index,\n            },\n          ),\n      ) || [],\n    [resultsPage?.colNames, resultsPage?.data],\n  );\n\n  // Clear cache on reload button click\n  const handleReload = useCallback(() => {\n    setResponseError('');\n    setResultsPages(new Map());\n    setPageIndex(0);\n  }, []);\n\n  // Clear cache and reset page index if filters change\n  useEffect(() => {\n    setResponseError('');\n    setResultsPages(new Map());\n    setPageIndex(0);\n  }, [filters]);\n\n  // Update cache order if page in cache\n  useEffect(() => {\n    if (\n      resultsPages.has(pageIndex) &&\n      [...resultsPages.keys()].at(-1) !== pageIndex\n    ) {\n      const nextResultsPages = new Map(resultsPages);\n      nextResultsPages.delete(pageIndex);\n      setResultsPages(\n        nextResultsPages.set(\n          pageIndex,\n          resultsPages.get(pageIndex) as ResultsPage,\n        ),\n      );\n    }\n  }, [pageIndex, resultsPages]);\n\n  // Download page of results & trim cache if page not in cache\n  useEffect(() => {\n    if (!responseError && !isLoading && !resultsPages.has(pageIndex)) {\n      setIsLoading(true);\n      const jsonPayload = getDrillPayload(formData, filters) ?? {};\n      const cachePageLimit = Math.ceil(SAMPLES_ROW_LIMIT / PAGE_SIZE);\n      getDatasourceSamples(\n        datasourceType,\n        datasourceId,\n        false,\n        jsonPayload,\n        PAGE_SIZE,\n        pageIndex + 1,\n      )\n        .then(response => {\n          setResultsPages(\n            new Map([\n              ...[...resultsPages.entries()].slice(-cachePageLimit + 1),\n              [\n                pageIndex,\n                {\n                  total: response.total_count,\n                  data: response.data,\n                  colNames: ensureIsArray(response.colnames),\n                  colTypes: ensureIsArray(response.coltypes),\n                },\n              ],\n            ]),\n          );\n          setResponseError('');\n        })\n        .catch(error => {\n          setResponseError(`${error.name}: ${error.message}`);\n        })\n        .finally(() => {\n          setIsLoading(false);\n        });\n    }\n  }, [\n    SAMPLES_ROW_LIMIT,\n    datasourceId,\n    datasourceType,\n    filters,\n    formData,\n    isLoading,\n    pageIndex,\n    responseError,\n    resultsPages,\n  ]);\n\n  const bootstrapping =\n    (!responseError && !resultsPages.size) ||\n    metadataBarStatus === ResourceStatus.Loading;\n\n  const allowHTML = formData.allow_render_html ?? true;\n\n  let tableContent = null;\n  if (responseError) {\n    // Render error if page download failed\n    tableContent = (\n      <pre\n        css={css`\n          margin-top: ${theme.gridUnit * 4}px;\n        `}\n      >\n        {responseError}\n      </pre>\n    );\n  } else if (bootstrapping) {\n    // Render loading if first page hasn't loaded\n    tableContent = <Loading />;\n  } else if (resultsPage?.total === 0) {\n    // Render empty state if no results are returned for page\n    const title = t('No rows were returned for this dataset');\n    tableContent = <EmptyStateMedium image=\"document.svg\" title={title} />;\n  } else {\n    // Render table if at least one page has successfully loaded\n    tableContent = (\n      <Resizable>\n        <Table\n          data={data}\n          columns={mappedColumns}\n          size={TableSize.Small}\n          defaultPageSize={PAGE_SIZE}\n          recordCount={resultsPage?.total}\n          usePagination\n          loading={isLoading}\n          onChange={pagination =>\n            setPageIndex(pagination.current ? pagination.current - 1 : 0)\n          }\n          resizable\n          virtualize\n          allowHTML={allowHTML}\n        />\n      </Resizable>\n    );\n  }\n\n  return (\n    <>\n      {!bootstrapping && metadataBar}\n      {!bootstrapping && (\n        <TableControls\n          filters={filters}\n          setFilters={setFilters}\n          totalCount={resultsPage?.total}\n          loading={isLoading}\n          onReload={handleReload}\n        />\n      )}\n      {tableContent}\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { omit } from 'lodash';\nimport {\n  ensureIsArray,\n  QueryFormData,\n  BinaryQueryObjectFilterClause,\n  buildQueryObject,\n} from '@superset-ui/core';\n\nexport function getDrillPayload(\n  queryFormData?: QueryFormData,\n  drillFilters?: BinaryQueryObjectFilterClause[],\n) {\n  if (!queryFormData) {\n    return undefined;\n  }\n  const queryObject = buildQueryObject(queryFormData);\n  const extras = omit(queryObject.extras, 'having');\n  const filters = [\n    ...ensureIsArray(queryObject.filters),\n    ...ensureIsArray(drillFilters).map(f => omit(f, 'formattedVal')),\n  ];\n  return {\n    granularity: queryObject.granularity,\n    time_range: queryObject.time_range,\n    filters,\n    extras,\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useContext, useMemo } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport {\n  BinaryQueryObjectFilterClause,\n  css,\n  QueryFormData,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport Modal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport { useSelector } from 'react-redux';\nimport { DashboardPageIdContext } from 'src/dashboard/containers/DashboardPage';\nimport { Slice } from 'src/types/Chart';\nimport { RootState } from 'src/dashboard/types';\nimport { findPermission } from 'src/utils/findPermission';\nimport DrillDetailPane from './DrillDetailPane';\n\ninterface ModalFooterProps {\n  canExplore: boolean;\n  closeModal?: () => void;\n  exploreChart: () => void;\n}\n\nconst ModalFooter = ({\n  canExplore,\n  closeModal,\n  exploreChart,\n}: ModalFooterProps) => {\n  const theme = useTheme();\n\n  return (\n    <>\n      <Button\n        buttonStyle=\"secondary\"\n        buttonSize=\"small\"\n        onClick={exploreChart}\n        disabled={!canExplore}\n        tooltip={\n          !canExplore\n            ? t('You do not have sufficient permissions to edit the chart')\n            : undefined\n        }\n      >\n        {t('Edit chart')}\n      </Button>\n      <Button\n        buttonStyle=\"primary\"\n        buttonSize=\"small\"\n        onClick={closeModal}\n        data-test=\"close-drilltodetail-modal\"\n        css={css`\n          margin-left: ${theme.gridUnit * 2}px;\n        `}\n      >\n        {t('Close')}\n      </Button>\n    </>\n  );\n};\n\ninterface DrillDetailModalProps {\n  chartId: number;\n  formData: QueryFormData;\n  initialFilters: BinaryQueryObjectFilterClause[];\n  showModal: boolean;\n  onHideModal: () => void;\n}\n\nexport default function DrillDetailModal({\n  chartId,\n  formData,\n  initialFilters,\n  showModal,\n  onHideModal,\n}: DrillDetailModalProps) {\n  const theme = useTheme();\n  const history = useHistory();\n  const dashboardPageId = useContext(DashboardPageIdContext);\n  const { slice_name: chartName } = useSelector(\n    (state: { sliceEntities: { slices: Record<number, Slice> } }) =>\n      state.sliceEntities.slices[chartId],\n  );\n  const canExplore = useSelector((state: RootState) =>\n    findPermission('can_explore', 'Superset', state.user?.roles),\n  );\n\n  const exploreUrl = useMemo(\n    () => `/explore/?dashboard_page_id=${dashboardPageId}&slice_id=${chartId}`,\n    [chartId, dashboardPageId],\n  );\n\n  const exploreChart = useCallback(() => {\n    history.push(exploreUrl);\n  }, [exploreUrl, history]);\n\n  return (\n    <Modal\n      show={showModal}\n      onHide={onHideModal ?? (() => null)}\n      css={css`\n        .ant-modal-body {\n          display: flex;\n          flex-direction: column;\n        }\n      `}\n      title={t('Drill to detail: %s', chartName)}\n      footer={\n        <ModalFooter exploreChart={exploreChart} canExplore={canExplore} />\n      }\n      responsive\n      resizable\n      resizableConfig={{\n        minHeight: theme.gridUnit * 128,\n        minWidth: theme.gridUnit * 128,\n        defaultSize: {\n          width: 'auto',\n          height: '75vh',\n        },\n      }}\n      draggable\n      destroyOnClose\n      maskClosable={false}\n    >\n      <DrillDetailPane formData={formData} initialFilters={initialFilters} />\n    </Modal>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ReactNode, RefObject, useCallback, useMemo, useState } from 'react';\nimport { isEmpty } from 'lodash';\nimport {\n  Behavior,\n  BinaryQueryObjectFilterClause,\n  css,\n  extractQueryFields,\n  getChartMetadataRegistry,\n  QueryFormData,\n  removeHTMLTags,\n  styled,\n  t,\n} from '@superset-ui/core';\nimport { useSelector } from 'react-redux';\nimport { Menu } from 'src/components/Menu';\nimport { RootState } from 'src/dashboard/types';\nimport DrillDetailModal from './DrillDetailModal';\nimport { getSubmenuYOffset } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { MenuItemWithTruncation } from '../MenuItemWithTruncation';\n\nconst DRILL_TO_DETAIL = t('Drill to detail');\nconst DRILL_TO_DETAIL_BY = t('Drill to detail by');\nconst DISABLED_REASONS = {\n  DATABASE: t(\n    'Drill to detail is disabled for this database. Change the database settings to enable it.',\n  ),\n  NO_AGGREGATIONS: t(\n    'Drill to detail is disabled because this chart does not group data by dimension value.',\n  ),\n  NO_FILTERS: t(\n    'Right-click on a dimension value to drill to detail by that value.',\n  ),\n  NOT_SUPPORTED: t(\n    'Drill to detail by value is not yet supported for this chart type.',\n  ),\n};\n\nconst DisabledMenuItem = ({ children, ...props }: { children: ReactNode }) => (\n  <Menu.Item disabled {...props}>\n    <div\n      css={css`\n        white-space: normal;\n        max-width: 160px;\n      `}\n    >\n      {children}\n    </div>\n  </Menu.Item>\n);\n\nconst Filter = ({\n  children,\n  stripHTML = false,\n}: {\n  children: ReactNode;\n  stripHTML: boolean;\n}) => {\n  const content =\n    stripHTML && typeof children === 'string'\n      ? removeHTMLTags(children)\n      : children;\n  return <span>{content}</span>;\n};\n\nconst StyledFilter = styled(Filter)`\n  ${({ theme }) => `\n     font-weight: ${theme.typography.weights.bold};\n     color: ${theme.colors.primary.base};\n   `}\n`;\n\nexport type DrillDetailMenuItemsProps = {\n  chartId: number;\n  formData: QueryFormData;\n  filters?: BinaryQueryObjectFilterClause[];\n  isContextMenu?: boolean;\n  contextMenuY?: number;\n  onSelection?: () => void;\n  onClick?: (event: MouseEvent) => void;\n  submenuIndex?: number;\n  showModal: boolean;\n  setShowModal: (show: boolean) => void;\n  drillToDetailMenuRef?: RefObject<any>;\n};\n\nconst DrillDetailMenuItems = ({\n  chartId,\n  formData,\n  filters = [],\n  isContextMenu = false,\n  contextMenuY = 0,\n  onSelection = () => null,\n  onClick = () => null,\n  submenuIndex = 0,\n  showModal,\n  setShowModal,\n  drillToDetailMenuRef,\n  ...props\n}: DrillDetailMenuItemsProps) => {\n  const drillToDetailDisabled = useSelector<RootState, boolean | undefined>(\n    ({ datasources }) =>\n      datasources[formData.datasource]?.database?.disable_drill_to_detail,\n  );\n\n  const [modalFilters, setFilters] = useState<BinaryQueryObjectFilterClause[]>(\n    [],\n  );\n\n  const openModal = useCallback(\n    (filters, event) => {\n      onClick(event);\n      onSelection();\n      setFilters(filters);\n      setShowModal(true);\n    },\n    [onClick, onSelection],\n  );\n\n  const closeModal = useCallback(() => {\n    setShowModal(false);\n  }, []);\n\n  // Check for Behavior.DRILL_TO_DETAIL to tell if plugin handles the `contextmenu`\n  // event for dimensions.  If it doesn't, tell the user that drill to detail by\n  // dimension is not supported.  If it does, and the `contextmenu` handler didn't\n  // pass any filters, tell the user that they didn't select a dimension.\n  const handlesDimensionContextMenu = useMemo(\n    () =>\n      getChartMetadataRegistry()\n        .get(formData.viz_type)\n        ?.behaviors.find(behavior => behavior === Behavior.DrillToDetail),\n    [formData.viz_type],\n  );\n\n  // Check metrics to see if chart's current configuration lacks\n  // aggregations, in which case Drill to Detail should be disabled.\n  const noAggregations = useMemo(() => {\n    const { metrics } = extractQueryFields(formData);\n    return isEmpty(metrics);\n  }, [formData]);\n\n  // Ensure submenu doesn't appear offscreen\n  const submenuYOffset = useMemo(\n    () =>\n      getSubmenuYOffset(\n        contextMenuY,\n        filters.length > 1 ? filters.length + 1 : filters.length,\n        submenuIndex,\n      ),\n    [contextMenuY, filters.length, submenuIndex],\n  );\n\n  let drillDisabled;\n  let drillByDisabled;\n  if (drillToDetailDisabled) {\n    drillDisabled = DISABLED_REASONS.DATABASE;\n    drillByDisabled = DISABLED_REASONS.DATABASE;\n  } else if (handlesDimensionContextMenu) {\n    if (noAggregations) {\n      drillDisabled = DISABLED_REASONS.NO_AGGREGATIONS;\n      drillByDisabled = DISABLED_REASONS.NO_AGGREGATIONS;\n    } else if (!filters?.length) {\n      drillByDisabled = DISABLED_REASONS.NO_FILTERS;\n    }\n  } else {\n    drillByDisabled = DISABLED_REASONS.NOT_SUPPORTED;\n  }\n\n  const drillToDetailMenuItem = drillDisabled ? (\n    <DisabledMenuItem {...props} key=\"drill-to-detail-disabled\">\n      {DRILL_TO_DETAIL}\n      <MenuItemTooltip title={drillDisabled} />\n    </DisabledMenuItem>\n  ) : (\n    <Menu.Item\n      {...props}\n      key=\"drill-to-detail\"\n      onClick={openModal.bind(null, [])}\n      ref={drillToDetailMenuRef}\n    >\n      {DRILL_TO_DETAIL}\n    </Menu.Item>\n  );\n\n  const drillToDetailByMenuItem = drillByDisabled ? (\n    <DisabledMenuItem {...props} key=\"drill-to-detail-by-disabled\">\n      {DRILL_TO_DETAIL_BY}\n      <MenuItemTooltip title={drillByDisabled} />\n    </DisabledMenuItem>\n  ) : (\n    <Menu.SubMenu\n      {...props}\n      popupOffset={[0, submenuYOffset]}\n      popupClassName=\"chart-context-submenu\"\n      title={DRILL_TO_DETAIL_BY}\n    >\n      <div data-test=\"drill-to-detail-by-submenu\">\n        {filters.map((filter, i) => (\n          <MenuItemWithTruncation\n            {...props}\n            tooltipText={`${DRILL_TO_DETAIL_BY} ${filter.formattedVal}`}\n            key={`drill-detail-filter-${i}`}\n            onClick={openModal.bind(null, [filter])}\n          >\n            {`${DRILL_TO_DETAIL_BY} `}\n            <StyledFilter stripHTML>{filter.formattedVal}</StyledFilter>\n          </MenuItemWithTruncation>\n        ))}\n        {filters.length > 1 && (\n          <Menu.Item\n            {...props}\n            key=\"drill-detail-filter-all\"\n            onClick={openModal.bind(null, filters)}\n          >\n            <div>\n              {`${DRILL_TO_DETAIL_BY} `}\n              <StyledFilter stripHTML={false}>{t('all')}</StyledFilter>\n            </div>\n          </Menu.Item>\n        )}\n      </div>\n    </Menu.SubMenu>\n  );\n\n  return (\n    <>\n      {drillToDetailMenuItem}\n      {isContextMenu && drillToDetailByMenuItem}\n      <DrillDetailModal\n        chartId={chartId}\n        formData={formData}\n        initialFilters={modalFilters}\n        showModal={showModal}\n        onHideModal={closeModal}\n      />\n    </>\n  );\n};\n\nexport default DrillDetailMenuItems;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ReactNode, CSSProperties } from 'react';\nimport { css, truncationCSS, useCSSTextTruncation } from '@superset-ui/core';\nimport { Menu } from 'src/components/Menu';\nimport { Tooltip } from 'src/components/Tooltip';\nimport type { MenuProps } from 'antd/lib/menu';\n\nexport type MenuItemWithTruncationProps = {\n  tooltipText: ReactNode;\n  children: ReactNode;\n  onClick?: MenuProps['onClick'];\n  style?: CSSProperties;\n};\n\nexport const MenuItemWithTruncation = ({\n  tooltipText,\n  children,\n  ...props\n}: MenuItemWithTruncationProps) => {\n  const [itemRef, itemIsTruncated] = useCSSTextTruncation<HTMLDivElement>();\n\n  return (\n    <Menu.Item\n      css={css`\n        display: flex;\n      `}\n      {...props}\n    >\n      <Tooltip title={itemIsTruncated ? tooltipText : null}>\n        <div\n          ref={itemRef}\n          css={css`\n            max-width: 100%;\n            ${truncationCSS};\n          `}\n        >\n          {children}\n        </div>\n      </Tooltip>\n    </Menu.Item>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport const MENU_ITEM_HEIGHT = 32;\nconst MENU_PADDING = 4;\nconst MENU_VERTICAL_SPACING = 32;\n\n/**\n * Calculates an adjusted Y-offset for a menu or submenu to prevent that\n * menu from appearing offscreen\n *\n * @param clientY The original Y-offset\n * @param itemsCount The number of menu items\n */\nexport const getMenuAdjustedY = (\n  clientY: number,\n  itemsCount: number,\n  maxItemsContainerHeight = Number.MAX_SAFE_INTEGER,\n  additionalItemsHeight = 0,\n) => {\n  // Viewport height\n  const vh = Math.max(\n    document.documentElement.clientHeight || 0,\n    window.innerHeight || 0,\n  );\n\n  const menuHeight =\n    Math.min(MENU_ITEM_HEIGHT * itemsCount, maxItemsContainerHeight) +\n    MENU_VERTICAL_SPACING +\n    additionalItemsHeight;\n  // Always show the context menu inside the viewport\n  return vh - clientY < menuHeight ? vh - menuHeight : clientY;\n};\n\nexport const getSubmenuYOffset = (\n  contextMenuY: number,\n  itemsCount: number,\n  submenuIndex = 0,\n  maxItemsContainerHeight = Number.MAX_SAFE_INTEGER,\n  additionalItemsHeight = 0,\n) => {\n  const submenuY =\n    contextMenuY +\n    MENU_PADDING +\n    MENU_ITEM_HEIGHT * submenuIndex +\n    MENU_PADDING;\n\n  return (\n    getMenuAdjustedY(\n      submenuY,\n      itemsCount,\n      maxItemsContainerHeight,\n      additionalItemsHeight,\n    ) - submenuY\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useTheme } from '@superset-ui/core';\n\nexport const CheckboxChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z\"\n        fill={theme.colors.primary.base}\n      />\n      <path\n        d=\"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z\"\n        fill=\"white\"\n      />\n    </svg>\n  );\n};\n\nexport const CheckboxHalfChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light1}\n      />\n      <path d=\"M14 10H4V8H14V10Z\" fill=\"white\" />\n    </svg>\n  );\n};\n\nexport const CheckboxUnchecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light2}\n      />\n      <path d=\"M16 2V16H2V2H16V2Z\" fill=\"white\" />\n    </svg>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { CSSProperties } from 'react';\nimport { styled } from '@superset-ui/core';\nimport { CheckboxChecked, CheckboxUnchecked } from 'src/components/Checkbox';\n\nexport interface CheckboxProps {\n  checked: boolean;\n  onChange: (val?: boolean) => void;\n  style?: CSSProperties;\n  className?: string;\n}\n\nconst Styles = styled.span`\n  &,\n  & svg {\n    vertical-align: top;\n  }\n`;\n\nexport default function Checkbox({\n  checked,\n  onChange,\n  style,\n  className,\n}: CheckboxProps) {\n  return (\n    <Styles\n      style={style}\n      onClick={() => {\n        onChange(!checked);\n      }}\n      role=\"checkbox\"\n      tabIndex={0}\n      aria-checked={checked}\n      aria-label=\"Checkbox\"\n      className={className || ''}\n    >\n      {checked ? <CheckboxChecked /> : <CheckboxUnchecked />}\n    </Styles>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  RefObject,\n  ReactElement,\n  ReactNode,\n  FocusEvent,\n  KeyboardEvent,\n  cloneElement,\n} from 'react';\n\nimport { AntdDropdown } from 'src/components';\nimport { DropDownProps } from 'antd/lib/dropdown';\nimport { styled } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\n\nconst MenuDots = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 0.75}px;\n  height: ${({ theme }) => theme.gridUnit * 0.75}px;\n  border-radius: 50%;\n  background-color: ${({ theme }) => theme.colors.grayscale.light1};\n\n  font-weight: ${({ theme }) => theme.typography.weights.normal};\n  display: inline-flex;\n  position: relative;\n\n  &:hover {\n    background-color: ${({ theme }) => theme.colors.primary.base};\n\n    &::before,\n    &::after {\n      background-color: ${({ theme }) => theme.colors.primary.base};\n    }\n  }\n\n  &::before,\n  &::after {\n    position: absolute;\n    content: ' ';\n    width: ${({ theme }) => theme.gridUnit * 0.75}px;\n    height: ${({ theme }) => theme.gridUnit * 0.75}px;\n    border-radius: 50%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n\n  &::before {\n    top: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  &::after {\n    bottom: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nconst MenuDotsWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport enum IconOrientation {\n  Vertical = 'vertical',\n  Horizontal = 'horizontal',\n}\nexport interface DropdownProps extends DropDownProps {\n  overlay: ReactElement;\n  iconOrientation?: IconOrientation;\n}\n\nconst RenderIcon = (\n  iconOrientation: IconOrientation = IconOrientation.Vertical,\n) => {\n  const component =\n    iconOrientation === IconOrientation.Horizontal ? (\n      <Icons.MoreHoriz iconSize=\"xl\" />\n    ) : (\n      <MenuDots />\n    );\n  return component;\n};\n\nexport const Dropdown = ({\n  overlay,\n  iconOrientation = IconOrientation.Vertical,\n  ...rest\n}: DropdownProps) => (\n  <AntdDropdown overlay={overlay} {...rest}>\n    <MenuDotsWrapper data-test=\"dropdown-trigger\">\n      {RenderIcon(iconOrientation)}\n    </MenuDotsWrapper>\n  </AntdDropdown>\n);\n\ninterface ExtendedDropDownProps extends DropDownProps {\n  ref?: RefObject<HTMLDivElement>;\n}\n\nexport interface NoAnimationDropdownProps extends ExtendedDropDownProps {\n  children: ReactNode;\n  onBlur?: (e: FocusEvent<HTMLDivElement>) => void;\n  onKeyDown?: (e: KeyboardEvent<HTMLDivElement>) => void;\n}\n\nexport const NoAnimationDropdown = (props: NoAnimationDropdownProps) => {\n  const { children, onBlur, onKeyDown, ...rest } = props;\n  const childrenWithProps = cloneElement(children as ReactElement, {\n    onBlur,\n    onKeyDown,\n  });\n\n  return (\n    <AntdDropdown overlayStyle={props.overlayStyle} {...rest}>\n      {childrenWithProps}\n    </AntdDropdown>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  ClientErrorObject,\n  getClientErrorObject,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport Tag from 'src/types/TagType';\n\nimport rison from 'rison';\nimport { cacheWrapper } from 'src/utils/cacheWrapper';\n\nconst localCache = new Map<string, any>();\n\nconst cachedSupersetGet = cacheWrapper(\n  SupersetClient.get,\n  localCache,\n  ({ endpoint }) => endpoint || '',\n);\n\ntype SelectTagsValue = {\n  value: number | undefined;\n  label: string | undefined;\n  key: number | undefined;\n};\n\nexport const tagToSelectOption = (\n  tag: Tag & { table_name: string },\n): SelectTagsValue => ({\n  value: tag.id,\n  label: tag.name,\n  key: tag.id,\n});\n\nexport const loadTags = async (\n  search: string,\n  page: number,\n  pageSize: number,\n) => {\n  const searchColumn = 'name';\n  const query = rison.encode({\n    filters: [\n      { col: searchColumn, opr: 'ct', value: search },\n      { col: 'type', opr: 'custom_tag', value: true },\n    ],\n    page,\n    page_size: pageSize,\n    order_column: searchColumn,\n    order_direction: 'asc',\n  });\n\n  const getErrorMessage = ({ error, message }: ClientErrorObject) => {\n    let errorText = message || error || t('An error has occurred');\n    if (message === 'Forbidden') {\n      errorText = t('You do not have permission to read tags');\n    }\n    return errorText;\n  };\n\n  return cachedSupersetGet({\n    endpoint: `/api/v1/tag/?q=${query}`,\n  })\n    .then(response => {\n      const data: {\n        label: string;\n        value: string | number;\n      }[] = response.json.result.map(tagToSelectOption);\n      return {\n        data,\n        totalCount: response.json.count,\n      };\n    })\n    .catch(async error => {\n      const errorMessage = getErrorMessage(await getClientErrorObject(error));\n      throw new Error(errorMessage);\n    });\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  Behavior,\n  DataMaskStateWithId,\n  EXTRA_FORM_DATA_APPEND_KEYS,\n  EXTRA_FORM_DATA_OVERRIDE_KEYS,\n  ExtraFormData,\n  isFeatureEnabled,\n  FeatureFlag,\n  Filter,\n  getChartMetadataRegistry,\n  QueryFormData,\n  t,\n} from '@superset-ui/core';\nimport { DashboardLayout } from 'src/dashboard/types';\nimport extractUrlParams from 'src/dashboard/util/extractUrlParams';\nimport { CHART_TYPE, TAB_TYPE } from '../../util/componentTypes';\nimport { DASHBOARD_GRID_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\nimport getBootstrapData from '../../../utils/getBootstrapData';\n\nconst getDefaultRowLimit = (): number => {\n  const bootstrapData = getBootstrapData();\n  const nativeFilterDefaultRowLimit =\n    bootstrapData?.common?.conf?.NATIVE_FILTER_DEFAULT_ROW_LIMIT;\n  return nativeFilterDefaultRowLimit || 1000;\n};\n\nexport const getFormData = ({\n  datasetId,\n  dependencies = {},\n  groupby,\n  defaultDataMask,\n  controlValues,\n  filterType,\n  sortMetric,\n  adhoc_filters,\n  time_range,\n  granularity_sqla,\n  type,\n  dashboardId,\n  id,\n}: Partial<Filter> & {\n  dashboardId: number;\n  datasetId?: number;\n  dependencies?: object;\n  groupby?: string;\n  adhoc_filters?: AdhocFilter[];\n  time_range?: string;\n}): Partial<QueryFormData> => {\n  const otherProps: {\n    datasource?: string;\n    groupby?: string[];\n    sortMetric?: string;\n  } = {};\n  if (datasetId) {\n    otherProps.datasource = `${datasetId}__table`;\n  }\n  if (groupby) {\n    otherProps.groupby = [groupby];\n  }\n  if (sortMetric) {\n    otherProps.sortMetric = sortMetric;\n  }\n  return {\n    ...controlValues,\n    ...otherProps,\n    adhoc_filters: adhoc_filters ?? [],\n    extra_filters: [],\n    extra_form_data: dependencies,\n    granularity_sqla,\n    metrics: ['count'],\n    row_limit: getDefaultRowLimit(),\n    showSearch: true,\n    defaultValue: defaultDataMask?.filterState?.value,\n    time_range,\n    url_params: extractUrlParams('regular'),\n    inView: true,\n    viz_type: filterType,\n    type,\n    dashboardId,\n    native_filter_id: id,\n  };\n};\n\nexport function mergeExtraFormData(\n  originalExtra: ExtraFormData = {},\n  newExtra: ExtraFormData = {},\n): ExtraFormData {\n  const mergedExtra: ExtraFormData = {};\n  EXTRA_FORM_DATA_APPEND_KEYS.forEach((key: string) => {\n    const mergedValues = [\n      ...(originalExtra[key] || []),\n      ...(newExtra[key] || []),\n    ];\n    if (mergedValues.length) {\n      mergedExtra[key] = mergedValues;\n    }\n  });\n  EXTRA_FORM_DATA_OVERRIDE_KEYS.forEach((key: string) => {\n    const originalValue = originalExtra[key];\n    if (originalValue !== undefined) {\n      mergedExtra[key] = originalValue;\n    }\n    const newValue = newExtra[key];\n    if (newValue !== undefined) {\n      mergedExtra[key] = newValue;\n    }\n  });\n  return mergedExtra;\n}\n\nexport function isCrossFilter(vizType: string) {\n  // @ts-ignore need export from superset-ui `ItemWithValue`\n  return getChartMetadataRegistry().items[vizType]?.value.behaviors?.includes(\n    Behavior.InteractiveChart,\n  );\n}\n\nexport function getExtraFormData(\n  dataMask: DataMaskStateWithId,\n  filterIdsAppliedOnChart: string[],\n): ExtraFormData {\n  let extraFormData: ExtraFormData = {};\n  filterIdsAppliedOnChart.forEach(key => {\n    extraFormData = mergeExtraFormData(\n      extraFormData,\n      dataMask[key]?.extraFormData ?? {},\n    );\n  });\n  return extraFormData;\n}\n\nexport function nativeFilterGate(behaviors: Behavior[]): boolean {\n  return (\n    !behaviors.includes(Behavior.NativeFilter) ||\n    (isFeatureEnabled(FeatureFlag.DashboardCrossFilters) &&\n      behaviors.includes(Behavior.InteractiveChart))\n  );\n}\n\nconst isComponentATab = (\n  dashboardLayout: DashboardLayout,\n  componentId: string,\n) => dashboardLayout?.[componentId]?.type === TAB_TYPE;\n\nconst findTabsWithChartsInScopeHelper = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n  componentId: string,\n  tabIds: string[],\n  tabsToHighlight: Set<string>,\n  visited: Set<string>,\n) => {\n  if (visited.has(componentId)) {\n    return;\n  }\n  visited.add(componentId);\n  if (\n    dashboardLayout?.[componentId]?.type === CHART_TYPE &&\n    chartsInScope.includes(dashboardLayout[componentId]?.meta?.chartId)\n  ) {\n    tabIds.forEach(tabsToHighlight.add, tabsToHighlight);\n  }\n  if (\n    dashboardLayout?.[componentId]?.children?.length === 0 ||\n    (isComponentATab(dashboardLayout, componentId) &&\n      tabsToHighlight.has(componentId))\n  ) {\n    return;\n  }\n  dashboardLayout[componentId]?.children.forEach(childId =>\n    findTabsWithChartsInScopeHelper(\n      dashboardLayout,\n      chartsInScope,\n      childId,\n      isComponentATab(dashboardLayout, childId) ? [...tabIds, childId] : tabIds,\n      tabsToHighlight,\n      visited,\n    ),\n  );\n};\n\nexport const findTabsWithChartsInScope = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n) => {\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot.children[0];\n  const hasTopLevelTabs = rootChildId !== DASHBOARD_GRID_ID;\n  const tabsInScope = new Set<string>();\n  const visited = new Set<string>();\n  if (hasTopLevelTabs) {\n    dashboardLayout[rootChildId]?.children?.forEach(tabId =>\n      findTabsWithChartsInScopeHelper(\n        dashboardLayout,\n        chartsInScope,\n        tabId,\n        [tabId],\n        tabsInScope,\n        visited,\n      ),\n    );\n  } else {\n    Object.values(dashboardLayout)\n      .filter(element => element?.type === TAB_TYPE)\n      .forEach(element =>\n        findTabsWithChartsInScopeHelper(\n          dashboardLayout,\n          chartsInScope,\n          element.id,\n          [element.id],\n          tabsInScope,\n          visited,\n        ),\n      );\n  }\n  return tabsInScope;\n};\n\nexport const getFilterValueForDisplay = (\n  value?: string[] | null | string | number | object,\n): string => {\n  if (value === null || value === undefined) {\n    return '';\n  }\n  if (typeof value === 'string' || typeof value === 'number') {\n    return `${value}`;\n  }\n  if (Array.isArray(value)) {\n    return value.join(', ');\n  }\n  if (typeof value === 'object') {\n    return JSON.stringify(value);\n  }\n  return t('Unknown value');\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DataRecordFilters } from '@superset-ui/core';\n\nexport default function getEffectiveExtraFilters(filters: DataRecordFilters) {\n  return Object.entries(filters)\n    .map(([column, values]) => ({\n      col: column,\n      op: Array.isArray(values) ? 'IN' : '==',\n      val: values,\n    }))\n    .filter(filter => filter.val !== null);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  DataMaskStateWithId,\n  DataRecordFilters,\n  JsonObject,\n  PartialFilters,\n} from '@superset-ui/core';\nimport { ChartConfiguration, ChartQueryPayload } from 'src/dashboard/types';\nimport { getExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport getEffectiveExtraFilters from './getEffectiveExtraFilters';\nimport { getAllActiveFilters } from '../activeAllDashboardFilters';\n\n// We cache formData objects so that our connected container components don't always trigger\n// render cascades. we cannot leverage the reselect library because our cache size is >1\nconst cachedFiltersByChart = {};\nconst cachedFormdataByChart = {};\n\nexport interface GetFormDataWithExtraFiltersArguments {\n  chartConfiguration: ChartConfiguration;\n  chart: ChartQueryPayload;\n  filters: DataRecordFilters;\n  colorScheme?: string;\n  colorNamespace?: string;\n  sliceId: number;\n  dataMask: DataMaskStateWithId;\n  nativeFilters: PartialFilters;\n  extraControls: Record<string, string | boolean | null>;\n  labelsColor?: Record<string, string>;\n  labelsColorMap?: Record<string, string>;\n  allSliceIds: number[];\n}\n\n// this function merge chart's formData with dashboard filters value,\n// and generate a new formData which will be used in the new query.\n// filters param only contains those applicable to this chart.\nexport default function getFormDataWithExtraFilters({\n  chart,\n  filters,\n  nativeFilters,\n  chartConfiguration,\n  colorScheme,\n  colorNamespace,\n  sliceId,\n  dataMask,\n  extraControls,\n  labelsColor,\n  labelsColorMap,\n  allSliceIds,\n}: GetFormDataWithExtraFiltersArguments) {\n  // if dashboard metadata + filters have not changed, use cache if possible\n  const cachedFormData = cachedFormdataByChart[sliceId];\n  if (\n    cachedFiltersByChart[sliceId] === filters &&\n    areObjectsEqual(cachedFormData?.color_scheme, colorScheme, {\n      ignoreUndefined: true,\n    }) &&\n    areObjectsEqual(cachedFormData?.color_namespace, colorNamespace, {\n      ignoreUndefined: true,\n    }) &&\n    areObjectsEqual(cachedFormData?.label_colors, labelsColor, {\n      ignoreUndefined: true,\n    }) &&\n    areObjectsEqual(cachedFormData?.shared_label_colors, labelsColorMap, {\n      ignoreUndefined: true,\n    }) &&\n    !!cachedFormData &&\n    areObjectsEqual(cachedFormData?.dataMask, dataMask, {\n      ignoreUndefined: true,\n    }) &&\n    areObjectsEqual(cachedFormData?.extraControls, extraControls, {\n      ignoreUndefined: true,\n    })\n  ) {\n    return cachedFormData;\n  }\n\n  let extraData: { extra_form_data?: JsonObject } = {};\n  const activeFilters = getAllActiveFilters({\n    chartConfiguration,\n    dataMask,\n    nativeFilters,\n    allSliceIds,\n  });\n  const filterIdsAppliedOnChart = Object.entries(activeFilters)\n    .filter(([, { scope }]) => scope.includes(chart.id))\n    .map(([filterId]) => filterId);\n  if (filterIdsAppliedOnChart.length) {\n    extraData = {\n      extra_form_data: getExtraFormData(dataMask, filterIdsAppliedOnChart),\n    };\n  }\n\n  const formData = {\n    ...chart.form_data,\n    label_colors: labelsColor,\n    shared_label_colors: labelsColorMap,\n    ...(colorScheme && { color_scheme: colorScheme }),\n    extra_filters: getEffectiveExtraFilters(filters),\n    ...extraData,\n    ...extraControls,\n  };\n\n  cachedFiltersByChart[sliceId] = filters;\n  cachedFormdataByChart[sliceId] = { ...formData, dataMask, extraControls };\n\n  return formData;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useMemo, useState, useEffect, useRef, RefObject } from 'react';\nimport {\n  css,\n  GenericDataType,\n  getTimeFormatter,\n  safeHtmlSpan,\n  styled,\n  t,\n  TimeFormats,\n  useTheme,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport { Column } from 'react-table';\nimport { debounce } from 'lodash';\nimport { Space } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport {\n  BOOL_FALSE_DISPLAY,\n  BOOL_TRUE_DISPLAY,\n  NULL_DISPLAY,\n  SLOW_DEBOUNCE,\n} from 'src/constants';\nimport { Radio } from 'src/components/Radio';\nimport Icons from 'src/components/Icons';\nimport Button from 'src/components/Button';\nimport Popover from 'src/components/Popover';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { getTimeColumns, setTimeColumns } from './utils';\n\nexport const CellNull = styled('span')`\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nexport const CopyButton = styled(Button)`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n\n  // needed to override button's first-of-type margin: 0\n  && {\n    margin: 0 ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  i {\n    padding: 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport const CopyToClipboardButton = ({\n  data,\n  columns,\n}: {\n  data?: Record<string, any>;\n  columns?: string[];\n}) => {\n  const theme = useTheme();\n  return (\n    <CopyToClipboard\n      text={\n        data && columns ? prepareCopyToClipboardTabularData(data, columns) : ''\n      }\n      wrapped={false}\n      copyNode={\n        <Icons.CopyOutlined\n          iconColor={theme.colors.grayscale.base}\n          iconSize=\"l\"\n          aria-label={t('Copy')}\n          role=\"button\"\n          css={css`\n            &.anticon > * {\n              line-height: 0;\n            }\n          `}\n        />\n      }\n    />\n  );\n};\n\nexport const FilterInput = ({\n  onChangeHandler,\n  shouldFocus = false,\n}: {\n  onChangeHandler(filterText: string): void;\n  shouldFocus?: boolean;\n}) => {\n  const inputRef: RefObject<any> = useRef(null);\n\n  useEffect(() => {\n    // Focus the input element when the component mounts\n    if (inputRef.current && shouldFocus) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  const theme = useTheme();\n  const debouncedChangeHandler = debounce(onChangeHandler, SLOW_DEBOUNCE);\n  return (\n    <Input\n      prefix={<Icons.Search iconColor={theme.colors.grayscale.base} />}\n      placeholder={t('Search')}\n      onChange={(event: any) => {\n        const filterText = event.target.value;\n        debouncedChangeHandler(filterText);\n      }}\n      css={css`\n        width: 200px;\n        margin-right: ${theme.gridUnit * 2}px;\n      `}\n      ref={inputRef}\n    />\n  );\n};\n\nenum FormatPickerValue {\n  Formatted = 'formatted',\n  Original = 'original',\n}\n\nconst FormatPicker = ({\n  onChange,\n  value,\n}: {\n  onChange: any;\n  value: FormatPickerValue;\n}) => (\n  <Radio.Group value={value} onChange={onChange}>\n    <Space direction=\"vertical\">\n      <Radio value={FormatPickerValue.Formatted}>{t('Formatted date')}</Radio>\n      <Radio value={FormatPickerValue.Original}>{t('Original value')}</Radio>\n    </Space>\n  </Radio.Group>\n);\n\nconst FormatPickerContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n\n  padding: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst FormatPickerLabel = styled.span`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  text-transform: uppercase;\n`;\n\nconst DataTableTemporalHeaderCell = ({\n  columnName,\n  onTimeColumnChange,\n  datasourceId,\n  isOriginalTimeColumn,\n}: {\n  columnName: string;\n  onTimeColumnChange: (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => void;\n  datasourceId?: string;\n  isOriginalTimeColumn: boolean;\n}) => {\n  const theme = useTheme();\n\n  const onChange = (e: any) => {\n    onTimeColumnChange(columnName, e.target.value);\n  };\n\n  const overlayContent = useMemo(\n    () =>\n      datasourceId ? ( // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n        <FormatPickerContainer onClick={e => e.stopPropagation()}>\n          {/* hack to disable click propagation from popover content to table header, which triggers sorting column */}\n          <Global\n            styles={css`\n              .column-formatting-popover .ant-popover-inner-content {\n                padding: 0;\n              }\n            `}\n          />\n          <FormatPickerLabel>{t('Column Formatting')}</FormatPickerLabel>\n          <FormatPicker\n            onChange={onChange}\n            value={\n              isOriginalTimeColumn\n                ? FormatPickerValue.Original\n                : FormatPickerValue.Formatted\n            }\n          />\n        </FormatPickerContainer>\n      ) : null,\n    [datasourceId, isOriginalTimeColumn],\n  );\n\n  return datasourceId ? (\n    <span>\n      <Popover\n        overlayClassName=\"column-formatting-popover\"\n        trigger=\"click\"\n        content={overlayContent}\n        placement=\"bottomLeft\"\n        arrowPointAtCenter\n      >\n        <Icons.SettingOutlined\n          iconSize=\"m\"\n          iconColor={theme.colors.grayscale.light1}\n          css={{ marginRight: `${theme.gridUnit}px` }}\n          onClick={e => e.stopPropagation()}\n        />\n      </Popover>\n      {columnName}\n    </span>\n  ) : (\n    <span>{columnName}</span>\n  );\n};\n\nexport const useFilteredTableData = (\n  filterText: string,\n  data?: Record<string, any>[],\n) => {\n  const rowsAsStrings = useMemo(\n    () =>\n      data?.map((row: Record<string, any>) =>\n        Object.values(row).map(value =>\n          value ? value.toString().toLowerCase() : t('N/A'),\n        ),\n      ) ?? [],\n    [data],\n  );\n\n  return useMemo(() => {\n    if (!data?.length) {\n      return [];\n    }\n    return data.filter((_, index: number) =>\n      rowsAsStrings[index].some(\n        value => value?.includes(filterText.toLowerCase()),\n      ),\n    );\n  }, [data, filterText, rowsAsStrings]);\n};\n\nconst timeFormatter = getTimeFormatter(TimeFormats.DATABASE_DATETIME);\n\nexport const useTableColumns = (\n  colnames?: string[],\n  coltypes?: GenericDataType[],\n  data?: Record<string, any>[],\n  datasourceId?: string,\n  isVisible?: boolean,\n  moreConfigs?: { [key: string]: Partial<Column> },\n  allowHTML?: boolean,\n) => {\n  const [originalFormattedTimeColumns, setOriginalFormattedTimeColumns] =\n    useState<string[]>(getTimeColumns(datasourceId));\n\n  const onTimeColumnChange = (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => {\n    if (!datasourceId) {\n      return;\n    }\n    if (\n      columnType === FormatPickerValue.Original &&\n      !originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.push(columnName);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    } else if (\n      columnType === FormatPickerValue.Formatted &&\n      originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.splice(cols.indexOf(columnName), 1);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    }\n  };\n\n  useEffect(() => {\n    if (isVisible) {\n      setOriginalFormattedTimeColumns(getTimeColumns(datasourceId));\n    }\n  }, [datasourceId, isVisible]);\n\n  return useMemo(\n    () =>\n      colnames && data?.length\n        ? colnames\n            .filter((column: string) => Object.keys(data[0]).includes(column))\n            .map((key, index) => {\n              const colType = coltypes?.[index];\n              const firstValue = data[0][key];\n              const originalFormattedTimeColumnIndex =\n                colType === GenericDataType.Temporal\n                  ? originalFormattedTimeColumns.indexOf(key)\n                  : -1;\n              const isOriginalTimeColumn =\n                originalFormattedTimeColumns.includes(key);\n              return {\n                // react-table requires a non-empty id, therefore we introduce a fallback value in case the key is empty\n                id: key || index,\n                accessor: row => row[key],\n                Header:\n                  colType === GenericDataType.Temporal &&\n                  typeof firstValue !== 'string' ? (\n                    <DataTableTemporalHeaderCell\n                      columnName={key}\n                      datasourceId={datasourceId}\n                      onTimeColumnChange={onTimeColumnChange}\n                      isOriginalTimeColumn={isOriginalTimeColumn}\n                    />\n                  ) : (\n                    key\n                  ),\n                Cell: ({ value }) => {\n                  if (value === true) {\n                    return BOOL_TRUE_DISPLAY;\n                  }\n                  if (value === false) {\n                    return BOOL_FALSE_DISPLAY;\n                  }\n                  if (value === null) {\n                    return <CellNull>{NULL_DISPLAY}</CellNull>;\n                  }\n                  if (\n                    colType === GenericDataType.Temporal &&\n                    originalFormattedTimeColumnIndex === -1 &&\n                    typeof value === 'number'\n                  ) {\n                    return timeFormatter(value);\n                  }\n                  if (typeof value === 'string' && allowHTML) {\n                    return safeHtmlSpan(value);\n                  }\n                  return String(value);\n                },\n                ...moreConfigs?.[key],\n              } as Column;\n            })\n        : [],\n    [\n      colnames,\n      data,\n      coltypes,\n      datasourceId,\n      moreConfigs,\n      originalFormattedTimeColumns,\n    ],\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ensureIsArray } from '@superset-ui/core';\nimport {\n  LocalStorageKeys,\n  setItem,\n  getItem,\n} from 'src/utils/localStorageHelpers';\n\nexport const getTimeColumns = (datasourceId?: string): string[] => {\n  const colsMap = getItem(\n    LocalStorageKeys.ExploreDataTableOriginalFormattedTimeColumns,\n    {},\n  );\n  if (datasourceId === undefined) {\n    return [];\n  }\n  return ensureIsArray(colsMap[datasourceId]);\n};\n\nexport const setTimeColumns = (datasourceId: string, columns: string[]) => {\n  const colsMap = getItem(\n    LocalStorageKeys.ExploreDataTableOriginalFormattedTimeColumns,\n    {},\n  );\n  setItem(LocalStorageKeys.ExploreDataTableOriginalFormattedTimeColumns, {\n    ...colsMap,\n    [datasourceId]: columns,\n  });\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useMemo } from 'react';\nimport { zip } from 'lodash';\nimport { css, GenericDataType, styled } from '@superset-ui/core';\nimport {\n  CopyToClipboardButton,\n  FilterInput,\n} from 'src/explore/components/DataTableControl';\nimport { applyFormattingToTabularData } from 'src/utils/common';\nimport { getTimeColumns } from 'src/explore/components/DataTableControl/utils';\nimport RowCountLabel from 'src/explore/components/RowCountLabel';\nimport { TableControlsProps } from '../types';\n\nexport const TableControlsWrapper = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: ${theme.gridUnit * 2}px;\n\n    span {\n      flex-shrink: 0;\n    }\n  `}\n`;\n\nexport const TableControls = ({\n  data,\n  datasourceId,\n  onInputChange,\n  columnNames,\n  columnTypes,\n  rowcount,\n  isLoading,\n  canDownload,\n}: TableControlsProps) => {\n  const originalTimeColumns = getTimeColumns(datasourceId);\n  const formattedTimeColumns = zip<string, GenericDataType>(\n    columnNames,\n    columnTypes,\n  )\n    .filter(\n      ([name, type]) =>\n        type === GenericDataType.Temporal &&\n        name &&\n        !originalTimeColumns.includes(name),\n    )\n    .map(([colname]) => colname);\n  const formattedData = useMemo(\n    () => applyFormattingToTabularData(data, formattedTimeColumns),\n    [data, formattedTimeColumns],\n  );\n  return (\n    <TableControlsWrapper>\n      <FilterInput onChangeHandler={onInputChange} shouldFocus />\n      <div\n        css={css`\n          display: flex;\n          align-items: center;\n        `}\n      >\n        <RowCountLabel rowcount={rowcount} loading={isLoading} />\n        {canDownload && (\n          <CopyToClipboardButton data={formattedData} columns={columnNames} />\n        )}\n      </div>\n    </TableControlsWrapper>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useState } from 'react';\nimport { t } from '@superset-ui/core';\nimport TableView, { EmptyWrapperType } from 'src/components/TableView';\nimport {\n  useFilteredTableData,\n  useTableColumns,\n} from 'src/explore/components/DataTableControl';\nimport { TableControls } from './DataTableControls';\nimport { SingleQueryResultPaneProp } from '../types';\n\nexport const SingleQueryResultPane = ({\n  data,\n  colnames,\n  coltypes,\n  rowcount,\n  datasourceId,\n  dataSize = 50,\n  isVisible,\n  canDownload,\n}: SingleQueryResultPaneProp) => {\n  const [filterText, setFilterText] = useState('');\n\n  // this is to preserve the order of the columns, even if there are integer values,\n  // while also only grabbing the first column's keys\n  const columns = useTableColumns(\n    colnames,\n    coltypes,\n    data,\n    datasourceId,\n    isVisible,\n    {}, // moreConfig\n    true, // allowHTML\n  );\n  const filteredData = useFilteredTableData(filterText, data);\n\n  return (\n    <>\n      <TableControls\n        data={filteredData}\n        columnNames={colnames}\n        columnTypes={coltypes}\n        rowcount={rowcount}\n        datasourceId={datasourceId}\n        onInputChange={input => setFilterText(input)}\n        isLoading={false}\n        canDownload={canDownload}\n      />\n      <TableView\n        columns={columns}\n        data={filteredData}\n        pageSize={dataSize}\n        noDataText={t('No results')}\n        emptyWrapperType={EmptyWrapperType.Small}\n        className=\"table-condensed\"\n        isPaginationSticky\n        showRowCount={false}\n        small\n      />\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactElement } from 'react';\nimport {\n  Datasource,\n  GenericDataType,\n  JsonObject,\n  QueryFormData,\n} from '@superset-ui/core';\nimport { ExploreActions } from 'src/explore/actions/exploreActions';\nimport { ChartStatus } from 'src/explore/types';\n\nexport enum ResultTypes {\n  Results = 'results',\n  Samples = 'samples',\n}\n\nexport interface DataTablesPaneProps {\n  queryFormData: QueryFormData;\n  datasource: Datasource;\n  queryForce: boolean;\n  ownState?: JsonObject;\n  chartStatus: ChartStatus;\n  onCollapseChange: (isOpen: boolean) => void;\n  errorMessage?: JSX.Element;\n  actions: ExploreActions;\n  canDownload: boolean;\n}\n\nexport interface ResultsPaneProps {\n  isRequest: boolean;\n  queryFormData: QueryFormData;\n  queryForce: boolean;\n  ownState?: JsonObject;\n  errorMessage?: ReactElement;\n  actions?: ExploreActions;\n  dataSize?: number;\n  // reload OriginalFormattedTimeColumns from localStorage when isVisible is true\n  isVisible: boolean;\n  canDownload: boolean;\n}\n\nexport interface SamplesPaneProps {\n  isRequest: boolean;\n  datasource: Datasource;\n  queryForce: boolean;\n  actions?: ExploreActions;\n  dataSize?: number;\n  // reload OriginalFormattedTimeColumns from localStorage when isVisible is true\n  isVisible: boolean;\n  canDownload: boolean;\n}\n\nexport interface TableControlsProps {\n  data: Record<string, any>[];\n  // {datasource.id}__{datasource.type}, eg: 1__table\n  datasourceId: string;\n  onInputChange: (input: string) => void;\n  columnNames: string[];\n  columnTypes: GenericDataType[];\n  isLoading: boolean;\n  rowcount: number;\n  canDownload: boolean;\n}\n\nexport interface QueryResultInterface {\n  colnames: string[];\n  coltypes: GenericDataType[];\n  rowcount: number;\n  data: Record<string, any>[][];\n}\n\nexport interface SingleQueryResultPaneProp extends QueryResultInterface {\n  // {datasource.id}__{datasource.type}, eg: 1__table\n  datasourceId: string;\n  dataSize?: number;\n  // reload OriginalFormattedTimeColumns from localStorage when isVisible is true\n  isVisible: boolean;\n  canDownload: boolean;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useState, useEffect, ReactElement } from 'react';\n\nimport {\n  ensureIsArray,\n  styled,\n  t,\n  getChartMetadataRegistry,\n  getClientErrorObject,\n} from '@superset-ui/core';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateMedium } from 'src/components/EmptyState';\nimport { getChartDataRequest } from 'src/components/Chart/chartAction';\nimport { ResultsPaneProps, QueryResultInterface } from '../types';\nimport { SingleQueryResultPane } from './SingleQueryResultPane';\nimport { TableControls } from './DataTableControls';\n\nconst Error = styled.pre`\n  margin-top: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst cache = new WeakMap();\n\nexport const useResultsPane = ({\n  isRequest,\n  queryFormData,\n  queryForce,\n  ownState,\n  errorMessage,\n  actions,\n  isVisible,\n  dataSize = 50,\n  canDownload,\n}: ResultsPaneProps): ReactElement[] => {\n  const metadata = getChartMetadataRegistry().get(\n    queryFormData?.viz_type || queryFormData?.vizType,\n  );\n\n  const [resultResp, setResultResp] = useState<QueryResultInterface[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [responseError, setResponseError] = useState<string>('');\n  const queryCount = metadata?.queryObjectCount ?? 1;\n\n  useEffect(() => {\n    // it's an invalid formData when gets a errorMessage\n    if (errorMessage) return;\n    if (isRequest && cache.has(queryFormData)) {\n      setResultResp(ensureIsArray(cache.get(queryFormData)));\n      setResponseError('');\n      if (queryForce && actions) {\n        actions.setForceQuery(false);\n      }\n      setIsLoading(false);\n    }\n    if (isRequest && !cache.has(queryFormData)) {\n      setIsLoading(true);\n      getChartDataRequest({\n        formData: queryFormData,\n        force: queryForce,\n        resultFormat: 'json',\n        resultType: 'results',\n        ownState,\n      })\n        .then(({ json }) => {\n          setResultResp(ensureIsArray(json.result));\n          setResponseError('');\n          cache.set(queryFormData, json.result);\n          if (queryForce && actions) {\n            actions.setForceQuery(false);\n          }\n        })\n        .catch(response => {\n          getClientErrorObject(response).then(({ error, message }) => {\n            setResponseError(error || message || t('Sorry, an error occurred'));\n          });\n        })\n        .finally(() => {\n          setIsLoading(false);\n        });\n    }\n  }, [queryFormData, isRequest]);\n\n  useEffect(() => {\n    if (errorMessage) {\n      setIsLoading(false);\n    }\n  }, [errorMessage]);\n\n  if (isLoading) {\n    return Array(queryCount).fill(<Loading />);\n  }\n\n  if (errorMessage) {\n    const title = t('Run a query to display results');\n    return Array(queryCount).fill(\n      <EmptyStateMedium image=\"document.svg\" title={title} />,\n    );\n  }\n\n  if (responseError) {\n    const err = (\n      <>\n        <TableControls\n          data={[]}\n          columnNames={[]}\n          columnTypes={[]}\n          rowcount={0}\n          datasourceId={queryFormData.datasource}\n          onInputChange={() => {}}\n          isLoading={false}\n          canDownload={canDownload}\n        />\n        <Error>{responseError}</Error>\n      </>\n    );\n    return Array(queryCount).fill(err);\n  }\n\n  if (resultResp.length === 0) {\n    const title = t('No results were returned for this query');\n    return Array(queryCount).fill(\n      <EmptyStateMedium image=\"document.svg\" title={title} />,\n    );\n  }\n  return resultResp\n    .slice(0, queryCount)\n    .map((result, idx) => (\n      <SingleQueryResultPane\n        data={result.data}\n        colnames={result.colnames}\n        coltypes={result.coltypes}\n        rowcount={result.rowcount}\n        dataSize={dataSize}\n        datasourceId={queryFormData.datasource}\n        key={idx}\n        isVisible={isVisible}\n        canDownload={canDownload}\n      />\n    ));\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, styled } from '@superset-ui/core';\nimport Tabs from 'src/components/Tabs';\nimport { ResultTypes, ResultsPaneProps } from '../types';\nimport { useResultsPane } from './useResultsPane';\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n\n  .ant-tabs {\n    height: 100%;\n  }\n\n  .ant-tabs-content {\n    height: 100%;\n  }\n\n  .ant-tabs-tabpane {\n    display: flex;\n    flex-direction: column;\n  }\n\n  .table-condensed {\n    overflow: auto;\n  }\n`;\n\nexport const ResultsPaneOnDashboard = ({\n  isRequest,\n  queryFormData,\n  queryForce,\n  ownState,\n  errorMessage,\n  actions,\n  isVisible,\n  dataSize = 50,\n  canDownload,\n}: ResultsPaneProps) => {\n  const resultsPanes = useResultsPane({\n    errorMessage,\n    queryFormData,\n    queryForce,\n    ownState,\n    isRequest,\n    actions,\n    dataSize,\n    isVisible,\n    canDownload,\n  });\n\n  if (resultsPanes.length === 1) {\n    return <Wrapper>{resultsPanes[0]}</Wrapper>;\n  }\n\n  const panes = resultsPanes.map((pane, idx) => {\n    if (idx === 0) {\n      return (\n        <Tabs.TabPane tab={t('Results')} key={ResultTypes.Results}>\n          {pane}\n        </Tabs.TabPane>\n      );\n    }\n\n    return (\n      <Tabs.TabPane\n        tab={t('Results %s', idx + 1)}\n        key={`${ResultTypes.Results} ${idx + 1}`}\n      >\n        {pane}\n      </Tabs.TabPane>\n    );\n  });\n\n  return (\n    <Wrapper>\n      <Tabs fullWidth={false}>{panes}</Tabs>\n    </Wrapper>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useState, useEffect, useMemo } from 'react';\nimport { ensureIsArray, GenericDataType, styled, t } from '@superset-ui/core';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateMedium } from 'src/components/EmptyState';\nimport TableView, { EmptyWrapperType } from 'src/components/TableView';\nimport {\n  useFilteredTableData,\n  useTableColumns,\n} from 'src/explore/components/DataTableControl';\nimport { getDatasourceSamples } from 'src/components/Chart/chartAction';\nimport { TableControls } from './DataTableControls';\nimport { SamplesPaneProps } from '../types';\n\nconst Error = styled.pre`\n  margin-top: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst cache = new WeakSet();\n\nexport const SamplesPane = ({\n  isRequest,\n  datasource,\n  queryForce,\n  actions,\n  dataSize = 50,\n  isVisible,\n  canDownload,\n}: SamplesPaneProps) => {\n  const [filterText, setFilterText] = useState('');\n  const [data, setData] = useState<Record<string, any>[][]>([]);\n  const [colnames, setColnames] = useState<string[]>([]);\n  const [coltypes, setColtypes] = useState<GenericDataType[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [rowcount, setRowCount] = useState<number>(0);\n  const [responseError, setResponseError] = useState<string>('');\n  const datasourceId = useMemo(\n    () => `${datasource.id}__${datasource.type}`,\n    [datasource],\n  );\n\n  useEffect(() => {\n    if (isRequest && queryForce) {\n      cache.delete(datasource);\n    }\n\n    if (isRequest && !cache.has(datasource)) {\n      setIsLoading(true);\n      getDatasourceSamples(datasource.type, datasource.id, queryForce, {})\n        .then(response => {\n          setData(ensureIsArray(response.data));\n          setColnames(ensureIsArray(response.colnames));\n          setColtypes(ensureIsArray(response.coltypes));\n          setRowCount(response.rowcount);\n          setResponseError('');\n          cache.add(datasource);\n          if (queryForce && actions) {\n            actions.setForceQuery(false);\n          }\n        })\n        .catch(error => {\n          setData([]);\n          setColnames([]);\n          setColtypes([]);\n          setResponseError(`${error.name}: ${error.message}`);\n        })\n        .finally(() => {\n          setIsLoading(false);\n        });\n    }\n  }, [datasource, isRequest, queryForce]);\n\n  // this is to preserve the order of the columns, even if there are integer values,\n  // while also only grabbing the first column's keys\n  const columns = useTableColumns(\n    colnames,\n    coltypes,\n    data,\n    datasourceId,\n    isVisible,\n    {}, // moreConfig\n    true, // allowHTML\n  );\n  const filteredData = useFilteredTableData(filterText, data);\n\n  if (isLoading) {\n    return <Loading />;\n  }\n\n  if (responseError) {\n    return (\n      <>\n        <TableControls\n          data={filteredData}\n          columnNames={colnames}\n          columnTypes={coltypes}\n          rowcount={rowcount}\n          datasourceId={datasourceId}\n          onInputChange={input => setFilterText(input)}\n          isLoading={isLoading}\n          canDownload={canDownload}\n        />\n        <Error>{responseError}</Error>\n      </>\n    );\n  }\n\n  if (data.length === 0) {\n    const title = t('No samples were returned for this dataset');\n    return <EmptyStateMedium image=\"document.svg\" title={title} />;\n  }\n\n  return (\n    <>\n      <TableControls\n        data={filteredData}\n        columnNames={colnames}\n        columnTypes={coltypes}\n        rowcount={rowcount}\n        datasourceId={datasourceId}\n        onInputChange={input => setFilterText(input)}\n        isLoading={isLoading}\n        canDownload={canDownload}\n      />\n      <TableView\n        columns={columns}\n        data={filteredData}\n        pageSize={dataSize}\n        noDataText={t('No results')}\n        emptyWrapperType={EmptyWrapperType.Small}\n        className=\"table-condensed\"\n        isPaginationSticky\n        showRowCount={false}\n        small\n      />\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useEffect, useMemo, useState, MouseEvent } from 'react';\nimport {\n  isFeatureEnabled,\n  FeatureFlag,\n  styled,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport Tabs from 'src/components/Tabs';\nimport {\n  getItem,\n  setItem,\n  LocalStorageKeys,\n} from 'src/utils/localStorageHelpers';\nimport {\n  SamplesPane,\n  TableControlsWrapper,\n  useResultsPane,\n} from './components';\nimport { DataTablesPaneProps, ResultTypes } from './types';\n\nconst SouthPane = styled.div`\n  ${({ theme }) => `\n    position: relative;\n    background-color: ${theme.colors.grayscale.light5};\n    z-index: 5;\n    overflow: hidden;\n\n    .ant-tabs {\n      height: 100%;\n    }\n\n    .ant-tabs-content-holder {\n      height: 100%;\n    }\n\n    .ant-tabs-content {\n      height: 100%;\n    }\n\n    .ant-tabs-tabpane {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      .table-condensed {\n        height: 100%;\n        overflow: auto;\n        margin-bottom: ${theme.gridUnit * 4}px;\n\n        .table {\n          margin-bottom: ${theme.gridUnit * 2}px;\n        }\n      }\n\n      .pagination-container > ul[role='navigation'] {\n        margin-top: 0;\n      }\n    }\n  `}\n`;\n\nexport const DataTablesPane = ({\n  queryFormData,\n  datasource,\n  queryForce,\n  onCollapseChange,\n  chartStatus,\n  ownState,\n  errorMessage,\n  actions,\n  canDownload,\n}: DataTablesPaneProps) => {\n  const theme = useTheme();\n  const [activeTabKey, setActiveTabKey] = useState<string>(ResultTypes.Results);\n  const [isRequest, setIsRequest] = useState<Record<ResultTypes, boolean>>({\n    results: false,\n    samples: false,\n  });\n  const [panelOpen, setPanelOpen] = useState(\n    isFeatureEnabled(FeatureFlag.DatapanelClosedByDefault)\n      ? false\n      : getItem(LocalStorageKeys.IsDatapanelOpen, false),\n  );\n\n  useEffect(() => {\n    if (!isFeatureEnabled(FeatureFlag.DatapanelClosedByDefault))\n      setItem(LocalStorageKeys.IsDatapanelOpen, panelOpen);\n  }, [panelOpen]);\n\n  useEffect(() => {\n    if (!panelOpen) {\n      setIsRequest({\n        results: false,\n        samples: false,\n      });\n    }\n\n    if (\n      panelOpen &&\n      activeTabKey.startsWith(ResultTypes.Results) &&\n      chartStatus &&\n      chartStatus !== 'loading'\n    ) {\n      setIsRequest({\n        results: true,\n        samples: false,\n      });\n    }\n\n    if (panelOpen && activeTabKey === ResultTypes.Samples) {\n      setIsRequest({\n        results: false,\n        samples: true,\n      });\n    }\n  }, [panelOpen, activeTabKey, chartStatus]);\n\n  const handleCollapseChange = useCallback(\n    (isOpen: boolean) => {\n      onCollapseChange(isOpen);\n      setPanelOpen(isOpen);\n    },\n    [onCollapseChange],\n  );\n\n  const handleTabClick = useCallback(\n    (tabKey: string, e: MouseEvent) => {\n      if (!panelOpen) {\n        handleCollapseChange(true);\n      } else if (tabKey === activeTabKey) {\n        e.preventDefault();\n        handleCollapseChange(false);\n      }\n      setActiveTabKey(tabKey);\n    },\n    [activeTabKey, handleCollapseChange, panelOpen],\n  );\n\n  const CollapseButton = useMemo(() => {\n    const caretIcon = panelOpen ? (\n      <Icons.CaretUp\n        iconColor={theme.colors.grayscale.base}\n        aria-label={t('Collapse data panel')}\n      />\n    ) : (\n      <Icons.CaretDown\n        iconColor={theme.colors.grayscale.base}\n        aria-label={t('Expand data panel')}\n      />\n    );\n    return (\n      <TableControlsWrapper>\n        {panelOpen ? (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={() => handleCollapseChange(false)}\n          >\n            {caretIcon}\n          </span>\n        ) : (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={() => handleCollapseChange(true)}\n          >\n            {caretIcon}\n          </span>\n        )}\n      </TableControlsWrapper>\n    );\n  }, [handleCollapseChange, panelOpen, theme.colors.grayscale.base]);\n\n  const queryResultsPanes = useResultsPane({\n    errorMessage,\n    queryFormData,\n    queryForce,\n    ownState,\n    isRequest: isRequest.results,\n    actions,\n    isVisible: ResultTypes.Results === activeTabKey,\n    canDownload,\n  }).map((pane, idx) => {\n    if (idx === 0) {\n      return (\n        <Tabs.TabPane tab={t('Results')} key={ResultTypes.Results}>\n          {pane}\n        </Tabs.TabPane>\n      );\n    }\n    if (idx > 0) {\n      return (\n        <Tabs.TabPane\n          tab={t('Results %s', idx + 1)}\n          key={`${ResultTypes.Results} ${idx + 1}`}\n        >\n          {pane}\n        </Tabs.TabPane>\n      );\n    }\n    return null;\n  });\n\n  return (\n    <SouthPane data-test=\"some-purposeful-instance\">\n      <Tabs\n        fullWidth={false}\n        tabBarExtraContent={CollapseButton}\n        activeKey={panelOpen ? activeTabKey : ''}\n        onTabClick={handleTabClick}\n      >\n        {queryResultsPanes}\n        <Tabs.TabPane tab={t('Samples')} key={ResultTypes.Samples}>\n          <SamplesPane\n            datasource={datasource}\n            queryForce={queryForce}\n            isRequest={isRequest.samples}\n            actions={actions}\n            isVisible={ResultTypes.Samples === activeTabKey}\n            canDownload={canDownload}\n          />\n        </Tabs.TabPane>\n      </Tabs>\n    </SouthPane>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * All possible draggable items for the chart controls.\n */\nexport enum DndItemType {\n  // an existing column in table\n  Column = 'column',\n  // a selected column option in ColumnSelectControl\n  ColumnOption = 'columnOption',\n  // an adhoc column option in ColumnSelectControl\n  AdhocColumnOption = 'adhocColumn',\n\n  // a saved metric\n  Metric = 'metric',\n  // a selected saved metric in MetricsControl\n  MetricOption = 'metricOption',\n  // an adhoc metric option in MetricsControl\n  AdhocMetricOption = 'adhocMetric',\n\n  // an adhoc filter option\n  FilterOption = 'filterOption',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\n\nexport const ExplorePopoverContent = styled.div`\n  .edit-popover-resize {\n    transform: scaleX(-1);\n    float: right;\n    margin-top: ${({ theme }) => theme.gridUnit * 4}px;\n    margin-right: ${({ theme }) => theme.gridUnit * -2}px;\n    cursor: nwse-resize;\n  }\n  .filter-sql-editor {\n    border: ${({ theme }) => theme.colors.grayscale.light2} solid thin;\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getNumberFormatter, t, tn } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\n\ntype RowCountLabelProps = {\n  rowcount?: number;\n  limit?: number;\n  loading?: boolean;\n};\n\nconst limitReachedMsg = t(\n  'The row limit set for the chart was reached. The chart may show partial data.',\n);\n\nexport default function RowCountLabel(props: RowCountLabelProps) {\n  const { rowcount = 0, limit = null, loading } = props;\n  const limitReached = limit && rowcount >= limit;\n  const type =\n    limitReached || (rowcount === 0 && !loading) ? 'danger' : 'default';\n  const formattedRowCount = getNumberFormatter()(rowcount);\n  const label = (\n    <Label type={type}>\n      {loading ? (\n        t('Loading...')\n      ) : (\n        <span data-test=\"row-count-label\">\n          {tn('%s row', '%s rows', rowcount, formattedRowCount)}\n        </span>\n      )}\n    </Label>\n  );\n  return limitReached ? (\n    <Tooltip id=\"tt-rowcount-tooltip\" title={<span>{limitReachedMsg}</span>}>\n      {label}\n    </Tooltip>\n  ) : (\n    label\n  );\n}\n\nexport type { RowCountLabelProps };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { css, SupersetTheme } from '@superset-ui/core';\nimport { useRef, useState } from 'react';\nimport { Tooltip } from 'src/components/Tooltip';\n\ntype ColorSchemeLabelProps = {\n  colors: string[];\n  id: string;\n  label: string;\n};\n\nexport default function ColorSchemeLabel(props: ColorSchemeLabelProps) {\n  const { id, label, colors } = props;\n  const [showTooltip, setShowTooltip] = useState<boolean>(false);\n  const labelNameRef = useRef<HTMLElement>(null);\n  const labelsColorRef = useRef<HTMLElement>(null);\n  const handleShowTooltip = () => {\n    const labelNameElement = labelNameRef.current;\n    const labelsColorElement = labelsColorRef.current;\n    if (\n      labelNameElement &&\n      labelsColorElement &&\n      (labelNameElement.scrollWidth > labelNameElement.offsetWidth ||\n        labelNameElement.scrollHeight > labelNameElement.offsetHeight ||\n        labelsColorElement.scrollWidth > labelsColorElement.offsetWidth ||\n        labelsColorElement.scrollHeight > labelsColorElement.offsetHeight)\n    ) {\n      setShowTooltip(true);\n    }\n  };\n  const handleHideTooltip = () => {\n    setShowTooltip(false);\n  };\n\n  const colorsList = () =>\n    colors.map((color: string, i: number) => (\n      <span\n        data-test=\"color\"\n        key={`${id}-${i}`}\n        css={(theme: { gridUnit: number }) => css`\n          padding-left: ${theme.gridUnit / 2}px;\n          :before {\n            content: '';\n            display: inline-block;\n            background-color: ${color};\n            border: 1px solid ${color === 'white' ? 'black' : color};\n            width: 9px;\n            height: 10px;\n          }\n        `}\n      />\n    ));\n\n  const tooltipContent = () => (\n    <>\n      <span>{label}</span>\n      <div>{colorsList()}</div>\n    </>\n  );\n\n  return (\n    <Tooltip\n      data-testid=\"tooltip\"\n      overlayClassName=\"color-scheme-tooltip\"\n      title={tooltipContent}\n      key={id}\n      visible={showTooltip}\n    >\n      <span\n        className=\"color-scheme-option\"\n        onMouseEnter={handleShowTooltip}\n        onMouseLeave={handleHideTooltip}\n        css={css`\n          display: flex;\n          align-items: center;\n          justify-content: flex-start;\n        `}\n        data-test={id}\n      >\n        <span\n          className=\"color-scheme-label\"\n          ref={labelNameRef}\n          css={(theme: SupersetTheme) => css`\n            min-width: 125px;\n            padding-right: ${theme.gridUnit * 2}px;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            white-space: nowrap;\n          `}\n        >\n          {label}\n        </span>\n        <span\n          ref={labelsColorRef}\n          css={(theme: SupersetTheme) => css`\n            flex: 100%;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            white-space: nowrap;\n            padding-right: ${theme.gridUnit}px;\n          `}\n        >\n          {colorsList()}\n        </span>\n      </span>\n    </Tooltip>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useMemo, ReactNode } from 'react';\n\nimport {\n  css,\n  ColorScheme,\n  ColorSchemeGroup,\n  SequentialScheme,\n  styled,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport AntdSelect from 'antd/lib/select';\nimport { isFunction, sortBy } from 'lodash';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { SelectOptionsType } from 'src/components/Select/types';\nimport { StyledSelect } from 'src/components/Select/styles';\nimport { handleFilterOptionHelper } from 'src/components/Select/utils';\nimport ColorSchemeLabel from './ColorSchemeLabel';\n\nconst { Option, OptGroup } = AntdSelect;\n\nexport type OptionData = SelectOptionsType[number]['options'][number];\n\nexport interface ColorSchemes {\n  [key: string]: ColorScheme;\n}\n\nexport interface ColorSchemeControlProps {\n  hasCustomLabelsColor: boolean;\n  dashboardId?: number;\n  label: string;\n  name: string;\n  onChange?: (value: string) => void;\n  value: string;\n  clearable: boolean;\n  defaultScheme?: string;\n  choices: string[][] | (() => string[][]);\n  schemes: ColorSchemes | (() => ColorSchemes);\n  isLinear: boolean;\n}\n\nconst StyledAlert = styled(Icons.AlertSolid)`\n  color: ${({ theme }) => theme.colors.alert.base};\n`;\n\nconst CUSTOM_LABEL_ALERT = t(\n  `This color scheme is being overridden by custom label colors.\n    Check the JSON metadata in the Advanced settings`,\n);\n\nconst DASHBOARD_ALERT = t(\n  `The color scheme is determined by the related dashboard.\n        Edit the color scheme in the dashboard properties.`,\n);\n\nconst Label = ({\n  label,\n  hasCustomLabelsColor,\n  dashboardId,\n}: Pick<\n  ColorSchemeControlProps,\n  'label' | 'hasCustomLabelsColor' | 'dashboardId'\n>) => {\n  if (hasCustomLabelsColor || dashboardId) {\n    const alertTitle = hasCustomLabelsColor\n      ? CUSTOM_LABEL_ALERT\n      : DASHBOARD_ALERT;\n    return (\n      <>\n        {label}{' '}\n        <Tooltip title={alertTitle}>\n          <StyledAlert iconSize=\"s\" />\n        </Tooltip>\n      </>\n    );\n  }\n  return <>{label}</>;\n};\n\nconst ColorSchemeControl = ({\n  hasCustomLabelsColor = false,\n  dashboardId,\n  label = t('Color scheme'),\n  onChange = () => {},\n  value,\n  clearable = false,\n  defaultScheme,\n  choices = [],\n  schemes = {},\n  isLinear,\n  ...rest\n}: ColorSchemeControlProps) => {\n  const theme = useTheme();\n  const currentScheme = useMemo(() => {\n    if (dashboardId) {\n      return 'dashboard';\n    }\n    let result = value || defaultScheme;\n    if (result === 'SUPERSET_DEFAULT') {\n      const schemesObject = isFunction(schemes) ? schemes() : schemes;\n      result = schemesObject?.SUPERSET_DEFAULT?.id;\n    }\n    return result;\n  }, [dashboardId, defaultScheme, schemes, value]);\n\n  const options = useMemo(() => {\n    if (dashboardId) {\n      return [\n        <Option value=\"dashboard\" label={t('dashboard')} key=\"dashboard\">\n          <Tooltip title={DASHBOARD_ALERT}>{t('Dashboard scheme')}</Tooltip>\n        </Option>,\n      ];\n    }\n    const schemesObject = isFunction(schemes) ? schemes() : schemes;\n    const controlChoices = isFunction(choices) ? choices() : choices;\n    const allColorOptions: string[] = [];\n    const filteredColorOptions = controlChoices.filter(o => {\n      const option = o[0];\n      const isValidColorOption =\n        option !== 'SUPERSET_DEFAULT' && !allColorOptions.includes(option);\n      allColorOptions.push(option);\n      return isValidColorOption;\n    });\n\n    const groups = filteredColorOptions.reduce(\n      (acc, [value]) => {\n        const currentScheme = schemesObject[value];\n\n        // For categorical scheme, display all the colors\n        // For sequential scheme, show 10 or interpolate to 10.\n        // Sequential schemes usually have at most 10 colors.\n        let colors: string[] = [];\n        if (currentScheme) {\n          colors = isLinear\n            ? (currentScheme as SequentialScheme).getColors(10)\n            : currentScheme.colors;\n        }\n        const option = {\n          customLabel: (\n            <ColorSchemeLabel\n              id={currentScheme.id}\n              label={currentScheme.label}\n              colors={colors}\n            />\n          ) as ReactNode,\n          label: schemesObject?.[value]?.label || value,\n          value,\n        };\n        acc[currentScheme.group ?? ColorSchemeGroup.Other].options.push(option);\n        return acc;\n      },\n      {\n        [ColorSchemeGroup.Custom]: {\n          title: ColorSchemeGroup.Custom,\n          label: t('Custom color palettes'),\n          options: [] as OptionData,\n        },\n        [ColorSchemeGroup.Featured]: {\n          title: ColorSchemeGroup.Featured,\n          label: t('Featured color palettes'),\n          options: [] as OptionData,\n        },\n        [ColorSchemeGroup.Other]: {\n          title: ColorSchemeGroup.Other,\n          label: t('Other color palettes'),\n          options: [] as OptionData,\n        },\n      },\n    );\n    const nonEmptyGroups = Object.values(groups)\n      .filter(group => group.options.length > 0)\n      .map(group => ({\n        ...group,\n        options: sortBy(group.options, opt => opt.label),\n      }));\n\n    // if there are no featured or custom color schemes, return the ungrouped options\n    if (\n      nonEmptyGroups.length === 1 &&\n      nonEmptyGroups[0].title === ColorSchemeGroup.Other\n    ) {\n      return nonEmptyGroups[0].options.map((opt, index) => (\n        <Option value={opt.value} label={opt.label} key={index}>\n          {opt.customLabel}\n        </Option>\n      ));\n    }\n    return nonEmptyGroups.map((group, groupIndex) => (\n      <OptGroup label={group.label} key={groupIndex}>\n        {group.options.map((opt, optIndex) => (\n          <Option\n            value={opt.value}\n            label={opt.label}\n            key={`${groupIndex}-${optIndex}`}\n          >\n            {opt.customLabel}\n          </Option>\n        ))}\n      </OptGroup>\n    ));\n  }, [choices, dashboardId, isLinear, schemes]);\n\n  // We can't pass on change directly because it receives a second\n  // parameter and it would be interpreted as the error parameter\n  const handleOnChange = (value: string) => onChange(value);\n\n  return (\n    <>\n      <ControlHeader\n        {...rest}\n        label={\n          <Label\n            label={label}\n            hasCustomLabelsColor={hasCustomLabelsColor}\n            dashboardId={dashboardId}\n          />\n        }\n      />\n      <StyledSelect\n        css={css`\n          width: 100%;\n          & .ant-select-item.ant-select-item-group {\n            padding-left: ${theme.gridUnit}px;\n            font-size: ${theme.typography.sizes.m}px;\n          }\n          & .ant-select-item-option-grouped {\n            padding-left: ${theme.gridUnit * 3}px;\n          }\n        `}\n        aria-label={t('Select color scheme')}\n        allowClear={clearable}\n        disabled={!!dashboardId}\n        onChange={handleOnChange}\n        placeholder={t('Select scheme')}\n        value={currentScheme}\n        getPopupContainer={triggerNode => triggerNode.parentNode}\n        showSearch\n        filterOption={(search, option) =>\n          handleFilterOptionHelper(\n            search,\n            option as OptionData,\n            ['label', 'value'],\n            true,\n          )\n        }\n      >\n        {options}\n      </StyledSelect>\n    </>\n  );\n};\n\nexport default ColorSchemeControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useState } from 'react';\nimport { ensureIsArray, SupersetClient, t } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport rison from 'rison';\nimport { AdvancedDataTypesState, Props } from './index';\n\nconst INITIAL_ADVANCED_DATA_TYPES_STATE: AdvancedDataTypesState = {\n  parsedAdvancedDataType: '',\n  advancedDataTypeOperatorList: [],\n  errorMessage: '',\n};\n\nconst useAdvancedDataTypes = (validHandler: (isValid: boolean) => void) => {\n  const [advancedDataTypesState, setAdvancedDataTypesState] =\n    useState<AdvancedDataTypesState>(INITIAL_ADVANCED_DATA_TYPES_STATE);\n  const [subjectAdvancedDataType, setSubjectAdvancedDataType] = useState<\n    string | undefined\n  >();\n\n  const fetchAdvancedDataTypeValueCallback = useCallback(\n    (\n      comp: string | string[],\n      advancedDataTypesState: AdvancedDataTypesState,\n      subjectAdvancedDataType?: string,\n    ) => {\n      const values = ensureIsArray(comp);\n      if (!subjectAdvancedDataType) {\n        setAdvancedDataTypesState(INITIAL_ADVANCED_DATA_TYPES_STATE);\n        return;\n      }\n      debounce(() => {\n        const queryParams = rison.encode({\n          type: subjectAdvancedDataType,\n          values,\n        });\n        const endpoint = `/api/v1/advanced_data_type/convert?q=${queryParams}`;\n        SupersetClient.get({ endpoint })\n          .then(({ json }) => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: json.result.display_value,\n              advancedDataTypeOperatorList: json.result.valid_filter_operators,\n              errorMessage: json.result.error_message,\n            });\n            // Changed due to removal of status field\n            validHandler(!json.result.error_message);\n          })\n          .catch(() => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: '',\n              advancedDataTypeOperatorList:\n                advancedDataTypesState.advancedDataTypeOperatorList,\n              errorMessage: t('Failed to retrieve advanced type'),\n            });\n            validHandler(false);\n          });\n      }, 600)();\n    },\n    [validHandler],\n  );\n\n  const fetchSubjectAdvancedDataType = (props: Props) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option &&\n          option.column_name === props.adhocFilter.subject) ||\n        ('optionName' in option &&\n          option.optionName === props.adhocFilter.subject),\n    );\n    if (option && 'advanced_data_type' in option) {\n      setSubjectAdvancedDataType(option.advanced_data_type);\n    } else {\n      props.validHandler(true);\n    }\n  };\n\n  return {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    setAdvancedDataTypesState,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  };\n};\n\nexport default useAdvancedDataTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { FC, ChangeEvent, useEffect, useState } from 'react';\n\nimport FormItem from 'src/components/Form/FormItem';\nimport { Select } from 'src/components';\nimport {\n  isFeatureEnabled,\n  FeatureFlag,\n  isDefined,\n  styled,\n  SupersetClient,\n  SupersetTheme,\n  t,\n} from '@superset-ui/core';\nimport {\n  Operators,\n  OPERATORS_OPTIONS,\n  HAVING_OPERATORS,\n  MULTI_OPERATORS,\n  CUSTOM_OPERATORS,\n  DISABLE_INPUT_OPERATORS,\n  AGGREGATES,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Input } from 'src/components/Input';\nimport { optionLabel } from 'src/utils/common';\nimport {\n  ColumnMeta,\n  Dataset,\n  isTemporalColumn,\n} from '@superset-ui/chart-controls';\nimport useAdvancedDataTypes from './useAdvancedDataTypes';\nimport { useDatePickerInAdhocFilter } from '../utils';\nimport { useDefaultTimeFilter } from '../../DateFilterControl/utils';\nimport { Clauses, ExpressionTypes } from '../types';\n\nconst StyledInput = styled(Input)`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport const StyledFormItem = styled(FormItem)`\n  &.ant-row.ant-form-item {\n    margin: 0;\n  }\n`;\n\nconst SelectWithLabel = styled(Select)<{ labelText: string }>`\n  .ant-select-selector::after {\n    content: ${({ labelText }) => labelText || '\\\\A0'};\n    display: inline-block;\n    white-space: nowrap;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n    width: max-content;\n  }\n`;\n\nexport interface SimpleExpressionType {\n  expressionType: keyof typeof ExpressionTypes;\n  column: ColumnMeta;\n  aggregate: keyof typeof AGGREGATES;\n  label: string;\n}\nexport interface SQLExpressionType {\n  expressionType: keyof typeof ExpressionTypes;\n  sqlExpression: string;\n  label: string;\n}\n\nexport interface MetricColumnType {\n  saved_metric_name: string;\n}\n\nexport type ColumnType =\n  | ColumnMeta\n  | SimpleExpressionType\n  | SQLExpressionType\n  | MetricColumnType;\n\nexport interface Props {\n  adhocFilter: AdhocFilter;\n  onChange: (filter: AdhocFilter) => void;\n  options: ColumnType[];\n  datasource: Dataset;\n  partitionColumn: string;\n  operators?: Operators[];\n  validHandler: (isValid: boolean) => void;\n}\n\nexport interface AdvancedDataTypesState {\n  parsedAdvancedDataType: string;\n  advancedDataTypeOperatorList: string[];\n  errorMessage: string;\n}\n\nexport const useSimpleTabFilterProps = (props: Props) => {\n  const defaultTimeFilter = useDefaultTimeFilter();\n\n  const isOperatorRelevant = (operator: Operators, subject: string) => {\n    const column = props.datasource.columns?.find(\n      col => col.column_name === subject,\n    );\n    const isColumnBoolean =\n      !!column && (column.type === 'BOOL' || column.type === 'BOOLEAN');\n    const isColumnNumber =\n      !!column && (column.type === 'INT' || column.type === 'INTEGER');\n    const isColumnFunction = !!column && !!column.expression;\n\n    if (operator && operator === Operators.LatestPartition) {\n      const { partitionColumn } = props;\n      return partitionColumn && subject && subject === partitionColumn;\n    }\n    if (operator && operator === Operators.TemporalRange) {\n      // hide the TEMPORAL_RANGE operator\n      return false;\n    }\n    if (operator === Operators.IsTrue || operator === Operators.IsFalse) {\n      return isColumnBoolean || isColumnNumber || isColumnFunction;\n    }\n    if (isColumnBoolean) {\n      return operator === Operators.IsNull || operator === Operators.IsNotNull;\n    }\n    return (\n      props.adhocFilter.clause !== Clauses.Having ||\n      HAVING_OPERATORS.indexOf(operator) !== -1\n    );\n  };\n  const onSubjectChange = (id: string) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option && option.column_name === id) ||\n        ('optionName' in option && option.optionName === id),\n    );\n    let subject = '';\n    let clause;\n    // infer the new clause based on what subject was selected.\n    if (option && 'column_name' in option) {\n      subject = option.column_name;\n      clause = Clauses.Where;\n    } else if (option && 'saved_metric_name' in option) {\n      subject = option.saved_metric_name;\n      clause = Clauses.Having;\n    } else if (option?.label) {\n      subject = option.label;\n      clause = Clauses.Having;\n    }\n    let { operator, operatorId, comparator } = props.adhocFilter;\n    operator =\n      operator && operatorId && isOperatorRelevant(operatorId, subject)\n        ? OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation\n        : null;\n    if (!isDefined(operator)) {\n      // if operator is `null`, use the `IN` and reset the comparator.\n      operator = Operators.In;\n      operatorId = Operators.In;\n      comparator = undefined;\n    }\n\n    if (isTemporalColumn(id, props.datasource)) {\n      subject = id;\n      operator = Operators.TemporalRange;\n      operatorId = Operators.TemporalRange;\n      comparator = defaultTimeFilter;\n    }\n\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject,\n        clause,\n        operator,\n        expressionType: ExpressionTypes.Simple,\n        operatorId,\n        comparator,\n      }),\n    );\n  };\n  const onOperatorChange = (operatorId: Operators) => {\n    const currentComparator = props.adhocFilter.comparator;\n    let newComparator;\n    // convert between list of comparators and individual comparators\n    // (e.g. `in ('North America', 'Africa')` to `== 'North America'`)\n    if (MULTI_OPERATORS.has(operatorId)) {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator\n        : [currentComparator].filter(element => element);\n    } else {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator[0]\n        : currentComparator;\n    }\n    if (operatorId === Operators.IsTrue || operatorId === Operators.IsFalse) {\n      newComparator = Operators.IsTrue === operatorId;\n    }\n    if (operatorId && CUSTOM_OPERATORS.has(operatorId)) {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          subject: props.adhocFilter.subject,\n          clause: Clauses.Where,\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          expressionType: ExpressionTypes.Sql,\n          datasource: props.datasource,\n        }),\n      );\n    } else {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          comparator: newComparator,\n          expressionType: ExpressionTypes.Simple,\n        }),\n      );\n    }\n  };\n  const onComparatorChange = (comparator: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        comparator,\n        expressionType: ExpressionTypes.Simple,\n      }),\n    );\n  };\n  const clearOperator = (): void => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        operatorId: undefined,\n        operator: undefined,\n      }),\n    );\n  };\n  const onDatePickerChange = (columnName: string, timeRange: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject: columnName,\n        operator: Operators.TemporalRange,\n        comparator: timeRange,\n        expressionType: ExpressionTypes.Simple,\n      }),\n    );\n  };\n  return {\n    onSubjectChange,\n    onOperatorChange,\n    onComparatorChange,\n    isOperatorRelevant,\n    clearOperator,\n    onDatePickerChange,\n  };\n};\n\nconst AdhocFilterEditPopoverSimpleTabContent: FC<Props> = props => {\n  const {\n    onSubjectChange,\n    onOperatorChange,\n    isOperatorRelevant,\n    onComparatorChange,\n    onDatePickerChange,\n  } = useSimpleTabFilterProps(props);\n  const [suggestions, setSuggestions] = useState<\n    Record<'label' | 'value', any>[]\n  >([]);\n  const [comparator, setComparator] = useState(props.adhocFilter.comparator);\n  const [loadingComparatorSuggestions, setLoadingComparatorSuggestions] =\n    useState(false);\n\n  const {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  } = useAdvancedDataTypes(props.validHandler);\n  // TODO: This does not need to exist, just use the advancedTypeOperatorList list\n  const isOperatorRelevantWrapper = (operator: Operators, subject: string) =>\n    subjectAdvancedDataType\n      ? isOperatorRelevant(operator, subject) &&\n        advancedDataTypesState.advancedDataTypeOperatorList.includes(operator)\n      : isOperatorRelevant(operator, subject);\n  const onInputComparatorChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.target;\n    setComparator(value);\n    onComparatorChange(value);\n  };\n\n  const renderSubjectOptionLabel = (option: ColumnType) => (\n    <FilterDefinitionOption option={option} />\n  );\n\n  const getOptionsRemaining = () => {\n    // if select is multi/value is array, we show the options not selected\n    const valuesFromSuggestionsLength = Array.isArray(comparator)\n      ? comparator.filter(v => suggestions.includes(v)).length\n      : 0;\n    return suggestions?.length - valuesFromSuggestionsLength ?? 0;\n  };\n  const createSuggestionsPlaceholder = () => {\n    const optionsRemaining = getOptionsRemaining();\n    const placeholder = t('%s option(s)', optionsRemaining);\n    return optionsRemaining ? placeholder : '';\n  };\n\n  const handleSubjectChange = (subject: string) => {\n    setComparator(undefined);\n    onSubjectChange(subject);\n  };\n\n  let columns = props.options;\n  const { subject, operator, operatorId } = props.adhocFilter;\n\n  const subjectSelectProps = {\n    ariaLabel: t('Select subject'),\n    value: subject ?? undefined,\n    onChange: handleSubjectChange,\n    notFoundContent: t(\n      'No such column found. To filter on a metric, try the Custom SQL tab.',\n    ),\n    autoFocus: !subject,\n    placeholder: '',\n  };\n\n  subjectSelectProps.placeholder =\n    props.adhocFilter.clause === Clauses.Where\n      ? t('%s column(s)', columns.length)\n      : t('To filter on a metric, use Custom SQL tab.');\n  columns = props.options.filter(\n    option => 'column_name' in option && option.column_name,\n  );\n\n  const operatorSelectProps = {\n    placeholder: t(\n      '%s operator(s)',\n      (props.operators ?? OPERATORS_OPTIONS).filter(op =>\n        isOperatorRelevantWrapper(op, subject),\n      ).length,\n    ),\n    value: operatorId,\n    onChange: onOperatorChange,\n    autoFocus: !!subjectSelectProps.value && !operator,\n    ariaLabel: t('Select operator'),\n  };\n\n  const shouldFocusComparator =\n    !!subjectSelectProps.value && !!operatorSelectProps.value;\n\n  const comparatorSelectProps = {\n    allowClear: true,\n    allowNewOptions: true,\n    ariaLabel: t('Comparator option'),\n    mode: MULTI_OPERATORS.has(operatorId)\n      ? ('multiple' as const)\n      : ('single' as const),\n    loading: loadingComparatorSuggestions,\n    value: comparator,\n    onChange: onComparatorChange,\n    notFoundContent: t('Type a value here'),\n    disabled: DISABLE_INPUT_OPERATORS.includes(operatorId),\n    placeholder: createSuggestionsPlaceholder(),\n    autoFocus: shouldFocusComparator,\n  };\n\n  const labelText =\n    comparator && comparator.length > 0 && createSuggestionsPlaceholder();\n\n  const datePicker = useDatePickerInAdhocFilter({\n    columnName: props.adhocFilter.subject,\n    timeRange:\n      props.adhocFilter.operator === Operators.TemporalRange\n        ? props.adhocFilter.comparator\n        : undefined,\n    datasource: props.datasource,\n    onChange: onDatePickerChange,\n  });\n\n  useEffect(() => {\n    const refreshComparatorSuggestions = () => {\n      const { datasource } = props;\n      const col = props.adhocFilter.subject;\n      const having = props.adhocFilter.clause === Clauses.Having;\n\n      if (col && datasource && datasource.filter_select && !having) {\n        const controller = new AbortController();\n        const { signal } = controller;\n        if (loadingComparatorSuggestions) {\n          controller.abort();\n        }\n        setLoadingComparatorSuggestions(true);\n        SupersetClient.get({\n          signal,\n          endpoint: `/api/v1/datasource/${datasource.type}/${datasource.id}/column/${col}/values/`,\n        })\n          .then(({ json }) => {\n            setSuggestions(\n              json.result.map(\n                (suggestion: null | number | boolean | string) => ({\n                  value: suggestion,\n                  label: optionLabel(suggestion),\n                }),\n              ),\n            );\n            setLoadingComparatorSuggestions(false);\n          })\n          .catch(() => {\n            setSuggestions([]);\n            setLoadingComparatorSuggestions(false);\n          });\n      }\n    };\n    if (!datePicker) {\n      refreshComparatorSuggestions();\n    }\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.EnableAdvancedDataTypes)) {\n      fetchSubjectAdvancedDataType(props);\n    }\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.EnableAdvancedDataTypes)) {\n      fetchAdvancedDataTypeValueCallback(\n        comparator === undefined ? '' : comparator,\n        advancedDataTypesState,\n        subjectAdvancedDataType,\n      );\n    }\n  }, [comparator, subjectAdvancedDataType, fetchAdvancedDataTypeValueCallback]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.EnableAdvancedDataTypes)) {\n      setComparator(props.adhocFilter.comparator);\n    }\n  }, [props.adhocFilter.comparator]);\n\n  // another name for columns, just for following previous naming.\n  const subjectComponent = (\n    <Select\n      css={(theme: SupersetTheme) => ({\n        marginTop: theme.gridUnit * 4,\n        marginBottom: theme.gridUnit * 4,\n      })}\n      data-test=\"select-element\"\n      options={columns.map(column => ({\n        value:\n          ('column_name' in column && column.column_name) ||\n          ('optionName' in column && column.optionName) ||\n          '',\n        label:\n          ('saved_metric_name' in column && column.saved_metric_name) ||\n          ('column_name' in column && column.column_name) ||\n          ('label' in column && column.label),\n        key:\n          ('id' in column && column.id) ||\n          ('optionName' in column && column.optionName) ||\n          undefined,\n        customLabel: renderSubjectOptionLabel(column),\n      }))}\n      {...subjectSelectProps}\n    />\n  );\n\n  const operatorsAndOperandComponent = (\n    <>\n      <Select\n        css={(theme: SupersetTheme) => ({ marginBottom: theme.gridUnit * 4 })}\n        options={(props.operators ?? OPERATORS_OPTIONS)\n          .filter(op => isOperatorRelevantWrapper(op, subject))\n          .map((option, index) => ({\n            value: option,\n            label: OPERATOR_ENUM_TO_OPERATOR_TYPE[option].display,\n            key: option,\n            order: index,\n          }))}\n        {...operatorSelectProps}\n      />\n      {MULTI_OPERATORS.has(operatorId) || suggestions.length > 0 ? (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <SelectWithLabel\n            labelText={labelText}\n            options={suggestions}\n            {...comparatorSelectProps}\n          />\n        </Tooltip>\n      ) : (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <StyledInput\n            data-test=\"adhoc-filter-simple-value\"\n            name=\"filter-value\"\n            ref={ref => {\n              if (ref && shouldFocusComparator) {\n                ref.focus();\n              }\n            }}\n            onChange={onInputComparatorChange}\n            value={comparator}\n            placeholder={t('Filter value (case sensitive)')}\n            disabled={DISABLE_INPUT_OPERATORS.includes(operatorId)}\n          />\n        </Tooltip>\n      )}\n    </>\n  );\n  return (\n    <>\n      {subjectComponent}\n      {datePicker ?? operatorsAndOperandComponent}\n    </>\n  );\n};\n\nexport default AdhocFilterEditPopoverSimpleTabContent;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Clauses, ExpressionTypes } from '../types';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n      this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: ExpressionTypes.Sql,\n      }),\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const keywords = sqlKeywords.concat(\n      options\n        .map(option => {\n          if (option.column_name) {\n            return {\n              name: option.column_name,\n              value: option.column_name,\n              score: 50,\n              meta: 'option',\n            };\n          }\n          return null;\n        })\n        .filter(Boolean),\n    );\n    const selectOptions = Object.values(Clauses).map(clause => ({\n      label: clause,\n      value: clause,\n    }));\n\n    return (\n      <span>\n        <div className=\"filter-edit-clause-section\">\n          <div>\n            <StyledSelect\n              options={selectOptions}\n              ariaLabel={t('Select column')}\n              placeholder={t('choose WHERE or HAVING...')}\n              value={adhocFilter.clause}\n              onChange={this.onSqlExpressionClauseChange}\n            />\n          </div>\n          <span className=\"filter-edit-clause-info\">\n            <strong>WHERE</strong> {t('Filters by columns')}\n            <br />\n            <strong>HAVING</strong> {t('Filters by metrics')}\n          </span>\n        </div>\n        <div css={theme => ({ marginTop: theme.gridUnit * 4 })}>\n          <SQLEditor\n            ref={this.handleAceEditorRef}\n            keywords={keywords}\n            height={`${height - 130}px`}\n            onChange={this.onSqlExpressionChange}\n            width=\"100%\"\n            showGutter={false}\n            value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n          />\n        </div>\n      </span>\n    );\n  }\n}\nAdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { createRef, Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\nimport { ExpressionTypes } from '../types';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  requireSave: PropTypes.bool,\n};\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n  }\n\n  .filter-edit-clause-section {\n    display: flex;\n    flex-direction: row;\n    gap: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nconst FilterActionsContainer = styled.div`\n  margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nexport default class AdhocFilterEditPopover extends Component {\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.setSimpleTabIsValid = this.setSimpleTabIsValid.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n      activeKey: this.props?.adhocFilter?.expressionType || 'SIMPLE',\n      isSimpleTabValid: true,\n    };\n\n    this.popoverContentRef = createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  setSimpleTabIsValid(isValid) {\n    this.setState({ isSimpleTabValid: isValid });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY),\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey,\n    });\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      theme,\n      operators,\n      requireSave,\n      ...popoverProps\n    } = this.props;\n\n    const { adhocFilter } = this.state;\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges =\n      requireSave || !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      <FilterPopoverContentContainer\n        id=\"filter-edit-popover\"\n        {...popoverProps}\n        data-test=\"filter-edit-popover\"\n        ref={this.popoverContentRef}\n      >\n        <Tabs\n          id=\"adhoc-filter-edit-tabs\"\n          defaultActiveKey={adhocFilter.expressionType}\n          className=\"adhoc-filter-edit-tabs\"\n          data-test=\"adhoc-filter-edit-tabs\"\n          style={{ minHeight: this.state.height, width: this.state.width }}\n          allowOverflow\n          onChange={this.onTabChange}\n        >\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={ExpressionTypes.Simple}\n            tab={t('Simple')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSimpleTabContent\n                operators={operators}\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={options}\n                datasource={datasource}\n                onHeightChange={this.adjustHeight}\n                partitionColumn={partitionColumn}\n                popoverRef={this.popoverContentRef.current}\n                validHandler={this.setSimpleTabIsValid}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={ExpressionTypes.Sql}\n            tab={t('Custom SQL')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSqlTabContent\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={this.props.options}\n                height={this.state.height}\n                activeKey={this.state.activeKey}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n        </Tabs>\n        <FilterActionsContainer>\n          <Button buttonSize=\"small\" onClick={this.props.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            data-test=\"adhoc-filter-edit-popover-save-button\"\n            disabled={\n              !stateIsValid ||\n              !this.state.isSimpleTabValid ||\n              !hasUnsavedChanges\n            }\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <ResizeIcon\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </FilterActionsContainer>\n      </FilterPopoverContentContainer>\n    );\n  }\n}\n\nAdhocFilterEditPopover.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { PureComponent } from 'react';\nimport { OptionSortType } from 'src/explore/types';\nimport AdhocFilterEditPopover from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopover';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport { Operators } from 'src/explore/constants';\nimport ControlPopover from '../../ControlPopover/ControlPopover';\n\ninterface AdhocFilterPopoverTriggerProps {\n  sections?: string[];\n  operators?: Operators[];\n  adhocFilter: AdhocFilter;\n  options: OptionSortType[];\n  datasource: Record<string, any>;\n  onFilterEdit: (editedFilter: AdhocFilter) => void;\n  partitionColumn?: string;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  requireSave?: boolean;\n}\n\ninterface AdhocFilterPopoverTriggerState {\n  popoverVisible: boolean;\n}\n\nclass AdhocFilterPopoverTrigger extends PureComponent<\n  AdhocFilterPopoverTriggerProps,\n  AdhocFilterPopoverTriggerState\n> {\n  constructor(props: AdhocFilterPopoverTriggerProps) {\n    super(props);\n    this.onPopoverResize = this.onPopoverResize.bind(this);\n    this.closePopover = this.closePopover.bind(this);\n    this.togglePopover = this.togglePopover.bind(this);\n    this.state = {\n      popoverVisible: false,\n    };\n  }\n\n  onPopoverResize() {\n    this.forceUpdate();\n  }\n\n  closePopover() {\n    this.togglePopover(false);\n  }\n\n  togglePopover(visible: boolean) {\n    this.setState({\n      popoverVisible: visible,\n    });\n  }\n\n  render() {\n    const { adhocFilter, isControlledComponent } = this.props;\n\n    const { visible, togglePopover, closePopover } = isControlledComponent\n      ? {\n          visible: this.props.visible,\n          togglePopover: this.props.togglePopover,\n          closePopover: this.props.closePopover,\n        }\n      : {\n          visible: this.state.popoverVisible,\n          togglePopover: this.togglePopover,\n          closePopover: this.closePopover,\n        };\n    const overlayContent = (\n      <ExplorePopoverContent>\n        <AdhocFilterEditPopover\n          adhocFilter={adhocFilter}\n          options={this.props.options}\n          datasource={this.props.datasource}\n          partitionColumn={this.props.partitionColumn}\n          onResize={this.onPopoverResize}\n          onClose={closePopover}\n          sections={this.props.sections}\n          operators={this.props.operators}\n          onChange={this.props.onFilterEdit}\n          requireSave={this.props.requireSave}\n        />\n      </ExplorePopoverContent>\n    );\n\n    return (\n      <ControlPopover\n        trigger=\"click\"\n        content={overlayContent}\n        defaultVisible={visible}\n        visible={visible}\n        onVisibleChange={togglePopover}\n        destroyTooltipOnHide\n      >\n        {this.props.children}\n      </ControlPopover>\n    );\n  }\n}\n\nexport default AdhocFilterPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport enum ExpressionTypes {\n  Simple = 'SIMPLE',\n  Sql = 'SQL',\n}\n\nexport enum Clauses {\n  Having = 'HAVING',\n  Where = 'WHERE',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useState } from 'react';\nimport { NO_TIME_RANGE, fetchTimeRange } from '@superset-ui/core';\nimport { Operators } from 'src/explore/constants';\nimport AdhocFilter from '../AdhocFilter';\nimport { ExpressionTypes } from '../types';\n\ninterface Results {\n  actualTimeRange?: string;\n  title?: string;\n}\n\nexport const useGetTimeRangeLabel = (adhocFilter: AdhocFilter): Results => {\n  const [actualTimeRange, setActualTimeRange] = useState<Results>({});\n\n  useEffect(() => {\n    if (\n      adhocFilter.operator !== Operators.TemporalRange ||\n      adhocFilter.expressionType !== ExpressionTypes.Simple\n    ) {\n      setActualTimeRange({});\n    }\n    if (\n      adhocFilter.operator === Operators.TemporalRange &&\n      adhocFilter.comparator === NO_TIME_RANGE\n    ) {\n      setActualTimeRange({\n        actualTimeRange: `${adhocFilter.subject} (${NO_TIME_RANGE})`,\n        title: NO_TIME_RANGE,\n      });\n    }\n\n    if (\n      adhocFilter.operator === Operators.TemporalRange &&\n      adhocFilter.expressionType === ExpressionTypes.Simple &&\n      adhocFilter.comparator !== NO_TIME_RANGE &&\n      actualTimeRange.title !== adhocFilter.comparator\n    ) {\n      fetchTimeRange(adhocFilter.comparator, adhocFilter.subject).then(\n        ({ value, error }) => {\n          if (error) {\n            setActualTimeRange({\n              actualTimeRange: `${adhocFilter.subject} (${adhocFilter.comparator})`,\n              title: error,\n            });\n          } else {\n            setActualTimeRange({\n              actualTimeRange: value ?? '',\n              title: adhocFilter.comparator,\n            });\n          }\n        },\n      );\n    }\n  }, [adhocFilter]);\n\n  return actualTimeRange;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactElement } from 'react';\n\nimport { t } from '@superset-ui/core';\nimport { Dataset, isTemporalColumn } from '@superset-ui/chart-controls';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl/DateFilterLabel';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\ninterface DatePickerInFilterProps {\n  columnName: string;\n  timeRange?: string;\n  datasource: Dataset;\n  onChange: (columnName: string, timeRange: string) => void;\n}\n\nexport const useDatePickerInAdhocFilter = ({\n  columnName,\n  timeRange,\n  datasource,\n  onChange,\n}: DatePickerInFilterProps): ReactElement | undefined => {\n  const onTimeRangeChange = (val: string) => onChange(columnName, val);\n\n  return isTemporalColumn(columnName, datasource) ? (\n    <>\n      <ControlHeader label={t('Time Range')} />\n      <DateFilterControl\n        value={timeRange}\n        name=\"time_range\"\n        onChange={onTimeRangeChange}\n        overlayStyle=\"Modal\"\n      />\n    </>\n  ) : undefined;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  isFreeFormAdhocFilter,\n  isSimpleAdhocFilter,\n  SimpleAdhocFilter,\n} from '@superset-ui/core';\nimport {\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n  Operators,\n} from 'src/explore/constants';\nimport { getSimpleSQLExpression } from 'src/explore/exploreUtils';\n\nexport const OPERATORS_TO_SQL = {\n  '==': '=',\n  '!=': '<>',\n  '>': '>',\n  '<': '<',\n  '>=': '>=',\n  '<=': '<=',\n  IN: 'IN',\n  'NOT IN': 'NOT IN',\n  LIKE: 'LIKE',\n  ILIKE: 'ILIKE',\n  REGEX: 'REGEX',\n  'IS NOT NULL': 'IS NOT NULL',\n  'IS NULL': 'IS NULL',\n  'IS TRUE': 'IS TRUE',\n  'IS FALSE': 'IS FALSE',\n  'LATEST PARTITION': ({\n    datasource,\n  }: {\n    datasource: { schema: string; datasource_name: string };\n  }) =>\n    `= '{{ presto.latest_partition('${datasource.schema}.${datasource.datasource_name}') }}'`,\n};\n\nexport const translateToSql = (\n  adhocFilter: AdhocFilter,\n  { useSimple }: { useSimple: boolean } = { useSimple: false },\n) => {\n  if (isSimpleAdhocFilter(adhocFilter) || useSimple) {\n    const { subject, operator } = adhocFilter as SimpleAdhocFilter;\n    const comparator =\n      'comparator' in adhocFilter ? adhocFilter.comparator : undefined;\n    const op =\n      operator &&\n      // 'LATEST PARTITION' supported callback only\n      operator ===\n        OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.LatestPartition].operation\n        ? OPERATORS_TO_SQL[operator](adhocFilter)\n        : OPERATORS_TO_SQL[operator];\n    return getSimpleSQLExpression(subject, op, comparator);\n  }\n  if (isFreeFormAdhocFilter(adhocFilter)) {\n    return adhocFilter.sqlExpression;\n  }\n  return '';\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useRef, ReactNode } from 'react';\n\nimport { useDrag, useDrop, DropTargetMonitor } from 'react-dnd';\nimport { styled, t, useTheme, keyframes, css } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport { StyledMetricOption } from '../../optionRenderers';\n\nexport const DragContainer = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n  :last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const OptionControlContainer = styled.div<{\n  withCaret?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  background-color: ${({ theme }) => theme.colors.grayscale.light3};\n  border-radius: 3px;\n  cursor: ${({ withCaret }) => (withCaret ? 'pointer' : 'default')};\n`;\nexport const Label = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${theme.gridUnit}px;\n    svg {\n      margin-right: ${theme.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${theme.gridUnit * 2}px;\n      margin-left: ${theme.gridUnit}px;\n      font-weight: ${theme.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}\n`;\n\nconst LabelText = styled.span`\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nexport const CaretContainer = styled.div`\n  height: 100%;\n  border-left: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  margin-left: auto;\n`;\n\nexport const CloseContainer = styled.div`\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 6}px;\n  border-right: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  cursor: pointer;\n`;\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const HeaderContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nexport const LabelsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: solid 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst borderPulse = keyframes`\n  0% {\n    right: 100%;\n  }\n  50% {\n    left: 4px;\n  }\n  90% {\n    right: 4px;\n  }\n  100% {\n    left: 100%;\n  }\n`;\n\nexport const DndLabelsContainer = styled.div<{\n  canDrop?: boolean;\n  isOver?: boolean;\n  isDragging?: boolean;\n  isLoading?: boolean;\n}>`\n  ${({ theme, isLoading, canDrop, isDragging, isOver }) => `\n  position: relative;\n  padding: ${theme.gridUnit}px;\n  border: ${\n    !isLoading && isDragging\n      ? `dashed 1px ${\n          canDrop ? theme.colors.info.dark1 : theme.colors.error.dark1\n        }`\n      : `solid 1px ${\n          isLoading && isDragging\n            ? theme.colors.warning.light1\n            : theme.colors.grayscale.light2\n        }`\n  };\n  border-radius: ${theme.gridUnit}px;\n  &:before,\n  &:after {\n    content: ' ';\n    position: absolute;\n    border-radius: ${theme.gridUnit}px;\n  }\n  &:before {\n    display: ${isDragging || isLoading ? 'block' : 'none'};\n    background-color: ${\n      canDrop ? theme.colors.primary.base : theme.colors.error.light1\n    };\n    z-index: ${theme.zIndex.aboveDashboardCharts};\n    opacity: ${theme.opacity.light};\n    top: 1px;\n    right: 1px;\n    bottom: 1px;\n    left: 1px;\n  }\n  &:after {\n    display: ${isLoading || (canDrop && isOver) ? 'block' : 'none'};\n    background-color: ${\n      isLoading ? theme.colors.grayscale.light3 : theme.colors.primary.base\n    };\n    z-index: ${theme.zIndex.dropdown};\n    opacity: ${theme.opacity.mediumLight};\n    top: ${-theme.gridUnit}px;\n    right: ${-theme.gridUnit}px;\n    bottom: ${-theme.gridUnit}px;\n    left: ${-theme.gridUnit}px;\n    cursor: ${isLoading ? 'wait' : 'auto'};\n  }\n  `}\n\n  &:before {\n    ${({ theme, isLoading }) =>\n      isLoading &&\n      css`\n        animation: ${borderPulse} 2s ease-in infinite;\n        background: linear-gradient(currentColor 0 0) 0 100%/0% 3px no-repeat;\n        background-size: 100% ${theme.gridUnit / 2}px;\n        top: auto;\n        right: ${theme.gridUnit}px;\n        left: ${theme.gridUnit}px;\n        bottom: -${theme.gridUnit / 2}px;\n        height: ${theme.gridUnit / 2}px;\n      `};\n  }\n`;\n\nexport const AddControlLabel = styled.div<{\n  cancelHover?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n  border: dashed 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n  cursor: ${({ cancelHover }) => (cancelHover ? 'inherit' : 'pointer')};\n\n  :hover {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light4};\n  }\n\n  :active {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light3};\n  }\n`;\n\nexport const AddIconButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: ${({ theme }) => theme.gridUnit * 4}px;\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n  padding: 0;\n  background-color: ${({ theme }) => theme.colors.primary.dark1};\n  border: none;\n  border-radius: 2px;\n\n  :disabled {\n    cursor: not-allowed;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\ninterface DragItem {\n  dragIndex: number;\n  type: string;\n}\n\nexport const OptionControlLabel = ({\n  label,\n  savedMetric,\n  adhocMetric,\n  onRemove,\n  onMoveLabel,\n  onDropLabel,\n  withCaret,\n  isFunction,\n  type,\n  index,\n  isExtra,\n  datasourceWarningMessage,\n  tooltipTitle,\n  multi = true,\n  ...props\n}: {\n  label: string | ReactNode;\n  savedMetric?: savedMetricType;\n  adhocMetric?: AdhocMetric;\n  onRemove: () => void;\n  onMoveLabel: (dragIndex: number, hoverIndex: number) => void;\n  onDropLabel: () => void;\n  withCaret?: boolean;\n  isFunction?: boolean;\n  isDraggable?: boolean;\n  type: string;\n  index: number;\n  isExtra?: boolean;\n  datasourceWarningMessage?: string;\n  tooltipTitle?: string;\n  multi?: boolean;\n}) => {\n  const theme = useTheme();\n  const ref = useRef<HTMLDivElement>(null);\n  const labelRef = useRef<HTMLDivElement>(null);\n  const hasMetricName = savedMetric?.metric_name;\n  const [, drop] = useDrop({\n    accept: type,\n    drop() {\n      if (!multi) {\n        return;\n      }\n      onDropLabel?.();\n    },\n    hover(item: DragItem, monitor: DropTargetMonitor) {\n      if (!multi) {\n        return;\n      }\n      if (!ref.current) {\n        return;\n      }\n      const { dragIndex } = item;\n      const hoverIndex = index;\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset?.y\n        ? clientOffset?.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n      // Time to actually perform the action\n      onMoveLabel?.(dragIndex, hoverIndex);\n      // Note: we're mutating the monitor item here!\n      // Generally it's better to avoid mutations,\n      // but it's good here for the sake of performance\n      // to avoid expensive index searches.\n      // eslint-disable-next-line no-param-reassign\n      item.dragIndex = hoverIndex;\n    },\n  });\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type,\n      dragIndex: index,\n      value: savedMetric?.metric_name ? savedMetric : adhocMetric,\n    },\n    collect: monitor => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const getLabelContent = () => {\n    const shouldShowTooltip =\n      (!isDragging &&\n        typeof label === 'string' &&\n        tooltipTitle &&\n        label &&\n        tooltipTitle !== label) ||\n      (!isDragging &&\n        labelRef &&\n        labelRef.current &&\n        labelRef.current.scrollWidth > labelRef.current.clientWidth);\n\n    if (savedMetric && hasMetricName) {\n      return (\n        <StyledMetricOption\n          metric={savedMetric}\n          labelRef={labelRef}\n          shouldShowTooltip={!isDragging}\n        />\n      );\n    }\n    if (!shouldShowTooltip) {\n      return <LabelText ref={labelRef}>{label}</LabelText>;\n    }\n    return (\n      <Tooltip title={tooltipTitle || label}>\n        <LabelText ref={labelRef}>{label}</LabelText>\n      </Tooltip>\n    );\n  };\n\n  const getOptionControlContent = () => (\n    <OptionControlContainer\n      withCaret={withCaret}\n      data-test=\"option-label\"\n      {...props}\n    >\n      <CloseContainer\n        role=\"button\"\n        data-test=\"remove-control-button\"\n        onClick={onRemove}\n      >\n        <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n      </CloseContainer>\n      <Label data-test=\"control-label\">\n        {isFunction && <Icons.FieldDerived />}\n        {getLabelContent()}\n      </Label>\n      {(!!datasourceWarningMessage || isExtra) && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={\n            datasourceWarningMessage ||\n            t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)\n          }\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n\n  drag(drop(ref));\n  return <DragContainer ref={ref}>{getOptionControlContent()}</DragContainer>;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { FC } from 'react';\nimport { styled } from '@superset-ui/core';\nimport SyntaxHighlighter from 'react-syntax-highlighter/dist/cjs/light';\nimport github from 'react-syntax-highlighter/dist/cjs/styles/hljs/github';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { CopyButton } from 'src/explore/components/DataTableControl';\nimport markdownSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/markdown';\nimport htmlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/htmlbars';\nimport sqlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/sql';\nimport jsonSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/json';\n\nconst CopyButtonViewQuery = styled(CopyButton)`\n  && {\n    margin: 0 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nSyntaxHighlighter.registerLanguage('markdown', markdownSyntax);\nSyntaxHighlighter.registerLanguage('html', htmlSyntax);\nSyntaxHighlighter.registerLanguage('sql', sqlSyntax);\nSyntaxHighlighter.registerLanguage('json', jsonSyntax);\n\ninterface ViewQueryProps {\n  sql: string;\n  language?: string;\n}\n\nconst StyledSyntaxContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst StyledSyntaxHighlighter = styled(SyntaxHighlighter)`\n  flex: 1;\n`;\n\nconst ViewQuery: FC<ViewQueryProps> = props => {\n  const { sql, language = 'sql' } = props;\n  return (\n    <StyledSyntaxContainer key={sql}>\n      <CopyToClipboard\n        text={sql}\n        shouldShowText={false}\n        copyNode={\n          <CopyButtonViewQuery buttonSize=\"xsmall\">\n            <i className=\"fa fa-clipboard\" />\n          </CopyButtonViewQuery>\n        }\n      />\n      <StyledSyntaxHighlighter language={language} style={github}>\n        {sql}\n      </StyledSyntaxHighlighter>\n    </StyledSyntaxContainer>\n  );\n};\n\nexport default ViewQuery;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { FC, useEffect, useState } from 'react';\n\nimport {\n  styled,\n  ensureIsArray,\n  t,\n  getClientErrorObject,\n} from '@superset-ui/core';\nimport Loading from 'src/components/Loading';\nimport { getChartDataRequest } from 'src/components/Chart/chartAction';\nimport ViewQuery from 'src/explore/components/controls/ViewQuery';\n\ninterface Props {\n  latestQueryFormData: object;\n}\n\ntype Result = {\n  query: string;\n  language: string;\n};\n\nconst ViewQueryModalContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst ViewQueryModal: FC<Props> = props => {\n  const [result, setResult] = useState<Result[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadChartData = (resultType: string) => {\n    setIsLoading(true);\n    getChartDataRequest({\n      formData: props.latestQueryFormData,\n      resultFormat: 'json',\n      resultType,\n    })\n      .then(({ json }) => {\n        setResult(ensureIsArray(json.result));\n        setIsLoading(false);\n        setError(null);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(({ error, message }) => {\n          setError(\n            error ||\n              message ||\n              response.statusText ||\n              t('Sorry, An error occurred'),\n          );\n          setIsLoading(false);\n        });\n      });\n  };\n  useEffect(() => {\n    loadChartData('query');\n  }, [JSON.stringify(props.latestQueryFormData)]);\n\n  if (isLoading) {\n    return <Loading />;\n  }\n  if (error) {\n    return <pre>{error}</pre>;\n  }\n\n  return (\n    <ViewQueryModalContainer>\n      {result.map(item =>\n        item.query ? (\n          <ViewQuery sql={item.query} language={item.language || undefined} />\n        ) : null,\n      )}\n    </ViewQueryModalContainer>\n  );\n};\n\nexport default ViewQueryModal;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { omit } from 'lodash';\nimport { SupersetClient, JsonObject } from '@superset-ui/core';\n\ntype Payload = {\n  datasource_id: number;\n  datasource_type: string;\n  form_data: string;\n  chart_id?: number;\n};\n\nconst TEMPORARY_CONTROLS = ['url_params'];\n\nexport const sanitizeFormData = (formData: JsonObject): JsonObject =>\n  omit(formData, TEMPORARY_CONTROLS);\n\nconst assembleEndpoint = (key?: string, tabId?: string) => {\n  let endpoint = 'api/v1/explore/form_data';\n  if (key) {\n    endpoint = endpoint.concat(`/${key}`);\n  }\n  if (tabId) {\n    endpoint = endpoint.concat(`?tab_id=${tabId}`);\n  }\n  return endpoint;\n};\n\nconst assemblePayload = (\n  datasourceId: number,\n  datasourceType: string,\n  formData: JsonObject,\n  chartId?: number,\n) => {\n  const payload: Payload = {\n    datasource_id: datasourceId,\n    datasource_type: datasourceType,\n    form_data: JSON.stringify(sanitizeFormData(formData)),\n  };\n  if (chartId) {\n    payload.chart_id = chartId;\n  }\n  return payload;\n};\n\nexport const postFormData = (\n  datasourceId: number,\n  datasourceType: string,\n  formData: JsonObject,\n  chartId?: number,\n  tabId?: string,\n): Promise<string> =>\n  SupersetClient.post({\n    endpoint: assembleEndpoint(undefined, tabId),\n    jsonPayload: assemblePayload(\n      datasourceId,\n      datasourceType,\n      formData,\n      chartId,\n    ),\n  }).then(r => r.json.key);\n\nexport const putFormData = (\n  datasourceId: number,\n  datasourceType: string,\n  key: string,\n  formData: JsonObject,\n  chartId?: number,\n  tabId?: string,\n): Promise<string> =>\n  SupersetClient.put({\n    endpoint: assembleEndpoint(key, tabId),\n    jsonPayload: assemblePayload(\n      datasourceId,\n      datasourceType,\n      formData,\n      chartId,\n    ),\n  }).then(r => r.json.message);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useMemo, useState } from 'react';\nimport { css, t, useTheme } from '@superset-ui/core';\nimport Alert from 'src/components/Alert';\nimport { Dataset } from 'src/components/Chart/types';\nimport MetadataBar from 'src/components/MetadataBar';\nimport {\n  ContentType,\n  MetadataType,\n} from 'src/components/MetadataBar/ContentType';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport { cachedSupersetGet } from 'src/utils/cachedSupersetGet';\n\nexport type UseDatasetMetadataBarProps =\n  | { datasetId?: undefined; dataset: Dataset }\n  | { datasetId: number | string; dataset?: undefined };\nexport const useDatasetMetadataBar = ({\n  dataset: datasetProps,\n  datasetId,\n}: UseDatasetMetadataBarProps) => {\n  const theme = useTheme();\n  const [result, setResult] = useState<Dataset>();\n  const [status, setStatus] = useState<ResourceStatus>(\n    datasetProps ? ResourceStatus.Complete : ResourceStatus.Loading,\n  );\n\n  useEffect(() => {\n    if (!datasetProps && datasetId) {\n      cachedSupersetGet({\n        endpoint: `/api/v1/dataset/${datasetId}`,\n      })\n        .then(({ json: { result } }) => {\n          setResult(result);\n          setStatus(ResourceStatus.Complete);\n        })\n        .catch(() => {\n          setStatus(ResourceStatus.Error);\n        });\n    }\n  }, [datasetId, datasetProps]);\n\n  const metadataBar = useMemo(() => {\n    const items: ContentType[] = [];\n    const dataset = datasetProps || result;\n    if (dataset) {\n      const {\n        changed_on_humanized,\n        created_on_humanized,\n        description,\n        table_name,\n        changed_by,\n        created_by,\n        owners,\n      } = dataset;\n      const notAvailable = t('Not available');\n      const createdBy =\n        `${created_by?.first_name ?? ''} ${\n          created_by?.last_name ?? ''\n        }`.trim() || notAvailable;\n      const modifiedBy = changed_by\n        ? `${changed_by.first_name} ${changed_by.last_name}`\n        : notAvailable;\n      const formattedOwners =\n        owners?.length > 0\n          ? owners.map(owner => `${owner.first_name} ${owner.last_name}`)\n          : [notAvailable];\n      items.push({\n        type: MetadataType.Table,\n        title: table_name,\n      });\n      items.push({\n        type: MetadataType.LastModified,\n        value: changed_on_humanized,\n        modifiedBy,\n      });\n      items.push({\n        type: MetadataType.Owner,\n        createdBy,\n        owners: formattedOwners,\n        createdOn: created_on_humanized,\n      });\n      if (description) {\n        items.push({\n          type: MetadataType.Description,\n          value: description,\n        });\n      }\n    }\n    return (\n      <div\n        css={css`\n          display: flex;\n          margin-bottom: ${theme.gridUnit * 4}px;\n        `}\n      >\n        {status === ResourceStatus.Complete && (\n          <MetadataBar items={items} tooltipPlacement=\"bottom\" />\n        )}\n        {status === ResourceStatus.Error && (\n          <Alert\n            type=\"error\"\n            message={t('There was an error loading the dataset metadata')}\n          />\n        )}\n      </div>\n    );\n  }, [datasetProps, result, status, theme.gridUnit]);\n\n  return {\n    metadataBar,\n    status,\n  };\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Types mirroring enums in `superset/reports/models.py`:\n */\nexport type ReportScheduleType = 'Alert' | 'Report';\nexport type ReportCreationMethod = 'charts' | 'dashboards' | 'alerts_reports';\n\nexport type ReportRecipientType = 'Email' | 'Slack';\n\nexport enum ReportType {\n  Dashboards = 'dashboards',\n  Charts = 'charts',\n}\n\nexport enum NotificationFormats {\n  Text = 'TEXT',\n  PNG = 'PNG',\n  CSV = 'CSV',\n}\nexport interface ReportObject {\n  id?: number;\n  active: boolean;\n  crontab: string;\n  dashboard?: number;\n  chart?: number;\n  description?: string;\n  log_retention: number;\n  name: string;\n  owners: number[];\n  recipients: [\n    {\n      recipient_config_json: {\n        target: string;\n        ccTarget: string;\n        bccTarget: string;\n      };\n      type: ReportRecipientType;\n    },\n  ];\n  report_format: string;\n  timezone: string;\n  type: ReportScheduleType;\n  validator_config_json: {} | null;\n  validator_type: string;\n  working_timeout: number;\n  creation_method: string;\n  force_screenshot: boolean;\n  custom_width?: number | null;\n  error?: string;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { styled, css, SupersetTheme } from '@superset-ui/core';\nimport Modal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport { Radio } from 'src/components/Radio';\nimport { CronPicker } from 'src/components/CronPicker';\n\nexport const StyledModal = styled(Modal)`\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\nexport const StyledTopSection = styled.div`\n  padding: ${({ theme }) =>\n    `${theme.gridUnit * 3}px ${theme.gridUnit * 4}px ${theme.gridUnit * 2}px`};\n  label {\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\nexport const StyledBottomSection = styled.div`\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  padding: ${({ theme }) =>\n    `${theme.gridUnit * 4}px ${theme.gridUnit * 4}px ${theme.gridUnit * 6}px`};\n  .ant-select {\n    width: 100%;\n  }\n  .control-label {\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\nexport const StyledIconWrapper = styled.span`\n  span {\n    margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n    vertical-align: middle;\n  }\n  .text {\n    vertical-align: middle;\n  }\n`;\n\nexport const StyledScheduleTitle = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 7}px;\n\n  h4 {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  }\n`;\n\nexport const StyledCronPicker = styled(CronPicker)`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  width: ${({ theme }) => theme.gridUnit * 120}px;\n`;\n\nexport const StyledCronError = styled.p`\n  color: ${({ theme }) => theme.colors.error.base};\n`;\n\nexport const noBottomMargin = css`\n  margin-bottom: 0;\n`;\n\nexport const StyledFooterButton = styled(Button)`\n  width: ${({ theme }) => theme.gridUnit * 40}px;\n`;\n\nexport const TimezoneHeaderStyle = (theme: SupersetTheme) => css`\n  margin: ${theme.gridUnit * 3}px 0 ${theme.gridUnit * 2}px;\n`;\n\nexport const CustomWidthHeaderStyle = (theme: SupersetTheme) => css`\n  margin: ${theme.gridUnit * 3}px 0 ${theme.gridUnit * 2}px;\n`;\n\nexport const SectionHeaderStyle = (theme: SupersetTheme) => css`\n  margin: ${theme.gridUnit * 3}px 0;\n`;\n\nexport const StyledMessageContentTitle = styled.div`\n  margin: ${({ theme }) => theme.gridUnit * 8}px 0\n    ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport const StyledRadio = styled(Radio)`\n  display: block;\n  line-height: ${({ theme }) => theme.gridUnit * 8}px;\n`;\n\nexport const StyledRadioGroup = styled(Radio.Group)`\n  margin-left: ${({ theme }) => theme.gridUnit * 0.5}px;\n`;\n\nexport const antDErrorAlertStyles = (theme: SupersetTheme) => css`\n  border: ${theme.colors.error.base} 1px solid;\n  padding: ${theme.gridUnit * 4}px;\n  margin: ${theme.gridUnit * 4}px;\n  margin-top: 0;\n  color: ${theme.colors.error.dark2};\n  .ant-alert-message {\n    font-size: ${theme.typography.sizes.m}px;\n    font-weight: bold;\n  }\n  .ant-alert-description {\n    font-size: ${theme.typography.sizes.m}px;\n    line-height: ${theme.gridUnit * 4}px;\n    .ant-alert-icon {\n      margin-right: ${theme.gridUnit * 2.5}px;\n      font-size: ${theme.typography.sizes.l}px;\n      position: relative;\n      top: ${theme.gridUnit / 4}px;\n    }\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  useState,\n  useEffect,\n  useReducer,\n  useCallback,\n  useMemo,\n  ChangeEvent,\n} from 'react';\n\nimport { t, SupersetTheme, getClientErrorObject } from '@superset-ui/core';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  addReport,\n  editReport,\n} from 'src/features/reports/ReportModal/actions';\nimport Alert from 'src/components/Alert';\nimport TimezoneSelector from 'src/components/TimezoneSelector';\nimport LabeledErrorBoundInput from 'src/components/Form/LabeledErrorBoundInput';\nimport Icons from 'src/components/Icons';\nimport { CronError } from 'src/components/CronPicker';\nimport { RadioChangeEvent } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { ChartState } from 'src/explore/types';\nimport {\n  ReportCreationMethod,\n  ReportObject,\n  NotificationFormats,\n} from 'src/features/reports/types';\nimport { reportSelector } from 'src/views/CRUD/hooks';\nimport { StyledInputContainer } from 'src/features/alerts/AlertReportModal';\nimport { CreationMethod } from './HeaderReportDropdown';\nimport {\n  antDErrorAlertStyles,\n  CustomWidthHeaderStyle,\n  StyledModal,\n  StyledTopSection,\n  StyledBottomSection,\n  StyledIconWrapper,\n  StyledScheduleTitle,\n  StyledCronPicker,\n  StyledCronError,\n  noBottomMargin,\n  StyledFooterButton,\n  TimezoneHeaderStyle,\n  SectionHeaderStyle,\n  StyledMessageContentTitle,\n  StyledRadio,\n  StyledRadioGroup,\n} from './styles';\n\ninterface ReportProps {\n  onHide: () => {};\n  addDangerToast: (msg: string) => void;\n  show: boolean;\n  userId: number;\n  userEmail: string;\n  ccEmail: string;\n  bccEmail: string;\n  chart?: ChartState;\n  chartName?: string;\n  dashboardId?: number;\n  dashboardName?: string;\n  creationMethod: ReportCreationMethod;\n  props: any;\n}\n\nconst TEXT_BASED_VISUALIZATION_TYPES = [\n  'pivot_table_v2',\n  'table',\n  'paired_ttest',\n];\n\nconst INITIAL_STATE = {\n  crontab: '0 12 * * 1',\n};\n\ntype ReportObjectState = Partial<ReportObject> & {\n  error?: string;\n  /**\n   * Is submitting changes to the backend.\n   */\n  isSubmitting?: boolean;\n};\n\n// Same instance to be used in useEffects\nconst EMPTY_OBJECT = {};\n\nfunction ReportModal({\n  onHide,\n  show = false,\n  dashboardId,\n  chart,\n  userId,\n  userEmail,\n  ccEmail,\n  bccEmail,\n  creationMethod,\n  dashboardName,\n  chartName,\n}: ReportProps) {\n  const vizType = chart?.sliceFormData?.viz_type;\n  const isChart = !!chart;\n  const isTextBasedChart =\n    isChart && vizType && TEXT_BASED_VISUALIZATION_TYPES.includes(vizType);\n  const defaultNotificationFormat = isTextBasedChart\n    ? NotificationFormats.Text\n    : NotificationFormats.PNG;\n  const entityName = dashboardName || chartName;\n  const initialState: ReportObjectState = useMemo(\n    () => ({\n      ...INITIAL_STATE,\n      name: entityName\n        ? t('Weekly Report for %s', entityName)\n        : t('Weekly Report'),\n    }),\n    [entityName],\n  );\n\n  const reportReducer = useCallback(\n    (state: ReportObjectState | null, action: 'reset' | ReportObjectState) => {\n      if (action === 'reset') {\n        return initialState;\n      }\n      return {\n        ...state,\n        ...action,\n      };\n    },\n    [initialState],\n  );\n\n  const [currentReport, setCurrentReport] = useReducer(\n    reportReducer,\n    initialState,\n  );\n  const [cronError, setCronError] = useState<CronError>();\n\n  const dispatch = useDispatch();\n  // Report fetch logic\n  const report = useSelector<any, ReportObject>(state => {\n    const resourceType = dashboardId\n      ? CreationMethod.Dashboards\n      : CreationMethod.Charts;\n    return (\n      reportSelector(state, resourceType, dashboardId || chart?.id) ||\n      EMPTY_OBJECT\n    );\n  });\n  const isEditMode = report && Object.keys(report).length;\n\n  useEffect(() => {\n    if (isEditMode) {\n      setCurrentReport(report);\n    } else {\n      setCurrentReport('reset');\n    }\n  }, [isEditMode, report]);\n\n  const onSave = async () => {\n    // Create new Report\n    const newReportValues: Partial<ReportObject> = {\n      type: 'Report',\n      active: true,\n      force_screenshot: false,\n      custom_width: currentReport.custom_width,\n      creation_method: creationMethod,\n      dashboard: dashboardId,\n      chart: chart?.id,\n      owners: [userId],\n      recipients: [\n        {\n          recipient_config_json: {\n            target: userEmail,\n            ccTarget: ccEmail,\n            bccTarget: bccEmail,\n          },\n          type: 'Email',\n        },\n      ],\n      name: currentReport.name,\n      description: currentReport.description,\n      crontab: currentReport.crontab,\n      report_format: currentReport.report_format || defaultNotificationFormat,\n      timezone: currentReport.timezone,\n    };\n\n    setCurrentReport({ isSubmitting: true, error: undefined });\n    try {\n      if (isEditMode) {\n        await dispatch(\n          editReport(currentReport.id, newReportValues as ReportObject),\n        );\n      } else {\n        await dispatch(addReport(newReportValues as ReportObject));\n      }\n      onHide();\n    } catch (e) {\n      const { error } = await getClientErrorObject(e);\n      setCurrentReport({ error });\n    }\n    setCurrentReport({ isSubmitting: false });\n  };\n\n  const wrappedTitle = (\n    <StyledIconWrapper>\n      <Icons.Calendar />\n      <span className=\"text\">\n        {isEditMode ? t('Edit email report') : t('Schedule a new email report')}\n      </span>\n    </StyledIconWrapper>\n  );\n\n  const renderModalFooter = (\n    <>\n      <StyledFooterButton key=\"back\" onClick={onHide}>\n        {t('Cancel')}\n      </StyledFooterButton>\n      <StyledFooterButton\n        key=\"submit\"\n        buttonStyle=\"primary\"\n        onClick={onSave}\n        disabled={!currentReport.name}\n        loading={currentReport.isSubmitting}\n      >\n        {isEditMode ? t('Save') : t('Add')}\n      </StyledFooterButton>\n    </>\n  );\n\n  const renderMessageContentSection = (\n    <>\n      <StyledMessageContentTitle>\n        <h4>{t('Message content')}</h4>\n      </StyledMessageContentTitle>\n      <div className=\"inline-container\">\n        <StyledRadioGroup\n          onChange={(event: RadioChangeEvent) => {\n            setCurrentReport({ report_format: event.target.value });\n          }}\n          value={currentReport.report_format || defaultNotificationFormat}\n        >\n          {isTextBasedChart && (\n            <StyledRadio value={NotificationFormats.Text}>\n              {t('Text embedded in email')}\n            </StyledRadio>\n          )}\n          <StyledRadio value={NotificationFormats.PNG}>\n            {t('Image (PNG) embedded in email')}\n          </StyledRadio>\n          <StyledRadio value={NotificationFormats.CSV}>\n            {t('Formatted CSV attached in email')}\n          </StyledRadio>\n        </StyledRadioGroup>\n      </div>\n    </>\n  );\n  const renderCustomWidthSection = (\n    <StyledInputContainer>\n      <div className=\"control-label\" css={CustomWidthHeaderStyle}>\n        {t('Screenshot width')}\n      </div>\n      <div className=\"input-container\">\n        <Input\n          type=\"number\"\n          name=\"custom_width\"\n          value={currentReport?.custom_width || ''}\n          placeholder={t('Input custom width in pixels')}\n          onChange={(event: ChangeEvent<HTMLInputElement>) => {\n            setCurrentReport({\n              custom_width: parseInt(event.target.value, 10) || null,\n            });\n          }}\n        />\n      </div>\n    </StyledInputContainer>\n  );\n\n  return (\n    <StyledModal\n      show={show}\n      onHide={onHide}\n      title={wrappedTitle}\n      footer={renderModalFooter}\n      width=\"432\"\n      centered\n    >\n      <StyledTopSection>\n        <LabeledErrorBoundInput\n          id=\"name\"\n          name=\"name\"\n          value={currentReport.name || ''}\n          placeholder={initialState.name}\n          required\n          validationMethods={{\n            onChange: ({ target }: { target: HTMLInputElement }) =>\n              setCurrentReport({ name: target.value }),\n          }}\n          label={t('Report Name')}\n          data-test=\"report-name-test\"\n        />\n        <LabeledErrorBoundInput\n          id=\"description\"\n          name=\"description\"\n          value={currentReport?.description || ''}\n          validationMethods={{\n            onChange: ({ target }: { target: HTMLInputElement }) => {\n              setCurrentReport({ description: target.value });\n            },\n          }}\n          label={t('Description')}\n          placeholder={t(\n            'Include a description that will be sent with your report',\n          )}\n          css={noBottomMargin}\n          data-test=\"report-description-test\"\n        />\n      </StyledTopSection>\n\n      <StyledBottomSection>\n        <StyledScheduleTitle>\n          <h4 css={(theme: SupersetTheme) => SectionHeaderStyle(theme)}>\n            {t('Schedule')}\n          </h4>\n          <p>{t('The report will be sent to your email at')}</p>\n        </StyledScheduleTitle>\n\n        <StyledCronPicker\n          clearButton={false}\n          value={currentReport.crontab || '0 12 * * 1'}\n          setValue={(newValue: string) => {\n            setCurrentReport({ crontab: newValue });\n          }}\n          onError={setCronError}\n        />\n        <StyledCronError>{cronError}</StyledCronError>\n        <div\n          className=\"control-label\"\n          css={(theme: SupersetTheme) => TimezoneHeaderStyle(theme)}\n        >\n          {t('Timezone')}\n        </div>\n        <TimezoneSelector\n          timezone={currentReport.timezone}\n          onTimezoneChange={value => {\n            setCurrentReport({ timezone: value });\n          }}\n        />\n        {isChart && renderMessageContentSection}\n        {(!isChart || !isTextBasedChart) && renderCustomWidthSection}\n      </StyledBottomSection>\n      {currentReport.error && (\n        <Alert\n          type=\"error\"\n          css={(theme: SupersetTheme) => antDErrorAlertStyles(theme)}\n          message={\n            isEditMode\n              ? t('Failed to update report')\n              : t('Failed to create report')\n          }\n          description={currentReport.error}\n        />\n      )}\n    </StyledModal>\n  );\n}\n\nexport default withToasts(ReportModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useState, useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { isEmpty } from 'lodash';\nimport {\n  t,\n  SupersetTheme,\n  css,\n  styled,\n  useTheme,\n  FeatureFlag,\n  isFeatureEnabled,\n  getExtensionsRegistry,\n  usePrevious,\n} from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport { Switch } from 'src/components/Switch';\nimport { AlertObject } from 'src/features/alerts/types';\nimport { Menu } from 'src/components/Menu';\nimport Checkbox from 'src/components/Checkbox';\nimport { noOp } from 'src/utils/common';\nimport { NoAnimationDropdown } from 'src/components/Dropdown';\nimport DeleteModal from 'src/components/DeleteModal';\nimport ReportModal from 'src/features/reports/ReportModal';\nimport { ChartState } from 'src/explore/types';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport {\n  fetchUISpecificReport,\n  toggleActive,\n  deleteActiveReport,\n} from 'src/features/reports/ReportModal/actions';\nimport { reportSelector } from 'src/views/CRUD/hooks';\nimport { MenuItemWithCheckboxContainer } from 'src/explore/components/useExploreAdditionalActionsMenu/index';\n\nconst extensionsRegistry = getExtensionsRegistry();\n\nconst deleteColor = (theme: SupersetTheme) => css`\n  color: ${theme.colors.error.base};\n`;\n\nconst onMenuHover = (theme: SupersetTheme) => css`\n  & .ant-menu-item {\n    padding: 5px 12px;\n    margin-top: 0px;\n    margin-bottom: 4px;\n    :hover {\n      color: ${theme.colors.grayscale.dark1};\n    }\n  }\n  :hover {\n    background-color: ${theme.colors.secondary.light5};\n  }\n`;\n\nconst onMenuItemHover = (theme: SupersetTheme) => css`\n  &:hover {\n    color: ${theme.colors.grayscale.dark1};\n    background-color: ${theme.colors.secondary.light5};\n  }\n`;\n\nconst StyledDropdownItemWithIcon = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  > *:first-child {\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nconst DropdownItemExtension = extensionsRegistry.get(\n  'report-modal.dropdown.item.icon',\n);\n\nexport enum CreationMethod {\n  Charts = 'charts',\n  Dashboards = 'dashboards',\n}\nexport interface HeaderReportProps {\n  dashboardId?: number;\n  chart?: ChartState;\n  useTextMenu?: boolean;\n  setShowReportSubMenu?: (show: boolean) => void;\n  setIsDropdownVisible?: (visible: boolean) => void;\n  isDropdownVisible?: boolean;\n  showReportSubMenu?: boolean;\n}\n\n// Same instance to be used in useEffects\nconst EMPTY_OBJECT = {};\n\nexport default function HeaderReportDropDown({\n  dashboardId,\n  chart,\n  useTextMenu = false,\n  setShowReportSubMenu,\n  setIsDropdownVisible,\n  isDropdownVisible,\n  ...rest\n}: HeaderReportProps) {\n  const dispatch = useDispatch();\n  const report = useSelector<any, AlertObject>(state => {\n    const resourceType = dashboardId\n      ? CreationMethod.Dashboards\n      : CreationMethod.Charts;\n    return (\n      reportSelector(state, resourceType, dashboardId || chart?.id) ||\n      EMPTY_OBJECT\n    );\n  });\n\n  const isReportActive: boolean = report?.active || false;\n  const user: UserWithPermissionsAndRoles = useSelector<\n    any,\n    UserWithPermissionsAndRoles\n  >(state => state.user);\n  const canAddReports = () => {\n    if (!isFeatureEnabled(FeatureFlag.AlertReports)) {\n      return false;\n    }\n\n    if (!user?.userId) {\n      // this is in the case that there is an anonymous user.\n      return false;\n    }\n\n    // Cannot add reports if the resource is not saved\n    if (!(dashboardId || chart?.id)) {\n      return false;\n    }\n\n    const roles = Object.keys(user.roles || []);\n    const permissions = roles.map(key =>\n      user.roles[key].filter(\n        perms => perms[0] === 'menu_access' && perms[1] === 'Manage',\n      ),\n    );\n    return permissions.some(permission => permission.length > 0);\n  };\n\n  const [currentReportDeleting, setCurrentReportDeleting] =\n    useState<AlertObject | null>(null);\n  const theme = useTheme();\n  const prevDashboard = usePrevious(dashboardId);\n  const [showModal, setShowModal] = useState<boolean>(false);\n  const toggleActiveKey = async (data: AlertObject, checked: boolean) => {\n    if (data?.id) {\n      dispatch(toggleActive(data, checked));\n    }\n  };\n\n  const handleReportDelete = async (report: AlertObject) => {\n    await dispatch(deleteActiveReport(report));\n    setCurrentReportDeleting(null);\n  };\n\n  const shouldFetch =\n    canAddReports() &&\n    !!((dashboardId && prevDashboard !== dashboardId) || chart?.id);\n\n  useEffect(() => {\n    if (shouldFetch) {\n      dispatch(\n        fetchUISpecificReport({\n          userId: user.userId,\n          filterField: dashboardId ? 'dashboard_id' : 'chart_id',\n          creationMethod: dashboardId ? 'dashboards' : 'charts',\n          resourceId: dashboardId || chart?.id,\n        }),\n      );\n    }\n  }, []);\n\n  const showReportSubMenu = report && setShowReportSubMenu && canAddReports();\n\n  // @z-index-below-dashboard-header (100) - 1 = 99\n  const dropdownOverlayStyle = {\n    zIndex: 99,\n    animationDuration: '0s',\n  };\n\n  useEffect(() => {\n    if (showReportSubMenu) {\n      setShowReportSubMenu(true);\n    } else if (!report && setShowReportSubMenu) {\n      setShowReportSubMenu(false);\n    }\n  }, [report]);\n\n  const handleShowMenu = () => {\n    if (setIsDropdownVisible) {\n      setIsDropdownVisible(false);\n      setShowModal(true);\n    }\n  };\n\n  const handleDeleteMenuClick = () => {\n    if (setIsDropdownVisible) {\n      setIsDropdownVisible(false);\n      setCurrentReportDeleting(report);\n    }\n  };\n\n  const textMenu = () =>\n    isEmpty(report) ? (\n      <Menu selectable={false} {...rest} css={onMenuHover}>\n        <Menu.Item onClick={handleShowMenu}>\n          {DropdownItemExtension ? (\n            <StyledDropdownItemWithIcon>\n              <div>{t('Set up an email report')}</div>\n              <DropdownItemExtension />\n            </StyledDropdownItemWithIcon>\n          ) : (\n            t('Set up an email report')\n          )}\n        </Menu.Item>\n        <Menu.Divider />\n      </Menu>\n    ) : (\n      isDropdownVisible && (\n        <Menu selectable={false} css={{ border: 'none' }}>\n          <Menu.Item\n            css={onMenuItemHover}\n            onClick={() => toggleActiveKey(report, !isReportActive)}\n          >\n            <MenuItemWithCheckboxContainer>\n              <Checkbox checked={isReportActive} onChange={noOp} />\n              {t('Email reports active')}\n            </MenuItemWithCheckboxContainer>\n          </Menu.Item>\n          <Menu.Item css={onMenuItemHover} onClick={handleShowMenu}>\n            {t('Edit email report')}\n          </Menu.Item>\n          <Menu.Item css={onMenuItemHover} onClick={handleDeleteMenuClick}>\n            {t('Delete email report')}\n          </Menu.Item>\n        </Menu>\n      )\n    );\n  const menu = () => (\n    <Menu selectable={false} css={{ width: '200px' }}>\n      <Menu.Item>\n        {t('Email reports active')}\n        <Switch\n          data-test=\"toggle-active\"\n          checked={isReportActive}\n          onClick={(checked: boolean) => toggleActiveKey(report, checked)}\n          size=\"small\"\n          css={{ marginLeft: theme.gridUnit * 2 }}\n        />\n      </Menu.Item>\n      <Menu.Item onClick={() => setShowModal(true)}>\n        {t('Edit email report')}\n      </Menu.Item>\n      <Menu.Item\n        onClick={() => setCurrentReportDeleting(report)}\n        css={deleteColor}\n      >\n        {t('Delete email report')}\n      </Menu.Item>\n    </Menu>\n  );\n\n  const iconMenu = () =>\n    isEmpty(report) ? (\n      <span\n        role=\"button\"\n        title={t('Schedule email report')}\n        tabIndex={0}\n        className=\"action-button action-schedule-report\"\n        onClick={() => setShowModal(true)}\n      >\n        <Icons.Calendar />\n      </span>\n    ) : (\n      <>\n        <NoAnimationDropdown\n          overlay={menu()}\n          overlayStyle={dropdownOverlayStyle}\n          trigger={['click']}\n          getPopupContainer={(triggerNode: any) =>\n            triggerNode.closest('.action-button')\n          }\n        >\n          <span\n            role=\"button\"\n            className=\"action-button action-schedule-report\"\n            tabIndex={0}\n          >\n            <Icons.Calendar />\n          </span>\n        </NoAnimationDropdown>\n      </>\n    );\n\n  return (\n    <>\n      {canAddReports() && (\n        <>\n          <ReportModal\n            userId={user.userId}\n            show={showModal}\n            onHide={() => setShowModal(false)}\n            userEmail={user.email}\n            dashboardId={dashboardId}\n            chart={chart}\n            creationMethod={\n              dashboardId ? CreationMethod.Dashboards : CreationMethod.Charts\n            }\n          />\n          {useTextMenu ? textMenu() : iconMenu()}\n          {currentReportDeleting && (\n            <DeleteModal\n              description={t(\n                'This action will permanently delete %s.',\n                currentReportDeleting?.name,\n              )}\n              onConfirm={() => {\n                if (currentReportDeleting) {\n                  handleReportDelete(currentReportDeleting);\n                }\n              }}\n              onHide={() => setCurrentReportDeleting(null)}\n              open\n              title={t('Delete Report?')}\n            />\n          )}\n        </>\n      )}\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useState } from 'react';\nimport { nanoid } from 'nanoid';\nimport {\n  StrictBroadcastChannel,\n  TabIdChannelMessage,\n} from './strictBroadcastChannel';\n\nconst TAB_ID_CHANNEL_NAME = 'tab_id_channel';\n\nconst channel: StrictBroadcastChannel<TabIdChannelMessage> =\n  new BroadcastChannel(TAB_ID_CHANNEL_NAME);\n\nexport function useTabId() {\n  const [tabId, setTabId] = useState<string>();\n\n  function isStorageAvailable() {\n    try {\n      return window.localStorage && window.sessionStorage;\n    } catch (error) {\n      return false;\n    }\n  }\n  useEffect(() => {\n    if (!isStorageAvailable()) {\n      if (!tabId) {\n        setTabId(nanoid());\n      }\n      return;\n    }\n\n    const updateTabId = () => {\n      let lastTabId;\n      try {\n        lastTabId = window.localStorage.getItem('last_tab_id');\n      } catch (error) {\n        // continue regardless of error\n      }\n      const newTabId = String(\n        lastTabId ? Number.parseInt(lastTabId, 10) + 1 : 1,\n      );\n      try {\n        window.sessionStorage.setItem('tab_id', newTabId);\n        window.localStorage.setItem('last_tab_id', newTabId);\n      } catch (error) {\n        // continue regardless of error\n      }\n      setTabId(newTabId);\n    };\n    let storedTabId;\n    try {\n      storedTabId = window.sessionStorage.getItem('tab_id');\n    } catch (error) {\n      // continue regardless of error\n    }\n    if (storedTabId) {\n      channel.postMessage({\n        type: 'REQUESTING_TAB_ID',\n        tabId: storedTabId,\n      });\n      setTabId(storedTabId);\n    } else {\n      updateTabId();\n    }\n\n    channel.onmessage = messageEvent => {\n      if (messageEvent.data.tabId === tabId) {\n        if (messageEvent.data.type === 'REQUESTING_TAB_ID') {\n          const message: TabIdChannelMessage = {\n            type: 'TAB_ID_DENIED',\n            tabId: messageEvent.data.tabId,\n          };\n          channel.postMessage(message);\n        } else if (messageEvent.data.type === 'TAB_ID_DENIED') {\n          updateTabId();\n        }\n      }\n    };\n  }, [tabId]);\n\n  return tabId;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nexport const cacheWrapper =\n  <T extends Array<any>, U>(\n    fn: (...args: T) => U,\n    cache: Map<string, any>,\n    keyFn: (...args: T) => string = (...args: T) => JSON.stringify([...args]),\n  ) =>\n  (...args: T): U => {\n    const key = keyFn(...args);\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    const result = fn(...args);\n    cache.set(key, result);\n    return result;\n  };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { SupersetClient } from '@superset-ui/core';\nimport { cacheWrapper } from './cacheWrapper';\n\nexport const supersetGetCache = new Map<string, any>();\n\nexport const cachedSupersetGet = cacheWrapper(\n  SupersetClient.get,\n  supersetGetCache,\n  ({ endpoint }) => endpoint || '',\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SyntheticEvent } from 'react';\nimport domToImage from 'dom-to-image-more';\nimport { kebabCase } from 'lodash';\nimport { t, supersetTheme } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\n\n/**\n * generate a consistent file stem from a description and date\n *\n * @param description title or description of content of file\n * @param date date when file was generated\n */\nconst generateFileStem = (description: string, date = new Date()) =>\n  `${kebabCase(description)}-${date.toISOString().replace(/[: ]/g, '-')}`;\n\n/**\n * Create an event handler for turning an element into an image\n *\n * @param selector css selector of the parent element which should be turned into image\n * @param description name or a short description of what is being printed.\n *   Value will be normalized, and a date as well as a file extension will be added.\n * @param isExactSelector if false, searches for the closest ancestor that matches selector.\n * @returns event handler\n */\nexport default function downloadAsImage(\n  selector: string,\n  description: string,\n  isExactSelector = false,\n) {\n  return (event: SyntheticEvent) => {\n    const elementToPrint = isExactSelector\n      ? document.querySelector(selector)\n      : event.currentTarget.closest(selector);\n\n    if (!elementToPrint) {\n      return addWarningToast(\n        t('Image download failed, please refresh and try again.'),\n      );\n    }\n\n    // Mapbox controls are loaded from different origin, causing CORS error\n    // See https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL#exceptions\n    const filter = (node: Element) => {\n      if (typeof node.className === 'string') {\n        return (\n          node.className !== 'mapboxgl-control-container' &&\n          !node.className.includes('header-controls')\n        );\n      }\n      return true;\n    };\n\n    return domToImage\n      .toJpeg(elementToPrint, {\n        bgcolor: supersetTheme.colors.grayscale.light4,\n        filter,\n      })\n      .then((dataUrl: string) => {\n        const link = document.createElement('a');\n        link.download = `${generateFileStem(description)}.jpg`;\n        link.href = dataUrl;\n        link.click();\n      })\n      .catch((e: Error) => {\n        console.error('Creating image failed', e);\n      });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '@superset-ui/core';\n\nconst CREATE_CHART_TEXT = t('Create chart');\nconst UPDATE_CHART_TEXT = t('Update chart');\n\nexport const getChartRequiredFieldsMissingMessage = (isCreating: boolean) =>\n  t(\n    'Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.',\n    `\"${isCreating ? CREATE_CHART_TEXT : UPDATE_CHART_TEXT}\"`,\n  );\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  isAdhocColumn,\n  QueryObjectFilterClause,\n  SimpleAdhocFilter,\n} from '@superset-ui/core';\nimport {\n  Clauses,\n  ExpressionTypes,\n} from '../explore/components/controls/FilterControl/types';\nimport { OPERATOR_ENUM_TO_OPERATOR_TYPE } from '../explore/constants';\nimport { translateToSql } from '../explore/components/controls/FilterControl/utils/translateToSQL';\n\nexport const simpleFilterToAdhoc = (\n  filterClause: QueryObjectFilterClause,\n  clause: Clauses = Clauses.Where,\n) => {\n  let result: AdhocFilter;\n  if (isAdhocColumn(filterClause.col)) {\n    result = {\n      expressionType: 'SQL',\n      clause,\n      sqlExpression: translateToSql({\n        expressionType: ExpressionTypes.Simple,\n        subject: `(${filterClause.col.sqlExpression})`,\n        operator: filterClause.op,\n        comparator: 'val' in filterClause ? filterClause.val : undefined,\n      } as SimpleAdhocFilter),\n    };\n  } else {\n    result = {\n      expressionType: 'SIMPLE',\n      clause,\n      operator: filterClause.op,\n      operatorId: Object.entries(OPERATOR_ENUM_TO_OPERATOR_TYPE).find(\n        operatorEntry => operatorEntry[1].operation === filterClause.op,\n      )?.[0],\n      subject: filterClause.col,\n      comparator: 'val' in filterClause ? filterClause.val : undefined,\n    } as SimpleAdhocFilter;\n  }\n  if (filterClause.isExtra) {\n    Object.assign(result, {\n      isExtra: true,\n      filterOptionName: `filter_${Math.random()\n        .toString(36)\n        .substring(2, 15)}_${Math.random().toString(36).substring(2, 15)}`,\n    });\n  }\n  return result;\n};\n"],"names":["ChartSource","DrillByType","DrillByChart","formData","result","dataset","onContextMenu","inContextMenu","hooks","useMemo","_jsx","css","children","SuperChart","disableErrorBoundary","chartType","viz_type","enableNoResults","datasource","queriesData","height","width","BreadcrumbItem","styled","AntdBreadcrumb","Item","theme","isClickable","isHidden","colors","grayscale","light1","transitionTiming","dark1","PaginationContainer","div","gridUnit","DEFAULT_ADHOC_FILTER_FIELD_NAME","ModalFooter","closeModal","dispatch","useDispatch","addDangerToast","useToasts","useTheme","url","setUrl","useState","dashboardPageId","useContext","DashboardPageIdContext","onEditChartClick","useCallback","logEvent","LOG_ACTIONS_DRILL_BY_EDIT_CHART","slice_id","canExplore","useSelector","state","_state$user","findPermission","user","roles","datasource_id","datasource_type","split","useEffect","postFormData","Number","then","key","catch","t","isEditDisabled","_jsxs","_Fragment","Button","buttonStyle","buttonSize","onClick","disabled","tooltip","undefined","Link","to","DrillByModal","column","drillByConfig","onHideModal","canDownload","isChartDataLoading","setIsChartDataLoading","drillByConfigs","setDrillByConfigs","LOG_ACTIONS_DRILL_BY_MODAL_OPENED","currentColumn","groupbyFieldName","length","initialGroupbyColumns","ensureIsArray","map","colName","_dataset$columns","columns","find","col","column_name","filter","isDefined","displayModeToggle","drillByDisplayMode","useDisplayModeToggle","setDrillByDisplayMode","Chart","Radio","Group","onChange","target","value","defaultValue","Table","chartDataResult","setChartDataResult","resultsTable","useResultsTableView","datasourceId","SingleQueryResultPane","colnames","coltypes","rowcount","sql_rowcount","data","dataSize","isVisible","Tabs","fullWidth","res","index","TabPane","tab","currentFormData","setCurrentFormData","usedGroupbyColumns","setUsedGroupbyColumns","breadcrumbsData","setBreadcrumbsData","groupby","filters","getNewGroupby","groupbyCol","fieldName","Array","isArray","getFormDataChangesFromConfigs","configs","reduce","acc","config","overridenGroupbyFields","add","adhocFilterFieldName","simpleFilterToAdhoc","overridenAdhocFilterFields","Set","getFiltersFromConfigsByFieldName","breadcrumbs","useDrillByBreadcrumbs","onBreadcrumbClick","noOp","getBreadcrumbText","breadcrumb","verbose_name","join","formattedVal","val","breadcumb","item","props","LOG_ACTIONS_DRILL_BY_BREADCRUMB_CLICKED","prevConfigs","slice","prevBreadcrumbs","newBreadcrumbs","prevUsedGroupbyColumns","overrideFormData","newFormData","forEach","adhocFilterField","drilledFormData","updatedFormData","adhocFilters","Object","keys","slice_name","dashboards","usedCols","some","usedCol","onSelection","newColumn","LOG_ACTIONS_FURTHER_DRILL_BY","drill_depth","additionalConfig","drillBy","excludedColumns","openNewModal","contextMenu","useContextMenu","chartId","displayedItems","contextMenuRef","useRef","setInContextMenu","handleContextMenuSelected","args","handleContextMenuClosed","ChartContextMenu","ref","id","onClose","offsetX","offsetY","_contextMenuRef$curre","current","open","ContextMenuItem","DrillBy","chartName","chartLayoutItem","values","dashboardLayout","present","layoutItem","_layoutItem$meta","meta","sliceNameOverride","sliceName","useLegacyApi","getQuerySettings","getChartDataRequest","response","json","handleChartDataResponse","queriesResponse","finally","metadataBar","useDatasetMetadataBar","Modal","show","onHide","title","footer","responsive","resizable","resizableConfig","minHeight","minWidth","defaultSize","draggable","destroyOnClose","maskClosable","Loading","Alert","type","message","loadDrillByOptions","getExtensionsRegistry","get","queryString","rison","DrillByMenuItems","contextMenuY","submenuIndex","rest","isLoadingColumns","setIsLoadingColumns","searchInput","setSearchInput","setDataset","setColumns","showModal","setShowModal","setCurrentColumn","showSearch","handleSelection","event","_ref$current","_ref$current2","input","focus","setValue","hasDrillBy","handlesDimensionContextMenu","_getChartMetadataRegi","getChartMetadataRegistry","behaviors","behavior","Behavior","verboseMap","useVerboseMap","verbose_map","metrics","metric","metric_name","async","datasetId","cachedSupersetGet","endpoint","_drillByConfig$groupb","_ensureIsArray","includes","x_axis","every","excludedCol","error","logging","supersetGetCache","delete","loadOptions","handleInput","_debounce","FAST_DEBOUNCE","filteredColumns","toLowerCase","submenuYOffset","getSubmenuYOffset","Menu","SubMenu","popupClassName","popupOffset","Input","prefix","Icons","Search","iconSize","iconColor","e","stopPropagation","placeholder","nativeEvent","stopImmediatePropagation","allowClear","position","List","itemSize","itemCount","itemData","overscanCount","Row","style","MenuItemWithTruncation","tooltipText","MenuItemTooltip","All","_getChartMetadataRegi2","canWriteExploreFormData","_state$user2","canDatasourceSamples","_state$user3","_state$user4","canDrill","_state$user5","canDrillBy","canDrillToDetail","crossFiltersEnabled","dashboardInfo","openKeys","setOpenKeys","isDisplayed","clientX","clientY","setState","drillModalIsOpen","setDrillModalIsOpen","menuItems","showDrillToDetail","isFeatureEnabled","FeatureFlag","DrillToDetail","showDrillBy","showCrossFilters","DashboardCrossFilters","CrossFilter","isCrossFilteringSupportedByChart","InteractiveChart","itemsCount","_filters$crossFilter","isCrossFilterDisabled","crossFilter","crossFilteringTooltipTitle","push","updateDataMask","dataMask","isCurrentValueSelected","color","base","Divider","DrillDetailMenuItems","drillToDetail","isContextMenu","_document$getElementB","adjustedY","getMenuAdjustedY","document","getElementById","click","useImperativeHandle","ReactDOM","Dropdown","overlay","className","onOpenChange","trigger","onVisibleChange","_css","visibility","top","left","body","forwardRef","propTypes","annotationData","PropTypes","actions","isRequired","initialValues","latestQueryFormData","labelsColor","labelsColorMap","setControlValue","vizType","triggerRender","chartAlert","chartStatus","triggerQuery","chartIsStale","addFilter","setDataMask","onFilterMenuOpen","onFilterMenuClose","ownState","postTransformProps","source","Dashboard","Explore","emitCrossFilters","BLANK","defaultProps","ChartRenderer","Component","constructor","super","this","showContextMenu","legendState","hasQueryResponseChange","createRef","handleAddFilter","bind","handleRenderSuccess","handleRenderFailure","handleSetControlValue","handleOnContextMenu","handleLegendStateChanged","onContextMenuFallback","onAddFilter","onError","onLegendStateChanged","_this$props$actions","mutableQueriesResponse","_cloneDeep","shouldComponentUpdate","nextProps","nextState","_nextProps$queriesRes","_nextProps$queriesRes2","indexOf","_isEqual","filterState","color_scheme","stack","cacheBusterProp","vals","merge","refresh","chartRenderingSucceeded","LOG_ACTIONS_RENDER_CHART","start_offset","renderStartTime","ts","Date","getTime","duration","Logger","getTimestamp","info","warn","chartRenderingFailed","toString","componentStack","has_err","error_details","preventDefault","render","_ownState$searchText","snakeCaseVizType","_snakeCase","chartClassName","noResultsComponent","noResultTitle","noResultDescription","noResultImage","EmptyStateBig","description","image","EmptyStateSmall","drillToDetailProps","bypassNoResult","server_pagination","searchText","onRenderSuccess","onRenderFailure","noResults","ChartErrorMessage","owners","useChartOwnerNames","ownedError","extra","ErrorMessageWithStackTrace","dashboardId","timeout","force","isFiltersInitialized","chartStackTrace","errorMessage","onQuery","datasetsStatus","isInView","NONEXISTENT_DATASET","Styles","p","typography","sizes","s","LoadingDiv","MessageSpan","span","MonospaceDiv","families","monospace","PureComponent","handleRenderContainerFailure","componentDidMount","runQuery","componentDidUpdate","postChartFormData","Boolean","getUrlParam","URL_PARAMS","renderErrorMessage","queryResponse","_queryResponse$errors","errors","PLACEHOLDER_DATASOURCE","ResourceStatus","Error","subtitle","copyText","link","stackTrace","renderSpinner","databaseName","renderChartContainer","DashboardVirtualization","isCurrentUserBot","_datasource$database","database","name","isLoading","renderContainerStartTime","getChartRequiredFieldsMissingMessage","ErrorBoundary","showMessage","role","tabIndex","connect","bindActionCreators","CUSTOM_OPERATIONS","CUSTOM_OPERATORS","op","OPERATOR_ENUM_TO_OPERATOR_TYPE","operation","AdhocFilter","adhocFilter","_adhocFilter$operator","expressionType","ExpressionTypes","Simple","subject","operator","toUpperCase","operatorId","comparator","Operators","IsTrue","IsFalse","IsNull","IsNotNull","clause","Clauses","Where","sqlExpression","Sql","translateToSql","useSimple","isExtra","isNew","datasourceWarning","filterOptionName","Math","random","substring","duplicateWith","nextFields","equals","isValid","nullCheckOperators","truthCheckOperators","getDefaultLabel","label","getTooltipTitle","AdhocFilterOption","options","onFilterEdit","onRemoveFilter","partitionColumn","onMoveLabel","onDropLabel","sections","operators","actualTimeRange","useGetTimeRangeLabel","AdhocFilterPopoverTrigger","OptionControlLabel","tooltipTitle","onRemove","DndItemType","FilterOption","withCaret","Having","warning","selectedMetricType","adhocMetricType","adhocFilterType","columnType","savedMetrics","savedMetricType","selectedMetrics","canDelete","isDictionaryForAdhocFilter","AdhocFilterControl","optionsForSelect","onNewFilter","moveLabel","mapOption","getMetricExpression","removeFilter","optionRenderer","option","FilterDefinitionOption","valueRenderer","dbId","datasource_name","catalog","schema","is_sqllab_view","isSqllabView","SupersetClient","toQueryString","partitions","cols","statusText","UNSAFE_componentWillReceiveProps","valuesCopy","splice","prevState","content","newFilter","mappedOption","changedFilter","opts","savedMetricName","savedMetric","expression","dragIndex","hoverIndex","newValues","saved_metric_name","GreaterThan","AdhocMetric","Equals","results","sort","a","b","localeCompare","addNewFilterPopoverTrigger","HeaderContainer","ControlHeader","AddIconButton","PlusLarge","light5","LabelsContainer","AddControlLabel","PlusSmall","withTheme","EXPRESSION_TYPES","SIMPLE","SQL","inferSqlExpressionColumn","adhocMetric","sqlaAutoGeneratedMetricRegex","test","indexFirstCloseParen","indexPairedOpenParen","lastIndexOf","inferSqlExpressionAggregate","indexFirstOpenParen","inferredColumn","aggregate","hasCustomLabel","optionName","useVerboseName","params","transformCountDistinct","_this$column","_this$column2","AGGREGATES","COUNT_DISTINCT","StyledColumnOption","showType","CopyButtonEmbedCode","CopyButton","EmbedCodeContent","setHeight","setWidth","setErrorMessage","handleInputChange","currentTarget","updateUrl","getChartPermalink","html","srcLink","standalone","text","CopyToClipboard","shouldShowText","copyNode","TextArea","rows","readOnly","secondary","htmlFor","DashboardsSubMenu","menuProps","dashboardSearch","setDashboardSearch","hoveredItem","setHoveredItem","filteredDashboards","dashboard","dashboard_title","noResultsFound","urlQueryString","onMouseEnter","onMouseLeave","rel","Full","String","MENU_KEYS","VIZ_TYPES_PIVOTABLE","MenuItemWithCheckboxContainer","iconReset","primary","dark2","useExploreAdditionalActionsMenu","canDownloadCSV","onOpenInEditor","onOpenPropertiesModal","addSuccessToast","showReportSubMenu","setShowReportSubMenu","isDropdownVisible","setIsDropdownVisible","chart","_state$charts","charts","getChartKey","explore","shareByEmail","encodeURIComponent","window","location","href","exportCSV","exportChart","resultType","resultFormat","exportCSVPivoted","exportJson","exportExcel","copyLink","copyTextToClipboard","handleMenuClick","domEvent","_slice$slice_name","LOG_ACTIONS_CHART_DOWNLOAD_AS_CSV","LOG_ACTIONS_CHART_DOWNLOAD_AS_CSV_PIVOTED","LOG_ACTIONS_CHART_DOWNLOAD_AS_JSON","LOG_ACTIONS_CHART_DOWNLOAD_AS_XLS","downloadAsImage","LOG_ACTIONS_CHART_DOWNLOAD_AS_IMAGE","metaKey","selectable","icon","FileOutlined","FileImageOutlined","EmbeddableCharts","ModalTrigger","triggerNode","modalTitle","modalBody","maxWidth","HeaderReportDropDown","useTextMenu","ViewQueryModal","concat","keyword","score","SQL_KEYWORD_AUTOCOMPLETE_SCORE","Tooltip","placement","InfoCircleOutlined","BOOL_TRUE_DISPLAY","BOOL_FALSE_DISPLAY","NULL_DISPLAY","format","TimeFormats","DATABASE_DATETIME","getTimeFormatter","NullCell","headerTitle","groupTitle","groupOptions","popoverVisible","setPopoverVisible","Popover","visible","weights","bold","Space","direction","arrowPointAtCenter","SettingOutlined","TableControls","setFilters","totalCount","loading","onReload","filterMap","assign","isAdhocColumn","updatedFilterMap","filterTags","entries","Tag","closable","RowCountLabel","ReloadOutlined","PAGE_SIZE","TimeFormatting","_ref","styles","Resizable","useResizeDetector","cloneElement","DrillDetailPane","initialFilters","_formData$allow_rende","pageIndex","setPageIndex","lastPageIndex","setIsLoading","responseError","setResponseError","resultsPages","setResultsPages","Map","timeFormatting","setTimeFormatting","SAMPLES_ROW_LIMIT","common","conf","datasourceType","status","metadataBarStatus","resultsPage","nextResultsPage","mappedColumns","colNames","dataIndex","colTypes","GenericDataType","Temporal","HeaderWithRadioGroup","Original","Formatted","BooleanCell","TimeCell","row","curr","handleReload","has","at","nextResultsPages","set","_getDrillPayload","jsonPayload","queryFormData","drillFilters","queryObject","buildQueryObject","extras","_omit","f","granularity","time_range","getDrillPayload","cachePageLimit","ceil","getDatasourceSamples","total","total_count","bootstrapping","size","allowHTML","allow_render_html","tableContent","EmptyStateMedium","TableSize","Small","defaultPageSize","recordCount","usePagination","pagination","virtualize","exploreChart","DrillDetailModal","history","useHistory","sliceEntities","slices","exploreUrl","DRILL_TO_DETAIL","DRILL_TO_DETAIL_BY","DISABLED_REASONS","DATABASE","NO_AGGREGATIONS","NO_FILTERS","NOT_SUPPORTED","DisabledMenuItem","StyledFilter","Filter","stripHTML","removeHTMLTags","drillToDetailMenuRef","drillToDetailDisabled","datasources","_datasources$formData","_datasources$formData2","disable_drill_to_detail","modalFilters","openModal","noAggregations","extractQueryFields","_isEmpty","drillDisabled","drillByDisabled","drillToDetailMenuItem","_createElement","drillToDetailByMenuItem","i","itemRef","itemIsTruncated","useCSSTextTruncation","truncationCSS","maxItemsContainerHeight","MAX_SAFE_INTEGER","additionalItemsHeight","vh","max","documentElement","clientHeight","innerHeight","menuHeight","min","submenuY","CheckboxChecked","viewBox","fill","xmlns","d","CheckboxHalfChecked","CheckboxUnchecked","light2","Checkbox","checked","MenuDots","normal","MenuDotsWrapper","IconOrientation","RenderIcon","iconOrientation","Vertical","Horizontal","MoreHoriz","AntdDropdown","NoAnimationDropdown","onBlur","onKeyDown","childrenWithProps","overlayStyle","localCache","cacheWrapper","tagToSelectOption","tag","loadTags","search","page","pageSize","searchColumn","query","opr","page_size","order_column","order_direction","count","getErrorMessage","errorText","getClientErrorObject","getDefaultRowLimit","_bootstrapData$common","_bootstrapData$common2","bootstrapData","getBootstrapData","NATIVE_FILTER_DEFAULT_ROW_LIMIT","getFormData","dependencies","defaultDataMask","controlValues","filterType","sortMetric","adhoc_filters","granularity_sqla","_defaultDataMask$filt","otherProps","extra_filters","extra_form_data","row_limit","url_params","extractUrlParams","inView","native_filter_id","mergeExtraFormData","originalExtra","newExtra","mergedExtra","EXTRA_FORM_DATA_APPEND_KEYS","mergedValues","EXTRA_FORM_DATA_OVERRIDE_KEYS","originalValue","newValue","getExtraFormData","filterIdsAppliedOnChart","extraFormData","_dataMask$key$extraFo","_dataMask$key","nativeFilterGate","NativeFilter","isComponentATab","componentId","_dashboardLayout$comp","TAB_TYPE","findTabsWithChartsInScopeHelper","chartsInScope","tabIds","tabsToHighlight","visited","_dashboardLayout$comp2","_dashboardLayout$comp3","_dashboardLayout$comp4","_dashboardLayout$comp5","_dashboardLayout$comp6","_dashboardLayout$comp7","CHART_TYPE","childId","findTabsWithChartsInScope","rootChildId","DASHBOARD_ROOT_ID","hasTopLevelTabs","DASHBOARD_GRID_ID","tabsInScope","_dashboardLayout$root","_dashboardLayout$root2","tabId","element","getFilterValueForDisplay","JSON","stringify","getEffectiveExtraFilters","cachedFiltersByChart","cachedFormdataByChart","getFormDataWithExtraFilters","nativeFilters","chartConfiguration","colorScheme","colorNamespace","sliceId","extraControls","allSliceIds","cachedFormData","areObjectsEqual","ignoreUndefined","color_namespace","label_colors","shared_label_colors","extraData","activeFilters","getAllActiveFilters","scope","filterId","form_data","CellNull","CopyToClipboardButton","prepareCopyToClipboardTabularData","wrapped","CopyOutlined","FilterInput","onChangeHandler","shouldFocus","inputRef","debouncedChangeHandler","SLOW_DEBOUNCE","filterText","FormatPickerValue","FormatPicker","FormatPickerContainer","FormatPickerLabel","DataTableTemporalHeaderCell","columnName","onTimeColumnChange","isOriginalTimeColumn","overlayContent","Global","overlayClassName","marginRight","useFilteredTableData","rowsAsStrings","_data$map","_","timeFormatter","useTableColumns","moreConfigs","originalFormattedTimeColumns","setOriginalFormattedTimeColumns","getTimeColumns","setTimeColumns","colType","firstValue","originalFormattedTimeColumnIndex","accessor","Header","Cell","safeHtmlSpan","colsMap","getItem","LocalStorageKeys","ExploreDataTableOriginalFormattedTimeColumns","setItem","TableControlsWrapper","onInputChange","columnNames","columnTypes","originalTimeColumns","formattedTimeColumns","_zip","colname","formattedData","applyFormattingToTabularData","setFilterText","filteredData","TableView","noDataText","emptyWrapperType","EmptyWrapperType","isPaginationSticky","showRowCount","small","ResultTypes","pre","cache","WeakMap","useResultsPane","isRequest","queryForce","_metadata$queryObject","metadata","resultResp","setResultResp","queryCount","queryObjectCount","setForceQuery","err","idx","Wrapper","ResultsPaneOnDashboard","resultsPanes","panes","pane","Results","WeakSet","SamplesPane","setData","setColnames","setColtypes","setRowCount","SouthPane","DataTablesPane","onCollapseChange","activeTabKey","setActiveTabKey","setIsRequest","samples","panelOpen","setPanelOpen","DatapanelClosedByDefault","IsDatapanelOpen","startsWith","Samples","handleCollapseChange","isOpen","handleTabClick","tabKey","CollapseButton","caretIcon","CaretUp","CaretDown","queryResultsPanes","tabBarExtraContent","activeKey","onTabClick","ExplorePopoverContent","limitReachedMsg","limit","limitReached","formattedRowCount","getNumberFormatter","Label","tn","ColorSchemeLabel","showTooltip","setShowTooltip","labelNameRef","labelsColorRef","colorsList","tooltipContent","handleShowTooltip","labelNameElement","labelsColorElement","scrollWidth","offsetWidth","scrollHeight","offsetHeight","handleHideTooltip","Option","OptGroup","AntdSelect","StyledAlert","AlertSolid","alert","CUSTOM_LABEL_ALERT","DASHBOARD_ALERT","hasCustomLabelsColor","alertTitle","ColorSchemeControl","clearable","defaultScheme","choices","schemes","isLinear","currentScheme","_schemesObject$SUPERS","schemesObject","_isFunction","SUPERSET_DEFAULT","controlChoices","allColorOptions","groups","o","isValidColorOption","_schemesObject$value","_currentScheme$group","getColors","customLabel","group","ColorSchemeGroup","Other","Custom","Featured","nonEmptyGroups","_sortBy","opt","groupIndex","optIndex","StyledSelect","m","getPopupContainer","parentNode","filterOption","handleFilterOptionHelper","INITIAL_ADVANCED_DATA_TYPES_STATE","parsedAdvancedDataType","advancedDataTypeOperatorList","StyledInput","SelectWithLabel","FormItem","Select","labelText","_props$operators","_props$operators2","onSubjectChange","onOperatorChange","isOperatorRelevant","onComparatorChange","onDatePickerChange","useSimpleTabFilterProps","defaultTimeFilter","useDefaultTimeFilter","_props$datasource$col","isColumnBoolean","isColumnNumber","isColumnFunction","LatestPartition","TemporalRange","HAVING_OPERATORS","In","isTemporalColumn","currentComparator","newComparator","MULTI_OPERATORS","clearOperator","timeRange","suggestions","setSuggestions","setComparator","loadingComparatorSuggestions","setLoadingComparatorSuggestions","advancedDataTypesState","subjectAdvancedDataType","fetchAdvancedDataTypeValueCallback","fetchSubjectAdvancedDataType","useAdvancedDataTypes","validHandler","setAdvancedDataTypesState","setSubjectAdvancedDataType","comp","display_value","valid_filter_operators","error_message","advanced_data_type","isOperatorRelevantWrapper","createSuggestionsPlaceholder","optionsRemaining","getOptionsRemaining","valuesFromSuggestionsLength","v","subjectSelectProps","ariaLabel","notFoundContent","autoFocus","operatorSelectProps","OPERATORS_OPTIONS","shouldFocusComparator","comparatorSelectProps","allowNewOptions","mode","DISABLE_INPUT_OPERATORS","datePicker","useDatePickerInAdhocFilter","refreshComparatorSuggestions","having","filter_select","controller","AbortController","signal","abort","suggestion","optionLabel","EnableAdvancedDataTypes","subjectComponent","marginTop","marginBottom","renderSubjectOptionLabel","operatorsAndOperandComponent","display","order","AdhocFilterEditPopoverSqlTabContent","onSqlExpressionChange","onSqlExpressionClauseChange","handleAceEditorRef","aceEditorRef","editor","resize","keywords","sqlKeywords","selectOptions","SQLEditor","showGutter","editorProps","$blockScrolling","enableLiveAutocompletion","wrapEnabled","onResize","requireSave","ResizeIcon","FilterPopoverContentContainer","xs","FilterActionsContainer","AdhocFilterEditPopover","_this$props","_this$props$adhocFilt","onSave","onDragDown","onMouseMove","onMouseUp","onAdhocFilterChange","setSimpleTabIsValid","adjustHeight","onTabChange","POPOVER_INITIAL_WIDTH","POPOVER_INITIAL_HEIGHT","isSimpleTabValid","popoverContentRef","addEventListener","componentWillUnmount","removeEventListener","dragStartX","dragStartY","dragStartWidth","dragStartHeight","heightDifference","propsAdhocFilter","popoverProps","stateIsValid","hasUnsavedChanges","defaultActiveKey","allowOverflow","AdhocFilterEditPopoverSimpleTabContent","onHeightChange","popoverRef","cta","onMouseDown","onPopoverResize","closePopover","togglePopover","forceUpdate","isControlledComponent","ControlPopover","defaultVisible","destroyTooltipOnHide","setActualTimeRange","NO_TIME_RANGE","fetchTimeRange","DateFilterControl","OPERATORS_TO_SQL","IN","LIKE","ILIKE","REGEX","LATEST PARTITION","isSimpleAdhocFilter","getSimpleSQLExpression","isFreeFormAdhocFilter","DragContainer","OptionControlContainer","light3","LabelText","CaretContainer","CloseContainer","StyledInfoTooltipWithTrigger","InfoTooltipWithTrigger","borderPulse","keyframes","DndLabelsContainer","canDrop","isDragging","isOver","zIndex","aboveDashboardCharts","opacity","light","dropdown","mediumLight","cancelHover","light4","button","isFunction","datasourceWarningMessage","multi","labelRef","hasMetricName","drop","useDrop","accept","hover","monitor","hoverBoundingRect","getBoundingClientRect","hoverMiddleY","bottom","clientOffset","getClientOffset","hoverClientY","y","drag","useDrag","collect","XSmall","FieldDerived","getLabelContent","shouldShowTooltip","clientWidth","StyledMetricOption","bsStyle","CaretRight","CopyButtonViewQuery","SyntaxHighlighter","registerLanguage","markdownSyntax","htmlSyntax","sqlSyntax","jsonSyntax","StyledSyntaxContainer","StyledSyntaxHighlighter","sql","language","github","ViewQueryModalContainer","setResult","setError","ViewQuery","TEMPORARY_CONTROLS","sanitizeFormData","assembleEndpoint","assemblePayload","payload","chart_id","post","r","putFormData","put","datasetProps","setStatus","Complete","items","_created_by$first_nam","_created_by$last_name","changed_on_humanized","created_on_humanized","table_name","changed_by","created_by","notAvailable","createdBy","first_name","last_name","trim","modifiedBy","formattedOwners","owner","MetadataType","LastModified","Owner","createdOn","Description","MetadataBar","tooltipPlacement","ReportType","NotificationFormats","StyledModal","StyledTopSection","StyledBottomSection","StyledIconWrapper","StyledScheduleTitle","StyledCronPicker","CronPicker","StyledCronError","noBottomMargin","StyledFooterButton","CustomWidthHeaderStyle","StyledMessageContentTitle","StyledRadio","StyledRadioGroup","TEXT_BASED_VISUALIZATION_TYPES","INITIAL_STATE","crontab","EMPTY_OBJECT","withToasts","userId","userEmail","ccEmail","bccEmail","creationMethod","dashboardName","_chart$sliceFormData","sliceFormData","isChart","isTextBasedChart","defaultNotificationFormat","Text","PNG","entityName","initialState","reportReducer","action","currentReport","setCurrentReport","useReducer","cronError","setCronError","report","resourceType","CreationMethod","Dashboards","Charts","reportSelector","isEditMode","wrappedTitle","Calendar","renderModalFooter","newReportValues","active","force_screenshot","custom_width","creation_method","recipients","recipient_config_json","ccTarget","bccTarget","report_format","timezone","isSubmitting","editReport","addReport","renderMessageContentSection","CSV","renderCustomWidthSection","StyledInputContainer","parseInt","centered","LabeledErrorBoundInput","required","validationMethods","SectionHeaderStyle","clearButton","TimezoneHeaderStyle","TimezoneSelector","onTimezoneChange","antDErrorAlertStyles","l","extensionsRegistry","deleteColor","onMenuHover","onMenuItemHover","StyledDropdownItemWithIcon","DropdownItemExtension","_ref2","isReportActive","canAddReports","AlertReports","perms","permission","currentReportDeleting","setCurrentReportDeleting","prevDashboard","usePrevious","toggleActiveKey","toggleActive","shouldFetch","fetchUISpecificReport","filterField","resourceId","handleShowMenu","ReportModal","email","handleDeleteMenuClick","Switch","marginLeft","animationDuration","closest","DeleteModal","onConfirm","deleteActiveReport","handleReportDelete","channel","BroadcastChannel","useTabId","setTabId","localStorage","sessionStorage","isStorageAvailable","nanoid","updateTabId","lastTabId","newTabId","storedTabId","postMessage","onmessage","messageEvent","fn","keyFn","generateFileStem","date","_kebabCase","toISOString","replace","selector","isExactSelector","elementToPrint","querySelector","domToImage","bgcolor","supersetTheme","node","dataUrl","createElement","download","console","addWarningToast","CREATE_CHART_TEXT","UPDATE_CHART_TEXT","isCreating","filterClause","_Object$entries$find","operatorEntry"],"sourceRoot":""}